(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))I(E);new MutationObserver(E=>{for(const z of E)if(z.type==="childList")for(const P of z.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&I(P)}).observe(document,{childList:!0,subtree:!0});function T(E){const z={};return E.integrity&&(z.integrity=E.integrity),E.referrerPolicy&&(z.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?z.credentials="include":E.crossOrigin==="anonymous"?z.credentials="omit":z.credentials="same-origin",z}function I(E){if(E.ep)return;E.ep=!0;const z=T(E);fetch(E.href,z)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Xp(c){const y=Object.create(null);for(const T of c.split(","))y[T]=1;return T=>T in y}const hn={},Vu=[],Ma=()=>{},yb=()=>!1,Bf=c=>c.charCodeAt(0)===111&&c.charCodeAt(1)===110&&(c.charCodeAt(2)>122||c.charCodeAt(2)<97),Wp=c=>c.startsWith("onUpdate:"),Ir=Object.assign,Yp=(c,y)=>{const T=c.indexOf(y);T>-1&&c.splice(T,1)},vb=Object.prototype.hasOwnProperty,Xi=(c,y)=>vb.call(c,y),pi=Array.isArray,Uu=c=>jf(c)==="[object Map]",My=c=>jf(c)==="[object Set]",Ii=c=>typeof c=="function",Dn=c=>typeof c=="string",Go=c=>typeof c=="symbol",bn=c=>c!==null&&typeof c=="object",Ay=c=>(bn(c)||Ii(c))&&Ii(c.then)&&Ii(c.catch),Ry=Object.prototype.toString,jf=c=>Ry.call(c),xb=c=>jf(c).slice(8,-1),Ly=c=>jf(c)==="[object Object]",Kp=c=>Dn(c)&&c!=="NaN"&&c[0]!=="-"&&""+parseInt(c,10)===c,Yc=Xp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Vf=c=>{const y=Object.create(null);return T=>y[T]||(y[T]=c(T))},bb=/-(\w)/g,Bs=Vf(c=>c.replace(bb,(y,T)=>T?T.toUpperCase():"")),wb=/\B([A-Z])/g,ql=Vf(c=>c.replace(wb,"-$1").toLowerCase()),Uf=Vf(c=>c.charAt(0).toUpperCase()+c.slice(1)),Qd=Vf(c=>c?`on${Uf(c)}`:""),Fo=(c,y)=>!Object.is(c,y),ep=(c,...y)=>{for(let T=0;T<c.length;T++)c[T](...y)},Cp=(c,y,T,I=!1)=>{Object.defineProperty(c,y,{configurable:!0,enumerable:!1,writable:I,value:T})},Tb=c=>{const y=parseFloat(c);return isNaN(y)?c:y},Sb=c=>{const y=Dn(c)?Number(c):NaN;return isNaN(y)?c:y};let o_;const Gf=()=>o_||(o_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Wu(c){if(pi(c)){const y={};for(let T=0;T<c.length;T++){const I=c[T],E=Dn(I)?Cb(I):Wu(I);if(E)for(const z in E)y[z]=E[z]}return y}else if(Dn(c)||bn(c))return c}const Ib=/;(?![^(]*\))/g,kb=/:([^]+)/,Eb=/\/\*[^]*?\*\//g;function Cb(c){const y={};return c.replace(Eb,"").split(Ib).forEach(T=>{if(T){const I=T.split(kb);I.length>1&&(y[I[0].trim()]=I[1].trim())}}),y}function Jp(c){let y="";if(Dn(c))y=c;else if(pi(c))for(let T=0;T<c.length;T++){const I=Jp(c[T]);I&&(y+=I+" ")}else if(bn(c))for(const T in c)c[T]&&(y+=T+" ");return y.trim()}const Pb="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Mb=Xp(Pb);function Dy(c){return!!c||c===""}const zy=c=>!!(c&&c.__v_isRef===!0),yn=c=>Dn(c)?c:c==null?"":pi(c)||bn(c)&&(c.toString===Ry||!Ii(c.toString))?zy(c)?yn(c.value):JSON.stringify(c,Ny,2):String(c),Ny=(c,y)=>zy(y)?Ny(c,y.value):Uu(y)?{[`Map(${y.size})`]:[...y.entries()].reduce((T,[I,E],z)=>(T[tp(I,z)+" =>"]=E,T),{})}:My(y)?{[`Set(${y.size})`]:[...y.values()].map(T=>tp(T))}:Go(y)?tp(y):bn(y)&&!pi(y)&&!Ly(y)?String(y):y,tp=(c,y="")=>{var T;return Go(c)?`Symbol(${(T=c.description)!=null?T:y})`:c};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let zr;class Oy{constructor(y=!1){this.detached=y,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=zr,!y&&zr&&(this.index=(zr.scopes||(zr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let y,T;if(this.scopes)for(y=0,T=this.scopes.length;y<T;y++)this.scopes[y].pause();for(y=0,T=this.effects.length;y<T;y++)this.effects[y].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let y,T;if(this.scopes)for(y=0,T=this.scopes.length;y<T;y++)this.scopes[y].resume();for(y=0,T=this.effects.length;y<T;y++)this.effects[y].resume()}}run(y){if(this._active){const T=zr;try{return zr=this,y()}finally{zr=T}}}on(){++this._on===1&&(this.prevScope=zr,zr=this)}off(){this._on>0&&--this._on===0&&(zr=this.prevScope,this.prevScope=void 0)}stop(y){if(this._active){this._active=!1;let T,I;for(T=0,I=this.effects.length;T<I;T++)this.effects[T].stop();for(this.effects.length=0,T=0,I=this.cleanups.length;T<I;T++)this.cleanups[T]();if(this.cleanups.length=0,this.scopes){for(T=0,I=this.scopes.length;T<I;T++)this.scopes[T].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!y){const E=this.parent.scopes.pop();E&&E!==this&&(this.parent.scopes[this.index]=E,E.index=this.index)}this.parent=void 0}}}function Fy(c){return new Oy(c)}function By(){return zr}function Ab(c,y=!1){zr&&zr.cleanups.push(c)}let cn;const ip=new WeakSet;class jy{constructor(y){this.fn=y,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,zr&&zr.active&&zr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,ip.has(this)&&(ip.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Uy(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,l_(this),Gy(this);const y=cn,T=aa;cn=this,aa=!0;try{return this.fn()}finally{qy(this),cn=y,aa=T,this.flags&=-3}}stop(){if(this.flags&1){for(let y=this.deps;y;y=y.nextDep)tm(y);this.deps=this.depsTail=void 0,l_(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?ip.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Pp(this)&&this.run()}get dirty(){return Pp(this)}}let Vy=0,Kc,Jc;function Uy(c,y=!1){if(c.flags|=8,y){c.next=Jc,Jc=c;return}c.next=Kc,Kc=c}function Qp(){Vy++}function em(){if(--Vy>0)return;if(Jc){let y=Jc;for(Jc=void 0;y;){const T=y.next;y.next=void 0,y.flags&=-9,y=T}}let c;for(;Kc;){let y=Kc;for(Kc=void 0;y;){const T=y.next;if(y.next=void 0,y.flags&=-9,y.flags&1)try{y.trigger()}catch(I){c||(c=I)}y=T}}if(c)throw c}function Gy(c){for(let y=c.deps;y;y=y.nextDep)y.version=-1,y.prevActiveLink=y.dep.activeLink,y.dep.activeLink=y}function qy(c){let y,T=c.depsTail,I=T;for(;I;){const E=I.prevDep;I.version===-1?(I===T&&(T=E),tm(I),Rb(I)):y=I,I.dep.activeLink=I.prevActiveLink,I.prevActiveLink=void 0,I=E}c.deps=y,c.depsTail=T}function Pp(c){for(let y=c.deps;y;y=y.nextDep)if(y.dep.version!==y.version||y.dep.computed&&($y(y.dep.computed)||y.dep.version!==y.version))return!0;return!!c._dirty}function $y(c){if(c.flags&4&&!(c.flags&16)||(c.flags&=-17,c.globalVersion===rh)||(c.globalVersion=rh,!c.isSSR&&c.flags&128&&(!c.deps&&!c._dirty||!Pp(c))))return;c.flags|=2;const y=c.dep,T=cn,I=aa;cn=c,aa=!0;try{Gy(c);const E=c.fn(c._value);(y.version===0||Fo(E,c._value))&&(c.flags|=128,c._value=E,y.version++)}catch(E){throw y.version++,E}finally{cn=T,aa=I,qy(c),c.flags&=-3}}function tm(c,y=!1){const{dep:T,prevSub:I,nextSub:E}=c;if(I&&(I.nextSub=E,c.prevSub=void 0),E&&(E.prevSub=I,c.nextSub=void 0),T.subs===c&&(T.subs=I,!I&&T.computed)){T.computed.flags&=-5;for(let z=T.computed.deps;z;z=z.nextDep)tm(z,!0)}!y&&!--T.sc&&T.map&&T.map.delete(T.key)}function Rb(c){const{prevDep:y,nextDep:T}=c;y&&(y.nextDep=T,c.prevDep=void 0),T&&(T.prevDep=y,c.nextDep=void 0)}let aa=!0;const Zy=[];function no(){Zy.push(aa),aa=!1}function ro(){const c=Zy.pop();aa=c===void 0?!0:c}function l_(c){const{cleanup:y}=c;if(c.cleanup=void 0,y){const T=cn;cn=void 0;try{y()}finally{cn=T}}}let rh=0;class Lb{constructor(y,T){this.sub=y,this.dep=T,this.version=T.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class im{constructor(y){this.computed=y,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(y){if(!cn||!aa||cn===this.computed)return;let T=this.activeLink;if(T===void 0||T.sub!==cn)T=this.activeLink=new Lb(cn,this),cn.deps?(T.prevDep=cn.depsTail,cn.depsTail.nextDep=T,cn.depsTail=T):cn.deps=cn.depsTail=T,Hy(T);else if(T.version===-1&&(T.version=this.version,T.nextDep)){const I=T.nextDep;I.prevDep=T.prevDep,T.prevDep&&(T.prevDep.nextDep=I),T.prevDep=cn.depsTail,T.nextDep=void 0,cn.depsTail.nextDep=T,cn.depsTail=T,cn.deps===T&&(cn.deps=I)}return T}trigger(y){this.version++,rh++,this.notify(y)}notify(y){Qp();try{for(let T=this.subs;T;T=T.prevSub)T.sub.notify()&&T.sub.dep.notify()}finally{em()}}}function Hy(c){if(c.dep.sc++,c.sub.flags&4){const y=c.dep.computed;if(y&&!c.dep.subs){y.flags|=20;for(let I=y.deps;I;I=I.nextDep)Hy(I)}const T=c.dep.subs;T!==c&&(c.prevSub=T,T&&(T.nextSub=c)),c.dep.subs=c}}const If=new WeakMap,jl=Symbol(""),Mp=Symbol(""),sh=Symbol("");function Nr(c,y,T){if(aa&&cn){let I=If.get(c);I||If.set(c,I=new Map);let E=I.get(T);E||(I.set(T,E=new im),E.map=I,E.key=T),E.track()}}function to(c,y,T,I,E,z){const P=If.get(c);if(!P){rh++;return}const o=J=>{J&&J.trigger()};if(Qp(),y==="clear")P.forEach(o);else{const J=pi(c),re=J&&Kp(T);if(J&&T==="length"){const H=Number(I);P.forEach((ie,ce)=>{(ce==="length"||ce===sh||!Go(ce)&&ce>=H)&&o(ie)})}else switch((T!==void 0||P.has(void 0))&&o(P.get(T)),re&&o(P.get(sh)),y){case"add":J?re&&o(P.get("length")):(o(P.get(jl)),Uu(c)&&o(P.get(Mp)));break;case"delete":J||(o(P.get(jl)),Uu(c)&&o(P.get(Mp)));break;case"set":Uu(c)&&o(P.get(jl));break}}em()}function Db(c,y){const T=If.get(c);return T&&T.get(y)}function Fu(c){const y=Fi(c);return y===c?y:(Nr(y,"iterate",sh),Fs(c)?y:y.map(Sr))}function qf(c){return Nr(c=Fi(c),"iterate",sh),c}const zb={__proto__:null,[Symbol.iterator](){return np(this,Symbol.iterator,Sr)},concat(...c){return Fu(this).concat(...c.map(y=>pi(y)?Fu(y):y))},entries(){return np(this,"entries",c=>(c[1]=Sr(c[1]),c))},every(c,y){return Ja(this,"every",c,y,void 0,arguments)},filter(c,y){return Ja(this,"filter",c,y,T=>T.map(Sr),arguments)},find(c,y){return Ja(this,"find",c,y,Sr,arguments)},findIndex(c,y){return Ja(this,"findIndex",c,y,void 0,arguments)},findLast(c,y){return Ja(this,"findLast",c,y,Sr,arguments)},findLastIndex(c,y){return Ja(this,"findLastIndex",c,y,void 0,arguments)},forEach(c,y){return Ja(this,"forEach",c,y,void 0,arguments)},includes(...c){return rp(this,"includes",c)},indexOf(...c){return rp(this,"indexOf",c)},join(c){return Fu(this).join(c)},lastIndexOf(...c){return rp(this,"lastIndexOf",c)},map(c,y){return Ja(this,"map",c,y,void 0,arguments)},pop(){return $c(this,"pop")},push(...c){return $c(this,"push",c)},reduce(c,...y){return u_(this,"reduce",c,y)},reduceRight(c,...y){return u_(this,"reduceRight",c,y)},shift(){return $c(this,"shift")},some(c,y){return Ja(this,"some",c,y,void 0,arguments)},splice(...c){return $c(this,"splice",c)},toReversed(){return Fu(this).toReversed()},toSorted(c){return Fu(this).toSorted(c)},toSpliced(...c){return Fu(this).toSpliced(...c)},unshift(...c){return $c(this,"unshift",c)},values(){return np(this,"values",Sr)}};function np(c,y,T){const I=qf(c),E=I[y]();return I!==c&&!Fs(c)&&(E._next=E.next,E.next=()=>{const z=E._next();return z.value&&(z.value=T(z.value)),z}),E}const Nb=Array.prototype;function Ja(c,y,T,I,E,z){const P=qf(c),o=P!==c&&!Fs(c),J=P[y];if(J!==Nb[y]){const ie=J.apply(c,z);return o?Sr(ie):ie}let re=T;P!==c&&(o?re=function(ie,ce){return T.call(this,Sr(ie),ce,c)}:T.length>2&&(re=function(ie,ce){return T.call(this,ie,ce,c)}));const H=J.call(P,re,I);return o&&E?E(H):H}function u_(c,y,T,I){const E=qf(c);let z=T;return E!==c&&(Fs(c)?T.length>3&&(z=function(P,o,J){return T.call(this,P,o,J,c)}):z=function(P,o,J){return T.call(this,P,Sr(o),J,c)}),E[y](z,...I)}function rp(c,y,T){const I=Fi(c);Nr(I,"iterate",sh);const E=I[y](...T);return(E===-1||E===!1)&&sm(T[0])?(T[0]=Fi(T[0]),I[y](...T)):E}function $c(c,y,T=[]){no(),Qp();const I=Fi(c)[y].apply(c,T);return em(),ro(),I}const Ob=Xp("__proto__,__v_isRef,__isVue"),Xy=new Set(Object.getOwnPropertyNames(Symbol).filter(c=>c!=="arguments"&&c!=="caller").map(c=>Symbol[c]).filter(Go));function Fb(c){Go(c)||(c=String(c));const y=Fi(this);return Nr(y,"has",c),y.hasOwnProperty(c)}class Wy{constructor(y=!1,T=!1){this._isReadonly=y,this._isShallow=T}get(y,T,I){if(T==="__v_skip")return y.__v_skip;const E=this._isReadonly,z=this._isShallow;if(T==="__v_isReactive")return!E;if(T==="__v_isReadonly")return E;if(T==="__v_isShallow")return z;if(T==="__v_raw")return I===(E?z?Xb:Qy:z?Jy:Ky).get(y)||Object.getPrototypeOf(y)===Object.getPrototypeOf(I)?y:void 0;const P=pi(y);if(!E){let J;if(P&&(J=zb[T]))return J;if(T==="hasOwnProperty")return Fb}const o=Reflect.get(y,T,Vn(y)?y:I);return(Go(T)?Xy.has(T):Ob(T))||(E||Nr(y,"get",T),z)?o:Vn(o)?P&&Kp(T)?o:o.value:bn(o)?E?ev(o):$f(o):o}}class Yy extends Wy{constructor(y=!1){super(!1,y)}set(y,T,I,E){let z=y[T];if(!this._isShallow){const J=Vo(z);if(!Fs(I)&&!Vo(I)&&(z=Fi(z),I=Fi(I)),!pi(y)&&Vn(z)&&!Vn(I))return J?!1:(z.value=I,!0)}const P=pi(y)&&Kp(T)?Number(T)<y.length:Xi(y,T),o=Reflect.set(y,T,I,Vn(y)?y:E);return y===Fi(E)&&(P?Fo(I,z)&&to(y,"set",T,I):to(y,"add",T,I)),o}deleteProperty(y,T){const I=Xi(y,T);y[T];const E=Reflect.deleteProperty(y,T);return E&&I&&to(y,"delete",T,void 0),E}has(y,T){const I=Reflect.has(y,T);return(!Go(T)||!Xy.has(T))&&Nr(y,"has",T),I}ownKeys(y){return Nr(y,"iterate",pi(y)?"length":jl),Reflect.ownKeys(y)}}class Bb extends Wy{constructor(y=!1){super(!0,y)}set(y,T){return!0}deleteProperty(y,T){return!0}}const jb=new Yy,Vb=new Bb,Ub=new Yy(!0);const Ap=c=>c,af=c=>Reflect.getPrototypeOf(c);function Gb(c,y,T){return function(...I){const E=this.__v_raw,z=Fi(E),P=Uu(z),o=c==="entries"||c===Symbol.iterator&&P,J=c==="keys"&&P,re=E[c](...I),H=T?Ap:y?kf:Sr;return!y&&Nr(z,"iterate",J?Mp:jl),{next(){const{value:ie,done:ce}=re.next();return ce?{value:ie,done:ce}:{value:o?[H(ie[0]),H(ie[1])]:H(ie),done:ce}},[Symbol.iterator](){return this}}}}function of(c){return function(...y){return c==="delete"?!1:c==="clear"?void 0:this}}function qb(c,y){const T={get(E){const z=this.__v_raw,P=Fi(z),o=Fi(E);c||(Fo(E,o)&&Nr(P,"get",E),Nr(P,"get",o));const{has:J}=af(P),re=y?Ap:c?kf:Sr;if(J.call(P,E))return re(z.get(E));if(J.call(P,o))return re(z.get(o));z!==P&&z.get(E)},get size(){const E=this.__v_raw;return!c&&Nr(Fi(E),"iterate",jl),Reflect.get(E,"size",E)},has(E){const z=this.__v_raw,P=Fi(z),o=Fi(E);return c||(Fo(E,o)&&Nr(P,"has",E),Nr(P,"has",o)),E===o?z.has(E):z.has(E)||z.has(o)},forEach(E,z){const P=this,o=P.__v_raw,J=Fi(o),re=y?Ap:c?kf:Sr;return!c&&Nr(J,"iterate",jl),o.forEach((H,ie)=>E.call(z,re(H),re(ie),P))}};return Ir(T,c?{add:of("add"),set:of("set"),delete:of("delete"),clear:of("clear")}:{add(E){!y&&!Fs(E)&&!Vo(E)&&(E=Fi(E));const z=Fi(this);return af(z).has.call(z,E)||(z.add(E),to(z,"add",E,E)),this},set(E,z){!y&&!Fs(z)&&!Vo(z)&&(z=Fi(z));const P=Fi(this),{has:o,get:J}=af(P);let re=o.call(P,E);re||(E=Fi(E),re=o.call(P,E));const H=J.call(P,E);return P.set(E,z),re?Fo(z,H)&&to(P,"set",E,z):to(P,"add",E,z),this},delete(E){const z=Fi(this),{has:P,get:o}=af(z);let J=P.call(z,E);J||(E=Fi(E),J=P.call(z,E)),o&&o.call(z,E);const re=z.delete(E);return J&&to(z,"delete",E,void 0),re},clear(){const E=Fi(this),z=E.size!==0,P=E.clear();return z&&to(E,"clear",void 0,void 0),P}}),["keys","values","entries",Symbol.iterator].forEach(E=>{T[E]=Gb(E,c,y)}),T}function nm(c,y){const T=qb(c,y);return(I,E,z)=>E==="__v_isReactive"?!c:E==="__v_isReadonly"?c:E==="__v_raw"?I:Reflect.get(Xi(T,E)&&E in I?T:I,E,z)}const $b={get:nm(!1,!1)},Zb={get:nm(!1,!0)},Hb={get:nm(!0,!1)};const Ky=new WeakMap,Jy=new WeakMap,Qy=new WeakMap,Xb=new WeakMap;function Wb(c){switch(c){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Yb(c){return c.__v_skip||!Object.isExtensible(c)?0:Wb(xb(c))}function $f(c){return Vo(c)?c:rm(c,!1,jb,$b,Ky)}function Kb(c){return rm(c,!1,Ub,Zb,Jy)}function ev(c){return rm(c,!0,Vb,Hb,Qy)}function rm(c,y,T,I,E){if(!bn(c)||c.__v_raw&&!(y&&c.__v_isReactive))return c;const z=Yb(c);if(z===0)return c;const P=E.get(c);if(P)return P;const o=new Proxy(c,z===2?I:T);return E.set(c,o),o}function Bo(c){return Vo(c)?Bo(c.__v_raw):!!(c&&c.__v_isReactive)}function Vo(c){return!!(c&&c.__v_isReadonly)}function Fs(c){return!!(c&&c.__v_isShallow)}function sm(c){return c?!!c.__v_raw:!1}function Fi(c){const y=c&&c.__v_raw;return y?Fi(y):c}function am(c){return!Xi(c,"__v_skip")&&Object.isExtensible(c)&&Cp(c,"__v_skip",!0),c}const Sr=c=>bn(c)?$f(c):c,kf=c=>bn(c)?ev(c):c;function Vn(c){return c?c.__v_isRef===!0:!1}function vn(c){return Jb(c,!1)}function Jb(c,y){return Vn(c)?c:new Qb(c,y)}class Qb{constructor(y,T){this.dep=new im,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=T?y:Fi(y),this._value=T?y:Sr(y),this.__v_isShallow=T}get value(){return this.dep.track(),this._value}set value(y){const T=this._rawValue,I=this.__v_isShallow||Fs(y)||Vo(y);y=I?y:Fi(y),Fo(y,T)&&(this._rawValue=y,this._value=I?y:Sr(y),this.dep.trigger())}}function xn(c){return Vn(c)?c.value:c}const e1={get:(c,y,T)=>y==="__v_raw"?c:xn(Reflect.get(c,y,T)),set:(c,y,T,I)=>{const E=c[y];return Vn(E)&&!Vn(T)?(E.value=T,!0):Reflect.set(c,y,T,I)}};function tv(c){return Bo(c)?c:new Proxy(c,e1)}function t1(c){const y=pi(c)?new Array(c.length):{};for(const T in c)y[T]=n1(c,T);return y}class i1{constructor(y,T,I){this._object=y,this._key=T,this._defaultValue=I,this.__v_isRef=!0,this._value=void 0}get value(){const y=this._object[this._key];return this._value=y===void 0?this._defaultValue:y}set value(y){this._object[this._key]=y}get dep(){return Db(Fi(this._object),this._key)}}function n1(c,y,T){const I=c[y];return Vn(I)?I:new i1(c,y,T)}class r1{constructor(y,T,I){this.fn=y,this.setter=T,this._value=void 0,this.dep=new im(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=rh-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!T,this.isSSR=I}notify(){if(this.flags|=16,!(this.flags&8)&&cn!==this)return Uy(this,!0),!0}get value(){const y=this.dep.track();return $y(this),y&&(y.version=this.dep.version),this._value}set value(y){this.setter&&this.setter(y)}}function s1(c,y,T=!1){let I,E;return Ii(c)?I=c:(I=c.get,E=c.set),new r1(I,E,T)}const lf={},Ef=new WeakMap;let Fl;function a1(c,y=!1,T=Fl){if(T){let I=Ef.get(T);I||Ef.set(T,I=[]),I.push(c)}}function o1(c,y,T=hn){const{immediate:I,deep:E,once:z,scheduler:P,augmentJob:o,call:J}=T,re=We=>E?We:Fs(We)||E===!1||E===0?Oo(We,1):Oo(We);let H,ie,ce,Y,le=!1,Xe=!1;if(Vn(c)?(ie=()=>c.value,le=Fs(c)):Bo(c)?(ie=()=>re(c),le=!0):pi(c)?(Xe=!0,le=c.some(We=>Bo(We)||Fs(We)),ie=()=>c.map(We=>{if(Vn(We))return We.value;if(Bo(We))return re(We);if(Ii(We))return J?J(We,2):We()})):Ii(c)?y?ie=J?()=>J(c,2):c:ie=()=>{if(ce){no();try{ce()}finally{ro()}}const We=Fl;Fl=H;try{return J?J(c,3,[Y]):c(Y)}finally{Fl=We}}:ie=Ma,y&&E){const We=ie,qe=E===!0?1/0:E;ie=()=>Oo(We(),qe)}const ft=By(),it=()=>{H.stop(),ft&&ft.active&&Yp(ft.effects,H)};if(z&&y){const We=y;y=(...qe)=>{We(...qe),it()}}let Qe=Xe?new Array(c.length).fill(lf):lf;const tt=We=>{if(!(!(H.flags&1)||!H.dirty&&!We))if(y){const qe=H.run();if(E||le||(Xe?qe.some((Ke,pt)=>Fo(Ke,Qe[pt])):Fo(qe,Qe))){ce&&ce();const Ke=Fl;Fl=H;try{const pt=[qe,Qe===lf?void 0:Xe&&Qe[0]===lf?[]:Qe,Y];Qe=qe,J?J(y,3,pt):y(...pt)}finally{Fl=Ke}}}else H.run()};return o&&o(tt),H=new jy(ie),H.scheduler=P?()=>P(tt,!1):tt,Y=We=>a1(We,!1,H),ce=H.onStop=()=>{const We=Ef.get(H);if(We){if(J)J(We,4);else for(const qe of We)qe();Ef.delete(H)}},y?I?tt(!0):Qe=H.run():P?P(tt.bind(null,!0),!0):H.run(),it.pause=H.pause.bind(H),it.resume=H.resume.bind(H),it.stop=it,it}function Oo(c,y=1/0,T){if(y<=0||!bn(c)||c.__v_skip||(T=T||new Set,T.has(c)))return c;if(T.add(c),y--,Vn(c))Oo(c.value,y,T);else if(pi(c))for(let I=0;I<c.length;I++)Oo(c[I],y,T);else if(My(c)||Uu(c))c.forEach(I=>{Oo(I,y,T)});else if(Ly(c)){for(const I in c)Oo(c[I],y,T);for(const I of Object.getOwnPropertySymbols(c))Object.prototype.propertyIsEnumerable.call(c,I)&&Oo(c[I],y,T)}return c}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function fh(c,y,T,I){try{return I?c(...I):c()}catch(E){Zf(E,y,T)}}function oa(c,y,T,I){if(Ii(c)){const E=fh(c,y,T,I);return E&&Ay(E)&&E.catch(z=>{Zf(z,y,T)}),E}if(pi(c)){const E=[];for(let z=0;z<c.length;z++)E.push(oa(c[z],y,T,I));return E}}function Zf(c,y,T,I=!0){const E=y?y.vnode:null,{errorHandler:z,throwUnhandledErrorInProduction:P}=y&&y.appContext.config||hn;if(y){let o=y.parent;const J=y.proxy,re=`https://vuejs.org/error-reference/#runtime-${T}`;for(;o;){const H=o.ec;if(H){for(let ie=0;ie<H.length;ie++)if(H[ie](c,J,re)===!1)return}o=o.parent}if(z){no(),fh(z,null,10,[c,J,re]),ro();return}}l1(c,T,E,I,P)}function l1(c,y,T,I=!0,E=!1){if(E)throw c;console.error(c)}const Xr=[];let Ea=-1;const Gu=[];let Do=null,ju=0;const iv=Promise.resolve();let Cf=null;function nv(c){const y=Cf||iv;return c?y.then(this?c.bind(this):c):y}function u1(c){let y=Ea+1,T=Xr.length;for(;y<T;){const I=y+T>>>1,E=Xr[I],z=ah(E);z<c||z===c&&E.flags&2?y=I+1:T=I}return y}function om(c){if(!(c.flags&1)){const y=ah(c),T=Xr[Xr.length-1];!T||!(c.flags&2)&&y>=ah(T)?Xr.push(c):Xr.splice(u1(y),0,c),c.flags|=1,rv()}}function rv(){Cf||(Cf=iv.then(av))}function c1(c){pi(c)?Gu.push(...c):Do&&c.id===-1?Do.splice(ju+1,0,c):c.flags&1||(Gu.push(c),c.flags|=1),rv()}function c_(c,y,T=Ea+1){for(;T<Xr.length;T++){const I=Xr[T];if(I&&I.flags&2){if(c&&I.id!==c.uid)continue;Xr.splice(T,1),T--,I.flags&4&&(I.flags&=-2),I(),I.flags&4||(I.flags&=-2)}}}function sv(c){if(Gu.length){const y=[...new Set(Gu)].sort((T,I)=>ah(T)-ah(I));if(Gu.length=0,Do){Do.push(...y);return}for(Do=y,ju=0;ju<Do.length;ju++){const T=Do[ju];T.flags&4&&(T.flags&=-2),T.flags&8||T(),T.flags&=-2}Do=null,ju=0}}const ah=c=>c.id==null?c.flags&2?-1:1/0:c.id;function av(c){try{for(Ea=0;Ea<Xr.length;Ea++){const y=Xr[Ea];y&&!(y.flags&8)&&(y.flags&4&&(y.flags&=-2),fh(y,y.i,y.i?15:14),y.flags&4||(y.flags&=-2))}}finally{for(;Ea<Xr.length;Ea++){const y=Xr[Ea];y&&(y.flags&=-2)}Ea=-1,Xr.length=0,sv(),Cf=null,(Xr.length||Gu.length)&&av()}}let xs=null,ov=null;function Pf(c){const y=xs;return xs=c,ov=c&&c.type.__scopeId||null,y}function lv(c,y=xs,T){if(!y||c._n)return c;const I=(...E)=>{I._d&&b_(-1);const z=Pf(y);let P;try{P=c(...E)}finally{Pf(z),I._d&&b_(1)}return P};return I._n=!0,I._c=!0,I._d=!0,I}function Dl(c,y,T,I){const E=c.dirs,z=y&&y.dirs;for(let P=0;P<E.length;P++){const o=E[P];z&&(o.oldValue=z[P].value);let J=o.dir[I];J&&(no(),oa(J,T,8,[c.el,o,c,y]),ro())}}const h1=Symbol("_vte"),uv=c=>c.__isTeleport,zo=Symbol("_leaveCb"),uf=Symbol("_enterCb");function f1(){const c={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return dh(()=>{c.isMounted=!0}),_v(()=>{c.isUnmounting=!0}),c}const Ns=[Function,Array],cv={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ns,onEnter:Ns,onAfterEnter:Ns,onEnterCancelled:Ns,onBeforeLeave:Ns,onLeave:Ns,onAfterLeave:Ns,onLeaveCancelled:Ns,onBeforeAppear:Ns,onAppear:Ns,onAfterAppear:Ns,onAppearCancelled:Ns},hv=c=>{const y=c.subTree;return y.component?hv(y.component):y},d1={name:"BaseTransition",props:cv,setup(c,{slots:y}){const T=uw(),I=f1();return()=>{const E=y.default&&pv(y.default(),!0);if(!E||!E.length)return;const z=fv(E),P=Fi(c),{mode:o}=P;if(I.isLeaving)return sp(z);const J=h_(z);if(!J)return sp(z);let re=Rp(J,P,I,T,ie=>re=ie);J.type!==Yr&&oh(J,re);let H=T.subTree&&h_(T.subTree);if(H&&H.type!==Yr&&!Bl(J,H)&&hv(T).type!==Yr){let ie=Rp(H,P,I,T);if(oh(H,ie),o==="out-in"&&J.type!==Yr)return I.isLeaving=!0,ie.afterLeave=()=>{I.isLeaving=!1,T.job.flags&8||T.update(),delete ie.afterLeave,H=void 0},sp(z);o==="in-out"&&J.type!==Yr?ie.delayLeave=(ce,Y,le)=>{const Xe=dv(I,H);Xe[String(H.key)]=H,ce[zo]=()=>{Y(),ce[zo]=void 0,delete re.delayedLeave,H=void 0},re.delayedLeave=()=>{le(),delete re.delayedLeave,H=void 0}}:H=void 0}else H&&(H=void 0);return z}}};function fv(c){let y=c[0];if(c.length>1){for(const T of c)if(T.type!==Yr){y=T;break}}return y}const p1=d1;function dv(c,y){const{leavingVNodes:T}=c;let I=T.get(y.type);return I||(I=Object.create(null),T.set(y.type,I)),I}function Rp(c,y,T,I,E){const{appear:z,mode:P,persisted:o=!1,onBeforeEnter:J,onEnter:re,onAfterEnter:H,onEnterCancelled:ie,onBeforeLeave:ce,onLeave:Y,onAfterLeave:le,onLeaveCancelled:Xe,onBeforeAppear:ft,onAppear:it,onAfterAppear:Qe,onAppearCancelled:tt}=y,We=String(c.key),qe=dv(T,c),Ke=(Ye,Ct)=>{Ye&&oa(Ye,I,9,Ct)},pt=(Ye,Ct)=>{const Dt=Ct[1];Ke(Ye,Ct),pi(Ye)?Ye.every(ct=>ct.length<=1)&&Dt():Ye.length<=1&&Dt()},dt={mode:P,persisted:o,beforeEnter(Ye){let Ct=J;if(!T.isMounted)if(z)Ct=ft||J;else return;Ye[zo]&&Ye[zo](!0);const Dt=qe[We];Dt&&Bl(c,Dt)&&Dt.el[zo]&&Dt.el[zo](),Ke(Ct,[Ye])},enter(Ye){let Ct=re,Dt=H,ct=ie;if(!T.isMounted)if(z)Ct=it||re,Dt=Qe||H,ct=tt||ie;else return;let Pt=!1;const ut=Ye[uf]=Bt=>{Pt||(Pt=!0,Bt?Ke(ct,[Ye]):Ke(Dt,[Ye]),dt.delayedLeave&&dt.delayedLeave(),Ye[uf]=void 0)};Ct?pt(Ct,[Ye,ut]):ut()},leave(Ye,Ct){const Dt=String(c.key);if(Ye[uf]&&Ye[uf](!0),T.isUnmounting)return Ct();Ke(ce,[Ye]);let ct=!1;const Pt=Ye[zo]=ut=>{ct||(ct=!0,Ct(),ut?Ke(Xe,[Ye]):Ke(le,[Ye]),Ye[zo]=void 0,qe[Dt]===c&&delete qe[Dt])};qe[Dt]=c,Y?pt(Y,[Ye,Pt]):Pt()},clone(Ye){const Ct=Rp(Ye,y,T,I,E);return E&&E(Ct),Ct}};return dt}function sp(c){if(Hf(c))return c=Uo(c),c.children=null,c}function h_(c){if(!Hf(c))return uv(c.type)&&c.children?fv(c.children):c;if(c.component)return c.component.subTree;const{shapeFlag:y,children:T}=c;if(T){if(y&16)return T[0];if(y&32&&Ii(T.default))return T.default()}}function oh(c,y){c.shapeFlag&6&&c.component?(c.transition=y,oh(c.component.subTree,y)):c.shapeFlag&128?(c.ssContent.transition=y.clone(c.ssContent),c.ssFallback.transition=y.clone(c.ssFallback)):c.transition=y}function pv(c,y=!1,T){let I=[],E=0;for(let z=0;z<c.length;z++){let P=c[z];const o=T==null?P.key:String(T)+String(P.key!=null?P.key:z);P.type===Wr?(P.patchFlag&128&&E++,I=I.concat(pv(P.children,y,o))):(y||P.type!==Yr)&&I.push(o!=null?Uo(P,{key:o}):P)}if(E>1)for(let z=0;z<I.length;z++)I[z].patchFlag=-2;return I}function mv(c){c.ids=[c.ids[0]+c.ids[2]+++"-",0,0]}function Qc(c,y,T,I,E=!1){if(pi(c)){c.forEach((le,Xe)=>Qc(le,y&&(pi(y)?y[Xe]:y),T,I,E));return}if(eh(I)&&!E){I.shapeFlag&512&&I.type.__asyncResolved&&I.component.subTree.component&&Qc(c,y,T,I.component.subTree);return}const z=I.shapeFlag&4?dm(I.component):I.el,P=E?null:z,{i:o,r:J}=c,re=y&&y.r,H=o.refs===hn?o.refs={}:o.refs,ie=o.setupState,ce=Fi(ie),Y=ie===hn?()=>!1:le=>Xi(ce,le);if(re!=null&&re!==J&&(Dn(re)?(H[re]=null,Y(re)&&(ie[re]=null)):Vn(re)&&(re.value=null)),Ii(J))fh(J,o,12,[P,H]);else{const le=Dn(J),Xe=Vn(J);if(le||Xe){const ft=()=>{if(c.f){const it=le?Y(J)?ie[J]:H[J]:J.value;E?pi(it)&&Yp(it,z):pi(it)?it.includes(z)||it.push(z):le?(H[J]=[z],Y(J)&&(ie[J]=H[J])):(J.value=[z],c.k&&(H[c.k]=J.value))}else le?(H[J]=P,Y(J)&&(ie[J]=P)):Xe&&(J.value=P,c.k&&(H[c.k]=P))};P?(ft.id=-1,vs(ft,T)):ft()}}}Gf().requestIdleCallback;Gf().cancelIdleCallback;const eh=c=>!!c.type.__asyncLoader,Hf=c=>c.type.__isKeepAlive;function m1(c,y){gv(c,"a",y)}function g1(c,y){gv(c,"da",y)}function gv(c,y,T=gr){const I=c.__wdc||(c.__wdc=()=>{let E=T;for(;E;){if(E.isDeactivated)return;E=E.parent}return c()});if(Xf(y,I,T),T){let E=T.parent;for(;E&&E.parent;)Hf(E.parent.vnode)&&_1(I,y,T,E),E=E.parent}}function _1(c,y,T,I){const E=Xf(y,c,I,!0);lm(()=>{Yp(I[y],E)},T)}function Xf(c,y,T=gr,I=!1){if(T){const E=T[c]||(T[c]=[]),z=y.__weh||(y.__weh=(...P)=>{no();const o=mh(T),J=oa(y,T,c,P);return o(),ro(),J});return I?E.unshift(z):E.push(z),z}}const so=c=>(y,T=gr)=>{(!uh||c==="sp")&&Xf(c,(...I)=>y(...I),T)},y1=so("bm"),dh=so("m"),v1=so("bu"),x1=so("u"),_v=so("bum"),lm=so("um"),b1=so("sp"),w1=so("rtg"),T1=so("rtc");function S1(c,y=gr){Xf("ec",c,y)}const yv="components";function I1(c,y){return xv(yv,c,!0,y)||c}const vv=Symbol.for("v-ndc");function um(c){return Dn(c)?xv(yv,c,!1)||c:c||vv}function xv(c,y,T=!0,I=!1){const E=xs||gr;if(E){const z=E.type;{const o=pw(z,!1);if(o&&(o===y||o===Bs(y)||o===Uf(Bs(y))))return z}const P=f_(E[c]||z[c],y)||f_(E.appContext[c],y);return!P&&I?z:P}}function f_(c,y){return c&&(c[y]||c[Bs(y)]||c[Uf(Bs(y))])}function ph(c,y,T,I){let E;const z=T,P=pi(c);if(P||Dn(c)){const o=P&&Bo(c);let J=!1,re=!1;o&&(J=!Fs(c),re=Vo(c),c=qf(c)),E=new Array(c.length);for(let H=0,ie=c.length;H<ie;H++)E[H]=y(J?re?kf(Sr(c[H])):Sr(c[H]):c[H],H,void 0,z)}else if(typeof c=="number"){E=new Array(c);for(let o=0;o<c;o++)E[o]=y(o+1,o,void 0,z)}else if(bn(c))if(c[Symbol.iterator])E=Array.from(c,(o,J)=>y(o,J,void 0,z));else{const o=Object.keys(c);E=new Array(o.length);for(let J=0,re=o.length;J<re;J++){const H=o[J];E[J]=y(c[H],H,J,z)}}else E=[];return E}const Lp=c=>c?jv(c)?dm(c):Lp(c.parent):null,th=Ir(Object.create(null),{$:c=>c,$el:c=>c.vnode.el,$data:c=>c.data,$props:c=>c.props,$attrs:c=>c.attrs,$slots:c=>c.slots,$refs:c=>c.refs,$parent:c=>Lp(c.parent),$root:c=>Lp(c.root),$host:c=>c.ce,$emit:c=>c.emit,$options:c=>wv(c),$forceUpdate:c=>c.f||(c.f=()=>{om(c.update)}),$nextTick:c=>c.n||(c.n=nv.bind(c.proxy)),$watch:c=>H1.bind(c)}),ap=(c,y)=>c!==hn&&!c.__isScriptSetup&&Xi(c,y),k1={get({_:c},y){if(y==="__v_skip")return!0;const{ctx:T,setupState:I,data:E,props:z,accessCache:P,type:o,appContext:J}=c;let re;if(y[0]!=="$"){const Y=P[y];if(Y!==void 0)switch(Y){case 1:return I[y];case 2:return E[y];case 4:return T[y];case 3:return z[y]}else{if(ap(I,y))return P[y]=1,I[y];if(E!==hn&&Xi(E,y))return P[y]=2,E[y];if((re=c.propsOptions[0])&&Xi(re,y))return P[y]=3,z[y];if(T!==hn&&Xi(T,y))return P[y]=4,T[y];Dp&&(P[y]=0)}}const H=th[y];let ie,ce;if(H)return y==="$attrs"&&Nr(c.attrs,"get",""),H(c);if((ie=o.__cssModules)&&(ie=ie[y]))return ie;if(T!==hn&&Xi(T,y))return P[y]=4,T[y];if(ce=J.config.globalProperties,Xi(ce,y))return ce[y]},set({_:c},y,T){const{data:I,setupState:E,ctx:z}=c;return ap(E,y)?(E[y]=T,!0):I!==hn&&Xi(I,y)?(I[y]=T,!0):Xi(c.props,y)||y[0]==="$"&&y.slice(1)in c?!1:(z[y]=T,!0)},has({_:{data:c,setupState:y,accessCache:T,ctx:I,appContext:E,propsOptions:z}},P){let o;return!!T[P]||c!==hn&&Xi(c,P)||ap(y,P)||(o=z[0])&&Xi(o,P)||Xi(I,P)||Xi(th,P)||Xi(E.config.globalProperties,P)},defineProperty(c,y,T){return T.get!=null?c._.accessCache[y]=0:Xi(T,"value")&&this.set(c,y,T.value,null),Reflect.defineProperty(c,y,T)}};function d_(c){return pi(c)?c.reduce((y,T)=>(y[T]=null,y),{}):c}let Dp=!0;function E1(c){const y=wv(c),T=c.proxy,I=c.ctx;Dp=!1,y.beforeCreate&&p_(y.beforeCreate,c,"bc");const{data:E,computed:z,methods:P,watch:o,provide:J,inject:re,created:H,beforeMount:ie,mounted:ce,beforeUpdate:Y,updated:le,activated:Xe,deactivated:ft,beforeDestroy:it,beforeUnmount:Qe,destroyed:tt,unmounted:We,render:qe,renderTracked:Ke,renderTriggered:pt,errorCaptured:dt,serverPrefetch:Ye,expose:Ct,inheritAttrs:Dt,components:ct,directives:Pt,filters:ut}=y;if(re&&C1(re,I,null),P)for(const Ut in P){const ui=P[Ut];Ii(ui)&&(I[Ut]=ui.bind(T))}if(E){const Ut=E.call(T,T);bn(Ut)&&(c.data=$f(Ut))}if(Dp=!0,z)for(const Ut in z){const ui=z[Ut],Ni=Ii(ui)?ui.bind(T,T):Ii(ui.get)?ui.get.bind(T,T):Ma,Ot=!Ii(ui)&&Ii(ui.set)?ui.set.bind(T):Ma,Ei=io({get:Ni,set:Ot});Object.defineProperty(I,Ut,{enumerable:!0,configurable:!0,get:()=>Ei.value,set:Jt=>Ei.value=Jt})}if(o)for(const Ut in o)bv(o[Ut],I,T,Ut);if(J){const Ut=Ii(J)?J.call(T):J;Reflect.ownKeys(Ut).forEach(ui=>{Np(ui,Ut[ui])})}H&&p_(H,c,"c");function qt(Ut,ui){pi(ui)?ui.forEach(Ni=>Ut(Ni.bind(T))):ui&&Ut(ui.bind(T))}if(qt(y1,ie),qt(dh,ce),qt(v1,Y),qt(x1,le),qt(m1,Xe),qt(g1,ft),qt(S1,dt),qt(T1,Ke),qt(w1,pt),qt(_v,Qe),qt(lm,We),qt(b1,Ye),pi(Ct))if(Ct.length){const Ut=c.exposed||(c.exposed={});Ct.forEach(ui=>{Object.defineProperty(Ut,ui,{get:()=>T[ui],set:Ni=>T[ui]=Ni})})}else c.exposed||(c.exposed={});qe&&c.render===Ma&&(c.render=qe),Dt!=null&&(c.inheritAttrs=Dt),ct&&(c.components=ct),Pt&&(c.directives=Pt),Ye&&mv(c)}function C1(c,y,T=Ma){pi(c)&&(c=zp(c));for(const I in c){const E=c[I];let z;bn(E)?"default"in E?z=jo(E.from||I,E.default,!0):z=jo(E.from||I):z=jo(E),Vn(z)?Object.defineProperty(y,I,{enumerable:!0,configurable:!0,get:()=>z.value,set:P=>z.value=P}):y[I]=z}}function p_(c,y,T){oa(pi(c)?c.map(I=>I.bind(y.proxy)):c.bind(y.proxy),y,T)}function bv(c,y,T,I){let E=I.includes(".")?zv(T,I):()=>T[I];if(Dn(c)){const z=y[c];Ii(z)&&Ul(E,z)}else if(Ii(c))Ul(E,c.bind(T));else if(bn(c))if(pi(c))c.forEach(z=>bv(z,y,T,I));else{const z=Ii(c.handler)?c.handler.bind(T):y[c.handler];Ii(z)&&Ul(E,z,c)}}function wv(c){const y=c.type,{mixins:T,extends:I}=y,{mixins:E,optionsCache:z,config:{optionMergeStrategies:P}}=c.appContext,o=z.get(y);let J;return o?J=o:!E.length&&!T&&!I?J=y:(J={},E.length&&E.forEach(re=>Mf(J,re,P,!0)),Mf(J,y,P)),bn(y)&&z.set(y,J),J}function Mf(c,y,T,I=!1){const{mixins:E,extends:z}=y;z&&Mf(c,z,T,!0),E&&E.forEach(P=>Mf(c,P,T,!0));for(const P in y)if(!(I&&P==="expose")){const o=P1[P]||T&&T[P];c[P]=o?o(c[P],y[P]):y[P]}return c}const P1={data:m_,props:g_,emits:g_,methods:Hc,computed:Hc,beforeCreate:Hr,created:Hr,beforeMount:Hr,mounted:Hr,beforeUpdate:Hr,updated:Hr,beforeDestroy:Hr,beforeUnmount:Hr,destroyed:Hr,unmounted:Hr,activated:Hr,deactivated:Hr,errorCaptured:Hr,serverPrefetch:Hr,components:Hc,directives:Hc,watch:A1,provide:m_,inject:M1};function m_(c,y){return y?c?function(){return Ir(Ii(c)?c.call(this,this):c,Ii(y)?y.call(this,this):y)}:y:c}function M1(c,y){return Hc(zp(c),zp(y))}function zp(c){if(pi(c)){const y={};for(let T=0;T<c.length;T++)y[c[T]]=c[T];return y}return c}function Hr(c,y){return c?[...new Set([].concat(c,y))]:y}function Hc(c,y){return c?Ir(Object.create(null),c,y):y}function g_(c,y){return c?pi(c)&&pi(y)?[...new Set([...c,...y])]:Ir(Object.create(null),d_(c),d_(y??{})):y}function A1(c,y){if(!c)return y;if(!y)return c;const T=Ir(Object.create(null),c);for(const I in y)T[I]=Hr(c[I],y[I]);return T}function Tv(){return{app:null,config:{isNativeTag:yb,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let R1=0;function L1(c,y){return function(I,E=null){Ii(I)||(I=Ir({},I)),E!=null&&!bn(E)&&(E=null);const z=Tv(),P=new WeakSet,o=[];let J=!1;const re=z.app={_uid:R1++,_component:I,_props:E,_container:null,_context:z,_instance:null,version:gw,get config(){return z.config},set config(H){},use(H,...ie){return P.has(H)||(H&&Ii(H.install)?(P.add(H),H.install(re,...ie)):Ii(H)&&(P.add(H),H(re,...ie))),re},mixin(H){return z.mixins.includes(H)||z.mixins.push(H),re},component(H,ie){return ie?(z.components[H]=ie,re):z.components[H]},directive(H,ie){return ie?(z.directives[H]=ie,re):z.directives[H]},mount(H,ie,ce){if(!J){const Y=re._ceVNode||tn(I,E);return Y.appContext=z,ce===!0?ce="svg":ce===!1&&(ce=void 0),c(Y,H,ce),J=!0,re._container=H,H.__vue_app__=re,dm(Y.component)}},onUnmount(H){o.push(H)},unmount(){J&&(oa(o,re._instance,16),c(null,re._container),delete re._container.__vue_app__)},provide(H,ie){return z.provides[H]=ie,re},runWithContext(H){const ie=Vl;Vl=re;try{return H()}finally{Vl=ie}}};return re}}let Vl=null;function Np(c,y){if(gr){let T=gr.provides;const I=gr.parent&&gr.parent.provides;I===T&&(T=gr.provides=Object.create(I)),T[c]=y}}function jo(c,y,T=!1){const I=gr||xs;if(I||Vl){let E=Vl?Vl._context.provides:I?I.parent==null||I.ce?I.vnode.appContext&&I.vnode.appContext.provides:I.parent.provides:void 0;if(E&&c in E)return E[c];if(arguments.length>1)return T&&Ii(y)?y.call(I&&I.proxy):y}}function D1(){return!!(gr||xs||Vl)}const Sv={},Iv=()=>Object.create(Sv),kv=c=>Object.getPrototypeOf(c)===Sv;function z1(c,y,T,I=!1){const E={},z=Iv();c.propsDefaults=Object.create(null),Ev(c,y,E,z);for(const P in c.propsOptions[0])P in E||(E[P]=void 0);T?c.props=I?E:Kb(E):c.type.props?c.props=E:c.props=z,c.attrs=z}function N1(c,y,T,I){const{props:E,attrs:z,vnode:{patchFlag:P}}=c,o=Fi(E),[J]=c.propsOptions;let re=!1;if((I||P>0)&&!(P&16)){if(P&8){const H=c.vnode.dynamicProps;for(let ie=0;ie<H.length;ie++){let ce=H[ie];if(Wf(c.emitsOptions,ce))continue;const Y=y[ce];if(J)if(Xi(z,ce))Y!==z[ce]&&(z[ce]=Y,re=!0);else{const le=Bs(ce);E[le]=Op(J,o,le,Y,c,!1)}else Y!==z[ce]&&(z[ce]=Y,re=!0)}}}else{Ev(c,y,E,z)&&(re=!0);let H;for(const ie in o)(!y||!Xi(y,ie)&&((H=ql(ie))===ie||!Xi(y,H)))&&(J?T&&(T[ie]!==void 0||T[H]!==void 0)&&(E[ie]=Op(J,o,ie,void 0,c,!0)):delete E[ie]);if(z!==o)for(const ie in z)(!y||!Xi(y,ie))&&(delete z[ie],re=!0)}re&&to(c.attrs,"set","")}function Ev(c,y,T,I){const[E,z]=c.propsOptions;let P=!1,o;if(y)for(let J in y){if(Yc(J))continue;const re=y[J];let H;E&&Xi(E,H=Bs(J))?!z||!z.includes(H)?T[H]=re:(o||(o={}))[H]=re:Wf(c.emitsOptions,J)||(!(J in I)||re!==I[J])&&(I[J]=re,P=!0)}if(z){const J=Fi(T),re=o||hn;for(let H=0;H<z.length;H++){const ie=z[H];T[ie]=Op(E,J,ie,re[ie],c,!Xi(re,ie))}}return P}function Op(c,y,T,I,E,z){const P=c[T];if(P!=null){const o=Xi(P,"default");if(o&&I===void 0){const J=P.default;if(P.type!==Function&&!P.skipFactory&&Ii(J)){const{propsDefaults:re}=E;if(T in re)I=re[T];else{const H=mh(E);I=re[T]=J.call(null,y),H()}}else I=J;E.ce&&E.ce._setProp(T,I)}P[0]&&(z&&!o?I=!1:P[1]&&(I===""||I===ql(T))&&(I=!0))}return I}const O1=new WeakMap;function Cv(c,y,T=!1){const I=T?O1:y.propsCache,E=I.get(c);if(E)return E;const z=c.props,P={},o=[];let J=!1;if(!Ii(c)){const H=ie=>{J=!0;const[ce,Y]=Cv(ie,y,!0);Ir(P,ce),Y&&o.push(...Y)};!T&&y.mixins.length&&y.mixins.forEach(H),c.extends&&H(c.extends),c.mixins&&c.mixins.forEach(H)}if(!z&&!J)return bn(c)&&I.set(c,Vu),Vu;if(pi(z))for(let H=0;H<z.length;H++){const ie=Bs(z[H]);__(ie)&&(P[ie]=hn)}else if(z)for(const H in z){const ie=Bs(H);if(__(ie)){const ce=z[H],Y=P[ie]=pi(ce)||Ii(ce)?{type:ce}:Ir({},ce),le=Y.type;let Xe=!1,ft=!0;if(pi(le))for(let it=0;it<le.length;++it){const Qe=le[it],tt=Ii(Qe)&&Qe.name;if(tt==="Boolean"){Xe=!0;break}else tt==="String"&&(ft=!1)}else Xe=Ii(le)&&le.name==="Boolean";Y[0]=Xe,Y[1]=ft,(Xe||Xi(Y,"default"))&&o.push(ie)}}const re=[P,o];return bn(c)&&I.set(c,re),re}function __(c){return c[0]!=="$"&&!Yc(c)}const cm=c=>c[0]==="_"||c==="$stable",hm=c=>pi(c)?c.map(Ca):[Ca(c)],F1=(c,y,T)=>{if(y._n)return y;const I=lv((...E)=>hm(y(...E)),T);return I._c=!1,I},Pv=(c,y,T)=>{const I=c._ctx;for(const E in c){if(cm(E))continue;const z=c[E];if(Ii(z))y[E]=F1(E,z,I);else if(z!=null){const P=hm(z);y[E]=()=>P}}},Mv=(c,y)=>{const T=hm(y);c.slots.default=()=>T},Av=(c,y,T)=>{for(const I in y)(T||!cm(I))&&(c[I]=y[I])},B1=(c,y,T)=>{const I=c.slots=Iv();if(c.vnode.shapeFlag&32){const E=y.__;E&&Cp(I,"__",E,!0);const z=y._;z?(Av(I,y,T),T&&Cp(I,"_",z,!0)):Pv(y,I)}else y&&Mv(c,y)},j1=(c,y,T)=>{const{vnode:I,slots:E}=c;let z=!0,P=hn;if(I.shapeFlag&32){const o=y._;o?T&&o===1?z=!1:Av(E,y,T):(z=!y.$stable,Pv(y,E)),P=y}else y&&(Mv(c,y),P={default:1});if(z)for(const o in E)!cm(o)&&P[o]==null&&delete E[o]},vs=ew;function V1(c){return U1(c)}function U1(c,y){const T=Gf();T.__VUE__=!0;const{insert:I,remove:E,patchProp:z,createElement:P,createText:o,createComment:J,setText:re,setElementText:H,parentNode:ie,nextSibling:ce,setScopeId:Y=Ma,insertStaticContent:le}=c,Xe=(q,Te,Ze,ot=null,ht=null,rt=null,kt=void 0,Re=null,It=!!Te.dynamicChildren)=>{if(q===Te)return;q&&!Bl(q,Te)&&(ot=kr(q),Jt(q,ht,rt,!0),q=null),Te.patchFlag===-2&&(It=!1,Te.dynamicChildren=null);const{type:_t,ref:$t,shapeFlag:At}=Te;switch(_t){case Yf:ft(q,Te,Ze,ot);break;case Yr:it(q,Te,Ze,ot);break;case yf:q==null&&Qe(Te,Ze,ot,kt);break;case Wr:ct(q,Te,Ze,ot,ht,rt,kt,Re,It);break;default:At&1?qe(q,Te,Ze,ot,ht,rt,kt,Re,It):At&6?Pt(q,Te,Ze,ot,ht,rt,kt,Re,It):(At&64||At&128)&&_t.process(q,Te,Ze,ot,ht,rt,kt,Re,It,Ci)}$t!=null&&ht?Qc($t,q&&q.ref,rt,Te||q,!Te):$t==null&&q&&q.ref!=null&&Qc(q.ref,null,rt,q,!0)},ft=(q,Te,Ze,ot)=>{if(q==null)I(Te.el=o(Te.children),Ze,ot);else{const ht=Te.el=q.el;Te.children!==q.children&&re(ht,Te.children)}},it=(q,Te,Ze,ot)=>{q==null?I(Te.el=J(Te.children||""),Ze,ot):Te.el=q.el},Qe=(q,Te,Ze,ot)=>{[q.el,q.anchor]=le(q.children,Te,Ze,ot,q.el,q.anchor)},tt=({el:q,anchor:Te},Ze,ot)=>{let ht;for(;q&&q!==Te;)ht=ce(q),I(q,Ze,ot),q=ht;I(Te,Ze,ot)},We=({el:q,anchor:Te})=>{let Ze;for(;q&&q!==Te;)Ze=ce(q),E(q),q=Ze;E(Te)},qe=(q,Te,Ze,ot,ht,rt,kt,Re,It)=>{Te.type==="svg"?kt="svg":Te.type==="math"&&(kt="mathml"),q==null?Ke(Te,Ze,ot,ht,rt,kt,Re,It):Ye(q,Te,ht,rt,kt,Re,It)},Ke=(q,Te,Ze,ot,ht,rt,kt,Re)=>{let It,_t;const{props:$t,shapeFlag:At,transition:mt,dirs:Qt}=q;if(It=q.el=P(q.type,rt,$t&&$t.is,$t),At&8?H(It,q.children):At&16&&dt(q.children,It,null,ot,ht,op(q,rt),kt,Re),Qt&&Dl(q,null,ot,"created"),pt(It,q,q.scopeId,kt,ot),$t){for(const gi in $t)gi!=="value"&&!Yc(gi)&&z(It,gi,null,$t[gi],rt,ot);"value"in $t&&z(It,"value",null,$t.value,rt),(_t=$t.onVnodeBeforeMount)&&ka(_t,ot,q)}Qt&&Dl(q,null,ot,"beforeMount");const fi=G1(ht,mt);fi&&mt.beforeEnter(It),I(It,Te,Ze),((_t=$t&&$t.onVnodeMounted)||fi||Qt)&&vs(()=>{_t&&ka(_t,ot,q),fi&&mt.enter(It),Qt&&Dl(q,null,ot,"mounted")},ht)},pt=(q,Te,Ze,ot,ht)=>{if(Ze&&Y(q,Ze),ot)for(let rt=0;rt<ot.length;rt++)Y(q,ot[rt]);if(ht){let rt=ht.subTree;if(Te===rt||Ov(rt.type)&&(rt.ssContent===Te||rt.ssFallback===Te)){const kt=ht.vnode;pt(q,kt,kt.scopeId,kt.slotScopeIds,ht.parent)}}},dt=(q,Te,Ze,ot,ht,rt,kt,Re,It=0)=>{for(let _t=It;_t<q.length;_t++){const $t=q[_t]=Re?No(q[_t]):Ca(q[_t]);Xe(null,$t,Te,Ze,ot,ht,rt,kt,Re)}},Ye=(q,Te,Ze,ot,ht,rt,kt)=>{const Re=Te.el=q.el;let{patchFlag:It,dynamicChildren:_t,dirs:$t}=Te;It|=q.patchFlag&16;const At=q.props||hn,mt=Te.props||hn;let Qt;if(Ze&&zl(Ze,!1),(Qt=mt.onVnodeBeforeUpdate)&&ka(Qt,Ze,Te,q),$t&&Dl(Te,q,Ze,"beforeUpdate"),Ze&&zl(Ze,!0),(At.innerHTML&&mt.innerHTML==null||At.textContent&&mt.textContent==null)&&H(Re,""),_t?Ct(q.dynamicChildren,_t,Re,Ze,ot,op(Te,ht),rt):kt||ui(q,Te,Re,null,Ze,ot,op(Te,ht),rt,!1),It>0){if(It&16)Dt(Re,At,mt,Ze,ht);else if(It&2&&At.class!==mt.class&&z(Re,"class",null,mt.class,ht),It&4&&z(Re,"style",At.style,mt.style,ht),It&8){const fi=Te.dynamicProps;for(let gi=0;gi<fi.length;gi++){const Et=fi[gi],sn=At[Et],si=mt[Et];(si!==sn||Et==="value")&&z(Re,Et,sn,si,ht,Ze)}}It&1&&q.children!==Te.children&&H(Re,Te.children)}else!kt&&_t==null&&Dt(Re,At,mt,Ze,ht);((Qt=mt.onVnodeUpdated)||$t)&&vs(()=>{Qt&&ka(Qt,Ze,Te,q),$t&&Dl(Te,q,Ze,"updated")},ot)},Ct=(q,Te,Ze,ot,ht,rt,kt)=>{for(let Re=0;Re<Te.length;Re++){const It=q[Re],_t=Te[Re],$t=It.el&&(It.type===Wr||!Bl(It,_t)||It.shapeFlag&198)?ie(It.el):Ze;Xe(It,_t,$t,null,ot,ht,rt,kt,!0)}},Dt=(q,Te,Ze,ot,ht)=>{if(Te!==Ze){if(Te!==hn)for(const rt in Te)!Yc(rt)&&!(rt in Ze)&&z(q,rt,Te[rt],null,ht,ot);for(const rt in Ze){if(Yc(rt))continue;const kt=Ze[rt],Re=Te[rt];kt!==Re&&rt!=="value"&&z(q,rt,Re,kt,ht,ot)}"value"in Ze&&z(q,"value",Te.value,Ze.value,ht)}},ct=(q,Te,Ze,ot,ht,rt,kt,Re,It)=>{const _t=Te.el=q?q.el:o(""),$t=Te.anchor=q?q.anchor:o("");let{patchFlag:At,dynamicChildren:mt,slotScopeIds:Qt}=Te;Qt&&(Re=Re?Re.concat(Qt):Qt),q==null?(I(_t,Ze,ot),I($t,Ze,ot),dt(Te.children||[],Ze,$t,ht,rt,kt,Re,It)):At>0&&At&64&&mt&&q.dynamicChildren?(Ct(q.dynamicChildren,mt,Ze,ht,rt,kt,Re),(Te.key!=null||ht&&Te===ht.subTree)&&Rv(q,Te,!0)):ui(q,Te,Ze,$t,ht,rt,kt,Re,It)},Pt=(q,Te,Ze,ot,ht,rt,kt,Re,It)=>{Te.slotScopeIds=Re,q==null?Te.shapeFlag&512?ht.ctx.activate(Te,Ze,ot,kt,It):ut(Te,Ze,ot,ht,rt,kt,It):Bt(q,Te,It)},ut=(q,Te,Ze,ot,ht,rt,kt)=>{const Re=q.component=lw(q,ot,ht);if(Hf(q)&&(Re.ctx.renderer=Ci),cw(Re,!1,kt),Re.asyncDep){if(ht&&ht.registerDep(Re,qt,kt),!q.el){const It=Re.subTree=tn(Yr);it(null,It,Te,Ze)}}else qt(Re,q,Te,Ze,ht,rt,kt)},Bt=(q,Te,Ze)=>{const ot=Te.component=q.component;if(J1(q,Te,Ze))if(ot.asyncDep&&!ot.asyncResolved){Ut(ot,Te,Ze);return}else ot.next=Te,ot.update();else Te.el=q.el,ot.vnode=Te},qt=(q,Te,Ze,ot,ht,rt,kt)=>{const Re=()=>{if(q.isMounted){let{next:At,bu:mt,u:Qt,parent:fi,vnode:gi}=q;{const Ee=Lv(q);if(Ee){At&&(At.el=gi.el,Ut(q,At,kt)),Ee.asyncDep.then(()=>{q.isUnmounted||Re()});return}}let Et=At,sn;zl(q,!1),At?(At.el=gi.el,Ut(q,At,kt)):At=gi,mt&&ep(mt),(sn=At.props&&At.props.onVnodeBeforeUpdate)&&ka(sn,fi,At,gi),zl(q,!0);const si=v_(q),Zt=q.subTree;q.subTree=si,Xe(Zt,si,ie(Zt.el),kr(Zt),q,ht,rt),At.el=si.el,Et===null&&Q1(q,si.el),Qt&&vs(Qt,ht),(sn=At.props&&At.props.onVnodeUpdated)&&vs(()=>ka(sn,fi,At,gi),ht)}else{let At;const{el:mt,props:Qt}=Te,{bm:fi,m:gi,parent:Et,root:sn,type:si}=q,Zt=eh(Te);zl(q,!1),fi&&ep(fi),!Zt&&(At=Qt&&Qt.onVnodeBeforeMount)&&ka(At,Et,Te),zl(q,!0);{sn.ce&&sn.ce._def.shadowRoot!==!1&&sn.ce._injectChildStyle(si);const Ee=q.subTree=v_(q);Xe(null,Ee,Ze,ot,q,ht,rt),Te.el=Ee.el}if(gi&&vs(gi,ht),!Zt&&(At=Qt&&Qt.onVnodeMounted)){const Ee=Te;vs(()=>ka(At,Et,Ee),ht)}(Te.shapeFlag&256||Et&&eh(Et.vnode)&&Et.vnode.shapeFlag&256)&&q.a&&vs(q.a,ht),q.isMounted=!0,Te=Ze=ot=null}};q.scope.on();const It=q.effect=new jy(Re);q.scope.off();const _t=q.update=It.run.bind(It),$t=q.job=It.runIfDirty.bind(It);$t.i=q,$t.id=q.uid,It.scheduler=()=>om($t),zl(q,!0),_t()},Ut=(q,Te,Ze)=>{Te.component=q;const ot=q.vnode.props;q.vnode=Te,q.next=null,N1(q,Te.props,ot,Ze),j1(q,Te.children,Ze),no(),c_(q),ro()},ui=(q,Te,Ze,ot,ht,rt,kt,Re,It=!1)=>{const _t=q&&q.children,$t=q?q.shapeFlag:0,At=Te.children,{patchFlag:mt,shapeFlag:Qt}=Te;if(mt>0){if(mt&128){Ot(_t,At,Ze,ot,ht,rt,kt,Re,It);return}else if(mt&256){Ni(_t,At,Ze,ot,ht,rt,kt,Re,It);return}}Qt&8?($t&16&&yr(_t,ht,rt),At!==_t&&H(Ze,At)):$t&16?Qt&16?Ot(_t,At,Ze,ot,ht,rt,kt,Re,It):yr(_t,ht,rt,!0):($t&8&&H(Ze,""),Qt&16&&dt(At,Ze,ot,ht,rt,kt,Re,It))},Ni=(q,Te,Ze,ot,ht,rt,kt,Re,It)=>{q=q||Vu,Te=Te||Vu;const _t=q.length,$t=Te.length,At=Math.min(_t,$t);let mt;for(mt=0;mt<At;mt++){const Qt=Te[mt]=It?No(Te[mt]):Ca(Te[mt]);Xe(q[mt],Qt,Ze,null,ht,rt,kt,Re,It)}_t>$t?yr(q,ht,rt,!0,!1,At):dt(Te,Ze,ot,ht,rt,kt,Re,It,At)},Ot=(q,Te,Ze,ot,ht,rt,kt,Re,It)=>{let _t=0;const $t=Te.length;let At=q.length-1,mt=$t-1;for(;_t<=At&&_t<=mt;){const Qt=q[_t],fi=Te[_t]=It?No(Te[_t]):Ca(Te[_t]);if(Bl(Qt,fi))Xe(Qt,fi,Ze,null,ht,rt,kt,Re,It);else break;_t++}for(;_t<=At&&_t<=mt;){const Qt=q[At],fi=Te[mt]=It?No(Te[mt]):Ca(Te[mt]);if(Bl(Qt,fi))Xe(Qt,fi,Ze,null,ht,rt,kt,Re,It);else break;At--,mt--}if(_t>At){if(_t<=mt){const Qt=mt+1,fi=Qt<$t?Te[Qt].el:ot;for(;_t<=mt;)Xe(null,Te[_t]=It?No(Te[_t]):Ca(Te[_t]),Ze,fi,ht,rt,kt,Re,It),_t++}}else if(_t>mt)for(;_t<=At;)Jt(q[_t],ht,rt,!0),_t++;else{const Qt=_t,fi=_t,gi=new Map;for(_t=fi;_t<=mt;_t++){const Q=Te[_t]=It?No(Te[_t]):Ca(Te[_t]);Q.key!=null&&gi.set(Q.key,_t)}let Et,sn=0;const si=mt-fi+1;let Zt=!1,Ee=0;const W=new Array(si);for(_t=0;_t<si;_t++)W[_t]=0;for(_t=Qt;_t<=At;_t++){const Q=q[_t];if(sn>=si){Jt(Q,ht,rt,!0);continue}let pe;if(Q.key!=null)pe=gi.get(Q.key);else for(Et=fi;Et<=mt;Et++)if(W[Et-fi]===0&&Bl(Q,Te[Et])){pe=Et;break}pe===void 0?Jt(Q,ht,rt,!0):(W[pe-fi]=_t+1,pe>=Ee?Ee=pe:Zt=!0,Xe(Q,Te[pe],Ze,null,ht,rt,kt,Re,It),sn++)}const ee=Zt?q1(W):Vu;for(Et=ee.length-1,_t=si-1;_t>=0;_t--){const Q=fi+_t,pe=Te[Q],Se=Q+1<$t?Te[Q+1].el:ot;W[_t]===0?Xe(null,pe,Ze,Se,ht,rt,kt,Re,It):Zt&&(Et<0||_t!==ee[Et]?Ei(pe,Ze,Se,2):Et--)}}},Ei=(q,Te,Ze,ot,ht=null)=>{const{el:rt,type:kt,transition:Re,children:It,shapeFlag:_t}=q;if(_t&6){Ei(q.component.subTree,Te,Ze,ot);return}if(_t&128){q.suspense.move(Te,Ze,ot);return}if(_t&64){kt.move(q,Te,Ze,Ci);return}if(kt===Wr){I(rt,Te,Ze);for(let At=0;At<It.length;At++)Ei(It[At],Te,Ze,ot);I(q.anchor,Te,Ze);return}if(kt===yf){tt(q,Te,Ze);return}if(ot!==2&&_t&1&&Re)if(ot===0)Re.beforeEnter(rt),I(rt,Te,Ze),vs(()=>Re.enter(rt),ht);else{const{leave:At,delayLeave:mt,afterLeave:Qt}=Re,fi=()=>{q.ctx.isUnmounted?E(rt):I(rt,Te,Ze)},gi=()=>{At(rt,()=>{fi(),Qt&&Qt()})};mt?mt(rt,fi,gi):gi()}else I(rt,Te,Ze)},Jt=(q,Te,Ze,ot=!1,ht=!1)=>{const{type:rt,props:kt,ref:Re,children:It,dynamicChildren:_t,shapeFlag:$t,patchFlag:At,dirs:mt,cacheIndex:Qt}=q;if(At===-2&&(ht=!1),Re!=null&&(no(),Qc(Re,null,Ze,q,!0),ro()),Qt!=null&&(Te.renderCache[Qt]=void 0),$t&256){Te.ctx.deactivate(q);return}const fi=$t&1&&mt,gi=!eh(q);let Et;if(gi&&(Et=kt&&kt.onVnodeBeforeUnmount)&&ka(Et,Te,q),$t&6)Pn(q.component,Ze,ot);else{if($t&128){q.suspense.unmount(Ze,ot);return}fi&&Dl(q,null,Te,"beforeUnmount"),$t&64?q.type.remove(q,Te,Ze,Ci,ot):_t&&!_t.hasOnce&&(rt!==Wr||At>0&&At&64)?yr(_t,Te,Ze,!1,!0):(rt===Wr&&At&384||!ht&&$t&16)&&yr(It,Te,Ze),ot&&Ui(q)}(gi&&(Et=kt&&kt.onVnodeUnmounted)||fi)&&vs(()=>{Et&&ka(Et,Te,q),fi&&Dl(q,null,Te,"unmounted")},Ze)},Ui=q=>{const{type:Te,el:Ze,anchor:ot,transition:ht}=q;if(Te===Wr){ri(Ze,ot);return}if(Te===yf){We(q);return}const rt=()=>{E(Ze),ht&&!ht.persisted&&ht.afterLeave&&ht.afterLeave()};if(q.shapeFlag&1&&ht&&!ht.persisted){const{leave:kt,delayLeave:Re}=ht,It=()=>kt(Ze,rt);Re?Re(q.el,rt,It):It()}else rt()},ri=(q,Te)=>{let Ze;for(;q!==Te;)Ze=ce(q),E(q),q=Ze;E(Te)},Pn=(q,Te,Ze)=>{const{bum:ot,scope:ht,job:rt,subTree:kt,um:Re,m:It,a:_t,parent:$t,slots:{__:At}}=q;y_(It),y_(_t),ot&&ep(ot),$t&&pi(At)&&At.forEach(mt=>{$t.renderCache[mt]=void 0}),ht.stop(),rt&&(rt.flags|=8,Jt(kt,q,Te,Ze)),Re&&vs(Re,Te),vs(()=>{q.isUnmounted=!0},Te),Te&&Te.pendingBranch&&!Te.isUnmounted&&q.asyncDep&&!q.asyncResolved&&q.suspenseId===Te.pendingId&&(Te.deps--,Te.deps===0&&Te.resolve())},yr=(q,Te,Ze,ot=!1,ht=!1,rt=0)=>{for(let kt=rt;kt<q.length;kt++)Jt(q[kt],Te,Ze,ot,ht)},kr=q=>{if(q.shapeFlag&6)return kr(q.component.subTree);if(q.shapeFlag&128)return q.suspense.next();const Te=ce(q.anchor||q.el),Ze=Te&&Te[h1];return Ze?ce(Ze):Te};let Ne=!1;const rn=(q,Te,Ze)=>{q==null?Te._vnode&&Jt(Te._vnode,null,null,!0):Xe(Te._vnode||null,q,Te,null,null,null,Ze),Te._vnode=q,Ne||(Ne=!0,c_(),sv(),Ne=!1)},Ci={p:Xe,um:Jt,m:Ei,r:Ui,mt:ut,mc:dt,pc:ui,pbc:Ct,n:kr,o:c};return{render:rn,hydrate:void 0,createApp:L1(rn)}}function op({type:c,props:y},T){return T==="svg"&&c==="foreignObject"||T==="mathml"&&c==="annotation-xml"&&y&&y.encoding&&y.encoding.includes("html")?void 0:T}function zl({effect:c,job:y},T){T?(c.flags|=32,y.flags|=4):(c.flags&=-33,y.flags&=-5)}function G1(c,y){return(!c||c&&!c.pendingBranch)&&y&&!y.persisted}function Rv(c,y,T=!1){const I=c.children,E=y.children;if(pi(I)&&pi(E))for(let z=0;z<I.length;z++){const P=I[z];let o=E[z];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=E[z]=No(E[z]),o.el=P.el),!T&&o.patchFlag!==-2&&Rv(P,o)),o.type===Yf&&(o.el=P.el),o.type===Yr&&!o.el&&(o.el=P.el)}}function q1(c){const y=c.slice(),T=[0];let I,E,z,P,o;const J=c.length;for(I=0;I<J;I++){const re=c[I];if(re!==0){if(E=T[T.length-1],c[E]<re){y[I]=E,T.push(I);continue}for(z=0,P=T.length-1;z<P;)o=z+P>>1,c[T[o]]<re?z=o+1:P=o;re<c[T[z]]&&(z>0&&(y[I]=T[z-1]),T[z]=I)}}for(z=T.length,P=T[z-1];z-- >0;)T[z]=P,P=y[P];return T}function Lv(c){const y=c.subTree.component;if(y)return y.asyncDep&&!y.asyncResolved?y:Lv(y)}function y_(c){if(c)for(let y=0;y<c.length;y++)c[y].flags|=8}const $1=Symbol.for("v-scx"),Z1=()=>jo($1);function Ul(c,y,T){return Dv(c,y,T)}function Dv(c,y,T=hn){const{immediate:I,deep:E,flush:z,once:P}=T,o=Ir({},T),J=y&&I||!y&&z!=="post";let re;if(uh){if(z==="sync"){const Y=Z1();re=Y.__watcherHandles||(Y.__watcherHandles=[])}else if(!J){const Y=()=>{};return Y.stop=Ma,Y.resume=Ma,Y.pause=Ma,Y}}const H=gr;o.call=(Y,le,Xe)=>oa(Y,H,le,Xe);let ie=!1;z==="post"?o.scheduler=Y=>{vs(Y,H&&H.suspense)}:z!=="sync"&&(ie=!0,o.scheduler=(Y,le)=>{le?Y():om(Y)}),o.augmentJob=Y=>{y&&(Y.flags|=4),ie&&(Y.flags|=2,H&&(Y.id=H.uid,Y.i=H))};const ce=o1(c,y,o);return uh&&(re?re.push(ce):J&&ce()),ce}function H1(c,y,T){const I=this.proxy,E=Dn(c)?c.includes(".")?zv(I,c):()=>I[c]:c.bind(I,I);let z;Ii(y)?z=y:(z=y.handler,T=y);const P=mh(this),o=Dv(E,z.bind(I),T);return P(),o}function zv(c,y){const T=y.split(".");return()=>{let I=c;for(let E=0;E<T.length&&I;E++)I=I[T[E]];return I}}const X1=(c,y)=>y==="modelValue"||y==="model-value"?c.modelModifiers:c[`${y}Modifiers`]||c[`${Bs(y)}Modifiers`]||c[`${ql(y)}Modifiers`];function W1(c,y,...T){if(c.isUnmounted)return;const I=c.vnode.props||hn;let E=T;const z=y.startsWith("update:"),P=z&&X1(I,y.slice(7));P&&(P.trim&&(E=T.map(H=>Dn(H)?H.trim():H)),P.number&&(E=T.map(Tb)));let o,J=I[o=Qd(y)]||I[o=Qd(Bs(y))];!J&&z&&(J=I[o=Qd(ql(y))]),J&&oa(J,c,6,E);const re=I[o+"Once"];if(re){if(!c.emitted)c.emitted={};else if(c.emitted[o])return;c.emitted[o]=!0,oa(re,c,6,E)}}function Nv(c,y,T=!1){const I=y.emitsCache,E=I.get(c);if(E!==void 0)return E;const z=c.emits;let P={},o=!1;if(!Ii(c)){const J=re=>{const H=Nv(re,y,!0);H&&(o=!0,Ir(P,H))};!T&&y.mixins.length&&y.mixins.forEach(J),c.extends&&J(c.extends),c.mixins&&c.mixins.forEach(J)}return!z&&!o?(bn(c)&&I.set(c,null),null):(pi(z)?z.forEach(J=>P[J]=null):Ir(P,z),bn(c)&&I.set(c,P),P)}function Wf(c,y){return!c||!Bf(y)?!1:(y=y.slice(2).replace(/Once$/,""),Xi(c,y[0].toLowerCase()+y.slice(1))||Xi(c,ql(y))||Xi(c,y))}function v_(c){const{type:y,vnode:T,proxy:I,withProxy:E,propsOptions:[z],slots:P,attrs:o,emit:J,render:re,renderCache:H,props:ie,data:ce,setupState:Y,ctx:le,inheritAttrs:Xe}=c,ft=Pf(c);let it,Qe;try{if(T.shapeFlag&4){const We=E||I,qe=We;it=Ca(re.call(qe,We,H,ie,Y,ce,le)),Qe=o}else{const We=y;it=Ca(We.length>1?We(ie,{attrs:o,slots:P,emit:J}):We(ie,null)),Qe=y.props?o:Y1(o)}}catch(We){ih.length=0,Zf(We,c,1),it=tn(Yr)}let tt=it;if(Qe&&Xe!==!1){const We=Object.keys(Qe),{shapeFlag:qe}=tt;We.length&&qe&7&&(z&&We.some(Wp)&&(Qe=K1(Qe,z)),tt=Uo(tt,Qe,!1,!0))}return T.dirs&&(tt=Uo(tt,null,!1,!0),tt.dirs=tt.dirs?tt.dirs.concat(T.dirs):T.dirs),T.transition&&oh(tt,T.transition),it=tt,Pf(ft),it}const Y1=c=>{let y;for(const T in c)(T==="class"||T==="style"||Bf(T))&&((y||(y={}))[T]=c[T]);return y},K1=(c,y)=>{const T={};for(const I in c)(!Wp(I)||!(I.slice(9)in y))&&(T[I]=c[I]);return T};function J1(c,y,T){const{props:I,children:E,component:z}=c,{props:P,children:o,patchFlag:J}=y,re=z.emitsOptions;if(y.dirs||y.transition)return!0;if(T&&J>=0){if(J&1024)return!0;if(J&16)return I?x_(I,P,re):!!P;if(J&8){const H=y.dynamicProps;for(let ie=0;ie<H.length;ie++){const ce=H[ie];if(P[ce]!==I[ce]&&!Wf(re,ce))return!0}}}else return(E||o)&&(!o||!o.$stable)?!0:I===P?!1:I?P?x_(I,P,re):!0:!!P;return!1}function x_(c,y,T){const I=Object.keys(y);if(I.length!==Object.keys(c).length)return!0;for(let E=0;E<I.length;E++){const z=I[E];if(y[z]!==c[z]&&!Wf(T,z))return!0}return!1}function Q1({vnode:c,parent:y},T){for(;y;){const I=y.subTree;if(I.suspense&&I.suspense.activeBranch===c&&(I.el=c.el),I===c)(c=y.vnode).el=T,y=y.parent;else break}}const Ov=c=>c.__isSuspense;function ew(c,y){y&&y.pendingBranch?pi(c)?y.effects.push(...c):y.effects.push(c):c1(c)}const Wr=Symbol.for("v-fgt"),Yf=Symbol.for("v-txt"),Yr=Symbol.for("v-cmt"),yf=Symbol.for("v-stc"),ih=[];let bs=null;function mi(c=!1){ih.push(bs=c?null:[])}function tw(){ih.pop(),bs=ih[ih.length-1]||null}let lh=1;function b_(c,y=!1){lh+=c,c<0&&bs&&y&&(bs.hasOnce=!0)}function Fv(c){return c.dynamicChildren=lh>0?bs||Vu:null,tw(),lh>0&&bs&&bs.push(c),c}function Di(c,y,T,I,E,z){return Fv(vt(c,y,T,I,E,z,!0))}function Aa(c,y,T,I,E){return Fv(tn(c,y,T,I,E,!0))}function Af(c){return c?c.__v_isVNode===!0:!1}function Bl(c,y){return c.type===y.type&&c.key===y.key}const Bv=({key:c})=>c??null,vf=({ref:c,ref_key:y,ref_for:T})=>(typeof c=="number"&&(c=""+c),c!=null?Dn(c)||Vn(c)||Ii(c)?{i:xs,r:c,k:y,f:!!T}:c:null);function vt(c,y=null,T=null,I=0,E=null,z=c===Wr?0:1,P=!1,o=!1){const J={__v_isVNode:!0,__v_skip:!0,type:c,props:y,key:y&&Bv(y),ref:y&&vf(y),scopeId:ov,slotScopeIds:null,children:T,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:z,patchFlag:I,dynamicProps:E,dynamicChildren:null,appContext:null,ctx:xs};return o?(fm(J,T),z&128&&c.normalize(J)):T&&(J.shapeFlag|=Dn(T)?8:16),lh>0&&!P&&bs&&(J.patchFlag>0||z&6)&&J.patchFlag!==32&&bs.push(J),J}const tn=iw;function iw(c,y=null,T=null,I=0,E=null,z=!1){if((!c||c===vv)&&(c=Yr),Af(c)){const o=Uo(c,y,!0);return T&&fm(o,T),lh>0&&!z&&bs&&(o.shapeFlag&6?bs[bs.indexOf(c)]=o:bs.push(o)),o.patchFlag=-2,o}if(mw(c)&&(c=c.__vccOpts),y){y=nw(y);let{class:o,style:J}=y;o&&!Dn(o)&&(y.class=Jp(o)),bn(J)&&(sm(J)&&!pi(J)&&(J=Ir({},J)),y.style=Wu(J))}const P=Dn(c)?1:Ov(c)?128:uv(c)?64:bn(c)?4:Ii(c)?2:0;return vt(c,y,T,I,E,P,z,!0)}function nw(c){return c?sm(c)||kv(c)?Ir({},c):c:null}function Uo(c,y,T=!1,I=!1){const{props:E,ref:z,patchFlag:P,children:o,transition:J}=c,re=y?sw(E||{},y):E,H={__v_isVNode:!0,__v_skip:!0,type:c.type,props:re,key:re&&Bv(re),ref:y&&y.ref?T&&z?pi(z)?z.concat(vf(y)):[z,vf(y)]:vf(y):z,scopeId:c.scopeId,slotScopeIds:c.slotScopeIds,children:o,target:c.target,targetStart:c.targetStart,targetAnchor:c.targetAnchor,staticCount:c.staticCount,shapeFlag:c.shapeFlag,patchFlag:y&&c.type!==Wr?P===-1?16:P|16:P,dynamicProps:c.dynamicProps,dynamicChildren:c.dynamicChildren,appContext:c.appContext,dirs:c.dirs,transition:J,component:c.component,suspense:c.suspense,ssContent:c.ssContent&&Uo(c.ssContent),ssFallback:c.ssFallback&&Uo(c.ssFallback),el:c.el,anchor:c.anchor,ctx:c.ctx,ce:c.ce};return J&&I&&oh(H,J.clone(H)),H}function qu(c=" ",y=0){return tn(Yf,null,c,y)}function rw(c,y){const T=tn(yf,null,c);return T.staticCount=y,T}function jn(c="",y=!1){return y?(mi(),Aa(Yr,null,c)):tn(Yr,null,c)}function Ca(c){return c==null||typeof c=="boolean"?tn(Yr):pi(c)?tn(Wr,null,c.slice()):Af(c)?No(c):tn(Yf,null,String(c))}function No(c){return c.el===null&&c.patchFlag!==-1||c.memo?c:Uo(c)}function fm(c,y){let T=0;const{shapeFlag:I}=c;if(y==null)y=null;else if(pi(y))T=16;else if(typeof y=="object")if(I&65){const E=y.default;E&&(E._c&&(E._d=!1),fm(c,E()),E._c&&(E._d=!0));return}else{T=32;const E=y._;!E&&!kv(y)?y._ctx=xs:E===3&&xs&&(xs.slots._===1?y._=1:(y._=2,c.patchFlag|=1024))}else Ii(y)?(y={default:y,_ctx:xs},T=32):(y=String(y),I&64?(T=16,y=[qu(y)]):T=8);c.children=y,c.shapeFlag|=T}function sw(...c){const y={};for(let T=0;T<c.length;T++){const I=c[T];for(const E in I)if(E==="class")y.class!==I.class&&(y.class=Jp([y.class,I.class]));else if(E==="style")y.style=Wu([y.style,I.style]);else if(Bf(E)){const z=y[E],P=I[E];P&&z!==P&&!(pi(z)&&z.includes(P))&&(y[E]=z?[].concat(z,P):P)}else E!==""&&(y[E]=I[E])}return y}function ka(c,y,T,I=null){oa(c,y,7,[T,I])}const aw=Tv();let ow=0;function lw(c,y,T){const I=c.type,E=(y?y.appContext:c.appContext)||aw,z={uid:ow++,vnode:c,type:I,parent:y,appContext:E,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Oy(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:y?y.provides:Object.create(E.provides),ids:y?y.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Cv(I,E),emitsOptions:Nv(I,E),emit:null,emitted:null,propsDefaults:hn,inheritAttrs:I.inheritAttrs,ctx:hn,data:hn,props:hn,attrs:hn,slots:hn,refs:hn,setupState:hn,setupContext:null,suspense:T,suspenseId:T?T.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return z.ctx={_:z},z.root=y?y.root:z,z.emit=W1.bind(null,z),c.ce&&c.ce(z),z}let gr=null;const uw=()=>gr||xs;let Rf,Fp;{const c=Gf(),y=(T,I)=>{let E;return(E=c[T])||(E=c[T]=[]),E.push(I),z=>{E.length>1?E.forEach(P=>P(z)):E[0](z)}};Rf=y("__VUE_INSTANCE_SETTERS__",T=>gr=T),Fp=y("__VUE_SSR_SETTERS__",T=>uh=T)}const mh=c=>{const y=gr;return Rf(c),c.scope.on(),()=>{c.scope.off(),Rf(y)}},w_=()=>{gr&&gr.scope.off(),Rf(null)};function jv(c){return c.vnode.shapeFlag&4}let uh=!1;function cw(c,y=!1,T=!1){y&&Fp(y);const{props:I,children:E}=c.vnode,z=jv(c);z1(c,I,z,y),B1(c,E,T||y);const P=z?hw(c,y):void 0;return y&&Fp(!1),P}function hw(c,y){const T=c.type;c.accessCache=Object.create(null),c.proxy=new Proxy(c.ctx,k1);const{setup:I}=T;if(I){no();const E=c.setupContext=I.length>1?dw(c):null,z=mh(c),P=fh(I,c,0,[c.props,E]),o=Ay(P);if(ro(),z(),(o||c.sp)&&!eh(c)&&mv(c),o){if(P.then(w_,w_),y)return P.then(J=>{T_(c,J)}).catch(J=>{Zf(J,c,0)});c.asyncDep=P}else T_(c,P)}else Vv(c)}function T_(c,y,T){Ii(y)?c.type.__ssrInlineRender?c.ssrRender=y:c.render=y:bn(y)&&(c.setupState=tv(y)),Vv(c)}function Vv(c,y,T){const I=c.type;c.render||(c.render=I.render||Ma);{const E=mh(c);no();try{E1(c)}finally{ro(),E()}}}const fw={get(c,y){return Nr(c,"get",""),c[y]}};function dw(c){const y=T=>{c.exposed=T||{}};return{attrs:new Proxy(c.attrs,fw),slots:c.slots,emit:c.emit,expose:y}}function dm(c){return c.exposed?c.exposeProxy||(c.exposeProxy=new Proxy(tv(am(c.exposed)),{get(y,T){if(T in y)return y[T];if(T in th)return th[T](c)},has(y,T){return T in y||T in th}})):c.proxy}function pw(c,y=!0){return Ii(c)?c.displayName||c.name:c.name||y&&c.__name}function mw(c){return Ii(c)&&"__vccOpts"in c}const io=(c,y)=>s1(c,y,uh);function Lf(c,y,T){const I=arguments.length;return I===2?bn(y)&&!pi(y)?Af(y)?tn(c,null,[y]):tn(c,y):tn(c,null,y):(I>3?T=Array.prototype.slice.call(arguments,2):I===3&&Af(T)&&(T=[T]),tn(c,y,T))}const gw="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Bp;const S_=typeof window<"u"&&window.trustedTypes;if(S_)try{Bp=S_.createPolicy("vue",{createHTML:c=>c})}catch{}const Uv=Bp?c=>Bp.createHTML(c):c=>c,_w="http://www.w3.org/2000/svg",yw="http://www.w3.org/1998/Math/MathML",eo=typeof document<"u"?document:null,I_=eo&&eo.createElement("template"),vw={insert:(c,y,T)=>{y.insertBefore(c,T||null)},remove:c=>{const y=c.parentNode;y&&y.removeChild(c)},createElement:(c,y,T,I)=>{const E=y==="svg"?eo.createElementNS(_w,c):y==="mathml"?eo.createElementNS(yw,c):T?eo.createElement(c,{is:T}):eo.createElement(c);return c==="select"&&I&&I.multiple!=null&&E.setAttribute("multiple",I.multiple),E},createText:c=>eo.createTextNode(c),createComment:c=>eo.createComment(c),setText:(c,y)=>{c.nodeValue=y},setElementText:(c,y)=>{c.textContent=y},parentNode:c=>c.parentNode,nextSibling:c=>c.nextSibling,querySelector:c=>eo.querySelector(c),setScopeId(c,y){c.setAttribute(y,"")},insertStaticContent(c,y,T,I,E,z){const P=T?T.previousSibling:y.lastChild;if(E&&(E===z||E.nextSibling))for(;y.insertBefore(E.cloneNode(!0),T),!(E===z||!(E=E.nextSibling)););else{I_.innerHTML=Uv(I==="svg"?`<svg>${c}</svg>`:I==="mathml"?`<math>${c}</math>`:c);const o=I_.content;if(I==="svg"||I==="mathml"){const J=o.firstChild;for(;J.firstChild;)o.appendChild(J.firstChild);o.removeChild(J)}y.insertBefore(o,T)}return[P?P.nextSibling:y.firstChild,T?T.previousSibling:y.lastChild]}},Ao="transition",Zc="animation",ch=Symbol("_vtc"),Gv={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},xw=Ir({},cv,Gv),bw=c=>(c.displayName="Transition",c.props=xw,c),ww=bw((c,{slots:y})=>Lf(p1,Tw(c),y)),Nl=(c,y=[])=>{pi(c)?c.forEach(T=>T(...y)):c&&c(...y)},k_=c=>c?pi(c)?c.some(y=>y.length>1):c.length>1:!1;function Tw(c){const y={};for(const ct in c)ct in Gv||(y[ct]=c[ct]);if(c.css===!1)return y;const{name:T="v",type:I,duration:E,enterFromClass:z=`${T}-enter-from`,enterActiveClass:P=`${T}-enter-active`,enterToClass:o=`${T}-enter-to`,appearFromClass:J=z,appearActiveClass:re=P,appearToClass:H=o,leaveFromClass:ie=`${T}-leave-from`,leaveActiveClass:ce=`${T}-leave-active`,leaveToClass:Y=`${T}-leave-to`}=c,le=Sw(E),Xe=le&&le[0],ft=le&&le[1],{onBeforeEnter:it,onEnter:Qe,onEnterCancelled:tt,onLeave:We,onLeaveCancelled:qe,onBeforeAppear:Ke=it,onAppear:pt=Qe,onAppearCancelled:dt=tt}=y,Ye=(ct,Pt,ut,Bt)=>{ct._enterCancelled=Bt,Ol(ct,Pt?H:o),Ol(ct,Pt?re:P),ut&&ut()},Ct=(ct,Pt)=>{ct._isLeaving=!1,Ol(ct,ie),Ol(ct,Y),Ol(ct,ce),Pt&&Pt()},Dt=ct=>(Pt,ut)=>{const Bt=ct?pt:Qe,qt=()=>Ye(Pt,ct,ut);Nl(Bt,[Pt,qt]),E_(()=>{Ol(Pt,ct?J:z),Qa(Pt,ct?H:o),k_(Bt)||C_(Pt,I,Xe,qt)})};return Ir(y,{onBeforeEnter(ct){Nl(it,[ct]),Qa(ct,z),Qa(ct,P)},onBeforeAppear(ct){Nl(Ke,[ct]),Qa(ct,J),Qa(ct,re)},onEnter:Dt(!1),onAppear:Dt(!0),onLeave(ct,Pt){ct._isLeaving=!0;const ut=()=>Ct(ct,Pt);Qa(ct,ie),ct._enterCancelled?(Qa(ct,ce),A_()):(A_(),Qa(ct,ce)),E_(()=>{ct._isLeaving&&(Ol(ct,ie),Qa(ct,Y),k_(We)||C_(ct,I,ft,ut))}),Nl(We,[ct,ut])},onEnterCancelled(ct){Ye(ct,!1,void 0,!0),Nl(tt,[ct])},onAppearCancelled(ct){Ye(ct,!0,void 0,!0),Nl(dt,[ct])},onLeaveCancelled(ct){Ct(ct),Nl(qe,[ct])}})}function Sw(c){if(c==null)return null;if(bn(c))return[lp(c.enter),lp(c.leave)];{const y=lp(c);return[y,y]}}function lp(c){return Sb(c)}function Qa(c,y){y.split(/\s+/).forEach(T=>T&&c.classList.add(T)),(c[ch]||(c[ch]=new Set)).add(y)}function Ol(c,y){y.split(/\s+/).forEach(I=>I&&c.classList.remove(I));const T=c[ch];T&&(T.delete(y),T.size||(c[ch]=void 0))}function E_(c){requestAnimationFrame(()=>{requestAnimationFrame(c)})}let Iw=0;function C_(c,y,T,I){const E=c._endId=++Iw,z=()=>{E===c._endId&&I()};if(T!=null)return setTimeout(z,T);const{type:P,timeout:o,propCount:J}=kw(c,y);if(!P)return I();const re=P+"end";let H=0;const ie=()=>{c.removeEventListener(re,ce),z()},ce=Y=>{Y.target===c&&++H>=J&&ie()};setTimeout(()=>{H<J&&ie()},o+1),c.addEventListener(re,ce)}function kw(c,y){const T=window.getComputedStyle(c),I=le=>(T[le]||"").split(", "),E=I(`${Ao}Delay`),z=I(`${Ao}Duration`),P=P_(E,z),o=I(`${Zc}Delay`),J=I(`${Zc}Duration`),re=P_(o,J);let H=null,ie=0,ce=0;y===Ao?P>0&&(H=Ao,ie=P,ce=z.length):y===Zc?re>0&&(H=Zc,ie=re,ce=J.length):(ie=Math.max(P,re),H=ie>0?P>re?Ao:Zc:null,ce=H?H===Ao?z.length:J.length:0);const Y=H===Ao&&/\b(transform|all)(,|$)/.test(I(`${Ao}Property`).toString());return{type:H,timeout:ie,propCount:ce,hasTransform:Y}}function P_(c,y){for(;c.length<y.length;)c=c.concat(c);return Math.max(...y.map((T,I)=>M_(T)+M_(c[I])))}function M_(c){return c==="auto"?0:Number(c.slice(0,-1).replace(",","."))*1e3}function A_(){return document.body.offsetHeight}function Ew(c,y,T){const I=c[ch];I&&(y=(y?[y,...I]:[...I]).join(" ")),y==null?c.removeAttribute("class"):T?c.setAttribute("class",y):c.className=y}const R_=Symbol("_vod"),Cw=Symbol("_vsh"),Pw=Symbol(""),Mw=/(^|;)\s*display\s*:/;function Aw(c,y,T){const I=c.style,E=Dn(T);let z=!1;if(T&&!E){if(y)if(Dn(y))for(const P of y.split(";")){const o=P.slice(0,P.indexOf(":")).trim();T[o]==null&&xf(I,o,"")}else for(const P in y)T[P]==null&&xf(I,P,"");for(const P in T)P==="display"&&(z=!0),xf(I,P,T[P])}else if(E){if(y!==T){const P=I[Pw];P&&(T+=";"+P),I.cssText=T,z=Mw.test(T)}}else y&&c.removeAttribute("style");R_ in c&&(c[R_]=z?I.display:"",c[Cw]&&(I.display="none"))}const L_=/\s*!important$/;function xf(c,y,T){if(pi(T))T.forEach(I=>xf(c,y,I));else if(T==null&&(T=""),y.startsWith("--"))c.setProperty(y,T);else{const I=Rw(c,y);L_.test(T)?c.setProperty(ql(I),T.replace(L_,""),"important"):c[I]=T}}const D_=["Webkit","Moz","ms"],up={};function Rw(c,y){const T=up[y];if(T)return T;let I=Bs(y);if(I!=="filter"&&I in c)return up[y]=I;I=Uf(I);for(let E=0;E<D_.length;E++){const z=D_[E]+I;if(z in c)return up[y]=z}return y}const z_="http://www.w3.org/1999/xlink";function N_(c,y,T,I,E,z=Mb(y)){I&&y.startsWith("xlink:")?T==null?c.removeAttributeNS(z_,y.slice(6,y.length)):c.setAttributeNS(z_,y,T):T==null||z&&!Dy(T)?c.removeAttribute(y):c.setAttribute(y,z?"":Go(T)?String(T):T)}function O_(c,y,T,I,E){if(y==="innerHTML"||y==="textContent"){T!=null&&(c[y]=y==="innerHTML"?Uv(T):T);return}const z=c.tagName;if(y==="value"&&z!=="PROGRESS"&&!z.includes("-")){const o=z==="OPTION"?c.getAttribute("value")||"":c.value,J=T==null?c.type==="checkbox"?"on":"":String(T);(o!==J||!("_value"in c))&&(c.value=J),T==null&&c.removeAttribute(y),c._value=T;return}let P=!1;if(T===""||T==null){const o=typeof c[y];o==="boolean"?T=Dy(T):T==null&&o==="string"?(T="",P=!0):o==="number"&&(T=0,P=!0)}try{c[y]=T}catch{}P&&c.removeAttribute(E||y)}function Lw(c,y,T,I){c.addEventListener(y,T,I)}function Dw(c,y,T,I){c.removeEventListener(y,T,I)}const F_=Symbol("_vei");function zw(c,y,T,I,E=null){const z=c[F_]||(c[F_]={}),P=z[y];if(I&&P)P.value=I;else{const[o,J]=Nw(y);if(I){const re=z[y]=Bw(I,E);Lw(c,o,re,J)}else P&&(Dw(c,o,P,J),z[y]=void 0)}}const B_=/(?:Once|Passive|Capture)$/;function Nw(c){let y;if(B_.test(c)){y={};let I;for(;I=c.match(B_);)c=c.slice(0,c.length-I[0].length),y[I[0].toLowerCase()]=!0}return[c[2]===":"?c.slice(3):ql(c.slice(2)),y]}let cp=0;const Ow=Promise.resolve(),Fw=()=>cp||(Ow.then(()=>cp=0),cp=Date.now());function Bw(c,y){const T=I=>{if(!I._vts)I._vts=Date.now();else if(I._vts<=T.attached)return;oa(jw(I,T.value),y,5,[I])};return T.value=c,T.attached=Fw(),T}function jw(c,y){if(pi(y)){const T=c.stopImmediatePropagation;return c.stopImmediatePropagation=()=>{T.call(c),c._stopped=!0},y.map(I=>E=>!E._stopped&&I&&I(E))}else return y}const j_=c=>c.charCodeAt(0)===111&&c.charCodeAt(1)===110&&c.charCodeAt(2)>96&&c.charCodeAt(2)<123,Vw=(c,y,T,I,E,z)=>{const P=E==="svg";y==="class"?Ew(c,I,P):y==="style"?Aw(c,T,I):Bf(y)?Wp(y)||zw(c,y,T,I,z):(y[0]==="."?(y=y.slice(1),!0):y[0]==="^"?(y=y.slice(1),!1):Uw(c,y,I,P))?(O_(c,y,I),!c.tagName.includes("-")&&(y==="value"||y==="checked"||y==="selected")&&N_(c,y,I,P,z,y!=="value")):c._isVueCE&&(/[A-Z]/.test(y)||!Dn(I))?O_(c,Bs(y),I,z,y):(y==="true-value"?c._trueValue=I:y==="false-value"&&(c._falseValue=I),N_(c,y,I,P))};function Uw(c,y,T,I){if(I)return!!(y==="innerHTML"||y==="textContent"||y in c&&j_(y)&&Ii(T));if(y==="spellcheck"||y==="draggable"||y==="translate"||y==="autocorrect"||y==="form"||y==="list"&&c.tagName==="INPUT"||y==="type"&&c.tagName==="TEXTAREA")return!1;if(y==="width"||y==="height"){const E=c.tagName;if(E==="IMG"||E==="VIDEO"||E==="CANVAS"||E==="SOURCE")return!1}return j_(y)&&Dn(T)?!1:y in c}const Gw=Ir({patchProp:Vw},vw);let V_;function qw(){return V_||(V_=V1(Gw))}const $w=(...c)=>{const y=qw().createApp(...c),{mount:T}=y;return y.mount=I=>{const E=Hw(I);if(!E)return;const z=y._component;!Ii(z)&&!z.render&&!z.template&&(z.template=E.innerHTML),E.nodeType===1&&(E.textContent="");const P=T(E,!1,Zw(E));return E instanceof Element&&(E.removeAttribute("v-cloak"),E.setAttribute("data-v-app","")),P},y};function Zw(c){if(c instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&c instanceof MathMLElement)return"mathml"}function Hw(c){return Dn(c)?document.querySelector(c):c}/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let qv;const Kf=c=>qv=c,$v=Symbol();function jp(c){return c&&typeof c=="object"&&Object.prototype.toString.call(c)==="[object Object]"&&typeof c.toJSON!="function"}var nh;(function(c){c.direct="direct",c.patchObject="patch object",c.patchFunction="patch function"})(nh||(nh={}));function Xw(){const c=Fy(!0),y=c.run(()=>vn({}));let T=[],I=[];const E=am({install(z){Kf(E),E._a=z,z.provide($v,E),z.config.globalProperties.$pinia=E,I.forEach(P=>T.push(P)),I=[]},use(z){return this._a?T.push(z):I.push(z),this},_p:T,_a:null,_e:c,_s:new Map,state:y});return E}const Zv=()=>{};function U_(c,y,T,I=Zv){c.push(y);const E=()=>{const z=c.indexOf(y);z>-1&&(c.splice(z,1),I())};return!T&&By()&&Ab(E),E}function Bu(c,...y){c.slice().forEach(T=>{T(...y)})}const Ww=c=>c(),G_=Symbol(),hp=Symbol();function Vp(c,y){c instanceof Map&&y instanceof Map?y.forEach((T,I)=>c.set(I,T)):c instanceof Set&&y instanceof Set&&y.forEach(c.add,c);for(const T in y){if(!y.hasOwnProperty(T))continue;const I=y[T],E=c[T];jp(E)&&jp(I)&&c.hasOwnProperty(T)&&!Vn(I)&&!Bo(I)?c[T]=Vp(E,I):c[T]=I}return c}const Yw=Symbol();function Kw(c){return!jp(c)||!Object.prototype.hasOwnProperty.call(c,Yw)}const{assign:Lo}=Object;function Jw(c){return!!(Vn(c)&&c.effect)}function Qw(c,y,T,I){const{state:E,actions:z,getters:P}=y,o=T.state.value[c];let J;function re(){o||(T.state.value[c]=E?E():{});const H=t1(T.state.value[c]);return Lo(H,z,Object.keys(P||{}).reduce((ie,ce)=>(ie[ce]=am(io(()=>{Kf(T);const Y=T._s.get(c);return P[ce].call(Y,Y)})),ie),{}))}return J=Hv(c,re,y,T,I,!0),J}function Hv(c,y,T={},I,E,z){let P;const o=Lo({actions:{}},T),J={deep:!0};let re,H,ie=[],ce=[],Y;const le=I.state.value[c];!z&&!le&&(I.state.value[c]={}),vn({});let Xe;function ft(dt){let Ye;re=H=!1,typeof dt=="function"?(dt(I.state.value[c]),Ye={type:nh.patchFunction,storeId:c,events:Y}):(Vp(I.state.value[c],dt),Ye={type:nh.patchObject,payload:dt,storeId:c,events:Y});const Ct=Xe=Symbol();nv().then(()=>{Xe===Ct&&(re=!0)}),H=!0,Bu(ie,Ye,I.state.value[c])}const it=z?function(){const{state:Ye}=T,Ct=Ye?Ye():{};this.$patch(Dt=>{Lo(Dt,Ct)})}:Zv;function Qe(){P.stop(),ie=[],ce=[],I._s.delete(c)}const tt=(dt,Ye="")=>{if(G_ in dt)return dt[hp]=Ye,dt;const Ct=function(){Kf(I);const Dt=Array.from(arguments),ct=[],Pt=[];function ut(Ut){ct.push(Ut)}function Bt(Ut){Pt.push(Ut)}Bu(ce,{args:Dt,name:Ct[hp],store:qe,after:ut,onError:Bt});let qt;try{qt=dt.apply(this&&this.$id===c?this:qe,Dt)}catch(Ut){throw Bu(Pt,Ut),Ut}return qt instanceof Promise?qt.then(Ut=>(Bu(ct,Ut),Ut)).catch(Ut=>(Bu(Pt,Ut),Promise.reject(Ut))):(Bu(ct,qt),qt)};return Ct[G_]=!0,Ct[hp]=Ye,Ct},We={_p:I,$id:c,$onAction:U_.bind(null,ce),$patch:ft,$reset:it,$subscribe(dt,Ye={}){const Ct=U_(ie,dt,Ye.detached,()=>Dt()),Dt=P.run(()=>Ul(()=>I.state.value[c],ct=>{(Ye.flush==="sync"?H:re)&&dt({storeId:c,type:nh.direct,events:Y},ct)},Lo({},J,Ye)));return Ct},$dispose:Qe},qe=$f(We);I._s.set(c,qe);const pt=(I._a&&I._a.runWithContext||Ww)(()=>I._e.run(()=>(P=Fy()).run(()=>y({action:tt}))));for(const dt in pt){const Ye=pt[dt];if(Vn(Ye)&&!Jw(Ye)||Bo(Ye))z||(le&&Kw(Ye)&&(Vn(Ye)?Ye.value=le[dt]:Vp(Ye,le[dt])),I.state.value[c][dt]=Ye);else if(typeof Ye=="function"){const Ct=tt(Ye,dt);pt[dt]=Ct,o.actions[dt]=Ye}}return Lo(qe,pt),Lo(Fi(qe),pt),Object.defineProperty(qe,"$state",{get:()=>I.state.value[c],set:dt=>{ft(Ye=>{Lo(Ye,dt)})}}),I._p.forEach(dt=>{Lo(qe,P.run(()=>dt({store:qe,app:I._a,pinia:I,options:o})))}),le&&z&&T.hydrate&&T.hydrate(qe.$state,le),re=!0,H=!0,qe}/*! #__NO_SIDE_EFFECTS__ */function Yu(c,y,T){let I;const E=typeof y=="function";I=E?T:y;function z(P,o){const J=D1();return P=P||(J?jo($v,null):null),P&&Kf(P),P=qv,P._s.has(c)||(E?Hv(c,y,I,P):Qw(c,I,P)),P._s.get(c)}return z.$id=c,z}const eT=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,tT=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,iT=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function nT(c,y){if(c==="__proto__"||c==="constructor"&&y&&typeof y=="object"&&"prototype"in y){rT(c);return}return y}function rT(c){console.warn(`[destr] Dropping "${c}" key to prevent prototype pollution.`)}function sT(c,y={}){if(typeof c!="string")return c;if(c[0]==='"'&&c[c.length-1]==='"'&&c.indexOf("\\")===-1)return c.slice(1,-1);const T=c.trim();if(T.length<=9)switch(T.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!iT.test(c)){if(y.strict)throw new SyntaxError("[destr] Invalid JSON");return c}try{if(eT.test(c)||tT.test(c)){if(y.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(c,nT)}return JSON.parse(c)}catch(I){if(y.strict)throw I;return c}}function aT(c,y){if(c==null)return;let T=c;for(let I=0;I<y.length;I++){if(T==null||T[y[I]]==null)return;T=T[y[I]]}return T}function pm(c,y,T){if(T.length===0)return y;const I=T[0];return T.length>1&&(y=pm(typeof c!="object"||c===null||!Object.prototype.hasOwnProperty.call(c,I)?Number.isInteger(Number(T[1]))?[]:{}:c[I],y,Array.prototype.slice.call(T,1))),Number.isInteger(Number(I))&&Array.isArray(c)?c.slice()[I]:Object.assign({},c,{[I]:y})}function Xv(c,y){if(c==null||y.length===0)return c;if(y.length===1){if(c==null)return c;if(Number.isInteger(y[0])&&Array.isArray(c))return Array.prototype.slice.call(c,0).splice(y[0],1);const T={};for(const I in c)T[I]=c[I];return delete T[y[0]],T}if(c[y[0]]==null){if(Number.isInteger(y[0])&&Array.isArray(c))return Array.prototype.concat.call([],c);const T={};for(const I in c)T[I]=c[I];return T}return pm(c,Xv(c[y[0]],Array.prototype.slice.call(y,1)),[y[0]])}function Wv(c,y){return y.map(T=>T.split(".")).map(T=>[T,aT(c,T)]).filter(T=>T[1]!==void 0).reduce((T,I)=>pm(T,I[1],I[0]),{})}function Yv(c,y){return y.map(T=>T.split(".")).reduce((T,I)=>Xv(T,I),c)}function q_(c,{storage:y,serializer:T,key:I,debug:E,pick:z,omit:P,beforeHydrate:o,afterHydrate:J},re,H=!0){try{H&&o?.(re);const ie=y.getItem(I);if(ie){const ce=T.deserialize(ie),Y=z?Wv(ce,z):ce,le=P?Yv(Y,P):Y;c.$patch(le)}H&&J?.(re)}catch(ie){E&&console.error("[pinia-plugin-persistedstate]",ie)}}function $_(c,{storage:y,serializer:T,key:I,debug:E,pick:z,omit:P}){try{const o=z?Wv(c,z):c,J=P?Yv(o,P):o,re=T.serialize(J);y.setItem(I,re)}catch(o){E&&console.error("[pinia-plugin-persistedstate]",o)}}function oT(c,y,T){const{pinia:I,store:E,options:{persist:z=T}}=c;if(!z)return;if(!(E.$id in I.state.value)){const J=I._s.get(E.$id.replace("__hot:",""));J&&Promise.resolve().then(()=>J.$persist());return}const o=(Array.isArray(z)?z:z===!0?[{}]:[z]).map(y);E.$hydrate=({runHooks:J=!0}={})=>{o.forEach(re=>{q_(E,re,c,J)})},E.$persist=()=>{o.forEach(J=>{$_(E.$state,J)})},o.forEach(J=>{q_(E,J,c),E.$subscribe((re,H)=>$_(H,J),{detached:!0})})}function lT(c={}){return function(y){oT(y,T=>({key:(c.key?c.key:I=>I)(T.key??y.store.$id),debug:T.debug??c.debug??!1,serializer:T.serializer??c.serializer??{serialize:I=>JSON.stringify(I),deserialize:I=>sT(I)},storage:T.storage??c.storage??window.localStorage,beforeHydrate:T.beforeHydrate,afterHydrate:T.afterHydrate,pick:T.pick,omit:T.omit}),c.auto??!1)}}var uT=lT();const gh=Yu("map",{state:()=>({mapInstance:null,selectedKawasan:null,mapReady:!1,playerPoint:null}),actions:{setMapInstance(c){this.mapInstance=c,this.mapReady=!0},setSelectedKawasan(c){this.selectedKawasan=c},clearSelectedKawasan(){this.selectedKawasan=null},setPlayerPoint(c){this.playerPoint=c}}}),Jf=Yu("layers",{state:()=>({emptyData:{type:"FeatureCollection",features:[]},materialVisible:!0,materialData:null,lastSeedTime:null,kawasanVisible:!0,kawasanData:null,lastKawasanSeedTime:null}),actions:{toggleMaterial(){this.materialVisible=!this.materialVisible},toggleKawasan(){this.kawasanVisible=!this.kawasanVisible},setMaterialData(c){this.materialData=c},setKawasanData(c){this.kawasanData=c},generateMaterialData(c,y=180){const T=new Date,I=new Date(T);if(I.setMinutes(Math.floor(T.getMinutes()/60)*60),I.setSeconds(0,0),this.lastSeedTime&&new Date(this.lastSeedTime).getTime()===I.getTime())return;const[[E,z],[P,o]]=c,J=["melati","keris","jenglot"],H={type:"FeatureCollection",features:Array.from({length:y}).map(()=>{const ie=Math.random()*(P-E)+E,ce=Math.random()*(o-z)+z,Y=J[Math.floor(Math.random()*J.length)],le=crypto.randomUUID();return{type:"Feature",geometry:{type:"Point",coordinates:[ie,ce]},properties:{id:le,type:Y,icon:Y}}})};this.setMaterialData(H),this.lastSeedTime=I},generateKawasanData(c,y=8){function T(ce=10,Y=["melati","keris","jenglot"]){const le=[1,1,1];let Xe=ce;for(let it=0;it<Y.length-1;it++){const Qe=Math.floor(Math.random()*(Xe+1));le[it]=Qe,Xe-=Qe}le[Y.length-1]=Xe;for(let it=le.length-1;it>0;it--){const Qe=Math.floor(Math.random()*(it+1));[le[it],le[Qe]]=[le[Qe],le[it]]}const ft={};return Y.forEach((it,Qe)=>{ft[it]=le[Qe]}),ft}const I=new Date,E=new Date(I),z=crypto.randomUUID();if(E.setMinutes(0,0,0),E.setHours(Math.floor(I.getHours()/3)*3),this.lastKawasanSeedTime&&new Date(this.lastKawasanSeedTime).getTime()===E.getTime())return;const[[P,o],[J,re]]=c,ie={type:"FeatureCollection",features:Array.from({length:y}).map(()=>{const ce=Math.random()*(J-P)+P,Y=Math.random()*(re-o)+o,Xe=(.003+Math.random()*.006)/12,ft=[[[ce-Xe,Y-Xe],[ce+Xe,Y-Xe],[ce+Xe,Y+Xe],[ce-Xe,Y+Xe],[ce-Xe,Y-Xe]]];return{type:"Feature",id:z,geometry:{type:"Polygon",coordinates:ft},properties:{id:z,name:`Angker Zone ${Math.floor(Math.random()*1e3)}`,requirements:T()}}})};this.setKawasanData(ie),this.lastKawasanSeedTime=E}},persist:!0}),Qf=Yu("materials",{state:()=>({collectedMaterials:[]}),getters:{materialCountByType(c){return c.collectedMaterials.reduce((y,T)=>(y[T.type]=(y[T.type]||0)+1,y),{})}},actions:{collectMaterial(c){const y=gh(),T=Jf(),I=y.mapInstance;if(this.collectedMaterials.push({id:c.properties.id,type:c.properties.type,coordinates:c.geometry.coordinates,timestamp:new Date().toISOString()}),T.materialData={...T.materialData,features:T.materialData.features.filter(E=>E.properties.id!==c.properties.id)},I&&I.getSource("material")){const E=JSON.parse(JSON.stringify(T.materialData));I.getSource("material").setData(E)}},consumeMaterials(c){const y=this.materialCountByType;for(const T in c)if((y[T]||0)<c[T])return console.warn(`Not enough ${T}`),!1;for(const T in c){let I=c[T];this.collectedMaterials=this.collectedMaterials.filter(E=>E.type===T&&I>0?(I--,!1):!0)}return!0}},persist:!0}),_h=Yu("ghost",{state:()=>({caughtGhosts:[],ghostData:{Pocong:{text:'Pocong is believed to be the trapped soul of the deceased, still wrapped tightly in its white burial shroud. In Indonesian funeral tradition, the shroud is meant to be untied after burial to free the spirit. Failure to do so is thought to cause an anomaly: the deceased may manifest as a "Pocong", hopping restlessly between dimensions. Paranormal researchers speculate that this entity may be an echo of grief or unfinished rites, often appearing in areas with disturbed burial grounds.',locations:"Indonesia",similarEntities:[{name:"Hantu Bungkus",country:"Malaysia"},{name:"Jiangshi",country:"China"},{name:"Shiry (improper burial cases)",country:"Japan"}]},Kuntilanak:{text:"Kuntilanak is often reported as a female apparition clad in white, with flowing black hair and a piercing cry. Said to be the spirit of a woman who died during childbirth, her presence is associated with maternal trauma and emotional residues imprinted on the environment. Some researchers link Kuntilanak sightings with infrasound anomalies and electromagnetic disturbances, particularly near abandoned houses or forests where human tragedy once occurred.",location:"Indonesia",similarEntities:[{name:"Pontianak",country:"Malaysia"},{name:"La Llorona",country:"Mexico"},{name:"Onry",country:"Japan"}]},Genderuwo:{text:"Genderuwo is a mythological creature often described as a large, shadowy humanoid covered in coarse hair. Traditionally feared for its strength and pranks, its believed to inhabit old trees and crumbling structures. Modern hypotheses interpret Genderuwo as a psychic projection tied to testosterone-heavy aggression fields, possibly explained through collective fear memory or cryptid phenomena. Yet, no conclusive scientific evidence has debunked or confirmed its existence.",location:"Indonesia",similarEntities:[{name:"Orang Mawas",country:"Malaysia"},{name:"Bigfoot",country:"United States"},{name:"Yeti",country:"Nepal / Tibet"}]},Tuyul:{text:"Tuyul is depicted as a small, childlike spirit, often associated with financial theft. In folklore, they are summoned through occult rituals and bound to serve their masters greed. Ethnographic accounts suggest that Tuyul phenomena may be linked to subconscious guilt materializing during states of sleep paralysis or hypnagogic hallucination. However, unexplained financial losses in some cases continue to baffle investigators.",location:"Indonesia",similarEntities:[{name:"Pelletik / Pelesit (spirit familiars)",country:"Malaysia"},{name:"Domovoi",country:"Russia"},{name:"Kobold",country:"Germany"}]},Banaspati:{text:"Banaspati is a fiery entity said to take the form of a blazing orb floating through the night. Witnesses describe sudden combustion, levitation, and a scorching heat that leaves no trace. It is believed to be a spirit born of black magic or ancestral wrath. From a scientific angle, some theories suggest rare cases of plasma discharge, piezoelectric effects in fault zones, or even ball lightning  yet Banaspatis behavior defies all current physical models.",location:"Indonesia",similarEntities:[{name:"Will-o-the-wisp",country:"United Kingdom"},{name:"Min Min Light",country:"Australia"},{name:"Brown Mountain Lights",country:"United States"}]}}}),getters:{countByType(c){return c.caughtGhosts.reduce((y,T)=>(y[T.name]=(y[T.name]||0)+1,y),{})},totalCaught:c=>c.caughtGhosts.length},actions:{addGhost(c,y=null){this.caughtGhosts.push({name:c.name,alias:c.alias,timestamp:new Date().toISOString(),coordinates:y})},clearAll(){this.caughtGhosts=[]}},persist:!0}),Kv=[{id:"first_player",title:"The First Player",desc:"Joined before November 2025.",condition:()=>{const c=Ju().firstOpenedAt;return c?c<new Date("2025-11-01T00:00:00+07:00").getTime():!1}},{id:"first_catch",title:"First Catch",desc:"Caught your first ghost!",condition:({hantuCount:c})=>c>=1},{id:"explorer",title:"Explorer",desc:"Walked 1km in total",condition:({distance:c})=>c>=1e3},{id:"ghost_hunter",title:"Ghost Hunter",desc:"Caught 10 ghosts",condition:({hantuCount:c})=>c>=10},{id:"lonely_spirit",title:"Lonely Spirit",desc:"Visited a Kawasan Angker",condition:({angkerVisited:c})=>c>=1},{id:"hidden_one",title:"Hidden One",desc:"???",condition:()=>!1}];function cT(c,y){const T=[],I={hantuCount:c.totalHantu,distance:c.totalDistance,angkerVisited:c.angkerVisited??0};for(const E of Kv){const z=c.achievements.includes(E.id),P=typeof E.condition=="function"&&E.condition(I);!z&&P&&(c.achievements.push(E.id),T.push({id:E.id,title:E.title,desc:E.desc,emoji:E.emoji??""}))}}var ns=63710088e-1,Jv={centimeters:ns*100,centimetres:ns*100,degrees:360/(2*Math.PI),feet:ns*3.28084,inches:ns*39.37,kilometers:ns/1e3,kilometres:ns/1e3,meters:ns,metres:ns,miles:ns/1609.344,millimeters:ns*1e3,millimetres:ns*1e3,nauticalmiles:ns/1852,radians:1,yards:ns*1.0936};function Qv(c,y,T={}){const I={type:"Feature"};return(T.id===0||T.id)&&(I.id=T.id),T.bbox&&(I.bbox=T.bbox),I.properties=y||{},I.geometry=c,I}function $u(c,y,T={}){if(!c)throw new Error("coordinates is required");if(!Array.isArray(c))throw new Error("coordinates must be an Array");if(c.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Z_(c[0])||!Z_(c[1]))throw new Error("coordinates must contain numbers");return Qv({type:"Point",coordinates:c},y,T)}function Up(c,y={}){const T={type:"FeatureCollection"};return y.id&&(T.id=y.id),y.bbox&&(T.bbox=y.bbox),T.features=c,T}function e0(c,y="kilometers"){const T=Jv[y];if(!T)throw new Error(y+" units is invalid");return c*T}function hT(c,y="kilometers"){const T=Jv[y];if(!T)throw new Error(y+" units is invalid");return c/T}function cf(c){return c%360*Math.PI/180}function Z_(c){return!isNaN(c)&&c!==null&&!Array.isArray(c)}function H_(c){if(!c)throw new Error("coord is required");if(!Array.isArray(c)){if(c.type==="Feature"&&c.geometry!==null&&c.geometry.type==="Point")return[...c.geometry.coordinates];if(c.type==="Point")return[...c.coordinates]}if(Array.isArray(c)&&c.length>=2&&!Array.isArray(c[0])&&!Array.isArray(c[1]))return[...c];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function t0(c,y,T={}){var I=H_(c),E=H_(y),z=cf(E[1]-I[1]),P=cf(E[0]-I[0]),o=cf(I[1]),J=cf(E[1]),re=Math.pow(Math.sin(z/2),2)+Math.pow(Math.sin(P/2),2)*Math.cos(o)*Math.cos(J);return e0(2*Math.atan2(Math.sqrt(re),Math.sqrt(1-re)),T.units)}function i0(c,y,T){if(c!==null)for(var I,E,z,P,o,J,re,H=0,ie=0,ce,Y=c.type,le=Y==="FeatureCollection",Xe=Y==="Feature",ft=le?c.features.length:1,it=0;it<ft;it++){re=le?c.features[it].geometry:Xe?c.geometry:c,ce=re?re.type==="GeometryCollection":!1,o=ce?re.geometries.length:1;for(var Qe=0;Qe<o;Qe++){var tt=0,We=0;if(P=ce?re.geometries[Qe]:re,P!==null){J=P.coordinates;var qe=P.type;switch(H=0,qe){case null:break;case"Point":if(y(J,ie,it,tt,We)===!1)return!1;ie++,tt++;break;case"LineString":case"MultiPoint":for(I=0;I<J.length;I++){if(y(J[I],ie,it,tt,We)===!1)return!1;ie++,qe==="MultiPoint"&&tt++}qe==="LineString"&&tt++;break;case"Polygon":case"MultiLineString":for(I=0;I<J.length;I++){for(E=0;E<J[I].length-H;E++){if(y(J[I][E],ie,it,tt,We)===!1)return!1;ie++}qe==="MultiLineString"&&tt++,qe==="Polygon"&&We++}qe==="Polygon"&&tt++;break;case"MultiPolygon":for(I=0;I<J.length;I++){for(We=0,E=0;E<J[I].length;E++){for(z=0;z<J[I][E].length-H;z++){if(y(J[I][E][z],ie,it,tt,We)===!1)return!1;ie++}We++}tt++}break;case"GeometryCollection":for(I=0;I<P.geometries.length;I++)if(i0(P.geometries[I],y)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function X_(c,y){if(c.type==="Feature")y(c,0);else if(c.type==="FeatureCollection")for(var T=0;T<c.features.length&&y(c.features[T],T)!==!1;T++);}function n0(c,y){var T,I,E,z,P,o,J,re,H,ie,ce=0,Y=c.type==="FeatureCollection",le=c.type==="Feature",Xe=Y?c.features.length:1;for(T=0;T<Xe;T++){for(o=Y?c.features[T].geometry:le?c.geometry:c,re=Y?c.features[T].properties:le?c.properties:{},H=Y?c.features[T].bbox:le?c.bbox:void 0,ie=Y?c.features[T].id:le?c.id:void 0,J=o?o.type==="GeometryCollection":!1,P=J?o.geometries.length:1,E=0;E<P;E++){if(z=J?o.geometries[E]:o,z===null){if(y(null,ce,re,H,ie)===!1)return!1;continue}switch(z.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(y(z,ce,re,H,ie)===!1)return!1;break}case"GeometryCollection":{for(I=0;I<z.geometries.length;I++)if(y(z.geometries[I],ce,re,H,ie)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ce++}}function r0(c,y={}){if(c.bbox!=null&&y.recompute!==!0)return c.bbox;const T=[1/0,1/0,-1/0,-1/0];return i0(c,I=>{T[0]>I[0]&&(T[0]=I[0]),T[1]>I[1]&&(T[1]=I[1]),T[2]<I[0]&&(T[2]=I[0]),T[3]<I[1]&&(T[3]=I[1])}),T}var hf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mm(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function fT(c,y={}){const T=r0(c),I=(T[0]+T[2])/2,E=(T[1]+T[3])/2;return $u([I,E],y.properties,y)}var bf={exports:{}},dT=bf.exports,W_;function pT(){return W_||(W_=1,function(c,y){(function(T,I){c.exports=I()})(dT,function(){function T(p,s){(s==null||s>p.length)&&(s=p.length);for(var a=0,d=Array(s);a<s;a++)d[a]=p[a];return d}function I(p,s,a){return s=H(s),function(d,b){if(b&&(typeof b=="object"||typeof b=="function"))return b;if(b!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(M){if(M===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M}(d)}(p,ce()?Reflect.construct(s,a||[],H(p).constructor):s.apply(p,a))}function E(p,s){if(!(p instanceof s))throw new TypeError("Cannot call a class as a function")}function z(p,s,a){if(ce())return Reflect.construct.apply(null,arguments);var d=[null];d.push.apply(d,s);var b=new(p.bind.apply(p,d));return a&&Y(b,a.prototype),b}function P(p,s){for(var a=0;a<s.length;a++){var d=s[a];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(p,ft(d.key),d)}}function o(p,s,a){return s&&P(p.prototype,s),a&&P(p,a),Object.defineProperty(p,"prototype",{writable:!1}),p}function J(p,s){var a=typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(!a){if(Array.isArray(p)||(a=it(p))||s){a&&(p=a);var d=0,b=function(){};return{s:b,n:function(){return d>=p.length?{done:!0}:{done:!1,value:p[d++]}},e:function(te){throw te},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var M,N=!0,j=!1;return{s:function(){a=a.call(p)},n:function(){var te=a.next();return N=te.done,te},e:function(te){j=!0,M=te},f:function(){try{N||a.return==null||a.return()}finally{if(j)throw M}}}}function re(){return re=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(p,s,a){var d=function(M,N){for(;!{}.hasOwnProperty.call(M,N)&&(M=H(M))!==null;);return M}(p,s);if(d){var b=Object.getOwnPropertyDescriptor(d,s);return b.get?b.get.call(arguments.length<3?p:a):b.value}},re.apply(null,arguments)}function H(p){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},H(p)}function ie(p,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(s&&s.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),Object.defineProperty(p,"prototype",{writable:!1}),s&&Y(p,s)}function ce(){try{var p=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ce=function(){return!!p})()}function Y(p,s){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,d){return a.__proto__=d,a},Y(p,s)}function le(p,s,a,d){var b=re(H(1&d?p.prototype:p),s,a);return 2&d&&typeof b=="function"?function(M){return b.apply(a,M)}:b}function Xe(p){return function(s){if(Array.isArray(s))return T(s)}(p)||function(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}(p)||it(p)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ft(p){var s=function(a,d){if(typeof a!="object"||!a)return a;var b=a[Symbol.toPrimitive];if(b!==void 0){var M=b.call(a,d);if(typeof M!="object")return M;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(p,"string");return typeof s=="symbol"?s:s+""}function it(p,s){if(p){if(typeof p=="string")return T(p,s);var a={}.toString.call(p).slice(8,-1);return a==="Object"&&p.constructor&&(a=p.constructor.name),a==="Map"||a==="Set"?Array.from(p):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?T(p,s):void 0}}function Qe(p){var s=typeof Map=="function"?new Map:void 0;return Qe=function(a){if(a===null||!function(b){try{return Function.toString.call(b).indexOf("[native code]")!==-1}catch{return typeof b=="function"}}(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(s!==void 0){if(s.has(a))return s.get(a);s.set(a,d)}function d(){return z(a,arguments,H(this).constructor)}return d.prototype=Object.create(a.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),Y(d,a)},Qe(p)}var tt=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(s){this._quadrantSegments=s,this._quadrantSegments===0&&(this._joinStyle=p.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=p.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),s<=0&&(this._quadrantSegments=1),this._joinStyle!==p.JOIN_ROUND&&(this._quadrantSegments=p.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(s){this._joinStyle=s}},{key:"setSimplifyFactor",value:function(s){this._simplifyFactor=s<0?0:s}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(s){this._endCapStyle=s}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(s){this._mitreLimit=s}},{key:"setSingleSided",value:function(s){this._isSingleSided=s}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=p.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=p.CAP_ROUND,this._joinStyle=p.JOIN_ROUND,this._mitreLimit=p.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=p.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.setQuadrantSegments(s)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.setQuadrantSegments(a),this.setEndCapStyle(d)}else if(arguments.length===4){var b=arguments[0],M=arguments[1],N=arguments[2],j=arguments[3];this.setQuadrantSegments(b),this.setEndCapStyle(M),this.setJoinStyle(N),this.setMitreLimit(j)}}}},{key:"bufferDistanceError",value:function(s){var a=Math.PI/2/s;return 1-Math.cos(a/2)}}])}();tt.CAP_ROUND=1,tt.CAP_FLAT=2,tt.CAP_SQUARE=3,tt.JOIN_ROUND=1,tt.JOIN_MITRE=2,tt.JOIN_BEVEL=3,tt.DEFAULT_QUADRANT_SEGMENTS=8,tt.DEFAULT_MITRE_LIMIT=5,tt.DEFAULT_SIMPLIFY_FACTOR=.01;var We=function(p){function s(a){var d;return E(this,s),(d=I(this,s,[a])).name=Object.keys({Exception:s})[0],d}return ie(s,p),o(s,[{key:"toString",value:function(){return this.message}}])}(Qe(Error)),qe=function(p){function s(a){var d;return E(this,s),(d=I(this,s,[a])).name=Object.keys({IllegalArgumentException:s})[0],d}return ie(s,p),o(s)}(We),Ke=function(){return o(function p(){E(this,p)},[{key:"filter",value:function(p){}}])}();function pt(){}function dt(){}function Ye(){}var Ct,Dt,ct,Pt,ut,Bt,qt,Ut,ui=function(){return o(function p(){E(this,p)},null,[{key:"equalsWithTolerance",value:function(p,s,a){return Math.abs(p-s)<=a}}])}(),Ni=function(){return o(function p(s,a){E(this,p),this.low=a||0,this.high=s||0},null,[{key:"toBinaryString",value:function(p){var s,a="";for(s=2147483648;s>0;s>>>=1)a+=(p.high&s)===s?"1":"0";for(s=2147483648;s>0;s>>>=1)a+=(p.low&s)===s?"1":"0";return a}}])}();function Ot(){}function Ei(){}Ot.NaN=NaN,Ot.isNaN=function(p){return Number.isNaN(p)},Ot.isInfinite=function(p){return!Number.isFinite(p)},Ot.MAX_VALUE=Number.MAX_VALUE,Ot.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Ot.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(Bt=2146435072,qt=new Float64Array(1),Ut=new Int32Array(qt.buffer),Ot.doubleToLongBits=function(p){qt[0]=p;var s=0|Ut[0],a=0|Ut[1];return(a&Bt)===Bt&&1048575&a&&s!==0&&(s=0,a=2146959360),new Ni(a,s)},Ot.longBitsToDouble=function(p){return Ut[0]=p.low,Ut[1]=p.high,qt[0]}):(Ct=1023,Dt=Math.log2,ct=Math.floor,Pt=Math.pow,ut=function(){for(var p=53;p>0;p--){var s=Pt(2,p)-1;if(ct(Dt(s))+1===p)return s}return 0}(),Ot.doubleToLongBits=function(p){var s,a,d,b,M,N,j,te,fe;if(p<0||1/p===Number.NEGATIVE_INFINITY?(N=1<<31,p=-p):N=0,p===0)return new Ni(te=N,fe=0);if(p===1/0)return new Ni(te=2146435072|N,fe=0);if(p!=p)return new Ni(te=2146959360,fe=0);if(b=0,fe=0,(s=ct(p))>1)if(s<=ut)(b=ct(Dt(s)))<=20?(fe=0,te=s<<20-b&1048575):(fe=s%(a=Pt(2,d=b-20))<<32-d,te=s/a&1048575);else for(d=s,fe=0;(d=ct(a=d/2))!==0;)b++,fe>>>=1,fe|=(1&te)<<31,te>>>=1,a!==d&&(te|=524288);if(j=b+Ct,M=s===0,s=p-s,b<52&&s!==0)for(d=0;;){if((a=2*s)>=1?(s=a-1,M?(j--,M=!1):(d<<=1,d|=1,b++)):(s=a,M?--j==0&&(b++,M=!1):(d<<=1,b++)),b===20)te|=d,d=0;else if(b===52){fe|=d;break}if(a===1){b<20?te|=d<<20-b:b<52&&(fe|=d<<52-b);break}}return te|=j<<20,new Ni(te|=N,fe)},Ot.longBitsToDouble=function(p){var s,a,d,b,M=p.high,N=p.low,j=M&1<<31?-1:1;for(d=((2146435072&M)>>20)-Ct,b=0,a=1<<19,s=1;s<=20;s++)M&a&&(b+=Pt(2,-s)),a>>>=1;for(a=1<<31,s=21;s<=52;s++)N&a&&(b+=Pt(2,-s)),a>>>=1;if(d===-1023){if(b===0)return 0*j;d=-1022}else{if(d===1024)return b===0?j/0:NaN;b+=1}return j*b*Pt(2,d)});var Jt=function(p){function s(a){var d;return E(this,s),(d=I(this,s,[a])).name=Object.keys({RuntimeException:s})[0],d}return ie(s,p),o(s)}(We),Ui=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,null,[{key:"constructor_",value:function(){if(arguments.length===0)Jt.constructor_.call(this);else if(arguments.length===1){var a=arguments[0];Jt.constructor_.call(this,a)}}}])}(Jt),ri=function(){function p(){E(this,p)}return o(p,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)p.shouldNeverReachHere(null);else if(arguments.length===1){var s=arguments[0];throw new Ui("Should never reach here"+(s!==null?": "+s:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var s=arguments[0];p.isTrue(s,null)}else if(arguments.length===2){var a=arguments[1];if(!arguments[0])throw a===null?new Ui:new Ui(a)}}},{key:"equals",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];p.equals(s,a,null)}else if(arguments.length===3){var d=arguments[0],b=arguments[1],M=arguments[2];if(!b.equals(d))throw new Ui("Expected "+d+" but encountered "+b+(M!==null?": "+M:""))}}}])}(),Pn=new ArrayBuffer(8),yr=new Float64Array(Pn),kr=new Int32Array(Pn),Ne=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getM",value:function(){return Ot.NaN}},{key:"setOrdinate",value:function(s,a){switch(s){case p.X:this.x=a;break;case p.Y:this.y=a;break;case p.Z:this.setZ(a);break;default:throw new qe("Invalid ordinate index: "+s)}}},{key:"equals2D",value:function(){if(arguments.length===1){var s=arguments[0];return this.x===s.x&&this.y===s.y}if(arguments.length===2){var a=arguments[0],d=arguments[1];return!!ui.equalsWithTolerance(this.x,a.x,d)&&!!ui.equalsWithTolerance(this.y,a.y,d)}}},{key:"setM",value:function(s){throw new qe("Invalid ordinate index: "+p.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(s){switch(s){case p.X:return this.x;case p.Y:return this.y;case p.Z:return this.getZ()}throw new qe("Invalid ordinate index: "+s)}},{key:"equals3D",value:function(s){return this.x===s.x&&this.y===s.y&&(this.getZ()===s.getZ()||Ot.isNaN(this.getZ())&&Ot.isNaN(s.getZ()))}},{key:"equals",value:function(s){return s instanceof p&&this.equals2D(s)}},{key:"equalInZ",value:function(s,a){return ui.equalsWithTolerance(this.getZ(),s.getZ(),a)}},{key:"setX",value:function(s){this.x=s}},{key:"compareTo",value:function(s){var a=s;return this.x<a.x?-1:this.x>a.x?1:this.y<a.y?-1:this.y>a.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(s){this.z=s}},{key:"clone",value:function(){try{return null}catch(s){if(s instanceof CloneNotSupportedException)return ri.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw s}}},{key:"copy",value:function(){return new p(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(s){var a=this.x-s.x,d=this.y-s.y,b=this.getZ()-s.getZ();return Math.sqrt(a*a+d*d+b*b)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(s){this.y=s}},{key:"distance",value:function(s){var a=this.x-s.x,d=this.y-s.y;return Math.sqrt(a*a+d*d)}},{key:"hashCode",value:function(){var s=17;return s=37*(s=37*s+p.hashCode(this.x))+p.hashCode(this.y)}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ()}},{key:"interfaces_",get:function(){return[pt,dt,Ye]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)p.constructor_.call(this,0,0);else if(arguments.length===1){var s=arguments[0];p.constructor_.call(this,s.x,s.y,s.getZ())}else if(arguments.length===2){var a=arguments[0],d=arguments[1];p.constructor_.call(this,a,d,p.NULL_ORDINATE)}else if(arguments.length===3){var b=arguments[0],M=arguments[1],N=arguments[2];this.x=b,this.y=M,this.z=N}}},{key:"hashCode",value:function(s){return yr[0]=s,kr[0]^kr[1]}}])}(),rn=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"compare",value:function(s,a){var d=p.compare(s.x,a.x);if(d!==0)return d;var b=p.compare(s.y,a.y);return b!==0?b:this._dimensionsToTest<=2?0:p.compare(s.getZ(),a.getZ())}},{key:"interfaces_",get:function(){return[Ei]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)p.constructor_.call(this,2);else if(arguments.length===1){var s=arguments[0];if(s!==2&&s!==3)throw new qe("only 2 or 3 dimensions may be specified");this._dimensionsToTest=s}}},{key:"compare",value:function(s,a){return s<a?-1:s>a?1:Ot.isNaN(s)?Ot.isNaN(a)?0:-1:Ot.isNaN(a)?1:0}}])}();Ne.DimensionalComparator=rn,Ne.NULL_ORDINATE=Ot.NaN,Ne.X=0,Ne.Y=1,Ne.Z=2,Ne.M=3;var Ci=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(s){if(!(s instanceof p))return!1;var a=s;return this.isNull()?a.isNull():this._maxx===a.getMaxX()&&this._maxy===a.getMaxY()&&this._minx===a.getMinX()&&this._miny===a.getMinY()}},{key:"intersection",value:function(s){if(this.isNull()||s.isNull()||!this.intersects(s))return new p;var a=this._minx>s._minx?this._minx:s._minx,d=this._miny>s._miny?this._miny:s._miny;return new p(a,this._maxx<s._maxx?this._maxx:s._maxx,d,this._maxy<s._maxy?this._maxy:s._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Ne){var s=arguments[0];return this.covers(s.x,s.y)}if(arguments[0]instanceof p){var a=arguments[0];return!this.isNull()&&!a.isNull()&&a.getMinX()>=this._minx&&a.getMaxX()<=this._maxx&&a.getMinY()>=this._miny&&a.getMaxY()<=this._maxy}}else if(arguments.length===2){var d=arguments[0],b=arguments[1];return!this.isNull()&&d>=this._minx&&d<=this._maxx&&b>=this._miny&&b<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof p){var s=arguments[0];return!this.isNull()&&!s.isNull()&&!(s._minx>this._maxx||s._maxx<this._minx||s._miny>this._maxy||s._maxy<this._miny)}if(arguments[0]instanceof Ne){var a=arguments[0];return this.intersects(a.x,a.y)}}else if(arguments.length===2){if(arguments[0]instanceof Ne&&arguments[1]instanceof Ne){var d=arguments[0],b=arguments[1];return!this.isNull()&&!((d.x<b.x?d.x:b.x)>this._maxx)&&!((d.x>b.x?d.x:b.x)<this._minx)&&!((d.y<b.y?d.y:b.y)>this._maxy)&&!((d.y>b.y?d.y:b.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var M=arguments[0],N=arguments[1];return!this.isNull()&&!(M>this._maxx||M<this._minx||N>this._maxy||N<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var s=this.getWidth(),a=this.getHeight();return Math.sqrt(s*s+a*a)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Ne){var s=arguments[0];this.expandToInclude(s.x,s.y)}else if(arguments[0]instanceof p){var a=arguments[0];if(a.isNull())return null;this.isNull()?(this._minx=a.getMinX(),this._maxx=a.getMaxX(),this._miny=a.getMinY(),this._maxy=a.getMaxY()):(a._minx<this._minx&&(this._minx=a._minx),a._maxx>this._maxx&&(this._maxx=a._maxx),a._miny<this._miny&&(this._miny=a._miny),a._maxy>this._maxy&&(this._maxy=a._maxy))}}else if(arguments.length===2){var d=arguments[0],b=arguments[1];this.isNull()?(this._minx=d,this._maxx=d,this._miny=b,this._maxy=b):(d<this._minx&&(this._minx=d),d>this._maxx&&(this._maxx=d),b<this._miny&&(this._miny=b),b>this._maxy&&(this._maxy=b))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var s=this.getWidth(),a=this.getHeight();return s<a?s:a}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(s){var a=s;return this.isNull()?a.isNull()?0:-1:a.isNull()?1:this._minx<a._minx?-1:this._minx>a._minx?1:this._miny<a._miny?-1:this._miny>a._miny?1:this._maxx<a._maxx?-1:this._maxx>a._maxx?1:this._maxy<a._maxy?-1:this._maxy>a._maxy?1:0}},{key:"translate",value:function(s,a){if(this.isNull())return null;this.init(this.getMinX()+s,this.getMaxX()+s,this.getMinY()+a,this.getMaxY()+a)}},{key:"copy",value:function(){return new p(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(s){return!(!this.isNull()&&!s.isNull())||s._minx>this._maxx||s._maxx<this._minx||s._miny>this._maxy||s._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var s=this.getWidth(),a=this.getHeight();return s>a?s:a}},{key:"expandBy",value:function(){if(arguments.length===1){var s=arguments[0];this.expandBy(s,s)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];if(this.isNull())return null;this._minx-=a,this._maxx+=a,this._miny-=d,this._maxy+=d,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof p){var s=arguments[0];return this.covers(s)}if(arguments[0]instanceof Ne){var a=arguments[0];return this.covers(a)}}else if(arguments.length===2){var d=arguments[0],b=arguments[1];return this.covers(d,b)}}},{key:"centre",value:function(){return this.isNull()?null:new Ne((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Ne){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof p){var a=arguments[0];this._minx=a._minx,this._maxx=a._maxx,this._miny=a._miny,this._maxy=a._maxy}}else if(arguments.length===2){var d=arguments[0],b=arguments[1];this.init(d.x,b.x,d.y,b.y)}else if(arguments.length===4){var M=arguments[0],N=arguments[1],j=arguments[2],te=arguments[3];M<N?(this._minx=M,this._maxx=N):(this._minx=N,this._maxx=M),j<te?(this._miny=j,this._maxy=te):(this._miny=te,this._maxy=j)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(s){if(this.intersects(s))return 0;var a=0;this._maxx<s._minx?a=s._minx-this._maxx:this._minx>s._maxx&&(a=this._minx-s._maxx);var d=0;return this._maxy<s._miny?d=s._miny-this._maxy:this._miny>s._maxy&&(d=this._miny-s._maxy),a===0?d:d===0?a:Math.sqrt(a*a+d*d)}},{key:"hashCode",value:function(){var s=17;return s=37*(s=37*(s=37*(s=37*s+Ne.hashCode(this._minx))+Ne.hashCode(this._maxx))+Ne.hashCode(this._miny))+Ne.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[pt,Ye]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Ne){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof p){var a=arguments[0];this.init(a)}}else if(arguments.length===2){var d=arguments[0],b=arguments[1];this.init(d.x,b.x,d.y,b.y)}else if(arguments.length===4){var M=arguments[0],N=arguments[1],j=arguments[2],te=arguments[3];this.init(M,N,j,te)}}},{key:"intersects",value:function(){if(arguments.length===3){var s=arguments[0],a=arguments[1],d=arguments[2];return d.x>=(s.x<a.x?s.x:a.x)&&d.x<=(s.x>a.x?s.x:a.x)&&d.y>=(s.y<a.y?s.y:a.y)&&d.y<=(s.y>a.y?s.y:a.y)}if(arguments.length===4){var b=arguments[0],M=arguments[1],N=arguments[2],j=arguments[3],te=Math.min(N.x,j.x),fe=Math.max(N.x,j.x),Me=Math.min(b.x,M.x),Fe=Math.max(b.x,M.x);return!(Me>fe)&&!(Fe<te)&&(te=Math.min(N.y,j.y),fe=Math.max(N.y,j.y),Me=Math.min(b.y,M.y),Fe=Math.max(b.y,M.y),!(Me>fe)&&!(Fe<te))}}}])}(),jt=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===p.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(s){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(s){return this===s||this.equalsExact(s,0)}},{key:"geometryChanged",value:function(){this.apply(p.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(s){return s!==null&&this.norm().equalsExact(s.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var s;if(arguments.length===1){var a=arguments[0];return s=a,this.getTypeCode()!==s.getTypeCode()?this.getTypeCode()-s.getTypeCode():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(a)}if(arguments.length===2){var d=arguments[0],b=arguments[1];return s=d,this.getTypeCode()!==s.getTypeCode()?this.getTypeCode()-s.getTypeCode():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(d,b)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(s){if(s.getTypeCode()===p.TYPECODE_GEOMETRYCOLLECTION)throw new qe("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(s,a,d){return d===0?s.equals(a):s.distance(a)<=d}},{key:"norm",value:function(){var s=this.copy();return s.normalize(),s}},{key:"reverse",value:function(){var s=this.reverseInternal();return this.envelope!=null&&(s.envelope=this.envelope.copy()),s.setSRID(this.getSRID()),s}},{key:"copy",value:function(){var s=this.copyInternal();return s.envelope=this._envelope==null?null:this._envelope.copy(),s._SRID=this._SRID,s._userData=this._userData,s}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Ci(this._envelope)}},{key:"setSRID",value:function(s){this._SRID=s}},{key:"setUserData",value:function(s){this._userData=s}},{key:"compare",value:function(s,a){for(var d=s.iterator(),b=a.iterator();d.hasNext()&&b.hasNext();){var M=d.next(),N=b.next(),j=M.compareTo(N);if(j!==0)return j}return d.hasNext()?1:b.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(s){return this.getClass()===s.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===p.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===p.TYPECODE_MULTIPOINT||this.getTypeCode()===p.TYPECODE_MULTILINESTRING||this.getTypeCode()===p.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[dt,pt,Ye]}},{key:"getClass",value:function(){return p}}],[{key:"hasNonEmptyElements",value:function(s){for(var a=0;a<s.length;a++)if(!s[a].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(s){for(var a=0;a<s.length;a++)if(s[a]===null)return!0;return!1}}])}();jt.constructor_=function(p){p&&(this._envelope=null,this._userData=null,this._factory=p,this._SRID=p.getSRID())},jt.TYPECODE_POINT=0,jt.TYPECODE_MULTIPOINT=1,jt.TYPECODE_LINESTRING=2,jt.TYPECODE_LINEARRING=3,jt.TYPECODE_MULTILINESTRING=4,jt.TYPECODE_POLYGON=5,jt.TYPECODE_MULTIPOLYGON=6,jt.TYPECODE_GEOMETRYCOLLECTION=7,jt.TYPENAME_POINT="Point",jt.TYPENAME_MULTIPOINT="MultiPoint",jt.TYPENAME_LINESTRING="LineString",jt.TYPENAME_LINEARRING="LinearRing",jt.TYPENAME_MULTILINESTRING="MultiLineString",jt.TYPENAME_POLYGON="Polygon",jt.TYPENAME_MULTIPOLYGON="MultiPolygon",jt.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",jt.geometryChangedFilter={get interfaces_(){return[Ke]},filter:function(p){p.geometryChangedAction()}};var q=function(){function p(){E(this,p)}return o(p,null,[{key:"toLocationSymbol",value:function(s){switch(s){case p.EXTERIOR:return"e";case p.BOUNDARY:return"b";case p.INTERIOR:return"i";case p.NONE:return"-"}throw new qe("Unknown location value: "+s)}}])}();q.INTERIOR=0,q.BOUNDARY=1,q.EXTERIOR=2,q.NONE=-1;var Te=function(){return o(function p(){E(this,p)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])}(),Ze=function(p){function s(a){var d;return E(this,s),(d=I(this,s,[a])).name=Object.keys({NoSuchElementException:s})[0],d}return ie(s,p),o(s)}(We),ot=function(p){function s(a){var d;return E(this,s),(d=I(this,s,[a])).name=Object.keys({UnsupportedOperationException:s})[0],d}return ie(s,p),o(s)}(We),ht=function(p){function s(){return E(this,s),I(this,s,arguments)}return ie(s,p),o(s,[{key:"contains",value:function(){}}])}(Te),rt=function(p){function s(a){var d;return E(this,s),(d=I(this,s)).map=new Map,a instanceof Te&&d.addAll(a),d}return ie(s,p),o(s,[{key:"contains",value:function(a){var d=a.hashCode?a.hashCode():a;return!!this.map.has(d)}},{key:"add",value:function(a){var d=a.hashCode?a.hashCode():a;return!this.map.has(d)&&!!this.map.set(d,a)}},{key:"addAll",value:function(a){var d,b=J(a);try{for(b.s();!(d=b.n()).done;){var M=d.value;this.add(M)}}catch(N){b.e(N)}finally{b.f()}return!0}},{key:"remove",value:function(){throw new ot}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new kt(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(ht),kt=function(){return o(function p(s){E(this,p),this.iterator=s.values();var a=this.iterator.next(),d=a.done,b=a.value;this.done=d,this.value=b},[{key:"next",value:function(){if(this.done)throw new Ze;var p=this.value,s=this.iterator.next(),a=s.done,d=s.value;return this.done=a,this.value=d,p}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new ot}}])}(),Re=function(){function p(){E(this,p)}return o(p,null,[{key:"opposite",value:function(s){return s===p.LEFT?p.RIGHT:s===p.RIGHT?p.LEFT:s}}])}();Re.ON=0,Re.LEFT=1,Re.RIGHT=2;var It=function(p){function s(a){var d;return E(this,s),(d=I(this,s,[a])).name=Object.keys({EmptyStackException:s})[0],d}return ie(s,p),o(s)}(We),_t=function(p){function s(a){var d;return E(this,s),(d=I(this,s,[a])).name=Object.keys({IndexOutOfBoundsException:s})[0],d}return ie(s,p),o(s)}(We),$t=function(p){function s(){return E(this,s),I(this,s,arguments)}return ie(s,p),o(s,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(Te),At=function(p){function s(){var a;return E(this,s),(a=I(this,s)).array=[],a}return ie(s,p),o(s,[{key:"add",value:function(a){return this.array.push(a),!0}},{key:"get",value:function(a){if(a<0||a>=this.size())throw new _t;return this.array[a]}},{key:"push",value:function(a){return this.array.push(a),a}},{key:"pop",value:function(){if(this.array.length===0)throw new It;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new It;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(a){return this.array.indexOf(a)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}($t);function mt(p,s){return p.interfaces_&&p.interfaces_.indexOf(s)>-1}var Qt=function(){return o(function p(s){E(this,p),this.str=s},[{key:"append",value:function(p){this.str+=p}},{key:"setCharAt",value:function(p,s){this.str=this.str.substr(0,p)+s+this.str.substr(p+1)}},{key:"toString",value:function(){return this.str}}])}(),fi=function(){function p(s){E(this,p),this.value=s}return o(p,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(s){return this.value<s?-1:this.value>s?1:0}}],[{key:"compare",value:function(s,a){return s<a?-1:s>a?1:0}},{key:"isNan",value:function(s){return Number.isNaN(s)}},{key:"valueOf",value:function(s){return new p(s)}}])}(),gi=function(){return o(function p(){E(this,p)},null,[{key:"isWhitespace",value:function(p){return p<=32&&p>=0||p===127}},{key:"toUpperCase",value:function(p){return p.toUpperCase()}}])}(),Et=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"le",value:function(s){return this._hi<s._hi||this._hi===s._hi&&this._lo<=s._lo}},{key:"extractSignificantDigits",value:function(s,a){var d=this.abs(),b=p.magnitude(d._hi),M=p.TEN.pow(b);(d=d.divide(M)).gt(p.TEN)?(d=d.divide(p.TEN),b+=1):d.lt(p.ONE)&&(d=d.multiply(p.TEN),b-=1);for(var N=b+1,j=new Qt,te=p.MAX_PRINT_DIGITS-1,fe=0;fe<=te;fe++){s&&fe===N&&j.append(".");var Me=Math.trunc(d._hi);if(Me<0)break;var Fe=!1,lt=0;Me>9?(Fe=!0,lt="9"):lt="0"+Me,j.append(lt),d=d.subtract(p.valueOf(Me)).multiply(p.TEN),Fe&&d.selfAdd(p.TEN);var Rt=!0,Xt=p.magnitude(d._hi);if(Xt<0&&Math.abs(Xt)>=te-fe&&(Rt=!1),!Rt)break}return a[0]=b,j.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof p){var s=arguments[0];return this.add(s.negate())}if(typeof arguments[0]=="number"){var a=arguments[0];return this.add(-a)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof p){var s=arguments[0];return this._hi===s._hi&&this._lo===s._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof p){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s._hi,-s._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.isNaN()?this:this.selfAdd(-a,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(s){return this.le(s)?this:s}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof p){var s=arguments[0];return this.selfDivide(s._hi,s._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.selfDivide(a,0)}}else if(arguments.length===2){var d,b,M,N,j=arguments[0],te=arguments[1],fe=null,Me=null,Fe=null,lt=null;return M=this._hi/j,lt=(fe=(Fe=p.SPLIT*M)-(fe=Fe-M))*(Me=(lt=p.SPLIT*j)-(Me=lt-j))-(N=M*j)+fe*(b=j-Me)+(d=M-fe)*Me+d*b,lt=M+(Fe=(this._hi-N-lt+this._lo-M*te)/j),this._hi=lt,this._lo=M-lt+Fe,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof p){var s,a,d,b,M=arguments[0],N=null,j=null,te=null,fe=null;return s=(d=this._hi/M._hi)-(N=(te=p.SPLIT*d)-(N=te-d)),fe=N*(j=(fe=p.SPLIT*M._hi)-(j=fe-M._hi))-(b=d*M._hi)+N*(a=M._hi-j)+s*j+s*a,new p(fe=d+(te=(this._hi-b-fe+this._lo-d*M._lo)/M._hi),d-fe+te)}if(typeof arguments[0]=="number"){var Me=arguments[0];return Ot.isNaN(Me)?p.createNaN():p.copy(this).selfDivide(Me,0)}}},{key:"ge",value:function(s){return this._hi>s._hi||this._hi===s._hi&&this._lo>=s._lo}},{key:"pow",value:function(s){if(s===0)return p.valueOf(1);var a=new p(this),d=p.valueOf(1),b=Math.abs(s);if(b>1)for(;b>0;)b%2==1&&d.selfMultiply(a),(b/=2)>0&&(a=a.sqr());else d=a;return s<0?d.reciprocal():d}},{key:"ceil",value:function(){if(this.isNaN())return p.NaN;var s=Math.ceil(this._hi),a=0;return s===this._hi&&(a=Math.ceil(this._lo)),new p(s,a)}},{key:"compareTo",value:function(s){var a=s;return this._hi<a._hi?-1:this._hi>a._hi?1:this._lo<a._lo?-1:this._lo>a._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof p){var s=arguments[0];return this.init(s),this}if(typeof arguments[0]=="number"){var a=arguments[0];return this.init(a),this}}},{key:"max",value:function(s){return this.ge(s)?this:s}},{key:"sqrt",value:function(){if(this.isZero())return p.valueOf(0);if(this.isNegative())return p.NaN;var s=1/Math.sqrt(this._hi),a=this._hi*s,d=p.valueOf(a),b=this.subtract(d.sqr())._hi*(.5*s);return d.add(b)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof p){var s=arguments[0];return this.selfAdd(s._hi,s._lo)}if(typeof arguments[0]=="number"){var a,d,b,M,N,j=arguments[0],te=null;return te=(b=this._hi+j)-(M=b-this._hi),d=(N=(te=j-M+(this._hi-te))+this._lo)+(b-(a=b+N)),this._hi=a+d,this._lo=d+(a-this._hi),this}}else if(arguments.length===2){var fe,Me,Fe,lt,Rt=arguments[0],Xt=arguments[1],ti=null,vi=null,bi=null;Fe=this._hi+Rt,Me=this._lo+Xt,vi=Fe-(bi=Fe-this._hi),ti=Me-(lt=Me-this._lo);var zi=(fe=Fe+(bi=(vi=Rt-bi+(this._hi-vi))+Me))+(bi=(ti=Xt-lt+(this._lo-ti))+(bi+(Fe-fe))),ji=bi+(fe-zi);return this._hi=zi,this._lo=ji,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof p){var s=arguments[0];return this.selfMultiply(s._hi,s._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.selfMultiply(a,0)}}else if(arguments.length===2){var d,b,M=arguments[0],N=arguments[1],j=null,te=null,fe=null,Me=null;j=(fe=p.SPLIT*this._hi)-this._hi,Me=p.SPLIT*M,j=fe-j,d=this._hi-j,te=Me-M;var Fe=(fe=this._hi*M)+(Me=j*(te=Me-te)-fe+j*(b=M-te)+d*te+d*b+(this._hi*N+this._lo*M)),lt=Me+(j=fe-Fe);return this._hi=Fe,this._lo=lt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return p.NaN;var s=Math.floor(this._hi),a=0;return s===this._hi&&(a=Math.floor(this._lo)),new p(s,a)}},{key:"negate",value:function(){return this.isNaN()?this:new p(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(s){if(s instanceof CloneNotSupportedException)return null;throw s}}},{key:"multiply",value:function(){if(arguments[0]instanceof p){var s=arguments[0];return s.isNaN()?p.createNaN():p.copy(this).selfMultiply(s)}if(typeof arguments[0]=="number"){var a=arguments[0];return Ot.isNaN(a)?p.createNaN():p.copy(this).selfMultiply(a,0)}}},{key:"isNaN",value:function(){return Ot.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var s=p.magnitude(this._hi);return s>=-3&&s<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var s=this.getSpecialNumberString();if(s!==null)return s;var a=new Array(1).fill(null),d=this.extractSignificantDigits(!0,a),b=a[0]+1,M=d;if(d.charAt(0)===".")M="0"+d;else if(b<0)M="0."+p.stringOfChar("0",-b)+d;else if(d.indexOf(".")===-1){var N=b-d.length;M=d+p.stringOfChar("0",N)+".0"}return this.isNegative()?"-"+M:M}},{key:"reciprocal",value:function(){var s,a,d,b,M=null,N=null,j=null,te=null;s=(d=1/this._hi)-(M=(j=p.SPLIT*d)-(M=j-d)),N=(te=p.SPLIT*this._hi)-this._hi;var fe=d+(j=(1-(b=d*this._hi)-(te=M*(N=te-N)-b+M*(a=this._hi-N)+s*N+s*a)-d*this._lo)/this._hi);return new p(fe,d-fe+j)}},{key:"toSciNotation",value:function(){if(this.isZero())return p.SCI_NOT_ZERO;var s=this.getSpecialNumberString();if(s!==null)return s;var a=new Array(1).fill(null),d=this.extractSignificantDigits(!1,a),b=p.SCI_NOT_EXPONENT_CHAR+a[0];if(d.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+d);var M="";d.length>1&&(M=d.substring(1));var N=d.charAt(0)+"."+M;return this.isNegative()?"-"+N+b:N+b}},{key:"abs",value:function(){return this.isNaN()?p.NaN:this.isNegative()?this.negate():new p(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(s){return this._hi<s._hi||this._hi===s._hi&&this._lo<s._lo}},{key:"add",value:function(){if(arguments[0]instanceof p){var s=arguments[0];return p.copy(this).selfAdd(s)}if(typeof arguments[0]=="number"){var a=arguments[0];return p.copy(this).selfAdd(a)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this._hi=s,this._lo=0}else if(arguments[0]instanceof p){var a=arguments[0];this._hi=a._hi,this._lo=a._lo}}else if(arguments.length===2){var d=arguments[0],b=arguments[1];this._hi=d,this._lo=b}}},{key:"gt",value:function(s){return this._hi>s._hi||this._hi===s._hi&&this._lo>s._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?p.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[Ye,pt,dt]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this.init(s)}else if(arguments[0]instanceof p){var a=arguments[0];this.init(a)}else if(typeof arguments[0]=="string"){var d=arguments[0];p.constructor_.call(this,p.parse(d))}}else if(arguments.length===2){var b=arguments[0],M=arguments[1];this.init(b,M)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1],d=arguments[2],b=arguments[3];return p.determinant(p.valueOf(s),p.valueOf(a),p.valueOf(d),p.valueOf(b))}if(arguments[3]instanceof p&&arguments[2]instanceof p&&arguments[0]instanceof p&&arguments[1]instanceof p){var M=arguments[1],N=arguments[2],j=arguments[3];return arguments[0].multiply(j).selfSubtract(M.multiply(N))}}},{key:"sqr",value:function(s){return p.valueOf(s).selfMultiply(s)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var s=arguments[0];return p.parse(s)}if(typeof arguments[0]=="number")return new p(arguments[0])}},{key:"sqrt",value:function(s){return p.valueOf(s).sqrt()}},{key:"parse",value:function(s){for(var a=0,d=s.length;gi.isWhitespace(s.charAt(a));)a++;var b=!1;if(a<d){var M=s.charAt(a);M!=="-"&&M!=="+"||(a++,M==="-"&&(b=!0))}for(var N=new p,j=0,te=0,fe=0,Me=!1;!(a>=d);){var Fe=s.charAt(a);if(a++,gi.isDigit(Fe)){var lt=Fe-"0";N.selfMultiply(p.TEN),N.selfAdd(lt),j++}else{if(Fe!=="."){if(Fe==="e"||Fe==="E"){var Rt=s.substring(a);try{fe=fi.parseInt(Rt)}catch(zi){throw zi instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Rt+" in string "+s):zi}break}throw new NumberFormatException("Unexpected character '"+Fe+"' at position "+a+" in string "+s)}te=j,Me=!0}}var Xt=N;Me||(te=j);var ti=j-te-fe;if(ti===0)Xt=N;else if(ti>0){var vi=p.TEN.pow(ti);Xt=N.divide(vi)}else if(ti<0){var bi=p.TEN.pow(-ti);Xt=N.multiply(bi)}return b?Xt.negate():Xt}},{key:"createNaN",value:function(){return new p(Ot.NaN,Ot.NaN)}},{key:"copy",value:function(s){return new p(s)}},{key:"magnitude",value:function(s){var a=Math.abs(s),d=Math.log(a)/Math.log(10),b=Math.trunc(Math.floor(d));return 10*Math.pow(10,b)<=a&&(b+=1),b}},{key:"stringOfChar",value:function(s,a){for(var d=new Qt,b=0;b<a;b++)d.append(s);return d.toString()}}])}();Et.PI=new Et(3.141592653589793,12246467991473532e-32),Et.TWO_PI=new Et(6.283185307179586,24492935982947064e-32),Et.PI_2=new Et(1.5707963267948966,6123233995736766e-32),Et.E=new Et(2.718281828459045,14456468917292502e-32),Et.NaN=new Et(Ot.NaN,Ot.NaN),Et.EPS=123259516440783e-46,Et.SPLIT=134217729,Et.MAX_PRINT_DIGITS=32,Et.TEN=Et.valueOf(10),Et.ONE=Et.valueOf(1),Et.SCI_NOT_EXPONENT_CHAR="E",Et.SCI_NOT_ZERO="0.0E0";var sn=function(){function p(){E(this,p)}return o(p,null,[{key:"orientationIndex",value:function(s,a,d){var b=p.orientationIndexFilter(s,a,d);if(b<=1)return b;var M=Et.valueOf(a.x).selfAdd(-s.x),N=Et.valueOf(a.y).selfAdd(-s.y),j=Et.valueOf(d.x).selfAdd(-a.x),te=Et.valueOf(d.y).selfAdd(-a.y);return M.selfMultiply(te).selfSubtract(N.selfMultiply(j)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof Et&&arguments[2]instanceof Et&&arguments[0]instanceof Et&&arguments[1]instanceof Et){var s=arguments[1],a=arguments[2],d=arguments[3];return arguments[0].multiply(d).selfSubtract(s.multiply(a)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var b=arguments[0],M=arguments[1],N=arguments[2],j=arguments[3],te=Et.valueOf(b),fe=Et.valueOf(M),Me=Et.valueOf(N),Fe=Et.valueOf(j);return te.multiply(Fe).selfSubtract(fe.multiply(Me)).signum()}}},{key:"intersection",value:function(s,a,d,b){var M=new Et(s.y).selfSubtract(a.y),N=new Et(a.x).selfSubtract(s.x),j=new Et(s.x).selfMultiply(a.y).selfSubtract(new Et(a.x).selfMultiply(s.y)),te=new Et(d.y).selfSubtract(b.y),fe=new Et(b.x).selfSubtract(d.x),Me=new Et(d.x).selfMultiply(b.y).selfSubtract(new Et(b.x).selfMultiply(d.y)),Fe=N.multiply(Me).selfSubtract(fe.multiply(j)),lt=te.multiply(j).selfSubtract(M.multiply(Me)),Rt=M.multiply(fe).selfSubtract(te.multiply(N)),Xt=Fe.selfDivide(Rt).doubleValue(),ti=lt.selfDivide(Rt).doubleValue();return Ot.isNaN(Xt)||Ot.isInfinite(Xt)||Ot.isNaN(ti)||Ot.isInfinite(ti)?null:new Ne(Xt,ti)}},{key:"orientationIndexFilter",value:function(s,a,d){var b=null,M=(s.x-d.x)*(a.y-d.y),N=(s.y-d.y)*(a.x-d.x),j=M-N;if(M>0){if(N<=0)return p.signum(j);b=M+N}else{if(!(M<0)||N>=0)return p.signum(j);b=-M-N}var te=p.DP_SAFE_EPSILON*b;return j>=te||-j>=te?p.signum(j):2}},{key:"signum",value:function(s){return s>0?1:s<0?-1:0}}])}();sn.DP_SAFE_EPSILON=1e-15;var si=function(){return o(function p(){E(this,p)},[{key:"getM",value:function(p){if(this.hasM()){var s=this.getDimension()-this.getMeasures();return this.getOrdinate(p,s)}return Ot.NaN}},{key:"setOrdinate",value:function(p,s,a){}},{key:"getZ",value:function(p){return this.hasZ()?this.getOrdinate(p,2):Ot.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(p,s){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(p){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(p){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(p){}},{key:"copy",value:function(){}},{key:"getY",value:function(p){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[dt]}}])}();si.X=0,si.Y=1,si.Z=2,si.M=3;var Zt=function(){function p(){E(this,p)}return o(p,null,[{key:"index",value:function(s,a,d){return sn.orientationIndex(s,a,d)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var s=arguments[0],a=s.length-1;if(a<3)throw new qe("Ring has fewer than 4 points, so orientation cannot be determined");for(var d=s[0],b=0,M=1;M<=a;M++){var N=s[M];N.y>d.y&&(d=N,b=M)}var j=b;do(j-=1)<0&&(j=a);while(s[j].equals2D(d)&&j!==b);var te=b;do te=(te+1)%a;while(s[te].equals2D(d)&&te!==b);var fe=s[j],Me=s[te];if(fe.equals2D(d)||Me.equals2D(d)||fe.equals2D(Me))return!1;var Fe=p.index(fe,d,Me);return Fe===0?fe.x>Me.x:Fe>0}if(mt(arguments[0],si)){var lt=arguments[0],Rt=lt.size()-1;if(Rt<3)throw new qe("Ring has fewer than 4 points, so orientation cannot be determined");for(var Xt=lt.getCoordinate(0),ti=0,vi=1;vi<=Rt;vi++){var bi=lt.getCoordinate(vi);bi.y>Xt.y&&(Xt=bi,ti=vi)}var zi=null,ji=ti;do(ji-=1)<0&&(ji=Rt),zi=lt.getCoordinate(ji);while(zi.equals2D(Xt)&&ji!==ti);var Nn=null,Ps=ti;do Ps=(Ps+1)%Rt,Nn=lt.getCoordinate(Ps);while(Nn.equals2D(Xt)&&Ps!==ti);if(zi.equals2D(Xt)||Nn.equals2D(Xt)||zi.equals2D(Nn))return!1;var Js=p.index(zi,Xt,Nn);return Js===0?zi.x>Nn.x:Js>0}}}])}();Zt.CLOCKWISE=-1,Zt.RIGHT=Zt.CLOCKWISE,Zt.COUNTERCLOCKWISE=1,Zt.LEFT=Zt.COUNTERCLOCKWISE,Zt.COLLINEAR=0,Zt.STRAIGHT=Zt.COLLINEAR;var Ee=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(p,s){var a=this.getRightmostSideOfSegment(p,s);return a<0&&(a=this.getRightmostSideOfSegment(p,s-1)),a<0&&(this._minCoord=null,this.checkForRightmostCoordinate(p)),a}},{key:"findRightmostEdgeAtVertex",value:function(){var p=this._minDe.getEdge().getCoordinates();ri.isTrue(this._minIndex>0&&this._minIndex<p.length,"rightmost point expected to be interior vertex of edge");var s=p[this._minIndex-1],a=p[this._minIndex+1],d=Zt.index(this._minCoord,a,s),b=!1;(s.y<this._minCoord.y&&a.y<this._minCoord.y&&d===Zt.COUNTERCLOCKWISE||s.y>this._minCoord.y&&a.y>this._minCoord.y&&d===Zt.CLOCKWISE)&&(b=!0),b&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(p,s){var a=p.getEdge().getCoordinates();if(s<0||s+1>=a.length||a[s].y===a[s+1].y)return-1;var d=Re.LEFT;return a[s].y<a[s+1].y&&(d=Re.RIGHT),d}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(p){for(var s=p.getEdge().getCoordinates(),a=0;a<s.length-1;a++)(this._minCoord===null||s[a].x>this._minCoord.x)&&(this._minDe=p,this._minIndex=a,this._minCoord=s[a])}},{key:"findRightmostEdgeAtNode",value:function(){var p=this._minDe.getNode().getEdges();this._minDe=p.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(p){for(var s=p.iterator();s.hasNext();){var a=s.next();a.isForward()&&this.checkForRightmostCoordinate(a)}ri.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Re.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])}(),W=function(p){function s(a,d){var b;return E(this,s),(b=I(this,s,[d?a+" [ "+d+" ]":a])).pt=d?new Ne(d):void 0,b.name=Object.keys({TopologyException:s})[0],b}return ie(s,p),o(s,[{key:"getCoordinate",value:function(){return this.pt}}])}(Jt),ee=function(){return o(function p(){E(this,p),this.array=[]},[{key:"addLast",value:function(p){this.array.push(p)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])}(),Q=function(p){function s(a){var d;return E(this,s),(d=I(this,s)).array=[],a instanceof Te&&d.addAll(a),d}return ie(s,p),o(s,[{key:"interfaces_",get:function(){return[$t,Te]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(a){return arguments.length===1?this.array.push(a):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(a){var d,b=J(a);try{for(b.s();!(d=b.n()).done;){var M=d.value;this.array.push(M)}}catch(N){b.e(N)}finally{b.f()}}},{key:"set",value:function(a,d){var b=this.array[a];return this.array[a]=d,b}},{key:"iterator",value:function(){return new pe(this)}},{key:"get",value:function(a){if(a<0||a>=this.size())throw new _t;return this.array[a]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(a){a?this.array.sort(function(d,b){return a.compare(d,b)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(a){for(var d=0,b=this.array.length;d<b;d++)if(this.array[d]===a)return!!this.array.splice(d,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}($t),pe=function(){return o(function p(s){E(this,p),this.arrayList=s,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Ze;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(p){return this.arrayList.set(this.position-1,p)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])}(),Se=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var p=this._dirEdgeList.iterator();p.hasNext();)p.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(p){for(var s=null,a=p.getEdges().iterator();a.hasNext();){var d=a.next();if(d.isVisited()||d.getSym().isVisited()){s=d;break}}if(s===null)throw new W("unable to find edge to compute depths at "+p.getCoordinate());p.getEdges().computeDepths(s);for(var b=p.getEdges().iterator();b.hasNext();){var M=b.next();M.setVisited(!0),this.copySymDepths(M)}}},{key:"computeDepth",value:function(p){this.clearVisitedEdges();var s=this._finder.getEdge();s.getNode(),s.getLabel(),s.setEdgeDepths(Re.RIGHT,p),this.copySymDepths(s),this.computeDepths(s)}},{key:"create",value:function(p){this.addReachable(p),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var p=this._dirEdgeList.iterator();p.hasNext();){var s=p.next();s.getDepth(Re.RIGHT)>=1&&s.getDepth(Re.LEFT)<=0&&!s.isInteriorAreaEdge()&&s.setInResult(!0)}}},{key:"computeDepths",value:function(p){var s=new rt,a=new ee,d=p.getNode();for(a.addLast(d),s.add(d),p.setVisited(!0);!a.isEmpty();){var b=a.removeFirst();s.add(b),this.computeNodeDepth(b);for(var M=b.getEdges().iterator();M.hasNext();){var N=M.next().getSym();if(!N.isVisited()){var j=N.getNode();s.contains(j)||(a.addLast(j),s.add(j))}}}}},{key:"compareTo",value:function(p){var s=p;return this._rightMostCoord.x<s._rightMostCoord.x?-1:this._rightMostCoord.x>s._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var p=new Ci,s=this._dirEdgeList.iterator();s.hasNext();)for(var a=s.next().getEdge().getCoordinates(),d=0;d<a.length-1;d++)p.expandToInclude(a[d]);this._env=p}return this._env}},{key:"addReachable",value:function(p){var s=new At;for(s.add(p);!s.empty();){var a=s.pop();this.add(a,s)}}},{key:"copySymDepths",value:function(p){var s=p.getSym();s.setDepth(Re.LEFT,p.getDepth(Re.RIGHT)),s.setDepth(Re.RIGHT,p.getDepth(Re.LEFT))}},{key:"add",value:function(p,s){p.setVisited(!0),this._nodes.add(p);for(var a=p.getEdges().iterator();a.hasNext();){var d=a.next();this._dirEdgeList.add(d);var b=d.getSym().getNode();b.isVisited()||s.push(b)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[pt]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new Q,this._nodes=new Q,this._rightMostCoord=null,this._env=null,this._finder=new Ee}}])}(),Pe=function(){return o(function p(){E(this,p)},null,[{key:"intersection",value:function(p,s,a,d){var b=p.x<s.x?p.x:s.x,M=p.y<s.y?p.y:s.y,N=p.x>s.x?p.x:s.x,j=p.y>s.y?p.y:s.y,te=a.x<d.x?a.x:d.x,fe=a.y<d.y?a.y:d.y,Me=a.x>d.x?a.x:d.x,Fe=a.y>d.y?a.y:d.y,lt=((b>te?b:te)+(N<Me?N:Me))/2,Rt=((M>fe?M:fe)+(j<Fe?j:Fe))/2,Xt=p.x-lt,ti=p.y-Rt,vi=s.x-lt,bi=s.y-Rt,zi=a.x-lt,ji=a.y-Rt,Nn=d.x-lt,Ps=d.y-Rt,Js=ti-bi,Ms=vi-Xt,qa=Xt*bi-vi*ti,$a=ji-Ps,pa=Nn-zi,Qs=zi*Ps-Nn*ji,ol=Js*pa-$a*Ms,As=(Ms*Qs-pa*qa)/ol,Rs=($a*qa-Js*Qs)/ol;return Ot.isNaN(As)||Ot.isInfinite(As)||Ot.isNaN(Rs)||Ot.isInfinite(Rs)?null:new Ne(As+lt,Rs+Rt)}}])}(),Le=function(){return o(function p(){E(this,p)},null,[{key:"arraycopy",value:function(p,s,a,d,b){for(var M=0,N=s;N<s+b;N++)a[d+M]=p[N],M++}},{key:"getProperty",value:function(p){return{"line.separator":`
`}[p]}}])}(),ke=function(){function p(){E(this,p)}return o(p,null,[{key:"log10",value:function(s){var a=Math.log(s);return Ot.isInfinite(a)||Ot.isNaN(a)?a:a/p.LOG_10}},{key:"min",value:function(s,a,d,b){var M=s;return a<M&&(M=a),d<M&&(M=d),b<M&&(M=b),M}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1],d=arguments[2];return s<a?a:s>d?d:s}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],M=arguments[1],N=arguments[2];return b<M?M:b>N?N:b}}},{key:"wrap",value:function(s,a){return s<0?a- -s%a:s%a}},{key:"max",value:function(){if(arguments.length===3){var s=arguments[1],a=arguments[2],d=arguments[0];return s>d&&(d=s),a>d&&(d=a),d}if(arguments.length===4){var b=arguments[1],M=arguments[2],N=arguments[3],j=arguments[0];return b>j&&(j=b),M>j&&(j=M),N>j&&(j=N),j}}},{key:"average",value:function(s,a){return(s+a)/2}}])}();ke.LOG_10=Math.log(10);var Ge=function(){function p(){E(this,p)}return o(p,null,[{key:"segmentToSegment",value:function(s,a,d,b){if(s.equals(a))return p.pointToSegment(s,d,b);if(d.equals(b))return p.pointToSegment(b,s,a);var M=!1;if(Ci.intersects(s,a,d,b)){var N=(a.x-s.x)*(b.y-d.y)-(a.y-s.y)*(b.x-d.x);if(N===0)M=!0;else{var j=(s.y-d.y)*(b.x-d.x)-(s.x-d.x)*(b.y-d.y),te=((s.y-d.y)*(a.x-s.x)-(s.x-d.x)*(a.y-s.y))/N,fe=j/N;(fe<0||fe>1||te<0||te>1)&&(M=!0)}}else M=!0;return M?ke.min(p.pointToSegment(s,d,b),p.pointToSegment(a,d,b),p.pointToSegment(d,s,a),p.pointToSegment(b,s,a)):0}},{key:"pointToSegment",value:function(s,a,d){if(a.x===d.x&&a.y===d.y)return s.distance(a);var b=(d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y),M=((s.x-a.x)*(d.x-a.x)+(s.y-a.y)*(d.y-a.y))/b;if(M<=0)return s.distance(a);if(M>=1)return s.distance(d);var N=((a.y-s.y)*(d.x-a.x)-(a.x-s.x)*(d.y-a.y))/b;return Math.abs(N)*Math.sqrt(b)}},{key:"pointToLinePerpendicular",value:function(s,a,d){var b=(d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y),M=((a.y-s.y)*(d.x-a.x)-(a.x-s.x)*(d.y-a.y))/b;return Math.abs(M)*Math.sqrt(b)}},{key:"pointToSegmentString",value:function(s,a){if(a.length===0)throw new qe("Line array must contain at least one vertex");for(var d=s.distance(a[0]),b=0;b<a.length-1;b++){var M=p.pointToSegment(s,a[b],a[b+1]);M<d&&(d=M)}return d}}])}(),Ue=function(){return o(function p(){E(this,p)},[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||mt(arguments[0],si);else if(arguments.length!==2){if(arguments.length===3){var p=arguments[0],s=arguments[1];return this.create(p,s)}}}}])}(),Ae=function(){return o(function p(){E(this,p)},[{key:"filter",value:function(p){}}])}(),et=function(){return o(function p(){E(this,p)},null,[{key:"ofLine",value:function(p){var s=p.size();if(s<=1)return 0;var a=0,d=new Ne;p.getCoordinate(0,d);for(var b=d.x,M=d.y,N=1;N<s;N++){p.getCoordinate(N,d);var j=d.x,te=d.y,fe=j-b,Me=te-M;a+=Math.sqrt(fe*fe+Me*Me),b=j,M=te}return a}}])}(),be=o(function p(){E(this,p)}),Tt=function(){function p(){E(this,p)}return o(p,null,[{key:"copyCoord",value:function(s,a,d,b){for(var M=Math.min(s.getDimension(),d.getDimension()),N=0;N<M;N++)d.setOrdinate(b,N,s.getOrdinate(a,N))}},{key:"isRing",value:function(s){var a=s.size();return a===0||!(a<=3)&&s.getOrdinate(0,si.X)===s.getOrdinate(a-1,si.X)&&s.getOrdinate(0,si.Y)===s.getOrdinate(a-1,si.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(mt(arguments[0],si)&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];p.scroll(s,a,p.isRing(s))}else if(mt(arguments[0],si)&&arguments[1]instanceof Ne){var d=arguments[0],b=arguments[1],M=p.indexOf(b,d);if(M<=0)return null;p.scroll(d,M)}}else if(arguments.length===3){var N=arguments[0],j=arguments[1],te=arguments[2];if(j<=0)return null;for(var fe=N.copy(),Me=te?N.size()-1:N.size(),Fe=0;Fe<Me;Fe++)for(var lt=0;lt<N.getDimension();lt++)N.setOrdinate(Fe,lt,fe.getOrdinate((j+Fe)%Me,lt));if(te)for(var Rt=0;Rt<N.getDimension();Rt++)N.setOrdinate(Me,Rt,N.getOrdinate(0,Rt))}}},{key:"isEqual",value:function(s,a){var d=s.size();if(d!==a.size())return!1;for(var b=Math.min(s.getDimension(),a.getDimension()),M=0;M<d;M++)for(var N=0;N<b;N++){var j=s.getOrdinate(M,N),te=a.getOrdinate(M,N);if(s.getOrdinate(M,N)!==a.getOrdinate(M,N)&&(!Ot.isNaN(j)||!Ot.isNaN(te)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var s=arguments[0];return p.minCoordinateIndex(s,0,s.size()-1)}if(arguments.length===3){for(var a=arguments[0],d=arguments[2],b=-1,M=null,N=arguments[1];N<=d;N++){var j=a.getCoordinate(N);(M===null||M.compareTo(j)>0)&&(M=j,b=N)}return b}}},{key:"extend",value:function(s,a,d){var b=s.create(d,a.getDimension()),M=a.size();if(p.copy(a,0,b,0,M),M>0)for(var N=M;N<d;N++)p.copy(a,M-1,b,N,1);return b}},{key:"reverse",value:function(s){for(var a=s.size()-1,d=Math.trunc(a/2),b=0;b<=d;b++)p.swap(s,b,a-b)}},{key:"swap",value:function(s,a,d){if(a===d)return null;for(var b=0;b<s.getDimension();b++){var M=s.getOrdinate(a,b);s.setOrdinate(a,b,s.getOrdinate(d,b)),s.setOrdinate(d,b,M)}}},{key:"copy",value:function(s,a,d,b,M){for(var N=0;N<M;N++)p.copyCoord(s,a+N,d,b+N)}},{key:"ensureValidRing",value:function(s,a){var d=a.size();return d===0?a:d<=3?p.createClosedRing(s,a,4):a.getOrdinate(0,si.X)===a.getOrdinate(d-1,si.X)&&a.getOrdinate(0,si.Y)===a.getOrdinate(d-1,si.Y)?a:p.createClosedRing(s,a,d+1)}},{key:"indexOf",value:function(s,a){for(var d=0;d<a.size();d++)if(s.x===a.getOrdinate(d,si.X)&&s.y===a.getOrdinate(d,si.Y))return d;return-1}},{key:"createClosedRing",value:function(s,a,d){var b=s.create(d,a.getDimension()),M=a.size();p.copy(a,0,b,0,M);for(var N=M;N<d;N++)p.copy(a,0,b,N,1);return b}},{key:"minCoordinate",value:function(s){for(var a=null,d=0;d<s.size();d++){var b=s.getCoordinate(d);(a===null||a.compareTo(b)>0)&&(a=b)}return a}}])}(),He=function(){function p(){E(this,p)}return o(p,null,[{key:"toDimensionSymbol",value:function(s){switch(s){case p.FALSE:return p.SYM_FALSE;case p.TRUE:return p.SYM_TRUE;case p.DONTCARE:return p.SYM_DONTCARE;case p.P:return p.SYM_P;case p.L:return p.SYM_L;case p.A:return p.SYM_A}throw new qe("Unknown dimension value: "+s)}},{key:"toDimensionValue",value:function(s){switch(gi.toUpperCase(s)){case p.SYM_FALSE:return p.FALSE;case p.SYM_TRUE:return p.TRUE;case p.SYM_DONTCARE:return p.DONTCARE;case p.SYM_P:return p.P;case p.SYM_L:return p.L;case p.SYM_A:return p.A}throw new qe("Unknown dimension symbol: "+s)}}])}();He.P=0,He.L=1,He.A=2,He.FALSE=-1,He.TRUE=-2,He.DONTCARE=-3,He.SYM_FALSE="F",He.SYM_TRUE="T",He.SYM_DONTCARE="*",He.SYM_P="0",He.SYM_L="1",He.SYM_A="2";var Mt=function(){return o(function p(){E(this,p)},[{key:"filter",value:function(p){}}])}(),Ht=function(){return o(function p(){E(this,p)},[{key:"filter",value:function(p,s){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])}(),ii=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Ci:this._points.expandEnvelope(new Ci)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new s(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof jt){var a=arguments[0],d=arguments[1];if(!this.isEquivalentClass(a))return!1;var b=a;if(this._points.size()!==b._points.size())return!1;for(var M=0;M<this._points.size();M++)if(!this.equal(this._points.getCoordinate(M),b._points.getCoordinate(M),d))return!1;return!0}return le(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var a=0;a<Math.trunc(this._points.size()/2);a++){var d=this._points.size()-1-a;if(!this._points.getCoordinate(a).equals(this._points.getCoordinate(d))){if(this._points.getCoordinate(a).compareTo(this._points.getCoordinate(d))>0){var b=this._points.copy();Tt.reverse(b),this._points=b}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?He.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var a=this._points.copy();return Tt.reverse(a),this.getFactory().createLineString(a)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return jt.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return et.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var a=arguments[0],d=0,b=0;d<this._points.size()&&b<a._points.size();){var M=this._points.getCoordinate(d).compareTo(a._points.getCoordinate(b));if(M!==0)return M;d++,b++}return d<this._points.size()?1:b<a._points.size()?-1:0}if(arguments.length===2){var N=arguments[0];return arguments[1].compare(this._points,N._points)}}},{key:"apply",value:function(){if(mt(arguments[0],Ae))for(var a=arguments[0],d=0;d<this._points.size();d++)a.filter(this._points.getCoordinate(d));else if(mt(arguments[0],Ht)){var b=arguments[0];if(this._points.size()===0)return null;for(var M=0;M<this._points.size()&&(b.filter(this._points,M),!b.isDone());M++);b.isGeometryChanged()&&this.geometryChanged()}else mt(arguments[0],Mt)?arguments[0].filter(this):mt(arguments[0],Ke)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new ot}},{key:"isEquivalentClass",value:function(a){return a instanceof s}},{key:"getCoordinateN",value:function(a){return this._points.getCoordinate(a)}},{key:"getGeometryType",value:function(){return jt.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(a){if(a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),a.size()===1)throw new qe("Invalid number of points in LineString (found "+a.size()+" - must be 0 or >= 2)");this._points=a}},{key:"isCoordinate",value:function(a){for(var d=0;d<this._points.size();d++)if(this._points.getCoordinate(d).equals(a))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(a){return this.getFactory().createPoint(this._points.getCoordinate(a))}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var a=arguments[0],d=arguments[1];jt.constructor_.call(this,d),this.init(a)}}}}])}(jt),Bi=o(function p(){E(this,p)}),Li=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Ci;var a=new Ci;return a.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),a}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new s(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof jt){var a=arguments[0],d=arguments[1];return!!this.isEquivalentClass(a)&&(!(!this.isEmpty()||!a.isEmpty())||this.isEmpty()===a.isEmpty()&&this.equal(a.getCoordinate(),this.getCoordinate(),d))}return le(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return He.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return jt.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0];return this.getCoordinate().compareTo(a.getCoordinate())}if(arguments.length===2){var d=arguments[0];return arguments[1].compare(this._coordinates,d._coordinates)}}},{key:"apply",value:function(){if(mt(arguments[0],Ae)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this.getCoordinate())}else if(mt(arguments[0],Ht)){var d=arguments[0];if(this.isEmpty())return null;d.filter(this._coordinates,0),d.isGeometryChanged()&&this.geometryChanged()}else mt(arguments[0],Mt)?arguments[0].filter(this):mt(arguments[0],Ke)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return jt.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(a){a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),ri.isTrue(a.size()<=1),this._coordinates=a}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Bi]}}],[{key:"constructor_",value:function(){this._coordinates=null;var a=arguments[0],d=arguments[1];jt.constructor_.call(this,d),this.init(a)}}])}(jt),Pi=function(){function p(){E(this,p)}return o(p,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var s=arguments[0];return Math.abs(p.ofRingSigned(s))}if(mt(arguments[0],si)){var a=arguments[0];return Math.abs(p.ofRingSigned(a))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var s=arguments[0];if(s.length<3)return 0;for(var a=0,d=s[0].x,b=1;b<s.length-1;b++){var M=s[b].x-d,N=s[b+1].y;a+=M*(s[b-1].y-N)}return a/2}if(mt(arguments[0],si)){var j=arguments[0],te=j.size();if(te<3)return 0;var fe=new Ne,Me=new Ne,Fe=new Ne;j.getCoordinate(0,Me),j.getCoordinate(1,Fe);var lt=Me.x;Fe.x-=lt;for(var Rt=0,Xt=1;Xt<te-1;Xt++)fe.y=Me.y,Me.x=Fe.x,Me.y=Fe.y,j.getCoordinate(Xt+1,Fe),Fe.x-=lt,Rt+=Me.x*(fe.y-Fe.y);return Rt/2}}}])}(),Yt=function(){return o(function p(){E(this,p)},null,[{key:"sort",value:function(){var p=arguments,s=arguments[0];if(arguments.length===1)s.sort(function(lt,Rt){return lt.compareTo(Rt)});else if(arguments.length===2)s.sort(function(lt,Rt){return p[1].compare(lt,Rt)});else if(arguments.length===3){var a=s.slice(arguments[1],arguments[2]);a.sort();var d=s.slice(0,arguments[1]).concat(a,s.slice(arguments[2],s.length));s.splice(0,s.length);var b,M=J(d);try{for(M.s();!(b=M.n()).done;){var N=b.value;s.push(N)}}catch(lt){M.e(lt)}finally{M.f()}}else if(arguments.length===4){var j=s.slice(arguments[1],arguments[2]);j.sort(function(lt,Rt){return p[3].compare(lt,Rt)});var te=s.slice(0,arguments[1]).concat(j,s.slice(arguments[2],s.length));s.splice(0,s.length);var fe,Me=J(te);try{for(Me.s();!(fe=Me.n()).done;){var Fe=fe.value;s.push(Fe)}}catch(lt){Me.e(lt)}finally{Me.f()}}}},{key:"asList",value:function(p){var s,a=new Q,d=J(p);try{for(d.s();!(s=d.n()).done;){var b=s.value;a.add(b)}}catch(M){d.e(M)}finally{d.f()}return a}},{key:"copyOf",value:function(p,s){return p.slice(0,s)}}])}(),xi=o(function p(){E(this,p)}),dn=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),d=-1,b=this._shell.getCoordinates(),M=0;M<b.length;M++)a[++d]=b[M];for(var N=0;N<this._holes.length;N++)for(var j=this._holes[N].getCoordinates(),te=0;te<j.length;te++)a[++d]=j[te];return a}},{key:"getArea",value:function(){var a=0;a+=Pi.ofRing(this._shell.getCoordinateSequence());for(var d=0;d<this._holes.length;d++)a-=Pi.ofRing(this._holes[d].getCoordinateSequence());return a}},{key:"copyInternal",value:function(){for(var a=this._shell.copy(),d=new Array(this._holes.length).fill(null),b=0;b<this._holes.length;b++)d[b]=this._holes[b].copy();return new s(a,d,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var a=this._shell.getCoordinateSequence(),d=this.getEnvelopeInternal(),b=0;b<5;b++){var M=a.getX(b);if(M!==d.getMinX()&&M!==d.getMaxX())return!1;var N=a.getY(b);if(N!==d.getMinY()&&N!==d.getMaxY())return!1}for(var j=a.getX(0),te=a.getY(0),fe=1;fe<=4;fe++){var Me=a.getX(fe),Fe=a.getY(fe);if(Me!==j==(Fe!==te))return!1;j=Me,te=Fe}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof jt){var a=arguments[0],d=arguments[1];if(!this.isEquivalentClass(a))return!1;var b=a,M=this._shell,N=b._shell;if(!M.equalsExact(N,d)||this._holes.length!==b._holes.length)return!1;for(var j=0;j<this._holes.length;j++)if(!this._holes[j].equalsExact(b._holes[j],d))return!1;return!0}return le(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var a=0;a<this._holes.length;a++)this._holes[a]=this.normalized(this._holes[a],!1);Yt.sort(this._holes)}else if(arguments.length===2){var d=arguments[0],b=arguments[1];if(d.isEmpty())return null;var M=d.getCoordinateSequence(),N=Tt.minCoordinateIndex(M,0,M.size()-2);Tt.scroll(M,N,!0),Zt.isCCW(M)===b&&Tt.reverse(M)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var a=this.getExteriorRing().reverse(),d=new Array(this.getNumInteriorRing()).fill(null),b=0;b<d.length;b++)d[b]=this.getInteriorRingN(b).reverse();return this.getFactory().createPolygon(a,d)}},{key:"getTypeCode",value:function(){return jt.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var a=0;a+=this._shell.getLength();for(var d=0;d<this._holes.length;d++)a+=this._holes[d].getLength();return a}},{key:"getNumPoints",value:function(){for(var a=this._shell.getNumPoints(),d=0;d<this._holes.length;d++)a+=this._holes[d].getNumPoints();return a}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(a,d){var b=a.copy();return this.normalize(b,d),b}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],d=this._shell,b=a._shell;return d.compareToSameClass(b)}if(arguments.length===2){var M=arguments[1],N=arguments[0],j=this._shell,te=N._shell,fe=j.compareToSameClass(te,M);if(fe!==0)return fe;for(var Me=this.getNumInteriorRing(),Fe=N.getNumInteriorRing(),lt=0;lt<Me&&lt<Fe;){var Rt=this.getInteriorRingN(lt),Xt=N.getInteriorRingN(lt),ti=Rt.compareToSameClass(Xt,M);if(ti!==0)return ti;lt++}return lt<Me?1:lt<Fe?-1:0}}},{key:"apply",value:function(){if(mt(arguments[0],Ae)){var a=arguments[0];this._shell.apply(a);for(var d=0;d<this._holes.length;d++)this._holes[d].apply(a)}else if(mt(arguments[0],Ht)){var b=arguments[0];if(this._shell.apply(b),!b.isDone())for(var M=0;M<this._holes.length&&(this._holes[M].apply(b),!b.isDone());M++);b.isGeometryChanged()&&this.geometryChanged()}else if(mt(arguments[0],Mt))arguments[0].filter(this);else if(mt(arguments[0],Ke)){var N=arguments[0];N.filter(this),this._shell.apply(N);for(var j=0;j<this._holes.length;j++)this._holes[j].apply(N)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var d=0;d<this._holes.length;d++)a[d+1]=this._holes[d];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)}},{key:"getGeometryType",value:function(){return jt.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(a){return this._holes[a]}},{key:"interfaces_",get:function(){return[xi]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var a=arguments[0],d=arguments[1],b=arguments[2];if(jt.constructor_.call(this,b),a===null&&(a=this.getFactory().createLinearRing()),d===null&&(d=[]),jt.hasNullElements(d))throw new qe("holes must not contain null elements");if(a.isEmpty()&&jt.hasNonEmptyElements(d))throw new qe("shell is empty but holes are not");this._shell=a,this._holes=d}}])}(jt),xt=function(p){function s(){return E(this,s),I(this,s,arguments)}return ie(s,p),o(s)}(ht),Mn=function(p){function s(a){var d;return E(this,s),(d=I(this,s)).array=[],a instanceof Te&&d.addAll(a),d}return ie(s,p),o(s,[{key:"contains",value:function(a){var d,b=J(this.array);try{for(b.s();!(d=b.n()).done;)if(d.value.compareTo(a)===0)return!0}catch(M){b.e(M)}finally{b.f()}return!1}},{key:"add",value:function(a){if(this.contains(a))return!1;for(var d=0,b=this.array.length;d<b;d++)if(this.array[d].compareTo(a)===1)return!!this.array.splice(d,0,a);return this.array.push(a),!0}},{key:"addAll",value:function(a){var d,b=J(a);try{for(b.s();!(d=b.n()).done;){var M=d.value;this.add(M)}}catch(N){b.e(N)}finally{b.f()}return!0}},{key:"remove",value:function(){throw new ot}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Ki(this.array)}}])}(xt),Ki=function(){return o(function p(s){E(this,p),this.array=s,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new Ze;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new ot}}])}(),wn=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"computeEnvelopeInternal",value:function(){for(var a=new Ci,d=0;d<this._geometries.length;d++)a.expandToInclude(this._geometries[d].getEnvelopeInternal());return a}},{key:"getGeometryN",value:function(a){return this._geometries[a]}},{key:"getCoordinates",value:function(){for(var a=new Array(this.getNumPoints()).fill(null),d=-1,b=0;b<this._geometries.length;b++)for(var M=this._geometries[b].getCoordinates(),N=0;N<M.length;N++)a[++d]=M[N];return a}},{key:"getArea",value:function(){for(var a=0,d=0;d<this._geometries.length;d++)a+=this._geometries[d].getArea();return a}},{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),d=0;d<a.length;d++)a[d]=this._geometries[d].copy();return new s(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof jt){var a=arguments[0],d=arguments[1];if(!this.isEquivalentClass(a))return!1;var b=a;if(this._geometries.length!==b._geometries.length)return!1;for(var M=0;M<this._geometries.length;M++)if(!this._geometries[M].equalsExact(b._geometries[M],d))return!1;return!0}return le(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var a=0;a<this._geometries.length;a++)this._geometries[a].normalize();Yt.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var a=He.FALSE,d=0;d<this._geometries.length;d++)a=Math.max(a,this._geometries[d].getBoundaryDimension());return a}},{key:"reverseInternal",value:function(){for(var a=this._geometries.length,d=new Q(a),b=0;b<a;b++)d.add(this._geometries[b].reverse());return this.getFactory().buildGeometry(d)}},{key:"getTypeCode",value:function(){return jt.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var a=He.FALSE,d=0;d<this._geometries.length;d++)a=Math.max(a,this._geometries[d].getDimension());return a}},{key:"getLength",value:function(){for(var a=0,d=0;d<this._geometries.length;d++)a+=this._geometries[d].getLength();return a}},{key:"getNumPoints",value:function(){for(var a=0,d=0;d<this._geometries.length;d++)a+=this._geometries[d].getNumPoints();return a}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],d=new Mn(Yt.asList(this._geometries)),b=new Mn(Yt.asList(a._geometries));return this.compare(d,b)}if(arguments.length===2){for(var M=arguments[1],N=arguments[0],j=this.getNumGeometries(),te=N.getNumGeometries(),fe=0;fe<j&&fe<te;){var Me=this.getGeometryN(fe),Fe=N.getGeometryN(fe),lt=Me.compareToSameClass(Fe,M);if(lt!==0)return lt;fe++}return fe<j?1:fe<te?-1:0}}},{key:"apply",value:function(){if(mt(arguments[0],Ae))for(var a=arguments[0],d=0;d<this._geometries.length;d++)this._geometries[d].apply(a);else if(mt(arguments[0],Ht)){var b=arguments[0];if(this._geometries.length===0)return null;for(var M=0;M<this._geometries.length&&(this._geometries[M].apply(b),!b.isDone());M++);b.isGeometryChanged()&&this.geometryChanged()}else if(mt(arguments[0],Mt)){var N=arguments[0];N.filter(this);for(var j=0;j<this._geometries.length;j++)this._geometries[j].apply(N)}else if(mt(arguments[0],Ke)){var te=arguments[0];te.filter(this);for(var fe=0;fe<this._geometries.length;fe++)this._geometries[fe].apply(te)}}},{key:"getBoundary",value:function(){return jt.checkNotGeometryCollection(this),ri.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return jt.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var a=0;a<this._geometries.length;a++)if(!this._geometries[a].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var a=arguments[0],d=arguments[1];if(jt.constructor_.call(this,d),a===null&&(a=[]),jt.hasNullElements(a))throw new qe("geometries must not contain null elements");this._geometries=a}}}}])}(jt),rs=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),d=0;d<a.length;d++)a[d]=this._geometries[d].copy();return new s(a,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof jt){var a=arguments[0],d=arguments[1];return!!this.isEquivalentClass(a)&&le(s,"equalsExact",this,1).call(this,a,d)}return le(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var a=arguments[0];return this._geometries[a].getCoordinate()}return le(s,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return He.FALSE}},{key:"getTypeCode",value:function(){return jt.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return jt.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Bi]}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];wn.constructor_.call(this,a,d)}}])}(wn),bt=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"copyInternal",value:function(){return new s(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return He.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||le(s,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var a=this._points.copy();return Tt.reverse(a),this.getFactory().createLinearRing(a)}},{key:"getTypeCode",value:function(){return jt.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!le(s,"isClosed",this,1).call(this))throw new qe("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<s.MINIMUM_VALID_SIZE)throw new qe("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return jt.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];ii.constructor_.call(this,a,d),this.validateConstruction()}}])}(ii);bt.MINIMUM_VALID_SIZE=4;var oi=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"setOrdinate",value:function(a,d){switch(a){case s.X:this.x=d;break;case s.Y:this.y=d;break;default:throw new qe("Invalid ordinate index: "+a)}}},{key:"getZ",value:function(){return Ne.NULL_ORDINATE}},{key:"getOrdinate",value:function(a){switch(a){case s.X:return this.x;case s.Y:return this.y}throw new qe("Invalid ordinate index: "+a)}},{key:"setZ",value:function(a){throw new qe("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Ne.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof s){var a=arguments[0];Ne.constructor_.call(this,a.x,a.y)}else if(arguments[0]instanceof Ne){var d=arguments[0];Ne.constructor_.call(this,d.x,d.y)}}else if(arguments.length===2){var b=arguments[0],M=arguments[1];Ne.constructor_.call(this,b,M,Ne.NULL_ORDINATE)}}}])}(Ne);oi.X=0,oi.Y=1,oi.Z=-1,oi.M=-1;var li=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(a,d){switch(a){case s.X:this.x=d;break;case s.Y:this.y=d;break;case s.M:this._m=d;break;default:throw new qe("Invalid ordinate index: "+a)}}},{key:"setM",value:function(a){this._m=a}},{key:"getZ",value:function(){return Ne.NULL_ORDINATE}},{key:"getOrdinate",value:function(a){switch(a){case s.X:return this.x;case s.Y:return this.y;case s.M:return this._m}throw new qe("Invalid ordinate index: "+a)}},{key:"setZ",value:function(a){throw new qe("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ(),this._m=a.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Ne.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof s){var a=arguments[0];Ne.constructor_.call(this,a.x,a.y),this._m=a._m}else if(arguments[0]instanceof Ne){var d=arguments[0];Ne.constructor_.call(this,d.x,d.y),this._m=this.getM()}}else if(arguments.length===3){var b=arguments[0],M=arguments[1],N=arguments[2];Ne.constructor_.call(this,b,M,Ne.NULL_ORDINATE),this._m=N}}}])}(Ne);li.X=0,li.Y=1,li.Z=-1,li.M=2;var er=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(a,d){switch(a){case Ne.X:this.x=d;break;case Ne.Y:this.y=d;break;case Ne.Z:this.z=d;break;case Ne.M:this._m=d;break;default:throw new qe("Invalid ordinate index: "+a)}}},{key:"setM",value:function(a){this._m=a}},{key:"getOrdinate",value:function(a){switch(a){case Ne.X:return this.x;case Ne.Y:return this.y;case Ne.Z:return this.getZ();case Ne.M:return this.getM()}throw new qe("Invalid ordinate index: "+a)}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ(),this._m=a.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Ne.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof s){var a=arguments[0];Ne.constructor_.call(this,a),this._m=a._m}else if(arguments[0]instanceof Ne){var d=arguments[0];Ne.constructor_.call(this,d),this._m=this.getM()}}else if(arguments.length===4){var b=arguments[0],M=arguments[1],N=arguments[2],j=arguments[3];Ne.constructor_.call(this,b,M,N),this._m=j}}}])}(Ne),js=function(){function p(){E(this,p)}return o(p,null,[{key:"measures",value:function(s){return s instanceof oi?0:s instanceof li||s instanceof er?1:0}},{key:"dimension",value:function(s){return s instanceof oi?2:s instanceof li?3:s instanceof er?4:3}},{key:"create",value:function(){if(arguments.length===1){var s=arguments[0];return p.create(s,0)}if(arguments.length===2){var a=arguments[0],d=arguments[1];return a===2?new oi:a===3&&d===0?new Ne:a===3&&d===1?new li:a===4&&d===1?new er:new Ne}}}])}(),cr=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"getCoordinate",value:function(a){return this.get(a)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&mt(arguments[0],Te)){for(var a=arguments[1],d=!1,b=arguments[0].iterator();b.hasNext();)this.add(b.next(),a),d=!0;return d}return le(s,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var a=le(s,"clone",this,1).call(this),d=0;d<this.size();d++)a.add(d,this.get(d).clone());return a}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(s.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(s.coordArrayType);for(var a=this.size(),d=new Array(a).fill(null),b=0;b<a;b++)d[b]=this.get(a-b-1);return d}}},{key:"add",value:function(){if(arguments.length===1){var a=arguments[0];return le(s,"add",this,1).call(this,a)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var d=arguments[0],b=arguments[1];return this.add(d,b,!0),!0}if(arguments[0]instanceof Ne&&typeof arguments[1]=="boolean"){var M=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(M))return null;le(s,"add",this,1).call(this,M)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var N=arguments[0],j=arguments[1];return this.add(N,j),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var te=arguments[0],fe=arguments[1];if(arguments[2])for(var Me=0;Me<te.length;Me++)this.add(te[Me],fe);else for(var Fe=te.length-1;Fe>=0;Fe--)this.add(te[Fe],fe);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Ne){var lt=arguments[0],Rt=arguments[1];if(!arguments[2]){var Xt=this.size();if(Xt>0&&(lt>0&&this.get(lt-1).equals2D(Rt)||lt<Xt&&this.get(lt).equals2D(Rt)))return null}le(s,"add",this,1).call(this,lt,Rt)}}else if(arguments.length===4){var ti=arguments[0],vi=arguments[1],bi=arguments[2],zi=arguments[3],ji=1;bi>zi&&(ji=-1);for(var Nn=bi;Nn!==zi;Nn+=ji)this.add(ti[Nn],vi);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var a=this.get(0).copy();this.add(a,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var a=arguments[0];this.ensureCapacity(a.length),this.add(a,!0)}else if(arguments.length===2){var d=arguments[0],b=arguments[1];this.ensureCapacity(d.length),this.add(d,b)}}}}])}(Q);cr.coordArrayType=new Array(0).fill(null);var Wt=function(){function p(){E(this,p)}return o(p,null,[{key:"isRing",value:function(s){return!(s.length<4)&&!!s[0].equals2D(s[s.length-1])}},{key:"ptNotInList",value:function(s,a){for(var d=0;d<s.length;d++){var b=s[d];if(p.indexOf(b,a)<0)return b}return null}},{key:"scroll",value:function(s,a){var d=p.indexOf(a,s);if(d<0)return null;var b=new Array(s.length).fill(null);Le.arraycopy(s,d,b,0,s.length-d),Le.arraycopy(s,0,b,s.length-d,d),Le.arraycopy(b,0,s,0,s.length)}},{key:"equals",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];if(s===a)return!0;if(s===null||a===null||s.length!==a.length)return!1;for(var d=0;d<s.length;d++)if(!s[d].equals(a[d]))return!1;return!0}if(arguments.length===3){var b=arguments[0],M=arguments[1],N=arguments[2];if(b===M)return!0;if(b===null||M===null||b.length!==M.length)return!1;for(var j=0;j<b.length;j++)if(N.compare(b[j],M[j])!==0)return!1;return!0}}},{key:"intersection",value:function(s,a){for(var d=new cr,b=0;b<s.length;b++)a.intersects(s[b])&&d.add(s[b],!0);return d.toCoordinateArray()}},{key:"measures",value:function(s){if(s===null||s.length===0)return 0;var a,d=0,b=J(s);try{for(b.s();!(a=b.n()).done;){var M=a.value;d=Math.max(d,js.measures(M))}}catch(N){b.e(N)}finally{b.f()}return d}},{key:"hasRepeatedPoints",value:function(s){for(var a=1;a<s.length;a++)if(s[a-1].equals(s[a]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(s){return p.hasRepeatedPoints(s)?new cr(s,!1).toCoordinateArray():s}},{key:"reverse",value:function(s){for(var a=s.length-1,d=Math.trunc(a/2),b=0;b<=d;b++){var M=s[b];s[b]=s[a-b],s[a-b]=M}}},{key:"removeNull",value:function(s){for(var a=0,d=0;d<s.length;d++)s[d]!==null&&a++;var b=new Array(a).fill(null);if(a===0)return b;for(var M=0,N=0;N<s.length;N++)s[N]!==null&&(b[M++]=s[N]);return b}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var s=arguments[0],a=new Array(s.length).fill(null),d=0;d<s.length;d++)a[d]=s[d].copy();return a}if(arguments.length===5)for(var b=arguments[0],M=arguments[1],N=arguments[2],j=arguments[3],te=arguments[4],fe=0;fe<te;fe++)N[j+fe]=b[M+fe].copy()}},{key:"isEqualReversed",value:function(s,a){for(var d=0;d<s.length;d++){var b=s[d],M=a[s.length-d-1];if(b.compareTo(M)!==0)return!1}return!0}},{key:"envelope",value:function(s){for(var a=new Ci,d=0;d<s.length;d++)a.expandToInclude(s[d]);return a}},{key:"toCoordinateArray",value:function(s){return s.toArray(p.coordArrayType)}},{key:"dimension",value:function(s){if(s===null||s.length===0)return 3;var a,d=0,b=J(s);try{for(b.s();!(a=b.n()).done;){var M=a.value;d=Math.max(d,js.dimension(M))}}catch(N){b.e(N)}finally{b.f()}return d}},{key:"atLeastNCoordinatesOrNothing",value:function(s,a){return a.length>=s?a:[]}},{key:"indexOf",value:function(s,a){for(var d=0;d<a.length;d++)if(s.equals(a[d]))return d;return-1}},{key:"increasingDirection",value:function(s){for(var a=0;a<Math.trunc(s.length/2);a++){var d=s.length-1-a,b=s[a].compareTo(s[d]);if(b!==0)return b}return 1}},{key:"compare",value:function(s,a){for(var d=0;d<s.length&&d<a.length;){var b=s[d].compareTo(a[d]);if(b!==0)return b;d++}return d<a.length?-1:d<s.length?1:0}},{key:"minCoordinate",value:function(s){for(var a=null,d=0;d<s.length;d++)(a===null||a.compareTo(s[d])>0)&&(a=s[d]);return a}},{key:"extract",value:function(s,a,d){a=ke.clamp(a,0,s.length);var b=(d=ke.clamp(d,-1,s.length))-a+1;d<0&&(b=0),a>=s.length&&(b=0),d<a&&(b=0);var M=new Array(b).fill(null);if(b===0)return M;for(var N=0,j=a;j<=d;j++)M[N++]=s[j];return M}}])}(),ss=function(){return o(function p(){E(this,p)},[{key:"compare",value:function(p,s){var a=p,d=s;return Wt.compare(a,d)}},{key:"interfaces_",get:function(){return[Ei]}}])}(),Vs=function(){return o(function p(){E(this,p)},[{key:"compare",value:function(p,s){var a=p,d=s;if(a.length<d.length)return-1;if(a.length>d.length)return 1;if(a.length===0)return 0;var b=Wt.compare(a,d);return Wt.isEqualReversed(a,d)?0:b}},{key:"OLDcompare",value:function(p,s){var a=p,d=s;if(a.length<d.length)return-1;if(a.length>d.length)return 1;if(a.length===0)return 0;for(var b=Wt.increasingDirection(a),M=Wt.increasingDirection(d),N=b>0?0:a.length-1,j=M>0?0:a.length-1,te=0;te<a.length;te++){var fe=a[N].compareTo(d[j]);if(fe!==0)return fe;N+=b,j+=M}return 0}},{key:"interfaces_",get:function(){return[Ei]}}])}();Wt.ForwardComparator=ss,Wt.BidirectionalComparator=Vs,Wt.coordArrayType=new Array(0).fill(null);var Ji=function(){return o(function p(s){E(this,p),this.str=s},[{key:"append",value:function(p){this.str+=p}},{key:"setCharAt",value:function(p,s){this.str=this.str.substr(0,p)+s+this.str.substr(p+1)}},{key:"toString",value:function(){return this.str}}])}(),as=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getM",value:function(s){return this.hasM()?this._coordinates[s].getM():Ot.NaN}},{key:"setOrdinate",value:function(s,a,d){switch(a){case si.X:this._coordinates[s].x=d;break;case si.Y:this._coordinates[s].y=d;break;default:this._coordinates[s].setOrdinate(a,d)}}},{key:"getZ",value:function(s){return this.hasZ()?this._coordinates[s].getZ():Ot.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(s,a){switch(a){case si.X:return this._coordinates[s].x;case si.Y:return this._coordinates[s].y;default:return this._coordinates[s].getOrdinate(a)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var s=arguments[0];return this._coordinates[s]}if(arguments.length===2){var a=arguments[0];arguments[1].setCoordinate(this._coordinates[a])}}},{key:"getCoordinateCopy",value:function(s){var a=this.createCoordinate();return a.setCoordinate(this._coordinates[s]),a}},{key:"createCoordinate",value:function(){return js.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(s){return this._coordinates[s].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(s){for(var a=0;a<this._coordinates.length;a++)s.expandToInclude(this._coordinates[a]);return s}},{key:"copy",value:function(){for(var s=new Array(this.size()).fill(null),a=0;a<this._coordinates.length;a++){var d=this.createCoordinate();d.setCoordinate(this._coordinates[a]),s[a]=d}return new p(s,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var s=new Ji(17*this._coordinates.length);s.append("("),s.append(this._coordinates[0]);for(var a=1;a<this._coordinates.length;a++)s.append(", "),s.append(this._coordinates[a]);return s.append(")"),s.toString()}return"()"}},{key:"getY",value:function(s){return this._coordinates[s].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[si,Ye]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];p.constructor_.call(this,s,Wt.dimension(s),Wt.measures(s))}else if(Number.isInteger(arguments[0])){var a=arguments[0];this._coordinates=new Array(a).fill(null);for(var d=0;d<a;d++)this._coordinates[d]=new Ne}else if(mt(arguments[0],si)){var b=arguments[0];if(b===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=b.getDimension(),this._measures=b.getMeasures(),this._coordinates=new Array(b.size()).fill(null);for(var M=0;M<this._coordinates.length;M++)this._coordinates[M]=b.getCoordinateCopy(M)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var N=arguments[0],j=arguments[1];p.constructor_.call(this,N,j,Wt.measures(N))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var te=arguments[0],fe=arguments[1];this._coordinates=new Array(te).fill(null),this._dimension=fe;for(var Me=0;Me<te;Me++)this._coordinates[Me]=js.create(fe)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var Fe=arguments[0],lt=arguments[1],Rt=arguments[2];this._dimension=lt,this._measures=Rt,this._coordinates=Fe===null?new Array(0).fill(null):Fe}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Xt=arguments[0],ti=arguments[1],vi=arguments[2];this._coordinates=new Array(Xt).fill(null),this._dimension=ti,this._measures=vi;for(var bi=0;bi<Xt;bi++)this._coordinates[bi]=this.createCoordinate()}}}}])}(),Us=function(){function p(){E(this,p)}return o(p,[{key:"readResolve",value:function(){return p.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new as(arguments[0]);if(mt(arguments[0],si))return new as(arguments[0])}else{if(arguments.length===2){var s=arguments[1];return s>3&&(s=3),s<2&&(s=2),new as(arguments[0],s)}if(arguments.length===3){var a=arguments[2],d=arguments[1]-a;return a>1&&(a=1),d>3&&(d=3),d<2&&(d=2),new as(arguments[0],d+a,a)}}}},{key:"interfaces_",get:function(){return[Ue,Ye]}}],[{key:"instance",value:function(){return p.instanceObject}}])}();Us.instanceObject=new Us;var Or=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),d=0;d<a.length;d++)a[d]=this._geometries[d].copy();return new s(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof jt){var a=arguments[0],d=arguments[1];return!!this.isEquivalentClass(a)&&le(s,"equalsExact",this,1).call(this,a,d)}return le(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return jt.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new Q,d=0;d<this._geometries.length;d++)for(var b=this._geometries[d].getBoundary(),M=0;M<b.getNumGeometries();M++)a.add(b.getGeometryN(M));var N=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(N))}},{key:"getGeometryType",value:function(){return jt.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[xi]}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];wn.constructor_.call(this,a,d)}}])}(wn),la=function(){return o(function p(){E(this,p)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])}(),vr=function(p){function s(){var a;return E(this,s),(a=I(this,s)).map=new Map,a}return ie(s,p),o(s,[{key:"get",value:function(a){return this.map.get(a)||null}},{key:"put",value:function(a,d){return this.map.set(a,d),d}},{key:"values",value:function(){for(var a=new Q,d=this.map.values(),b=d.next();!b.done;)a.add(b.value),b=d.next();return a}},{key:"entrySet",value:function(){var a=new rt;return this.map.entries().forEach(function(d){return a.add(d)}),a}},{key:"size",value:function(){return this.map.size()}}])}(la),Ai=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"equals",value:function(s){if(!(s instanceof p))return!1;var a=s;return this._modelType===a._modelType&&this._scale===a._scale}},{key:"compareTo",value:function(s){var a=s,d=this.getMaximumSignificantDigits(),b=a.getMaximumSignificantDigits();return fi.compare(d,b)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===p.FLOATING||this._modelType===p.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var s="UNKNOWN";return this._modelType===p.FLOATING?s="Floating":this._modelType===p.FLOATING_SINGLE?s="Floating-Single":this._modelType===p.FIXED&&(s="Fixed (Scale="+this.getScale()+")"),s}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var s=arguments[0];return Ot.isNaN(s)||this._modelType===p.FLOATING_SINGLE?s:this._modelType===p.FIXED?Math.round(s*this._scale)/this._scale:s}if(arguments[0]instanceof Ne){var a=arguments[0];if(this._modelType===p.FLOATING)return null;a.x=this.makePrecise(a.x),a.y=this.makePrecise(a.y)}}},{key:"getMaximumSignificantDigits",value:function(){var s=16;return this._modelType===p.FLOATING?s=16:this._modelType===p.FLOATING_SINGLE?s=6:this._modelType===p.FIXED&&(s=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),s}},{key:"setScale",value:function(s){this._scale=Math.abs(s)}},{key:"interfaces_",get:function(){return[Ye,pt]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=p.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Gs){var s=arguments[0];this._modelType=s,s===p.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var a=arguments[0];this._modelType=p.FIXED,this.setScale(a)}else if(arguments[0]instanceof p){var d=arguments[0];this._modelType=d._modelType,this._scale=d._scale}}}},{key:"mostPrecise",value:function(s,a){return s.compareTo(a)>=0?s:a}}])}(),Gs=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"readResolve",value:function(){return p.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[Ye]}}],[{key:"constructor_",value:function(){this._name=null;var s=arguments[0];this._name=s,p.nameToTypeMap.put(s,this)}}])}();Gs.nameToTypeMap=new vr,Ai.Type=Gs,Ai.FIXED=new Gs("FIXED"),Ai.FLOATING=new Gs("FLOATING"),Ai.FLOATING_SINGLE=new Gs("FLOATING SINGLE"),Ai.maximumPreciseValue=9007199254740992;var qs=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),d=0;d<a.length;d++)a[d]=this._geometries[d].copy();return new s(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof jt){var a=arguments[0],d=arguments[1];return!!this.isEquivalentClass(a)&&le(s,"equalsExact",this,1).call(this,a,d)}return le(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?He.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!this._geometries[a].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return jt.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new ot}},{key:"getGeometryType",value:function(){return jt.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];wn.constructor_.call(this,a,d)}}])}(wn),os=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"createEmpty",value:function(s){switch(s){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new qe("Invalid dimension: "+s)}}},{key:"toGeometry",value:function(s){return s.isNull()?this.createPoint():s.getMinX()===s.getMaxX()&&s.getMinY()===s.getMaxY()?this.createPoint(new Ne(s.getMinX(),s.getMinY())):s.getMinX()===s.getMaxX()||s.getMinY()===s.getMaxY()?this.createLineString([new Ne(s.getMinX(),s.getMinY()),new Ne(s.getMaxX(),s.getMaxY())]):this.createPolygon(this.createLinearRing([new Ne(s.getMinX(),s.getMinY()),new Ne(s.getMinX(),s.getMaxY()),new Ne(s.getMaxX(),s.getMaxY()),new Ne(s.getMaxX(),s.getMinY()),new Ne(s.getMinX(),s.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return this.createLineString(s!==null?this.getCoordinateSequenceFactory().create(s):null)}if(mt(arguments[0],si))return new ii(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new qs(null,this):arguments.length===1?new qs(arguments[0],this):void 0}},{key:"buildGeometry",value:function(s){for(var a=null,d=!1,b=!1,M=s.iterator();M.hasNext();){var N=M.next(),j=N.getTypeCode();a===null&&(a=j),j!==a&&(d=!0),N instanceof wn&&(b=!0)}if(a===null)return this.createGeometryCollection();if(d||b)return this.createGeometryCollection(p.toGeometryArray(s));var te=s.iterator().next();if(s.size()>1){if(te instanceof dn)return this.createMultiPolygon(p.toPolygonArray(s));if(te instanceof ii)return this.createMultiLineString(p.toLineStringArray(s));if(te instanceof Li)return this.createMultiPoint(p.toPointArray(s));ri.shouldNeverReachHere("Unhandled geometry type: "+te.getGeometryType())}return te}},{key:"createMultiPointFromCoords",value:function(s){return this.createMultiPoint(s!==null?this.getCoordinateSequenceFactory().create(s):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Ne){var s=arguments[0];return this.createPoint(s!==null?this.getCoordinateSequenceFactory().create([s]):null)}if(mt(arguments[0],si))return new Li(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(mt(arguments[0],si)){var s=arguments[0];return this.createPolygon(this.createLinearRing(s))}if(arguments[0]instanceof Array){var a=arguments[0];return this.createPolygon(this.createLinearRing(a))}if(arguments[0]instanceof bt){var d=arguments[0];return this.createPolygon(d,null)}}else if(arguments.length===2)return new dn(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new wn(null,this):arguments.length===1?new wn(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return this.createLinearRing(s!==null?this.getCoordinateSequenceFactory().create(s):null)}if(mt(arguments[0],si))return new bt(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new Or(null,this):arguments.length===1?new Or(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new rs(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new rs(arguments[0],this);if(mt(arguments[0],si)){var s=arguments[0];if(s===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(s.size()).fill(null),d=0;d<s.size();d++){var b=this.getCoordinateSequenceFactory().create(1,s.getDimension(),s.getMeasures());Tt.copy(s,d,b,0,1),a[d]=this.createPoint(b)}return this.createMultiPoint(a)}}}},{key:"interfaces_",get:function(){return[Ye]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)p.constructor_.call(this,new Ai,0);else if(arguments.length===1){if(mt(arguments[0],Ue)){var s=arguments[0];p.constructor_.call(this,new Ai,0,s)}else if(arguments[0]instanceof Ai){var a=arguments[0];p.constructor_.call(this,a,0,p.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var d=arguments[0],b=arguments[1];p.constructor_.call(this,d,b,p.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var M=arguments[0],N=arguments[1],j=arguments[2];this._precisionModel=M,this._coordinateSequenceFactory=j,this._SRID=N}}},{key:"toMultiPolygonArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toGeometryArray",value:function(s){if(s===null)return null;var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Us.instance()}},{key:"toMultiLineStringArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toLineStringArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toMultiPointArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toLinearRingArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toPointArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toPolygonArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"createPointFromInternalCoord",value:function(s,a){return a.getPrecisionModel().makePrecise(s),a.getFactory().createPoint(s)}}])}(),ls="XY",ws="XYZ",$l="XYM",Zl="XYZM",$o={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},$s="EMPTY",La=1,Kr=2,Er=3,Hl=4,Zs=5,ua=6;for(var Zo in $o)$o[Zo].toUpperCase();var Ho=function(){return o(function p(s){E(this,p),this.wkt=s,this.index_=-1},[{key:"isAlpha_",value:function(p){return p>="a"&&p<="z"||p>="A"&&p<="Z"}},{key:"isNumeric_",value:function(p,s){return p>="0"&&p<="9"||p=="."&&!(s!==void 0&&s)}},{key:"isWhiteSpace_",value:function(p){return p==" "||p=="	"||p=="\r"||p==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var p,s=this.nextChar_(),a=this.index_,d=s;if(s=="(")p=Kr;else if(s==",")p=Zs;else if(s==")")p=Er;else if(this.isNumeric_(s)||s=="-")p=Hl,d=this.readNumber_();else if(this.isAlpha_(s))p=La,d=this.readText_();else{if(this.isWhiteSpace_(s))return this.nextToken();if(s!=="")throw new Error("Unexpected character: "+s);p=ua}return{position:a,value:d,type:p}}},{key:"readNumber_",value:function(){var p,s=this.index_,a=!1,d=!1;do p=="."?a=!0:p!="e"&&p!="E"||(d=!0),p=this.nextChar_();while(this.isNumeric_(p,a)||!d&&(p=="e"||p=="E")||d&&(p=="-"||p=="+"));return parseFloat(this.wkt.substring(s,this.index_--))}},{key:"readText_",value:function(){var p,s=this.index_;do p=this.nextChar_();while(this.isAlpha_(p));return this.wkt.substring(s,this.index_--).toUpperCase()}}])}(),Xl=function(){return o(function p(s,a){E(this,p),this.lexer_=s,this.token_,this.layout_=ls,this.factory=a},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(p){return this.token_.type==p}},{key:"match",value:function(p){var s=this.isTokenType(p);return s&&this.consume_(),s}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var p=ls,s=this.token_;if(this.isTokenType(La)){var a=s.value;a==="Z"?p=ws:a==="M"?p=$l:a==="ZM"&&(p=Zl),p!==ls&&this.consume_()}return p}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Kr)){var p=[];do p.push(this.parseGeometry_());while(this.match(Zs));if(this.match(Er))return p}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Kr)){var p=this.parsePoint_();if(this.match(Er))return p}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Kr)){var p=this.parsePointList_();if(this.match(Er))return p}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Kr)){var p=this.parseLineStringTextList_();if(this.match(Er))return p}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var p;if(this.match(Kr)){if(p=this.token_.type==Kr?this.parsePointTextList_():this.parsePointList_(),this.match(Er))return p}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Kr)){var p=this.parseLineStringTextList_();if(this.match(Er))return p}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Kr)){var p=this.parsePolygonTextList_();if(this.match(Er))return p}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var p=[],s=this.layout_.length,a=0;a<s;++a){var d=this.token_;if(!this.match(Hl))break;p.push(d.value)}if(p.length==s)return p;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var p=[this.parsePoint_()];this.match(Zs);)p.push(this.parsePoint_());return p}},{key:"parsePointTextList_",value:function(){for(var p=[this.parsePointText_()];this.match(Zs);)p.push(this.parsePointText_());return p}},{key:"parseLineStringTextList_",value:function(){for(var p=[this.parseLineStringText_()];this.match(Zs);)p.push(this.parseLineStringText_());return p}},{key:"parsePolygonTextList_",value:function(){for(var p=[this.parsePolygonText_()];this.match(Zs);)p.push(this.parsePolygonText_());return p}},{key:"isEmptyGeometry_",value:function(){var p=this.isTokenType(La)&&this.token_.value==$s;return p&&this.consume_(),p}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var p=this.factory,s=function(ti){return z(Ne,Xe(ti))},a=function(ti){var vi=ti.map(function(bi){return p.createLinearRing(bi.map(s))});return vi.length>1?p.createPolygon(vi[0],vi.slice(1)):p.createPolygon(vi[0])},d=this.token_;if(this.match(La)){var b=d.value;if(this.layout_=this.parseGeometryLayout_(),b=="GEOMETRYCOLLECTION"){var M=this.parseGeometryCollectionText_();return p.createGeometryCollection(M)}switch(b){case"POINT":var N=this.parsePointText_();return N?p.createPoint(z(Ne,Xe(N))):p.createPoint();case"LINESTRING":var j=this.parseLineStringText_().map(s);return p.createLineString(j);case"LINEARRING":var te=this.parseLineStringText_().map(s);return p.createLinearRing(te);case"POLYGON":var fe=this.parsePolygonText_();return fe&&fe.length!==0?a(fe):p.createPolygon();case"MULTIPOINT":var Me=this.parseMultiPointText_();if(!Me||Me.length===0)return p.createMultiPoint();var Fe=Me.map(s).map(function(ti){return p.createPoint(ti)});return p.createMultiPoint(Fe);case"MULTILINESTRING":var lt=this.parseMultiLineStringText_().map(function(ti){return p.createLineString(ti.map(s))});return p.createMultiLineString(lt);case"MULTIPOLYGON":var Rt=this.parseMultiPolygonText_();if(!Rt||Rt.length===0)return p.createMultiPolygon();var Xt=Rt.map(a);return p.createMultiPolygon(Xt);default:throw new Error("Invalid geometry type: "+b)}}throw new Error(this.formatErrorMessage_())}}])}();function Da(p){if(p.isEmpty())return"";var s=p.getCoordinate(),a=[s.x,s.y];return s.z===void 0||Number.isNaN(s.z)||a.push(s.z),s.m===void 0||Number.isNaN(s.m)||a.push(s.m),a.join(" ")}function Ts(p){for(var s=p.getCoordinates().map(function(M){var N=[M.x,M.y];return M.z===void 0||Number.isNaN(M.z)||N.push(M.z),M.m===void 0||Number.isNaN(M.m)||N.push(M.m),N}),a=[],d=0,b=s.length;d<b;++d)a.push(s[d].join(" "));return a.join(", ")}function Fr(p){var s=[];s.push("("+Ts(p.getExteriorRing())+")");for(var a=0,d=p.getNumInteriorRing();a<d;++a)s.push("("+Ts(p.getInteriorRingN(a))+")");return s.join(", ")}var yi={Point:Da,LineString:Ts,LinearRing:Ts,Polygon:Fr,MultiPoint:function(p){for(var s=[],a=0,d=p.getNumGeometries();a<d;++a)s.push("("+Da(p.getGeometryN(a))+")");return s.join(", ")},MultiLineString:function(p){for(var s=[],a=0,d=p.getNumGeometries();a<d;++a)s.push("("+Ts(p.getGeometryN(a))+")");return s.join(", ")},MultiPolygon:function(p){for(var s=[],a=0,d=p.getNumGeometries();a<d;++a)s.push("("+Fr(p.getGeometryN(a))+")");return s.join(", ")},GeometryCollection:function(p){for(var s=[],a=0,d=p.getNumGeometries();a<d;++a)s.push(Jr(p.getGeometryN(a)));return s.join(", ")}};function Jr(p){var s=p.getGeometryType(),a=yi[s];s=s.toUpperCase();var d=function(b){var M="";if(b.isEmpty())return M;var N=b.getCoordinate();return N.z===void 0||Number.isNaN(N.z)||(M+="Z"),N.m===void 0||Number.isNaN(N.m)||(M+="M"),M}(p);return d.length>0&&(s+=" "+d),p.isEmpty()?s+" "+$s:s+" ("+a(p)+")"}var us=function(){return o(function p(s){E(this,p),this.geometryFactory=s||new os,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(p){var s=new Ho(p);return new Xl(s,this.geometryFactory).parse()}},{key:"write",value:function(p){return Jr(p)}}])}(),cs=function(){return o(function p(s){E(this,p),this.parser=new us(s)},[{key:"write",value:function(p){return this.parser.write(p)}}],[{key:"toLineString",value:function(p,s){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+p.x+" "+p.y+", "+s.x+" "+s.y+" )"}}])}(),$i=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getIndexAlongSegment",value:function(s,a){return this.computeIntLineIndex(),this._intLineIndex[s][a]}},{key:"getTopologySummary",value:function(){var s=new Ji;return this.isEndPoint()&&s.append(" endpoint"),this._isProper&&s.append(" proper"),this.isCollinear()&&s.append(" collinear"),s.toString()}},{key:"computeIntersection",value:function(s,a,d,b){this._inputLines[0][0]=s,this._inputLines[0][1]=a,this._inputLines[1][0]=d,this._inputLines[1][1]=b,this._result=this.computeIntersect(s,a,d,b)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var s=arguments[0];this.getEdgeDistance(s,0)>this.getEdgeDistance(s,1)?(this._intLineIndex[s][0]=0,this._intLineIndex[s][1]=1):(this._intLineIndex[s][0]=1,this._intLineIndex[s][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(s){this._precisionModel=s}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var s=arguments[0],a=0;a<this._result;a++)if(!this._intPt[a].equals2D(this._inputLines[s][0])&&!this._intPt[a].equals2D(this._inputLines[s][1]))return!0;return!1}}},{key:"getIntersection",value:function(s){return this._intPt[s]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==p.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(s,a){return p.computeEdgeDistance(this._intPt[a],this._inputLines[s][0],this._inputLines[s][1])}},{key:"isCollinear",value:function(){return this._result===p.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return cs.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+cs.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(s,a){return this._inputLines[s][a]}},{key:"isIntersection",value:function(s){for(var a=0;a<this._result;a++)if(this._intPt[a].equals2D(s))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(s,a){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[s][a]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Ne,this._intPt[1]=new Ne,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(s,a,d){var b=Math.abs(d.x-a.x),M=Math.abs(d.y-a.y),N=-1;if(s.equals(a))N=0;else if(s.equals(d))N=b>M?b:M;else{var j=Math.abs(s.x-a.x),te=Math.abs(s.y-a.y);(N=b>M?j:te)!==0||s.equals(a)||(N=Math.max(j,te))}return ri.isTrue(!(N===0&&!s.equals(a)),"Bad distance calculation"),N}},{key:"nonRobustComputeEdgeDistance",value:function(s,a,d){var b=s.x-a.x,M=s.y-a.y,N=Math.sqrt(b*b+M*M);return ri.isTrue(!(N===0&&!s.equals(a)),"Invalid distance calculation"),N}}])}();$i.DONT_INTERSECT=0,$i.DO_INTERSECT=1,$i.COLLINEAR=2,$i.NO_INTERSECTION=0,$i.POINT_INTERSECTION=1,$i.COLLINEAR_INTERSECTION=2;var hs=function(p){function s(){return E(this,s),I(this,s)}return ie(s,p),o(s,[{key:"isInSegmentEnvelopes",value:function(a){var d=new Ci(this._inputLines[0][0],this._inputLines[0][1]),b=new Ci(this._inputLines[1][0],this._inputLines[1][1]);return d.contains(a)&&b.contains(a)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return le(s,"computeIntersection",this,1).apply(this,arguments);var a=arguments[0],d=arguments[1],b=arguments[2];if(this._isProper=!1,Ci.intersects(d,b,a)&&Zt.index(d,b,a)===0&&Zt.index(b,d,a)===0)return this._isProper=!0,(a.equals(d)||a.equals(b))&&(this._isProper=!1),this._result=$i.POINT_INTERSECTION,null;this._result=$i.NO_INTERSECTION}},{key:"intersection",value:function(a,d,b,M){var N=this.intersectionSafe(a,d,b,M);return this.isInSegmentEnvelopes(N)||(N=new Ne(s.nearestEndpoint(a,d,b,M))),this._precisionModel!==null&&this._precisionModel.makePrecise(N),N}},{key:"checkDD",value:function(a,d,b,M,N){var j=sn.intersection(a,d,b,M),te=this.isInSegmentEnvelopes(j);Le.out.println("DD in env = "+te+"  --------------------- "+j),N.distance(j)>1e-4&&Le.out.println("Distance = "+N.distance(j))}},{key:"intersectionSafe",value:function(a,d,b,M){var N=Pe.intersection(a,d,b,M);return N===null&&(N=s.nearestEndpoint(a,d,b,M)),N}},{key:"computeCollinearIntersection",value:function(a,d,b,M){var N=Ci.intersects(a,d,b),j=Ci.intersects(a,d,M),te=Ci.intersects(b,M,a),fe=Ci.intersects(b,M,d);return N&&j?(this._intPt[0]=b,this._intPt[1]=M,$i.COLLINEAR_INTERSECTION):te&&fe?(this._intPt[0]=a,this._intPt[1]=d,$i.COLLINEAR_INTERSECTION):N&&te?(this._intPt[0]=b,this._intPt[1]=a,!b.equals(a)||j||fe?$i.COLLINEAR_INTERSECTION:$i.POINT_INTERSECTION):N&&fe?(this._intPt[0]=b,this._intPt[1]=d,!b.equals(d)||j||te?$i.COLLINEAR_INTERSECTION:$i.POINT_INTERSECTION):j&&te?(this._intPt[0]=M,this._intPt[1]=a,!M.equals(a)||N||fe?$i.COLLINEAR_INTERSECTION:$i.POINT_INTERSECTION):j&&fe?(this._intPt[0]=M,this._intPt[1]=d,!M.equals(d)||N||te?$i.COLLINEAR_INTERSECTION:$i.POINT_INTERSECTION):$i.NO_INTERSECTION}},{key:"computeIntersect",value:function(a,d,b,M){if(this._isProper=!1,!Ci.intersects(a,d,b,M))return $i.NO_INTERSECTION;var N=Zt.index(a,d,b),j=Zt.index(a,d,M);if(N>0&&j>0||N<0&&j<0)return $i.NO_INTERSECTION;var te=Zt.index(b,M,a),fe=Zt.index(b,M,d);return te>0&&fe>0||te<0&&fe<0?$i.NO_INTERSECTION:N===0&&j===0&&te===0&&fe===0?this.computeCollinearIntersection(a,d,b,M):(N===0||j===0||te===0||fe===0?(this._isProper=!1,a.equals2D(b)||a.equals2D(M)?this._intPt[0]=a:d.equals2D(b)||d.equals2D(M)?this._intPt[0]=d:N===0?this._intPt[0]=new Ne(b):j===0?this._intPt[0]=new Ne(M):te===0?this._intPt[0]=new Ne(a):fe===0&&(this._intPt[0]=new Ne(d))):(this._isProper=!0,this._intPt[0]=this.intersection(a,d,b,M)),$i.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(a,d,b,M){var N=a,j=Ge.pointToSegment(a,b,M),te=Ge.pointToSegment(d,b,M);return te<j&&(j=te,N=d),(te=Ge.pointToSegment(b,a,d))<j&&(j=te,N=b),(te=Ge.pointToSegment(M,a,d))<j&&(j=te,N=M),N}}])}($i),Cr=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"countSegment",value:function(s,a){if(s.x<this._p.x&&a.x<this._p.x)return null;if(this._p.x===a.x&&this._p.y===a.y)return this._isPointOnSegment=!0,null;if(s.y===this._p.y&&a.y===this._p.y){var d=s.x,b=a.x;return d>b&&(d=a.x,b=s.x),this._p.x>=d&&this._p.x<=b&&(this._isPointOnSegment=!0),null}if(s.y>this._p.y&&a.y<=this._p.y||a.y>this._p.y&&s.y<=this._p.y){var M=Zt.index(s,a,this._p);if(M===Zt.COLLINEAR)return this._isPointOnSegment=!0,null;a.y<s.y&&(M=-M),M===Zt.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==q.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?q.BOUNDARY:this._crossingCount%2==1?q.INTERIOR:q.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var s=arguments[0];this._p=s}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Ne&&mt(arguments[1],si)){for(var s=arguments[1],a=new p(arguments[0]),d=new Ne,b=new Ne,M=1;M<s.size();M++)if(s.getCoordinate(M,d),s.getCoordinate(M-1,b),a.countSegment(d,b),a.isOnSegment())return a.getLocation();return a.getLocation()}if(arguments[0]instanceof Ne&&arguments[1]instanceof Array){for(var N=arguments[1],j=new p(arguments[0]),te=1;te<N.length;te++){var fe=N[te],Me=N[te-1];if(j.countSegment(fe,Me),j.isOnSegment())return j.getLocation()}return j.getLocation()}}}])}(),Br=function(){function p(){E(this,p)}return o(p,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Ne&&mt(arguments[1],si)){for(var s=arguments[0],a=arguments[1],d=new hs,b=new Ne,M=new Ne,N=a.size(),j=1;j<N;j++)if(a.getCoordinate(j-1,b),a.getCoordinate(j,M),d.computeIntersection(s,b,M),d.hasIntersection())return!0;return!1}if(arguments[0]instanceof Ne&&arguments[1]instanceof Array){for(var te=arguments[0],fe=arguments[1],Me=new hs,Fe=1;Fe<fe.length;Fe++){var lt=fe[Fe-1],Rt=fe[Fe];if(Me.computeIntersection(te,lt,Rt),Me.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(s,a){return Cr.locatePointInRing(s,a)}},{key:"isInRing",value:function(s,a){return p.locateInRing(s,a)!==q.EXTERIOR}}])}(),ai=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"setAllLocations",value:function(s){for(var a=0;a<this.location.length;a++)this.location[a]=s}},{key:"isNull",value:function(){for(var s=0;s<this.location.length;s++)if(this.location[s]!==q.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(s){for(var a=0;a<this.location.length;a++)this.location[a]===q.NONE&&(this.location[a]=s)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(s){if(s.location.length>this.location.length){var a=new Array(3).fill(null);a[Re.ON]=this.location[Re.ON],a[Re.LEFT]=q.NONE,a[Re.RIGHT]=q.NONE,this.location=a}for(var d=0;d<this.location.length;d++)this.location[d]===q.NONE&&d<s.location.length&&(this.location[d]=s.location[d])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var s=this.location[Re.LEFT];this.location[Re.LEFT]=this.location[Re.RIGHT],this.location[Re.RIGHT]=s}},{key:"toString",value:function(){var s=new Qt;return this.location.length>1&&s.append(q.toLocationSymbol(this.location[Re.LEFT])),s.append(q.toLocationSymbol(this.location[Re.ON])),this.location.length>1&&s.append(q.toLocationSymbol(this.location[Re.RIGHT])),s.toString()}},{key:"setLocations",value:function(s,a,d){this.location[Re.ON]=s,this.location[Re.LEFT]=a,this.location[Re.RIGHT]=d}},{key:"get",value:function(s){return s<this.location.length?this.location[s]:q.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var s=0;s<this.location.length;s++)if(this.location[s]===q.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var s=arguments[0];this.setLocation(Re.ON,s)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.location[a]=d}}},{key:"init",value:function(s){this.location=new Array(s).fill(null),this.setAllLocations(q.NONE)}},{key:"isEqualOnSide",value:function(s,a){return this.location[a]===s.location[a]}},{key:"allPositionsEqual",value:function(s){for(var a=0;a<this.location.length;a++)if(this.location[a]!==s)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];this.init(s.length)}else if(Number.isInteger(arguments[0])){var a=arguments[0];this.init(1),this.location[Re.ON]=a}else if(arguments[0]instanceof p){var d=arguments[0];if(this.init(d.location.length),d!==null)for(var b=0;b<this.location.length;b++)this.location[b]=d.location[b]}}else if(arguments.length===3){var M=arguments[0],N=arguments[1],j=arguments[2];this.init(3),this.location[Re.ON]=M,this.location[Re.LEFT]=N,this.location[Re.RIGHT]=j}}}])}(),Un=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getGeometryCount",value:function(){var s=0;return this.elt[0].isNull()||s++,this.elt[1].isNull()||s++,s}},{key:"setAllLocations",value:function(s,a){this.elt[s].setAllLocations(a)}},{key:"isNull",value:function(s){return this.elt[s].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var s=arguments[0];this.setAllLocationsIfNull(0,s),this.setAllLocationsIfNull(1,s)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.elt[a].setAllLocationsIfNull(d)}}},{key:"isLine",value:function(s){return this.elt[s].isLine()}},{key:"merge",value:function(s){for(var a=0;a<2;a++)this.elt[a]===null&&s.elt[a]!==null?this.elt[a]=new ai(s.elt[a]):this.elt[a].merge(s.elt[a])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var s=arguments[0];return this.elt[s].get(Re.ON)}if(arguments.length===2){var a=arguments[0],d=arguments[1];return this.elt[a].get(d)}}},{key:"toString",value:function(){var s=new Qt;return this.elt[0]!==null&&(s.append("A:"),s.append(this.elt[0].toString())),this.elt[1]!==null&&(s.append(" B:"),s.append(this.elt[1].toString())),s.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var s=arguments[0];return this.elt[s].isArea()}}},{key:"isAnyNull",value:function(s){return this.elt[s].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];this.elt[s].setLocation(Re.ON,a)}else if(arguments.length===3){var d=arguments[0],b=arguments[1],M=arguments[2];this.elt[d].setLocation(b,M)}}},{key:"isEqualOnSide",value:function(s,a){return this.elt[0].isEqualOnSide(s.elt[0],a)&&this.elt[1].isEqualOnSide(s.elt[1],a)}},{key:"allPositionsEqual",value:function(s,a){return this.elt[s].allPositionsEqual(a)}},{key:"toLine",value:function(s){this.elt[s].isArea()&&(this.elt[s]=new ai(this.elt[s].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var s=arguments[0];this.elt[0]=new ai(s),this.elt[1]=new ai(s)}else if(arguments[0]instanceof p){var a=arguments[0];this.elt[0]=new ai(a.elt[0]),this.elt[1]=new ai(a.elt[1])}}else if(arguments.length===2){var d=arguments[0],b=arguments[1];this.elt[0]=new ai(q.NONE),this.elt[1]=new ai(q.NONE),this.elt[d].setLocation(b)}else if(arguments.length===3){var M=arguments[0],N=arguments[1],j=arguments[2];this.elt[0]=new ai(M,N,j),this.elt[1]=new ai(M,N,j)}else if(arguments.length===4){var te=arguments[0],fe=arguments[1],Me=arguments[2],Fe=arguments[3];this.elt[0]=new ai(q.NONE,q.NONE,q.NONE),this.elt[1]=new ai(q.NONE,q.NONE,q.NONE),this.elt[te].setLocations(fe,Me,Fe)}}},{key:"toLineLabel",value:function(s){for(var a=new p(q.NONE),d=0;d<2;d++)a.setLocation(d,s.getLocation(d));return a}}])}(),Hs=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var p=new Array(this._pts.size()).fill(null),s=0;s<this._pts.size();s++)p[s]=this._pts.get(s);this._ring=this._geometryFactory.createLinearRing(p),this._isHole=Zt.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(p){this._startDe=p;var s=p,a=!0;do{if(s===null)throw new W("Found null DirectedEdge");if(s.getEdgeRing()===this)throw new W("Directed Edge visited twice during ring-building at "+s.getCoordinate());this._edges.add(s);var d=s.getLabel();ri.isTrue(d.isArea()),this.mergeLabel(d),this.addPoints(s.getEdge(),s.isForward(),a),a=!1,this.setEdgeRing(s,this),s=this.getNext(s)}while(s!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(p){return this._pts.get(p)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var p=this._startDe;do{var s=p.getNode().getEdges().getOutgoingDegree(this);s>this._maxNodeDegree&&(this._maxNodeDegree=s),p=this.getNext(p)}while(p!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(p,s,a){var d=p.getCoordinates();if(s){var b=1;a&&(b=0);for(var M=b;M<d.length;M++)this._pts.add(d[M])}else{var N=d.length-2;a&&(N=d.length-1);for(var j=N;j>=0;j--)this._pts.add(d[j])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var p=this._startDe;do p.getEdge().setInResult(!0),p=p.getNext();while(p!==this._startDe)}},{key:"containsPoint",value:function(p){var s=this.getLinearRing();if(!s.getEnvelopeInternal().contains(p)||!Br.isInRing(p,s.getCoordinates()))return!1;for(var a=this._holes.iterator();a.hasNext();)if(a.next().containsPoint(p))return!1;return!0}},{key:"addHole",value:function(p){this._holes.add(p)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var p=arguments[0];this.mergeLabel(p,0),this.mergeLabel(p,1)}else if(arguments.length===2){var s=arguments[1],a=arguments[0].getLocation(s,Re.RIGHT);if(a===q.NONE)return null;if(this._label.getLocation(s)===q.NONE)return this._label.setLocation(s,a),null}}},{key:"setShell",value:function(p){this._shell=p,p!==null&&p.addHole(this)}},{key:"toPolygon",value:function(p){for(var s=new Array(this._holes.size()).fill(null),a=0;a<this._holes.size();a++)s[a]=this._holes.get(a).getLinearRing();return p.createPolygon(this.getLinearRing(),s)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new Q,this._pts=new Q,this._label=new Un(q.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Q,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var p=arguments[0],s=arguments[1];this._geometryFactory=s,this.computePoints(p),this.computeRing()}}}}])}(),Xo=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"setEdgeRing",value:function(a,d){a.setMinEdgeRing(d)}},{key:"getNext",value:function(a){return a.getNextMin()}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];Hs.constructor_.call(this,a,d)}}])}(Hs),Gn=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"buildMinimalRings",value:function(){var a=new Q,d=this._startDe;do{if(d.getMinEdgeRing()===null){var b=new Xo(d,this._geometryFactory);a.add(b)}d=d.getNext()}while(d!==this._startDe);return a}},{key:"setEdgeRing",value:function(a,d){a.setEdgeRing(d)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var a=this._startDe;do a.getNode().getEdges().linkMinimalDirectedEdges(this),a=a.getNext();while(a!==this._startDe)}},{key:"getNext",value:function(a){return a.getNext()}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];Hs.constructor_.call(this,a,d)}}])}(Hs),pn=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(p){this._isVisited=p}},{key:"setInResult",value:function(p){this._isInResult=p}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(p){this._label=p}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(p){this._isCovered=p,this._isCoveredSet=!0}},{key:"updateIM",value:function(p){ri.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(p)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var p=arguments[0];this._label=p}}}}])}(),In=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"isIncidentEdgeInResult",value:function(){for(var a=this.getEdges().getEdges().iterator();a.hasNext();)if(a.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(a){a.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(a){}},{key:"computeMergedLocation",value:function(a,d){var b=q.NONE;if(b=this._label.getLocation(d),!a.isNull(d)){var M=a.getLocation(d);b!==q.BOUNDARY&&(b=M)}return b}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return le(s,"setLabel",this,1).apply(this,arguments);var a=arguments[0],d=arguments[1];this._label===null?this._label=new Un(a,d):this._label.setLocation(a,d)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof s){var a=arguments[0];this.mergeLabel(a._label)}else if(arguments[0]instanceof Un)for(var d=arguments[0],b=0;b<2;b++){var M=this.computeMergedLocation(d,b);this._label.getLocation(b)===q.NONE&&this._label.setLocation(b,M)}}},{key:"add",value:function(a){this._edges.insert(a),a.setNode(this)}},{key:"setLabelBoundary",value:function(a){if(this._label===null)return null;var d=q.NONE;this._label!==null&&(d=this._label.getLocation(a));var b=null;switch(d){case q.BOUNDARY:b=q.INTERIOR;break;case q.INTERIOR:default:b=q.BOUNDARY}this._label.setLocation(a,b)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var a=arguments[0],d=arguments[1];this._coord=a,this._edges=d,this._label=new Un(0,q.NONE)}}])}(pn),An=function(p){function s(){return E(this,s),I(this,s,arguments)}return ie(s,p),o(s)}(la);function Wi(p){return p==null?0:p.color}function Ri(p){return p==null?null:p.parent}function di(p,s){p!==null&&(p.color=s)}function qn(p){return p==null?null:p.left}function ci(p){return p==null?null:p.right}var hi=function(p){function s(){var a;return E(this,s),(a=I(this,s)).root_=null,a.size_=0,a}return ie(s,p),o(s,[{key:"get",value:function(a){for(var d=this.root_;d!==null;){var b=a.compareTo(d.key);if(b<0)d=d.left;else{if(!(b>0))return d.value;d=d.right}}return null}},{key:"put",value:function(a,d){if(this.root_===null)return this.root_={key:a,value:d,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var b,M,N=this.root_;do if(b=N,(M=a.compareTo(N.key))<0)N=N.left;else{if(!(M>0)){var j=N.value;return N.value=d,j}N=N.right}while(N!==null);var te={key:a,left:null,right:null,value:d,parent:b,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return M<0?b.left=te:b.right=te,this.fixAfterInsertion(te),this.size_++,null}},{key:"fixAfterInsertion",value:function(a){var d;for(a.color=1;a!=null&&a!==this.root_&&a.parent.color===1;)Ri(a)===qn(Ri(Ri(a)))?Wi(d=ci(Ri(Ri(a))))===1?(di(Ri(a),0),di(d,0),di(Ri(Ri(a)),1),a=Ri(Ri(a))):(a===ci(Ri(a))&&(a=Ri(a),this.rotateLeft(a)),di(Ri(a),0),di(Ri(Ri(a)),1),this.rotateRight(Ri(Ri(a)))):Wi(d=qn(Ri(Ri(a))))===1?(di(Ri(a),0),di(d,0),di(Ri(Ri(a)),1),a=Ri(Ri(a))):(a===qn(Ri(a))&&(a=Ri(a),this.rotateRight(a)),di(Ri(a),0),di(Ri(Ri(a)),1),this.rotateLeft(Ri(Ri(a))));this.root_.color=0}},{key:"values",value:function(){var a=new Q,d=this.getFirstEntry();if(d!==null)for(a.add(d.value);(d=s.successor(d))!==null;)a.add(d.value);return a}},{key:"entrySet",value:function(){var a=new rt,d=this.getFirstEntry();if(d!==null)for(a.add(d);(d=s.successor(d))!==null;)a.add(d);return a}},{key:"rotateLeft",value:function(a){if(a!=null){var d=a.right;a.right=d.left,d.left!=null&&(d.left.parent=a),d.parent=a.parent,a.parent==null?this.root_=d:a.parent.left===a?a.parent.left=d:a.parent.right=d,d.left=a,a.parent=d}}},{key:"rotateRight",value:function(a){if(a!=null){var d=a.left;a.left=d.right,d.right!=null&&(d.right.parent=a),d.parent=a.parent,a.parent==null?this.root_=d:a.parent.right===a?a.parent.right=d:a.parent.left=d,d.right=a,a.parent=d}}},{key:"getFirstEntry",value:function(){var a=this.root_;if(a!=null)for(;a.left!=null;)a=a.left;return a}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(a){for(var d=this.root_;d!==null;){var b=a.compareTo(d.key);if(b<0)d=d.left;else{if(!(b>0))return!0;d=d.right}}return!1}}],[{key:"successor",value:function(a){var d;if(a===null)return null;if(a.right!==null){for(d=a.right;d.left!==null;)d=d.left;return d}d=a.parent;for(var b=a;d!==null&&b===d.right;)b=d,d=d.parent;return d}}])}(An),Ss=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"find",value:function(p){return this.nodeMap.get(p)}},{key:"addNode",value:function(){if(arguments[0]instanceof Ne){var p=arguments[0],s=this.nodeMap.get(p);return s===null&&(s=this.nodeFact.createNode(p),this.nodeMap.put(p,s)),s}if(arguments[0]instanceof In){var a=arguments[0],d=this.nodeMap.get(a.getCoordinate());return d===null?(this.nodeMap.put(a.getCoordinate(),a),a):(d.mergeLabel(a),d)}}},{key:"print",value:function(p){for(var s=this.iterator();s.hasNext();)s.next().print(p)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(p){for(var s=new Q,a=this.iterator();a.hasNext();){var d=a.next();d.getLabel().getLocation(p)===q.BOUNDARY&&s.add(d)}return s}},{key:"add",value:function(p){var s=p.getCoordinate();this.addNode(s).add(p)}}],[{key:"constructor_",value:function(){this.nodeMap=new hi,this.nodeFact=null;var p=arguments[0];this.nodeFact=p}}])}(),Vt=function(){function p(){E(this,p)}return o(p,null,[{key:"isNorthern",value:function(s){return s===p.NE||s===p.NW}},{key:"isOpposite",value:function(s,a){return s!==a&&(s-a+4)%4===2}},{key:"commonHalfPlane",value:function(s,a){if(s===a)return s;if((s-a+4)%4===2)return-1;var d=s<a?s:a;return d===0&&(s>a?s:a)===3?3:d}},{key:"isInHalfPlane",value:function(s,a){return a===p.SE?s===p.SE||s===p.SW:s===a||s===a+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1];if(s===0&&a===0)throw new qe("Cannot compute the quadrant for point ( "+s+", "+a+" )");return s>=0?a>=0?p.NE:p.SE:a>=0?p.NW:p.SW}if(arguments[0]instanceof Ne&&arguments[1]instanceof Ne){var d=arguments[0],b=arguments[1];if(b.x===d.x&&b.y===d.y)throw new qe("Cannot compute the quadrant for two identical points "+d);return b.x>=d.x?b.y>=d.y?p.NE:p.SE:b.y>=d.y?p.NW:p.SW}}}])}();Vt.NE=0,Vt.NW=1,Vt.SW=2,Vt.SE=3;var Is=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"compareDirection",value:function(s){return this._dx===s._dx&&this._dy===s._dy?0:this._quadrant>s._quadrant?1:this._quadrant<s._quadrant?-1:Zt.index(s._p0,s._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(s){this._node=s}},{key:"print",value:function(s){var a=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),b=d.lastIndexOf("."),M=d.substring(b+1);s.print("  "+M+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+a+"   "+this._label)}},{key:"compareTo",value:function(s){var a=s;return this.compareDirection(a)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var s=Math.atan2(this._dy,this._dx),a=this.getClass().getName(),d=a.lastIndexOf(".");return"  "+a.substring(d+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label}},{key:"computeLabel",value:function(s){}},{key:"init",value:function(s,a){this._p0=s,this._p1=a,this._dx=a.x-s.x,this._dy=a.y-s.y,this._quadrant=Vt.quadrant(this._dx,this._dy),ri.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[pt]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var s=arguments[0];this._edge=s}else if(arguments.length===3){var a=arguments[0],d=arguments[1],b=arguments[2];p.constructor_.call(this,a,d,b,null)}else if(arguments.length===4){var M=arguments[0],N=arguments[1],j=arguments[2],te=arguments[3];p.constructor_.call(this,M),this.init(N,j),this._label=te}}}])}(),zn=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(a){return this._depth[a]}},{key:"setVisited",value:function(a){this._isVisited=a}},{key:"computeDirectedLabel",value:function(){this._label=new Un(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(a,d){if(this._depth[a]!==-999&&this._depth[a]!==d)throw new W("assigned depths do not match",this.getCoordinate());this._depth[a]=d}},{key:"isInteriorAreaEdge",value:function(){for(var a=!0,d=0;d<2;d++)this._label.isArea(d)&&this._label.getLocation(d,Re.LEFT)===q.INTERIOR&&this._label.getLocation(d,Re.RIGHT)===q.INTERIOR||(a=!1);return a}},{key:"setNextMin",value:function(a){this._nextMin=a}},{key:"print",value:function(a){le(s,"print",this,1).call(this,a),a.print(" "+this._depth[Re.LEFT]+"/"+this._depth[Re.RIGHT]),a.print(" ("+this.getDepthDelta()+")"),this._isInResult&&a.print(" inResult")}},{key:"setMinEdgeRing",value:function(a){this._minEdgeRing=a}},{key:"isLineEdge",value:function(){var a=this._label.isLine(0)||this._label.isLine(1),d=!this._label.isArea(0)||this._label.allPositionsEqual(0,q.EXTERIOR),b=!this._label.isArea(1)||this._label.allPositionsEqual(1,q.EXTERIOR);return a&&d&&b}},{key:"setEdgeRing",value:function(a){this._edgeRing=a}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var a=this._edge.getDepthDelta();return this._isForward||(a=-a),a}},{key:"setInResult",value:function(a){this._isInResult=a}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(a){this.print(a),a.print(" "),this._isForward?this._edge.print(a):this._edge.printReverse(a)}},{key:"setSym",value:function(a){this._sym=a}},{key:"setVisitedEdge",value:function(a){this.setVisited(a),this._sym.setVisited(a)}},{key:"setEdgeDepths",value:function(a,d){var b=this.getEdge().getDepthDelta();this._isForward||(b=-b);var M=1;a===Re.LEFT&&(M=-1);var N=Re.opposite(a),j=d+b*M;this.setDepth(a,d),this.setDepth(N,j)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(a){this._next=a}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var a=arguments[0],d=arguments[1];if(Is.constructor_.call(this,a),this._isForward=d,d)this.init(a.getCoordinate(0),a.getCoordinate(1));else{var b=a.getNumPoints()-1;this.init(a.getCoordinate(b),a.getCoordinate(b-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(a,d){return a===q.EXTERIOR&&d===q.INTERIOR?1:a===q.INTERIOR&&d===q.EXTERIOR?-1:0}}])}(Is),Xs=function(){return o(function p(){E(this,p)},[{key:"createNode",value:function(p){return new In(p,null)}}])}(),tr=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(p){p.println("Edges:");for(var s=0;s<this._edges.size();s++){p.println("edge "+s+":");var a=this._edges.get(s);a.print(p),a.eiList.print(p)}}},{key:"find",value:function(p){return this._nodes.find(p)}},{key:"addNode",value:function(){if(arguments[0]instanceof In){var p=arguments[0];return this._nodes.addNode(p)}if(arguments[0]instanceof Ne){var s=arguments[0];return this._nodes.addNode(s)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var p=this._nodes.iterator();p.hasNext();)p.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(p){Le.out.println(p)}},{key:"isBoundaryNode",value:function(p,s){var a=this._nodes.find(s);if(a===null)return!1;var d=a.getLabel();return d!==null&&d.getLocation(p)===q.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var p=this._nodes.iterator();p.hasNext();)p.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(p,s,a,d){return!!p.equals(a)&&Zt.index(p,s,d)===Zt.COLLINEAR&&Vt.quadrant(p,s)===Vt.quadrant(a,d)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(p){Le.out.print(p)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(p,s){for(var a=0;a<this._edges.size();a++){var d=this._edges.get(a),b=d.getCoordinates();if(this.matchInSameDirection(p,s,b[0],b[1])||this.matchInSameDirection(p,s,b[b.length-1],b[b.length-2]))return d}return null}},{key:"insertEdge",value:function(p){this._edges.add(p)}},{key:"findEdgeEnd",value:function(p){for(var s=this.getEdgeEnds().iterator();s.hasNext();){var a=s.next();if(a.getEdge()===p)return a}return null}},{key:"addEdges",value:function(p){for(var s=p.iterator();s.hasNext();){var a=s.next();this._edges.add(a);var d=new zn(a,!0),b=new zn(a,!1);d.setSym(b),b.setSym(d),this.add(d),this.add(b)}}},{key:"add",value:function(p){this._nodes.add(p),this._edgeEndList.add(p)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(p,s){for(var a=0;a<this._edges.size();a++){var d=this._edges.get(a),b=d.getCoordinates();if(p.equals(b[0])&&s.equals(b[1]))return d}return null}}],[{key:"constructor_",value:function(){if(this._edges=new Q,this._nodes=null,this._edgeEndList=new Q,arguments.length===0)this._nodes=new Ss(new Xs);else if(arguments.length===1){var p=arguments[0];this._nodes=new Ss(p)}}},{key:"linkResultDirectedEdges",value:function(p){for(var s=p.iterator();s.hasNext();)s.next().getEdges().linkResultDirectedEdges()}}])}(),Wo=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"sortShellsAndHoles",value:function(s,a,d){for(var b=s.iterator();b.hasNext();){var M=b.next();M.isHole()?d.add(M):a.add(M)}}},{key:"computePolygons",value:function(s){for(var a=new Q,d=s.iterator();d.hasNext();){var b=d.next().toPolygon(this._geometryFactory);a.add(b)}return a}},{key:"placeFreeHoles",value:function(s,a){for(var d=a.iterator();d.hasNext();){var b=d.next();if(b.getShell()===null){var M=p.findEdgeRingContaining(b,s);if(M===null)throw new W("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(M)}}}},{key:"buildMinimalEdgeRings",value:function(s,a,d){for(var b=new Q,M=s.iterator();M.hasNext();){var N=M.next();if(N.getMaxNodeDegree()>2){N.linkDirectedEdgesForMinimalEdgeRings();var j=N.buildMinimalRings(),te=this.findShell(j);te!==null?(this.placePolygonHoles(te,j),a.add(te)):d.addAll(j)}else b.add(N)}return b}},{key:"buildMaximalEdgeRings",value:function(s){for(var a=new Q,d=s.iterator();d.hasNext();){var b=d.next();if(b.isInResult()&&b.getLabel().isArea()&&b.getEdgeRing()===null){var M=new Gn(b,this._geometryFactory);a.add(M),M.setInResult()}}return a}},{key:"placePolygonHoles",value:function(s,a){for(var d=a.iterator();d.hasNext();){var b=d.next();b.isHole()&&b.setShell(s)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(s){for(var a=0,d=null,b=s.iterator();b.hasNext();){var M=b.next();M.isHole()||(d=M,a++)}return ri.isTrue(a<=1,"found two shells in MinimalEdgeRing list"),d}},{key:"add",value:function(){if(arguments.length===1){var s=arguments[0];this.add(s.getEdgeEnds(),s.getNodes())}else if(arguments.length===2){var a=arguments[0],d=arguments[1];tr.linkResultDirectedEdges(d);var b=this.buildMaximalEdgeRings(a),M=new Q,N=this.buildMinimalEdgeRings(b,this._shellList,M);this.sortShellsAndHoles(N,this._shellList,M),this.placeFreeHoles(this._shellList,M)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new Q;var s=arguments[0];this._geometryFactory=s}},{key:"findEdgeRingContaining",value:function(s,a){for(var d=s.getLinearRing(),b=d.getEnvelopeInternal(),M=d.getCoordinateN(0),N=null,j=null,te=a.iterator();te.hasNext();){var fe=te.next(),Me=fe.getLinearRing(),Fe=Me.getEnvelopeInternal();if(!Fe.equals(b)&&Fe.contains(b)){M=Wt.ptNotInList(d.getCoordinates(),Me.getCoordinates());var lt=!1;Br.isInRing(M,Me.getCoordinates())&&(lt=!0),lt&&(N===null||j.contains(Fe))&&(j=(N=fe).getLinearRing().getEnvelopeInternal())}}return N}}])}(),jr=function(){return o(function p(){E(this,p)},[{key:"getBounds",value:function(){}}])}(),Qr=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[jr,Ye]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var p=arguments[0],s=arguments[1];this._bounds=p,this._item=s}}])}(),za=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var p=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),p}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(p){for(var s=null,a=this._items.get(p);2*p<=this._size&&((s=2*p)!==this._size&&this._items.get(s+1).compareTo(this._items.get(s))<0&&s++,this._items.get(s).compareTo(a)<0);p=s)this._items.set(p,this._items.get(s));this._items.set(p,a)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(p){this._items.add(null),this._size+=1;var s=this._size;for(this._items.set(0,p);p.compareTo(this._items.get(Math.trunc(s/2)))<0;s/=2)this._items.set(s,this._items.get(Math.trunc(s/2)));this._items.set(s,p)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new Q,this._items.add(null)}}])}(),Na=function(){return o(function p(){E(this,p)},[{key:"insert",value:function(p,s){}},{key:"remove",value:function(p,s){}},{key:"query",value:function(){}}])}(),$n=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(p){ri.isTrue(this._bounds===null),this._childBoundables.add(p)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[jr,Ye]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new Q,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var p=arguments[0];this._level=p}}}}])}(),Zn={reverseOrder:function(){return{compare:function(p,s){return s.compareTo(p)}}},min:function(p){return Zn.sort(p),p.get(0)},sort:function(p,s){var a=p.toArray();s?Yt.sort(a,s):Yt.sort(a);for(var d=p.iterator(),b=0,M=a.length;b<M;b++)d.next(),d.set(a[b])},singletonList:function(p){var s=new Q;return s.add(p),s}},Rn=function(){function p(){E(this,p)}return o(p,null,[{key:"maxDistance",value:function(s,a,d,b,M,N,j,te){var fe=p.distance(s,a,M,N);return fe=Math.max(fe,p.distance(s,a,j,te)),fe=Math.max(fe,p.distance(d,b,M,N)),fe=Math.max(fe,p.distance(d,b,j,te))}},{key:"distance",value:function(s,a,d,b){var M=d-s,N=b-a;return Math.sqrt(M*M+N*N)}},{key:"maximumDistance",value:function(s,a){var d=Math.min(s.getMinX(),a.getMinX()),b=Math.min(s.getMinY(),a.getMinY()),M=Math.max(s.getMaxX(),a.getMaxX()),N=Math.max(s.getMaxY(),a.getMaxY());return p.distance(d,b,M,N)}},{key:"minMaxDistance",value:function(s,a){var d=s.getMinX(),b=s.getMinY(),M=s.getMaxX(),N=s.getMaxY(),j=a.getMinX(),te=a.getMinY(),fe=a.getMaxX(),Me=a.getMaxY(),Fe=p.maxDistance(d,b,d,N,j,te,j,Me);return Fe=Math.min(Fe,p.maxDistance(d,b,d,N,j,te,fe,te)),Fe=Math.min(Fe,p.maxDistance(d,b,d,N,fe,Me,j,Me)),Fe=Math.min(Fe,p.maxDistance(d,b,d,N,fe,Me,fe,te)),Fe=Math.min(Fe,p.maxDistance(d,b,M,b,j,te,j,Me)),Fe=Math.min(Fe,p.maxDistance(d,b,M,b,j,te,fe,te)),Fe=Math.min(Fe,p.maxDistance(d,b,M,b,fe,Me,j,Me)),Fe=Math.min(Fe,p.maxDistance(d,b,M,b,fe,Me,fe,te)),Fe=Math.min(Fe,p.maxDistance(M,N,d,N,j,te,j,Me)),Fe=Math.min(Fe,p.maxDistance(M,N,d,N,j,te,fe,te)),Fe=Math.min(Fe,p.maxDistance(M,N,d,N,fe,Me,j,Me)),Fe=Math.min(Fe,p.maxDistance(M,N,d,N,fe,Me,fe,te)),Fe=Math.min(Fe,p.maxDistance(M,N,M,b,j,te,j,Me)),Fe=Math.min(Fe,p.maxDistance(M,N,M,b,j,te,fe,te)),Fe=Math.min(Fe,p.maxDistance(M,N,M,b,fe,Me,j,Me)),Fe=Math.min(Fe,p.maxDistance(M,N,M,b,fe,Me,fe,te))}}])}(),Vr=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"maximumDistance",value:function(){return Rn.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(s,a){var d=p.isComposite(this._boundable1),b=p.isComposite(this._boundable2);if(d&&b)return p.area(this._boundable1)>p.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,s,a),null):(this.expand(this._boundable2,this._boundable1,!0,s,a),null);if(d)return this.expand(this._boundable1,this._boundable2,!1,s,a),null;if(b)return this.expand(this._boundable2,this._boundable1,!0,s,a),null;throw new qe("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(p.isComposite(this._boundable1)||p.isComposite(this._boundable2))}},{key:"compareTo",value:function(s){var a=s;return this._distance<a._distance?-1:this._distance>a._distance?1:0}},{key:"expand",value:function(s,a,d,b,M){for(var N=s.getChildBoundables().iterator();N.hasNext();){var j=N.next(),te=null;(te=d?new p(a,j,this._itemDistance):new p(j,a,this._itemDistance)).getDistance()<M&&b.add(te)}}},{key:"getBoundable",value:function(s){return s===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[pt]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var s=arguments[0],a=arguments[1],d=arguments[2];this._boundable1=s,this._boundable2=a,this._itemDistance=d,this._distance=this.distance()}},{key:"area",value:function(s){return s.getBounds().getArea()}},{key:"isComposite",value:function(s){return s instanceof $n}}])}(),ca=function(){return o(function p(){E(this,p)},[{key:"visitItem",value:function(p){}}])}(),Ur=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"queryInternal",value:function(){if(mt(arguments[2],ca)&&arguments[0]instanceof Object&&arguments[1]instanceof $n)for(var s=arguments[0],a=arguments[2],d=arguments[1].getChildBoundables(),b=0;b<d.size();b++){var M=d.get(b);this.getIntersectsOp().intersects(M.getBounds(),s)&&(M instanceof $n?this.queryInternal(s,M,a):M instanceof Qr?a.visitItem(M.getItem()):ri.shouldNeverReachHere())}else if(mt(arguments[2],$t)&&arguments[0]instanceof Object&&arguments[1]instanceof $n)for(var N=arguments[0],j=arguments[2],te=arguments[1].getChildBoundables(),fe=0;fe<te.size();fe++){var Me=te.get(fe);this.getIntersectsOp().intersects(Me.getBounds(),N)&&(Me instanceof $n?this.queryInternal(N,Me,j):Me instanceof Qr?j.add(Me.getItem()):ri.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(s){return s.get(s.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var s=0,a=arguments[0].getChildBoundables().iterator();a.hasNext();){var d=a.next();d instanceof $n?s+=this.size(d):d instanceof Qr&&(s+=1)}return s}}},{key:"removeItem",value:function(s,a){for(var d=null,b=s.getChildBoundables().iterator();b.hasNext();){var M=b.next();M instanceof Qr&&M.getItem()===a&&(d=M)}return d!==null&&(s.getChildBoundables().remove(d),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var s=this.itemsTree(this._root);return s===null?new Q:s}if(arguments.length===1){for(var a=arguments[0],d=new Q,b=a.getChildBoundables().iterator();b.hasNext();){var M=b.next();if(M instanceof $n){var N=this.itemsTree(M);N!==null&&d.add(N)}else M instanceof Qr?d.add(M.getItem()):ri.shouldNeverReachHere()}return d.size()<=0?null:d}}},{key:"insert",value:function(s,a){ri.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Qr(s,a))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var s=arguments[0],a=new Q;return this.boundablesAtLevel(s,this._root,a),a}if(arguments.length===3){var d=arguments[0],b=arguments[1],M=arguments[2];if(ri.isTrue(d>-2),b.getLevel()===d)return M.add(b),null;for(var N=b.getChildBoundables().iterator();N.hasNext();){var j=N.next();j instanceof $n?this.boundablesAtLevel(d,j,M):(ri.isTrue(j instanceof Qr),d===-1&&M.add(j))}return null}}},{key:"query",value:function(){if(arguments.length===1){var s=arguments[0];this.build();var a=new Q;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.queryInternal(s,this._root,a),a}if(arguments.length===2){var d=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),d)&&this.queryInternal(d,this._root,b)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.remove(s,this._root,a)}if(arguments.length===3){var d=arguments[0],b=arguments[1],M=arguments[2],N=this.removeItem(b,M);if(N)return!0;for(var j=null,te=b.getChildBoundables().iterator();te.hasNext();){var fe=te.next();if(this.getIntersectsOp().intersects(fe.getBounds(),d)&&fe instanceof $n&&(N=this.remove(d,fe,M))){j=fe;break}}return j!==null&&j.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(j),N}}},{key:"createHigherLevels",value:function(s,a){ri.isTrue(!s.isEmpty());var d=this.createParentBoundables(s,a+1);return d.size()===1?d.get(0):this.createHigherLevels(d,a+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var s=0,a=arguments[0].getChildBoundables().iterator();a.hasNext();){var d=a.next();if(d instanceof $n){var b=this.depth(d);b>s&&(s=b)}}return s+1}}},{key:"createParentBoundables",value:function(s,a){ri.isTrue(!s.isEmpty());var d=new Q;d.add(this.createNode(a));var b=new Q(s);Zn.sort(b,this.getComparator());for(var M=b.iterator();M.hasNext();){var N=M.next();this.lastNode(d).getChildBoundables().size()===this.getNodeCapacity()&&d.add(this.createNode(a)),this.lastNode(d).addChildBoundable(N)}return d}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[Ye]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new Q,this._nodeCapacity=null,arguments.length===0)p.constructor_.call(this,p.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var s=arguments[0];ri.isTrue(s>1,"Node capacity must be greater than 1"),this._nodeCapacity=s}}},{key:"compareDoubles",value:function(s,a){return s>a?1:s<a?-1:0}}])}();Ur.IntersectsOp=function(){},Ur.DEFAULT_NODE_CAPACITY=10;var Tn=function(){return o(function p(){E(this,p)},[{key:"distance",value:function(p,s){}}])}(),hr=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"createParentBoundablesFromVerticalSlices",value:function(a,d){ri.isTrue(a.length>0);for(var b=new Q,M=0;M<a.length;M++)b.addAll(this.createParentBoundablesFromVerticalSlice(a[M],d));return b}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var a=arguments[0],d=arguments[1];return this.nearestNeighbourK(a,Ot.POSITIVE_INFINITY,d)}if(arguments.length===3){var b=arguments[0],M=arguments[2],N=arguments[1],j=new za;j.add(b);for(var te=new za;!j.isEmpty()&&N>=0;){var fe=j.poll(),Me=fe.getDistance();if(Me>=N)break;fe.isLeaves()?te.size()<M?te.add(fe):(te.peek().getDistance()>Me&&(te.poll(),te.add(fe)),N=te.peek().getDistance()):fe.expandToQueue(j,N)}return s.getItems(te)}}},{key:"createNode",value:function(a){return new Ws(a)}},{key:"size",value:function(){return arguments.length===0?le(s,"size",this,1).call(this):le(s,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Ci))return le(s,"insert",this,1).apply(this,arguments);var a=arguments[0],d=arguments[1];if(a.isNull())return null;le(s,"insert",this,1).call(this,a,d)}},{key:"getIntersectsOp",value:function(){return s.intersectsOp}},{key:"verticalSlices",value:function(a,d){for(var b=Math.trunc(Math.ceil(a.size()/d)),M=new Array(d).fill(null),N=a.iterator(),j=0;j<d;j++){M[j]=new Q;for(var te=0;N.hasNext()&&te<b;){var fe=N.next();M[j].add(fe),te++}}return M}},{key:"query",value:function(){if(arguments.length===1){var a=arguments[0];return le(s,"query",this,1).call(this,a)}if(arguments.length===2){var d=arguments[0],b=arguments[1];le(s,"query",this,1).call(this,d,b)}}},{key:"getComparator",value:function(){return s.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(a,d){return le(s,"createParentBoundables",this,1).call(this,a,d)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Ci){var a=arguments[0],d=arguments[1];return le(s,"remove",this,1).call(this,a,d)}return le(s,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?le(s,"depth",this,1).call(this):le(s,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(a,d){ri.isTrue(!a.isEmpty());var b=Math.trunc(Math.ceil(a.size()/this.getNodeCapacity())),M=new Q(a);Zn.sort(M,s.xComparator);var N=this.verticalSlices(M,Math.trunc(Math.ceil(Math.sqrt(b))));return this.createParentBoundablesFromVerticalSlices(N,d)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(mt(arguments[0],Tn)){var a=arguments[0];if(this.isEmpty())return null;var d=new Vr(this.getRoot(),this.getRoot(),a);return this.nearestNeighbour(d)}if(arguments[0]instanceof Vr){var b=arguments[0],M=Ot.POSITIVE_INFINITY,N=null,j=new za;for(j.add(b);!j.isEmpty()&&M>0;){var te=j.poll(),fe=te.getDistance();if(fe>=M)break;te.isLeaves()?(M=fe,N=te):te.expandToQueue(j,M)}return N===null?null:[N.getBoundable(0).getItem(),N.getBoundable(1).getItem()]}}else{if(arguments.length===2){var Me=arguments[0],Fe=arguments[1];if(this.isEmpty()||Me.isEmpty())return null;var lt=new Vr(this.getRoot(),Me.getRoot(),Fe);return this.nearestNeighbour(lt)}if(arguments.length===3){var Rt=arguments[2],Xt=new Qr(arguments[0],arguments[1]),ti=new Vr(this.getRoot(),Xt,Rt);return this.nearestNeighbour(ti)[0]}if(arguments.length===4){var vi=arguments[2],bi=arguments[3],zi=new Qr(arguments[0],arguments[1]),ji=new Vr(this.getRoot(),zi,vi);return this.nearestNeighbourK(ji,bi)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var a=arguments[0],d=arguments[1],b=Ot.POSITIVE_INFINITY,M=new za;for(M.add(a);!M.isEmpty();){var N=M.poll(),j=N.getDistance();if(j>d)return!1;if(N.maximumDistance()<=d)return!0;if(N.isLeaves()){if((b=j)<=d)return!0}else N.expandToQueue(M,b)}return!1}if(arguments.length===3){var te=arguments[0],fe=arguments[1],Me=arguments[2],Fe=new Vr(this.getRoot(),te.getRoot(),fe);return this.isWithinDistance(Fe,Me)}}},{key:"interfaces_",get:function(){return[Na,Ye]}}],[{key:"constructor_",value:function(){if(arguments.length===0)s.constructor_.call(this,s.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var a=arguments[0];Ur.constructor_.call(this,a)}}},{key:"centreX",value:function(a){return s.avg(a.getMinX(),a.getMaxX())}},{key:"avg",value:function(a,d){return(a+d)/2}},{key:"getItems",value:function(a){for(var d=new Array(a.size()).fill(null),b=0;!a.isEmpty();){var M=a.poll();d[b]=M.getBoundable(0).getItem(),b++}return d}},{key:"centreY",value:function(a){return s.avg(a.getMinY(),a.getMaxY())}}])}(Ur),Ws=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"computeBounds",value:function(){for(var a=null,d=this.getChildBoundables().iterator();d.hasNext();){var b=d.next();a===null?a=new Ci(b.getBounds()):a.expandToInclude(b.getBounds())}return a}}],[{key:"constructor_",value:function(){var a=arguments[0];$n.constructor_.call(this,a)}}])}($n);hr.STRtreeNode=Ws,hr.xComparator=new(function(){return o(function p(){E(this,p)},[{key:"interfaces_",get:function(){return[Ei]}},{key:"compare",value:function(p,s){return Ur.compareDoubles(hr.centreX(p.getBounds()),hr.centreX(s.getBounds()))}}])}()),hr.yComparator=new(function(){return o(function p(){E(this,p)},[{key:"interfaces_",get:function(){return[Ei]}},{key:"compare",value:function(p,s){return Ur.compareDoubles(hr.centreY(p.getBounds()),hr.centreY(s.getBounds()))}}])}()),hr.intersectsOp=new(function(){return o(function p(){E(this,p)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(p,s){return p.intersects(s)}}])}()),hr.DEFAULT_NODE_CAPACITY=10;var ha=function(){function p(){E(this,p)}return o(p,null,[{key:"relativeSign",value:function(s,a){return s<a?-1:s>a?1:0}},{key:"compare",value:function(s,a,d){if(a.equals2D(d))return 0;var b=p.relativeSign(a.x,d.x),M=p.relativeSign(a.y,d.y);switch(s){case 0:return p.compareValue(b,M);case 1:return p.compareValue(M,b);case 2:return p.compareValue(M,-b);case 3:return p.compareValue(-b,M);case 4:return p.compareValue(-b,-M);case 5:return p.compareValue(-M,-b);case 6:return p.compareValue(-M,b);case 7:return p.compareValue(b,-M)}return ri.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(s,a){return s<0?-1:s>0?1:a<0?-1:a>0?1:0}}])}(),Qu=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(p){p.print(this.coord),p.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(p){var s=p;return this.segmentIndex<s.segmentIndex?-1:this.segmentIndex>s.segmentIndex?1:this.coord.equals2D(s.coord)?0:this._isInterior?s._isInterior?ha.compare(this._segmentOctant,this.coord,s.coord):1:-1}},{key:"isEndPoint",value:function(p){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===p}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[pt]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var p=arguments[0],s=arguments[1],a=arguments[2],d=arguments[3];this._segString=p,this.coord=new Ne(s),this.segmentIndex=a,this._segmentOctant=d,this._isInterior=!s.equals2D(p.getCoordinate(a))}}])}(),ks=function(){return o(function p(){E(this,p)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])}(),Oa=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var p=new cr;this.addEndpoints();for(var s=this.iterator(),a=s.next();s.hasNext();){var d=s.next();this.addEdgeCoordinates(a,d,p),a=d}return p.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var p=new Q;this.findCollapsesFromInsertedNodes(p),this.findCollapsesFromExistingVertices(p);for(var s=p.iterator();s.hasNext();){var a=s.next().intValue();this.add(this._edge.getCoordinate(a),a)}}},{key:"createSplitEdgePts",value:function(p,s){var a=s.segmentIndex-p.segmentIndex+2;if(a===2)return[new Ne(p.coord),new Ne(s.coord)];var d=this._edge.getCoordinate(s.segmentIndex),b=s.isInterior()||!s.coord.equals2D(d);b||a--;var M=new Array(a).fill(null),N=0;M[N++]=new Ne(p.coord);for(var j=p.segmentIndex+1;j<=s.segmentIndex;j++)M[N++]=this._edge.getCoordinate(j);return b&&(M[N]=new Ne(s.coord)),M}},{key:"print",value:function(p){p.println("Intersections:");for(var s=this.iterator();s.hasNext();)s.next().print(p)}},{key:"findCollapsesFromExistingVertices",value:function(p){for(var s=0;s<this._edge.size()-2;s++){var a=this._edge.getCoordinate(s);this._edge.getCoordinate(s+1);var d=this._edge.getCoordinate(s+2);a.equals2D(d)&&p.add(fi.valueOf(s+1))}}},{key:"addEdgeCoordinates",value:function(p,s,a){var d=this.createSplitEdgePts(p,s);a.add(d,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(p){this.addEndpoints(),this.addCollapsedNodes();for(var s=this.iterator(),a=s.next();s.hasNext();){var d=s.next(),b=this.createSplitEdge(a,d);p.add(b),a=d}}},{key:"findCollapseIndex",value:function(p,s,a){if(!p.coord.equals2D(s.coord))return!1;var d=s.segmentIndex-p.segmentIndex;return s.isInterior()||d--,d===1&&(a[0]=p.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(p){for(var s=new Array(1).fill(null),a=this.iterator(),d=a.next();a.hasNext();){var b=a.next();this.findCollapseIndex(d,b,s)&&p.add(fi.valueOf(s[0])),d=b}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var p=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(p),p)}},{key:"createSplitEdge",value:function(p,s){var a=this.createSplitEdgePts(p,s);return new Pr(a,this._edge.getData())}},{key:"add",value:function(p,s){var a=new Qu(this._edge,p,s,this._edge.getSegmentOctant(s)),d=this._nodeMap.get(a);return d!==null?(ri.isTrue(d.coord.equals2D(p),"Found equal nodes with different coordinates"),d):(this._nodeMap.put(a,a),a)}},{key:"checkSplitEdgesCorrectness",value:function(p){var s=this._edge.getCoordinates(),a=p.get(0).getCoordinate(0);if(!a.equals2D(s[0]))throw new Jt("bad split edge start point at "+a);var d=p.get(p.size()-1).getCoordinates(),b=d[d.length-1];if(!b.equals2D(s[s.length-1]))throw new Jt("bad split edge end point at "+b)}}],[{key:"constructor_",value:function(){this._nodeMap=new hi,this._edge=null;var p=arguments[0];this._edge=p}}])}(),Yo=function(){function p(){E(this,p)}return o(p,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1];if(s===0&&a===0)throw new qe("Cannot compute the octant for point ( "+s+", "+a+" )");var d=Math.abs(s),b=Math.abs(a);return s>=0?a>=0?d>=b?0:1:d>=b?7:6:a>=0?d>=b?3:2:d>=b?4:5}if(arguments[0]instanceof Ne&&arguments[1]instanceof Ne){var M=arguments[0],N=arguments[1],j=N.x-M.x,te=N.y-M.y;if(j===0&&te===0)throw new qe("Cannot compute the octant for two identical points "+M);return p.octant(j,te)}}}])}(),ec=function(){return o(function p(){E(this,p)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(p){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(p){}},{key:"getData",value:function(){}}])}(),ir=function(){return o(function p(){E(this,p)},[{key:"addIntersection",value:function(p,s){}},{key:"interfaces_",get:function(){return[ec]}}])}(),Pr=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(s){return this._pts[s]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(s){return s===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(s),this.getCoordinate(s+1))}},{key:"setData",value:function(s){this._data=s}},{key:"safeOctant",value:function(s,a){return s.equals2D(a)?0:Yo.octant(s,a)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];this.addIntersectionNode(s,a)}else if(arguments.length===4){var d=arguments[1],b=arguments[3],M=new Ne(arguments[0].getIntersection(b));this.addIntersection(M,d)}}},{key:"toString",value:function(){return cs.toLineString(new as(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(s,a){var d=a,b=d+1;if(b<this._pts.length){var M=this._pts[b];s.equals2D(M)&&(d=b)}return this._nodeList.add(s,d)}},{key:"addIntersections",value:function(s,a,d){for(var b=0;b<s.getIntersectionNum();b++)this.addIntersection(s,a,d,b)}},{key:"interfaces_",get:function(){return[ir]}}],[{key:"constructor_",value:function(){this._nodeList=new Oa(this),this._pts=null,this._data=null;var s=arguments[0],a=arguments[1];this._pts=s,this._data=a}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var s=arguments[0],a=new Q;return p.getNodedSubstrings(s,a),a}if(arguments.length===2)for(var d=arguments[1],b=arguments[0].iterator();b.hasNext();)b.next().getNodeList().addSplitEdges(d)}}])}(),Yi=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof p){var s=arguments[0],a=Zt.index(this.p0,this.p1,s.p0),d=Zt.index(this.p0,this.p1,s.p1);return a>=0&&d>=0||a<=0&&d<=0?Math.max(a,d):0}if(arguments[0]instanceof Ne){var b=arguments[0];return Zt.index(this.p0,this.p1,b)}}},{key:"toGeometry",value:function(s){return s.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(s){if(!(s instanceof p))return!1;var a=s;return this.p0.equals(a.p0)&&this.p1.equals(a.p1)}},{key:"intersection",value:function(s){var a=new hs;return a.computeIntersection(this.p0,this.p1,s.p0,s.p1),a.hasIntersection()?a.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Ne){var s=arguments[0];if(s.equals(this.p0)||s.equals(this.p1))return new Ne(s);var a=this.projectionFactor(s),d=new Ne;return d.x=this.p0.x+a*(this.p1.x-this.p0.x),d.y=this.p0.y+a*(this.p1.y-this.p0.y),d}if(arguments[0]instanceof p){var b=arguments[0],M=this.projectionFactor(b.p0),N=this.projectionFactor(b.p1);if(M>=1&&N>=1||M<=0&&N<=0)return null;var j=this.project(b.p0);M<0&&(j=this.p0),M>1&&(j=this.p1);var te=this.project(b.p1);return N<0&&(te=this.p0),N>1&&(te=this.p1),new p(j,te)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(s){return s===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(s){return Ge.pointToLinePerpendicular(s,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return p.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(s){if(s.equals(this.p0))return 0;if(s.equals(this.p1))return 1;var a=this.p1.x-this.p0.x,d=this.p1.y-this.p0.y,b=a*a+d*d;return b<=0?Ot.NaN:((s.x-this.p0.x)*a+(s.y-this.p0.y)*d)/b}},{key:"closestPoints",value:function(s){var a=this.intersection(s);if(a!==null)return[a,a];var d=new Array(2).fill(null),b=Ot.MAX_VALUE,M=null,N=this.closestPoint(s.p0);b=N.distance(s.p0),d[0]=N,d[1]=s.p0;var j=this.closestPoint(s.p1);(M=j.distance(s.p1))<b&&(b=M,d[0]=j,d[1]=s.p1);var te=s.closestPoint(this.p0);(M=te.distance(this.p0))<b&&(b=M,d[0]=this.p0,d[1]=te);var fe=s.closestPoint(this.p1);return(M=fe.distance(this.p1))<b&&(b=M,d[0]=this.p1,d[1]=fe),d}},{key:"closestPoint",value:function(s){var a=this.projectionFactor(s);return a>0&&a<1?this.project(s):this.p0.distance(s)<this.p1.distance(s)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(s){var a=s,d=this.p0.compareTo(a.p0);return d!==0?d:this.p1.compareTo(a.p1)}},{key:"reverse",value:function(){var s=this.p0;this.p0=this.p1,this.p1=s}},{key:"equalsTopo",value:function(s){return this.p0.equals(s.p0)&&this.p1.equals(s.p1)||this.p0.equals(s.p1)&&this.p1.equals(s.p0)}},{key:"lineIntersection",value:function(s){return Pe.intersection(this.p0,this.p1,s.p0,s.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(s,a){var d=this.p0.x+s*(this.p1.x-this.p0.x),b=this.p0.y+s*(this.p1.y-this.p0.y),M=this.p1.x-this.p0.x,N=this.p1.y-this.p0.y,j=Math.sqrt(M*M+N*N),te=0,fe=0;if(a!==0){if(j<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");te=a*M/j,fe=a*N/j}return new Ne(d-fe,b+te)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var s=arguments[0];this.setCoordinates(s.p0,s.p1)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.p0.x=a.x,this.p0.y=a.y,this.p1.x=d.x,this.p1.y=d.y}}},{key:"segmentFraction",value:function(s){var a=this.projectionFactor(s);return a<0?a=0:(a>1||Ot.isNaN(a))&&(a=1),a}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(s){var a=this.p1.getY()-this.p0.getY(),d=this.p0.getX()-this.p1.getX(),b=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),M=a*a+d*d,N=a*a-d*d,j=s.getX(),te=s.getY();return new Ne((-N*j-2*a*d*te-2*a*b)/M,(N*te-2*a*d*j-2*d*b)/M)}},{key:"distance",value:function(){if(arguments[0]instanceof p){var s=arguments[0];return Ge.segmentToSegment(this.p0,this.p1,s.p0,s.p1)}if(arguments[0]instanceof Ne){var a=arguments[0];return Ge.pointToSegment(a,this.p0,this.p1)}}},{key:"pointAlong",value:function(s){var a=new Ne;return a.x=this.p0.x+s*(this.p1.x-this.p0.x),a.y=this.p0.y+s*(this.p1.y-this.p0.y),a}},{key:"hashCode",value:function(){var s=Ot.doubleToLongBits(this.p0.x);s^=31*Ot.doubleToLongBits(this.p0.y);var a=Math.trunc(s)^Math.trunc(s>>32),d=Ot.doubleToLongBits(this.p1.x);return d^=31*Ot.doubleToLongBits(this.p1.y),a^(Math.trunc(d)^Math.trunc(d>>32))}},{key:"interfaces_",get:function(){return[pt,Ye]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)p.constructor_.call(this,new Ne,new Ne);else if(arguments.length===1){var s=arguments[0];p.constructor_.call(this,s.p0,s.p1)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.p0=a,this.p1=d}else if(arguments.length===4){var b=arguments[0],M=arguments[1],N=arguments[2],j=arguments[3];p.constructor_.call(this,new Ne(b,M),new Ne(N,j))}}},{key:"midPoint",value:function(s,a){return new Ne((s.x+a.x)/2,(s.y+a.y)/2)}}])}(),fr=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var p=arguments[1],s=arguments[2],a=arguments[3];arguments[0].getLineSegment(p,this._overlapSeg1),s.getLineSegment(a,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Yi,this._overlapSeg2=new Yi}}])}(),ao=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(p,s){s.p0=this._pts[p],s.p1=this._pts[p+1]}},{key:"computeSelect",value:function(p,s,a,d){var b=this._pts[s],M=this._pts[a];if(a-s==1)return d.select(this,s),null;if(!p.intersects(b,M))return null;var N=Math.trunc((s+a)/2);s<N&&this.computeSelect(p,s,N,d),N<a&&this.computeSelect(p,N,a,d)}},{key:"getCoordinates",value:function(){for(var p=new Array(this._end-this._start+1).fill(null),s=0,a=this._start;a<=this._end;a++)p[s++]=this._pts[a];return p}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var p=arguments[0],s=arguments[1];this.computeOverlaps(this._start,this._end,p,p._start,p._end,s)}else if(arguments.length===6){var a=arguments[0],d=arguments[1],b=arguments[2],M=arguments[3],N=arguments[4],j=arguments[5];if(d-a==1&&N-M==1)return j.overlap(this,a,b,M),null;if(!this.overlaps(a,d,b,M,N))return null;var te=Math.trunc((a+d)/2),fe=Math.trunc((M+N)/2);a<te&&(M<fe&&this.computeOverlaps(a,te,b,M,fe,j),fe<N&&this.computeOverlaps(a,te,b,fe,N,j)),te<d&&(M<fe&&this.computeOverlaps(te,d,b,M,fe,j),fe<N&&this.computeOverlaps(te,d,b,fe,N,j))}}},{key:"setId",value:function(p){this._id=p}},{key:"select",value:function(p,s){this.computeSelect(p,this._start,this._end,s)}},{key:"getEnvelope",value:function(){if(this._env===null){var p=this._pts[this._start],s=this._pts[this._end];this._env=new Ci(p,s)}return this._env}},{key:"overlaps",value:function(p,s,a,d,b){return Ci.intersects(this._pts[p],this._pts[s],a._pts[d],a._pts[b])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var p=arguments[0],s=arguments[1],a=arguments[2],d=arguments[3];this._pts=p,this._start=s,this._end=a,this._context=d}}])}(),Fa=function(){function p(){E(this,p)}return o(p,null,[{key:"findChainEnd",value:function(s,a){for(var d=a;d<s.length-1&&s[d].equals2D(s[d+1]);)d++;if(d>=s.length-1)return s.length-1;for(var b=Vt.quadrant(s[d],s[d+1]),M=a+1;M<s.length&&!(!s[M-1].equals2D(s[M])&&Vt.quadrant(s[M-1],s[M])!==b);)M++;return M-1}},{key:"getChains",value:function(){if(arguments.length===1){var s=arguments[0];return p.getChains(s,null)}if(arguments.length===2){var a=arguments[0],d=arguments[1],b=new Q,M=0;do{var N=p.findChainEnd(a,M),j=new ao(a,M,N,d);b.add(j),M=N}while(M<a.length-1);return b}}}])}(),Es=function(){return o(function p(){E(this,p)},[{key:"computeNodes",value:function(p){}},{key:"getNodedSubstrings",value:function(){}}])}(),oo=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(p){this._segInt=p}},{key:"interfaces_",get:function(){return[Es]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var p=arguments[0];this.setSegmentIntersector(p)}}}}])}(),Ko=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return Pr.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(a){for(var d=Fa.getChains(a.getCoordinates(),a).iterator();d.hasNext();){var b=d.next();b.setId(this._idCounter++),this._index.insert(b.getEnvelope(),b),this._monoChains.add(b)}}},{key:"computeNodes",value:function(a){this._nodedSegStrings=a;for(var d=a.iterator();d.hasNext();)this.add(d.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var a=new Wl(this._segInt),d=this._monoChains.iterator();d.hasNext();)for(var b=d.next(),M=this._index.query(b.getEnvelope()).iterator();M.hasNext();){var N=M.next();if(N.getId()>b.getId()&&(b.computeOverlaps(N,a),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new Q,this._index=new hr,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var a=arguments[0];oo.constructor_.call(this,a)}}}}])}(oo),Wl=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"overlap",value:function(){if(arguments.length!==4)return le(s,"overlap",this,1).apply(this,arguments);var a=arguments[1],d=arguments[2],b=arguments[3],M=arguments[0].getContext(),N=d.getContext();this._si.processIntersections(M,a,N,b)}}],[{key:"constructor_",value:function(){this._si=null;var a=arguments[0];this._si=a}}])}(fr);Ko.SegmentOverlapAction=Wl;var Gr=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"isDeletable",value:function(s,a,d,b){var M=this._inputLine[s],N=this._inputLine[a],j=this._inputLine[d];return!!this.isConcave(M,N,j)&&!!this.isShallow(M,N,j,b)&&this.isShallowSampled(M,N,s,d,b)}},{key:"deleteShallowConcavities",value:function(){for(var s=1,a=this.findNextNonDeletedIndex(s),d=this.findNextNonDeletedIndex(a),b=!1;d<this._inputLine.length;){var M=!1;this.isDeletable(s,a,d,this._distanceTol)&&(this._isDeleted[a]=p.DELETE,M=!0,b=!0),s=M?d:a,a=this.findNextNonDeletedIndex(s),d=this.findNextNonDeletedIndex(a)}return b}},{key:"isShallowConcavity",value:function(s,a,d,b){return Zt.index(s,a,d)===this._angleOrientation&&Ge.pointToSegment(a,s,d)<b}},{key:"isShallowSampled",value:function(s,a,d,b,M){var N=Math.trunc((b-d)/p.NUM_PTS_TO_CHECK);N<=0&&(N=1);for(var j=d;j<b;j+=N)if(!this.isShallow(s,a,this._inputLine[j],M))return!1;return!0}},{key:"isConcave",value:function(s,a,d){var b=Zt.index(s,a,d)===this._angleOrientation;return b}},{key:"simplify",value:function(s){this._distanceTol=Math.abs(s),s<0&&(this._angleOrientation=Zt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var a=!1;do a=this.deleteShallowConcavities();while(a);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(s){for(var a=s+1;a<this._inputLine.length&&this._isDeleted[a]===p.DELETE;)a++;return a}},{key:"isShallow",value:function(s,a,d,b){return Ge.pointToSegment(a,s,d)<b}},{key:"collapseLine",value:function(){for(var s=new cr,a=0;a<this._inputLine.length;a++)this._isDeleted[a]!==p.DELETE&&s.add(this._inputLine[a]);return s.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Zt.COUNTERCLOCKWISE;var s=arguments[0];this._inputLine=s}},{key:"simplify",value:function(s,a){return new p(s).simplify(a)}}])}();Gr.INIT=0,Gr.DELETE=1,Gr.KEEP=1,Gr.NUM_PTS_TO_CHECK=10;var Yl=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getCoordinates",value:function(){return this._ptList.toArray(p.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(s){this._precisionModel=s}},{key:"addPt",value:function(s){var a=new Ne(s);if(this._precisionModel.makePrecise(a),this.isRedundant(a))return null;this._ptList.add(a)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(s,a){if(a)for(var d=0;d<s.length;d++)this.addPt(s[d]);else for(var b=s.length-1;b>=0;b--)this.addPt(s[b])}},{key:"isRedundant",value:function(s){if(this._ptList.size()<1)return!1;var a=this._ptList.get(this._ptList.size()-1);return s.distance(a)<this._minimimVertexDistance}},{key:"toString",value:function(){return new os().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var s=new Ne(this._ptList.get(0)),a=this._ptList.get(this._ptList.size()-1);if(s.equals(a))return null;this._ptList.add(s)}},{key:"setMinimumVertexDistance",value:function(s){this._minimimVertexDistance=s}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Q}}])}();Yl.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Hn=function(){function p(){E(this,p)}return o(p,null,[{key:"toDegrees",value:function(s){return 180*s/Math.PI}},{key:"normalize",value:function(s){for(;s>Math.PI;)s-=p.PI_TIMES_2;for(;s<=-Math.PI;)s+=p.PI_TIMES_2;return s}},{key:"angle",value:function(){if(arguments.length===1){var s=arguments[0];return Math.atan2(s.y,s.x)}if(arguments.length===2){var a=arguments[0],d=arguments[1],b=d.x-a.x,M=d.y-a.y;return Math.atan2(M,b)}}},{key:"isAcute",value:function(s,a,d){var b=s.x-a.x,M=s.y-a.y;return b*(d.x-a.x)+M*(d.y-a.y)>0}},{key:"isObtuse",value:function(s,a,d){var b=s.x-a.x,M=s.y-a.y;return b*(d.x-a.x)+M*(d.y-a.y)<0}},{key:"interiorAngle",value:function(s,a,d){var b=p.angle(a,s),M=p.angle(a,d);return Math.abs(M-b)}},{key:"normalizePositive",value:function(s){if(s<0){for(;s<0;)s+=p.PI_TIMES_2;s>=p.PI_TIMES_2&&(s=0)}else{for(;s>=p.PI_TIMES_2;)s-=p.PI_TIMES_2;s<0&&(s=0)}return s}},{key:"angleBetween",value:function(s,a,d){var b=p.angle(a,s),M=p.angle(a,d);return p.diff(b,M)}},{key:"diff",value:function(s,a){var d=null;return(d=s<a?a-s:s-a)>Math.PI&&(d=2*Math.PI-d),d}},{key:"toRadians",value:function(s){return s*Math.PI/180}},{key:"getTurn",value:function(s,a){var d=Math.sin(a-s);return d>0?p.COUNTERCLOCKWISE:d<0?p.CLOCKWISE:p.NONE}},{key:"angleBetweenOriented",value:function(s,a,d){var b=p.angle(a,s),M=p.angle(a,d)-b;return M<=-Math.PI?M+p.PI_TIMES_2:M>Math.PI?M-p.PI_TIMES_2:M}}])}();Hn.PI_TIMES_2=2*Math.PI,Hn.PI_OVER_2=Math.PI/2,Hn.PI_OVER_4=Math.PI/4,Hn.COUNTERCLOCKWISE=Zt.COUNTERCLOCKWISE,Hn.CLOCKWISE=Zt.CLOCKWISE,Hn.NONE=Zt.COLLINEAR;var Cs=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"addNextSegment",value:function(s,a){if(this._s0=this._s1,this._s1=this._s2,this._s2=s,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var d=Zt.index(this._s0,this._s1,this._s2),b=d===Zt.CLOCKWISE&&this._side===Re.LEFT||d===Zt.COUNTERCLOCKWISE&&this._side===Re.RIGHT;d===0?this.addCollinear(a):b?this.addOutsideTurn(d,a):this.addInsideTurn(d,a)}},{key:"addLineEndCap",value:function(s,a){var d=new Yi(s,a),b=new Yi;this.computeOffsetSegment(d,Re.LEFT,this._distance,b);var M=new Yi;this.computeOffsetSegment(d,Re.RIGHT,this._distance,M);var N=a.x-s.x,j=a.y-s.y,te=Math.atan2(j,N);switch(this._bufParams.getEndCapStyle()){case tt.CAP_ROUND:this._segList.addPt(b.p1),this.addDirectedFillet(a,te+Math.PI/2,te-Math.PI/2,Zt.CLOCKWISE,this._distance),this._segList.addPt(M.p1);break;case tt.CAP_FLAT:this._segList.addPt(b.p1),this._segList.addPt(M.p1);break;case tt.CAP_SQUARE:var fe=new Ne;fe.x=Math.abs(this._distance)*Math.cos(te),fe.y=Math.abs(this._distance)*Math.sin(te);var Me=new Ne(b.p1.x+fe.x,b.p1.y+fe.y),Fe=new Ne(M.p1.x+fe.x,M.p1.y+fe.y);this._segList.addPt(Me),this._segList.addPt(Fe)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(s,a,d,b){var M=Pe.intersection(a.p0,a.p1,d.p0,d.p1);if(M!==null&&(b<=0?1:M.distance(s)/Math.abs(b))<=this._bufParams.getMitreLimit())return this._segList.addPt(M),null;this.addLimitedMitreJoin(a,d,b,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(s,a){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*p.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===tt.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===tt.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(a&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,s,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(s){this._segList.addPt(new Ne(s.x+this._distance,s.y+this._distance)),this._segList.addPt(new Ne(s.x+this._distance,s.y-this._distance)),this._segList.addPt(new Ne(s.x-this._distance,s.y-this._distance)),this._segList.addPt(new Ne(s.x-this._distance,s.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(s,a){this._segList.addPts(s,a)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(s,a,d,b,M){var N=a.x-s.x,j=a.y-s.y,te=Math.atan2(j,N),fe=d.x-s.x,Me=d.y-s.y,Fe=Math.atan2(Me,fe);b===Zt.CLOCKWISE?te<=Fe&&(te+=2*Math.PI):te>=Fe&&(te-=2*Math.PI),this._segList.addPt(a),this.addDirectedFillet(s,te,Fe,b,M),this._segList.addPt(d)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(s,a,d){this._s1=s,this._s2=a,this._side=d,this._seg1.setCoordinates(s,a),this.computeOffsetSegment(this._seg1,d,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(s,a,d,b){var M=this._seg0.p1,N=Hn.angle(M,this._seg0.p0),j=Hn.angleBetweenOriented(this._seg0.p0,M,this._seg1.p1)/2,te=Hn.normalize(N+j),fe=Hn.normalize(te+Math.PI),Me=b*d,Fe=d-Me*Math.abs(Math.sin(j)),lt=M.x+Me*Math.cos(fe),Rt=M.y+Me*Math.sin(fe),Xt=new Ne(lt,Rt),ti=new Yi(M,Xt),vi=ti.pointAlongOffset(1,Fe),bi=ti.pointAlongOffset(1,-Fe);this._side===Re.LEFT?(this._segList.addPt(vi),this._segList.addPt(bi)):(this._segList.addPt(bi),this._segList.addPt(vi))}},{key:"addDirectedFillet",value:function(s,a,d,b,M){var N=b===Zt.CLOCKWISE?-1:1,j=Math.abs(a-d),te=Math.trunc(j/this._filletAngleQuantum+.5);if(te<1)return null;for(var fe=j/te,Me=new Ne,Fe=0;Fe<te;Fe++){var lt=a+N*Fe*fe;Me.x=s.x+M*Math.cos(lt),Me.y=s.y+M*Math.sin(lt),this._segList.addPt(Me)}}},{key:"computeOffsetSegment",value:function(s,a,d,b){var M=a===Re.LEFT?1:-1,N=s.p1.x-s.p0.x,j=s.p1.y-s.p0.y,te=Math.sqrt(N*N+j*j),fe=M*d*N/te,Me=M*d*j/te;b.p0.x=s.p0.x-Me,b.p0.y=s.p0.y+fe,b.p1.x=s.p1.x-Me,b.p1.y=s.p1.y+fe}},{key:"addInsideTurn",value:function(s,a){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*p.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var d=new Ne((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(d);var b=new Ne((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(b)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(s){var a=new Ne(s.x+this._distance,s.y);this._segList.addPt(a),this.addDirectedFillet(s,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(s,a){this._segList.addPt(s.p1),this._segList.addPt(a.p0)}},{key:"init",value:function(s){this._distance=s,this._maxCurveSegmentError=s*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Yl,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(s*p.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(s){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===tt.JOIN_BEVEL||this._bufParams.getJoinStyle()===tt.JOIN_MITRE?(s&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Zt.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Yi,this._seg1=new Yi,this._offset0=new Yi,this._offset1=new Yi,this._side=0,this._hasNarrowConcaveAngle=!1;var s=arguments[0],a=arguments[1],d=arguments[2];this._precisionModel=s,this._bufParams=a,this._li=new hs,this._filletAngleQuantum=Math.PI/2/a.getQuadrantSegments(),a.getQuadrantSegments()>=8&&a.getJoinStyle()===tt.JOIN_ROUND&&(this._closingSegLengthFactor=p.MAX_CLOSING_SEG_LEN_FACTOR),this.init(d)}}])}();Cs.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Cs.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Cs.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Cs.MAX_CLOSING_SEG_LEN_FACTOR=80;var lo=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getOffsetCurve",value:function(s,a){if(this._distance=a,a===0)return null;var d=a<0,b=Math.abs(a),M=this.getSegGen(b);s.length<=1?this.computePointCurve(s[0],M):this.computeOffsetCurve(s,d,M);var N=M.getCoordinates();return d&&Wt.reverse(N),N}},{key:"computeSingleSidedBufferCurve",value:function(s,a,d){var b=this.simplifyTolerance(this._distance);if(a){d.addSegments(s,!0);var M=Gr.simplify(s,-b),N=M.length-1;d.initSideSegments(M[N],M[N-1],Re.LEFT),d.addFirstSegment();for(var j=N-2;j>=0;j--)d.addNextSegment(M[j],!0)}else{d.addSegments(s,!1);var te=Gr.simplify(s,b),fe=te.length-1;d.initSideSegments(te[0],te[1],Re.LEFT),d.addFirstSegment();for(var Me=2;Me<=fe;Me++)d.addNextSegment(te[Me],!0)}d.addLastSegment(),d.closeRing()}},{key:"computeRingBufferCurve",value:function(s,a,d){var b=this.simplifyTolerance(this._distance);a===Re.RIGHT&&(b=-b);var M=Gr.simplify(s,b),N=M.length-1;d.initSideSegments(M[N-1],M[0],a);for(var j=1;j<=N;j++){var te=j!==1;d.addNextSegment(M[j],te)}d.closeRing()}},{key:"computeLineBufferCurve",value:function(s,a){var d=this.simplifyTolerance(this._distance),b=Gr.simplify(s,d),M=b.length-1;a.initSideSegments(b[0],b[1],Re.LEFT);for(var N=2;N<=M;N++)a.addNextSegment(b[N],!0);a.addLastSegment(),a.addLineEndCap(b[M-1],b[M]);var j=Gr.simplify(s,-d),te=j.length-1;a.initSideSegments(j[te],j[te-1],Re.LEFT);for(var fe=te-2;fe>=0;fe--)a.addNextSegment(j[fe],!0);a.addLastSegment(),a.addLineEndCap(j[1],j[0]),a.closeRing()}},{key:"computePointCurve",value:function(s,a){switch(this._bufParams.getEndCapStyle()){case tt.CAP_ROUND:a.createCircle(s);break;case tt.CAP_SQUARE:a.createSquare(s)}}},{key:"getLineCurve",value:function(s,a){if(this._distance=a,this.isLineOffsetEmpty(a))return null;var d=Math.abs(a),b=this.getSegGen(d);if(s.length<=1)this.computePointCurve(s[0],b);else if(this._bufParams.isSingleSided()){var M=a<0;this.computeSingleSidedBufferCurve(s,M,b)}else this.computeLineBufferCurve(s,b);return b.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(s){return s*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(s,a,d){if(this._distance=d,s.length<=2)return this.getLineCurve(s,d);if(d===0)return p.copyCoordinates(s);var b=this.getSegGen(d);return this.computeRingBufferCurve(s,a,b),b.getCoordinates()}},{key:"computeOffsetCurve",value:function(s,a,d){var b=this.simplifyTolerance(this._distance);if(a){var M=Gr.simplify(s,-b),N=M.length-1;d.initSideSegments(M[N],M[N-1],Re.LEFT),d.addFirstSegment();for(var j=N-2;j>=0;j--)d.addNextSegment(M[j],!0)}else{var te=Gr.simplify(s,b),fe=te.length-1;d.initSideSegments(te[0],te[1],Re.LEFT),d.addFirstSegment();for(var Me=2;Me<=fe;Me++)d.addNextSegment(te[Me],!0)}d.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(s){return s===0||s<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(s){return new Cs(this._precisionModel,this._bufParams,s)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var s=arguments[0],a=arguments[1];this._precisionModel=s,this._bufParams=a}},{key:"copyCoordinates",value:function(s){for(var a=new Array(s.length).fill(null),d=0;d<a.length;d++)a[d]=new Ne(s[d]);return a}}])}(),fa=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var p=arguments[0],s=new Q,a=this._subgraphs.iterator();a.hasNext();){var d=a.next(),b=d.getEnvelope();p.y<b.getMinY()||p.y>b.getMaxY()||this.findStabbedSegments(p,d.getDirectedEdges(),s)}return s}if(arguments.length===3){if(mt(arguments[2],$t)&&arguments[0]instanceof Ne&&arguments[1]instanceof zn){for(var M=arguments[0],N=arguments[1],j=arguments[2],te=N.getEdge().getCoordinates(),fe=0;fe<te.length-1;fe++)if(this._seg.p0=te[fe],this._seg.p1=te[fe+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<M.x||this._seg.isHorizontal()||M.y<this._seg.p0.y||M.y>this._seg.p1.y||Zt.index(this._seg.p0,this._seg.p1,M)===Zt.RIGHT)){var Me=N.getDepth(Re.LEFT);this._seg.p0.equals(te[fe])||(Me=N.getDepth(Re.RIGHT));var Fe=new uo(this._seg,Me);j.add(Fe)}}else if(mt(arguments[2],$t)&&arguments[0]instanceof Ne&&mt(arguments[1],$t))for(var lt=arguments[0],Rt=arguments[2],Xt=arguments[1].iterator();Xt.hasNext();){var ti=Xt.next();ti.isForward()&&this.findStabbedSegments(lt,ti,Rt)}}}},{key:"getDepth",value:function(p){var s=this.findStabbedSegments(p);return s.size()===0?0:Zn.min(s)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Yi;var p=arguments[0];this._subgraphs=p}}])}(),uo=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(p){var s=p;if(this._upwardSeg.minX()>=s._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=s._upwardSeg.minX())return-1;var a=this._upwardSeg.orientationIndex(s._upwardSeg);return a!==0||(a=-1*s._upwardSeg.orientationIndex(this._upwardSeg))!==0?a:this._upwardSeg.compareTo(s._upwardSeg)}},{key:"compareX",value:function(p,s){var a=p.p0.compareTo(s.p0);return a!==0?a:p.p1.compareTo(s.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[pt]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var p=arguments[0],s=arguments[1];this._upwardSeg=new Yi(p),this._leftDepth=s}}])}();fa.DepthSegment=uo;var Ba=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,null,[{key:"constructor_",value:function(){We.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(We),Mr=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getY",value:function(){var s=this.y/this.w;if(Ot.isNaN(s)||Ot.isInfinite(s))throw new Ba;return s}},{key:"getX",value:function(){var s=this.x/this.w;if(Ot.isNaN(s)||Ot.isInfinite(s))throw new Ba;return s}},{key:"getCoordinate",value:function(){var s=new Ne;return s.x=this.getX(),s.y=this.getY(),s}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var s=arguments[0];this.x=s.x,this.y=s.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var a=arguments[0],d=arguments[1];this.x=a,this.y=d,this.w=1}else if(arguments[0]instanceof p&&arguments[1]instanceof p){var b=arguments[0],M=arguments[1];this.x=b.y*M.w-M.y*b.w,this.y=M.x*b.w-b.x*M.w,this.w=b.x*M.y-M.x*b.y}else if(arguments[0]instanceof Ne&&arguments[1]instanceof Ne){var N=arguments[0],j=arguments[1];this.x=N.y-j.y,this.y=j.x-N.x,this.w=N.x*j.y-j.x*N.y}}else if(arguments.length===3){var te=arguments[0],fe=arguments[1],Me=arguments[2];this.x=te,this.y=fe,this.w=Me}else if(arguments.length===4){var Fe=arguments[0],lt=arguments[1],Rt=arguments[2],Xt=arguments[3],ti=Fe.y-lt.y,vi=lt.x-Fe.x,bi=Fe.x*lt.y-lt.x*Fe.y,zi=Rt.y-Xt.y,ji=Xt.x-Rt.x,Nn=Rt.x*Xt.y-Xt.x*Rt.y;this.x=vi*Nn-ji*bi,this.y=zi*bi-ti*Nn,this.w=ti*ji-zi*vi}}}])}(),tc=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"area",value:function(){return p.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return p.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(s){if(s===null)throw new qe("Supplied point is null.");return p.interpolateZ(s,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return p.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return p.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return p.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return p.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return p.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return p.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var s=arguments[0],a=arguments[1],d=arguments[2];this.p0=s,this.p1=a,this.p2=d}},{key:"area",value:function(s,a,d){return Math.abs(((d.x-s.x)*(a.y-s.y)-(a.x-s.x)*(d.y-s.y))/2)}},{key:"signedArea",value:function(s,a,d){return((d.x-s.x)*(a.y-s.y)-(a.x-s.x)*(d.y-s.y))/2}},{key:"det",value:function(s,a,d,b){return s*b-a*d}},{key:"interpolateZ",value:function(s,a,d,b){var M=a.x,N=a.y,j=d.x-M,te=b.x-M,fe=d.y-N,Me=b.y-N,Fe=j*Me-te*fe,lt=s.x-M,Rt=s.y-N,Xt=(Me*lt-te*Rt)/Fe,ti=(-fe*lt+j*Rt)/Fe;return a.getZ()+Xt*(d.getZ()-a.getZ())+ti*(b.getZ()-a.getZ())}},{key:"longestSideLength",value:function(s,a,d){var b=s.distance(a),M=a.distance(d),N=d.distance(s),j=b;return M>j&&(j=M),N>j&&(j=N),j}},{key:"circumcentreDD",value:function(s,a,d){var b=Et.valueOf(s.x).subtract(d.x),M=Et.valueOf(s.y).subtract(d.y),N=Et.valueOf(a.x).subtract(d.x),j=Et.valueOf(a.y).subtract(d.y),te=Et.determinant(b,M,N,j).multiply(2),fe=b.sqr().add(M.sqr()),Me=N.sqr().add(j.sqr()),Fe=Et.determinant(M,fe,j,Me),lt=Et.determinant(b,fe,N,Me),Rt=Et.valueOf(d.x).subtract(Fe.divide(te)).doubleValue(),Xt=Et.valueOf(d.y).add(lt.divide(te)).doubleValue();return new Ne(Rt,Xt)}},{key:"isAcute",value:function(s,a,d){return!!Hn.isAcute(s,a,d)&&!!Hn.isAcute(a,d,s)&&!!Hn.isAcute(d,s,a)}},{key:"circumcentre",value:function(s,a,d){var b=d.x,M=d.y,N=s.x-b,j=s.y-M,te=a.x-b,fe=a.y-M,Me=2*p.det(N,j,te,fe),Fe=p.det(j,N*N+j*j,fe,te*te+fe*fe),lt=p.det(N,N*N+j*j,te,te*te+fe*fe);return new Ne(b-Fe/Me,M+lt/Me)}},{key:"perpendicularBisector",value:function(s,a){var d=a.x-s.x,b=a.y-s.y,M=new Mr(s.x+d/2,s.y+b/2,1),N=new Mr(s.x-b+d/2,s.y+d+b/2,1);return new Mr(M,N)}},{key:"angleBisector",value:function(s,a,d){var b=a.distance(s),M=b/(b+a.distance(d)),N=d.x-s.x,j=d.y-s.y;return new Ne(s.x+M*N,s.y+M*j)}},{key:"area3D",value:function(s,a,d){var b=a.x-s.x,M=a.y-s.y,N=a.getZ()-s.getZ(),j=d.x-s.x,te=d.y-s.y,fe=d.getZ()-s.getZ(),Me=M*fe-N*te,Fe=N*j-b*fe,lt=b*te-M*j,Rt=Me*Me+Fe*Fe+lt*lt,Xt=Math.sqrt(Rt)/2;return Xt}},{key:"centroid",value:function(s,a,d){var b=(s.x+a.x+d.x)/3,M=(s.y+a.y+d.y)/3;return new Ne(b,M)}},{key:"inCentre",value:function(s,a,d){var b=a.distance(d),M=s.distance(d),N=s.distance(a),j=b+M+N,te=(b*s.x+M*a.x+N*d.x)/j,fe=(b*s.y+M*a.y+N*d.y)/j;return new Ne(te,fe)}}])}(),Jo=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(p,s,a,d,b){if(s===0&&p.length<bt.MINIMUM_VALID_SIZE)return null;var M=d,N=b;p.length>=bt.MINIMUM_VALID_SIZE&&Zt.isCCW(p)&&(M=b,N=d,a=Re.opposite(a));var j=this._curveBuilder.getRingCurve(p,a,s);this.addCurve(j,M,N)}},{key:"addRingBothSides",value:function(p,s){this.addRingSide(p,s,Re.LEFT,q.EXTERIOR,q.INTERIOR),this.addRingSide(p,s,Re.RIGHT,q.INTERIOR,q.EXTERIOR)}},{key:"addPoint",value:function(p){if(this._distance<=0)return null;var s=p.getCoordinates(),a=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(a,q.EXTERIOR,q.INTERIOR)}},{key:"addPolygon",value:function(p){var s=this._distance,a=Re.LEFT;this._distance<0&&(s=-this._distance,a=Re.RIGHT);var d=p.getExteriorRing(),b=Wt.removeRepeatedPoints(d.getCoordinates());if(this._distance<0&&this.isErodedCompletely(d,this._distance)||this._distance<=0&&b.length<3)return null;this.addRingSide(b,s,a,q.EXTERIOR,q.INTERIOR);for(var M=0;M<p.getNumInteriorRing();M++){var N=p.getInteriorRingN(M),j=Wt.removeRepeatedPoints(N.getCoordinates());this._distance>0&&this.isErodedCompletely(N,-this._distance)||this.addRingSide(j,s,Re.opposite(a),q.INTERIOR,q.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(p,s){var a=new tc(p[0],p[1],p[2]),d=a.inCentre();return Ge.pointToSegment(d,a.p0,a.p1)<Math.abs(s)}},{key:"addLineString",value:function(p){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var s=Wt.removeRepeatedPoints(p.getCoordinates());if(Wt.isRing(s)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(s,this._distance);else{var a=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(a,q.EXTERIOR,q.INTERIOR)}}},{key:"addCurve",value:function(p,s,a){if(p===null||p.length<2)return null;var d=new Pr(p,new Un(0,q.BOUNDARY,s,a));this._curveList.add(d)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(p){if(p.isEmpty())return null;if(p instanceof dn)this.addPolygon(p);else if(p instanceof ii)this.addLineString(p);else if(p instanceof Li)this.addPoint(p);else if(p instanceof rs)this.addCollection(p);else if(p instanceof qs)this.addCollection(p);else if(p instanceof Or)this.addCollection(p);else{if(!(p instanceof wn))throw new ot(p.getGeometryType());this.addCollection(p)}}},{key:"isErodedCompletely",value:function(p,s){var a=p.getCoordinates();if(a.length<4)return s<0;if(a.length===4)return this.isTriangleErodedCompletely(a,s);var d=p.getEnvelopeInternal(),b=Math.min(d.getHeight(),d.getWidth());return s<0&&2*Math.abs(s)>b}},{key:"addCollection",value:function(p){for(var s=0;s<p.getNumGeometries();s++){var a=p.getGeometryN(s);this.add(a)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Q;var p=arguments[0],s=arguments[1],a=arguments[2];this._inputGeom=p,this._distance=s,this._curveBuilder=a}}])}(),ja=function(){return o(function p(){E(this,p)},[{key:"locate",value:function(p){}}])}(),Va=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,p.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ze;var s=this._parent.getGeometryN(this._index++);return s instanceof wn?(this._subcollectionIterator=new p(s),this._subcollectionIterator.next()):s}},{key:"remove",value:function(){throw new ot(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[ks]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var s=arguments[0];this._parent=s,this._atStart=!0,this._index=0,this._max=s.getNumGeometries()}},{key:"isAtomic",value:function(s){return!(s instanceof wn)}}])}(),Kl=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"locate",value:function(s){return p.locate(s,this._geom)}},{key:"interfaces_",get:function(){return[ja]}}],[{key:"constructor_",value:function(){this._geom=null;var s=arguments[0];this._geom=s}},{key:"locatePointInPolygon",value:function(s,a){if(a.isEmpty())return q.EXTERIOR;var d=a.getExteriorRing(),b=p.locatePointInRing(s,d);if(b!==q.INTERIOR)return b;for(var M=0;M<a.getNumInteriorRing();M++){var N=a.getInteriorRingN(M),j=p.locatePointInRing(s,N);if(j===q.BOUNDARY)return q.BOUNDARY;if(j===q.INTERIOR)return q.EXTERIOR}return q.INTERIOR}},{key:"locatePointInRing",value:function(s,a){return a.getEnvelopeInternal().intersects(s)?Br.locateInRing(s,a.getCoordinates()):q.EXTERIOR}},{key:"containsPointInPolygon",value:function(s,a){return q.EXTERIOR!==p.locatePointInPolygon(s,a)}},{key:"locateInGeometry",value:function(s,a){if(a instanceof dn)return p.locatePointInPolygon(s,a);if(a instanceof wn)for(var d=new Va(a);d.hasNext();){var b=d.next();if(b!==a){var M=p.locateInGeometry(s,b);if(M!==q.EXTERIOR)return M}}return q.EXTERIOR}},{key:"isContained",value:function(s,a){return q.EXTERIOR!==p.locate(s,a)}},{key:"locate",value:function(s,a){return a.isEmpty()?q.EXTERIOR:a.getEnvelopeInternal().intersects(s)?p.locateInGeometry(s,a):q.EXTERIOR}}])}(),Ua=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(p){this.getEdges();var s=this._edgeList.indexOf(p),a=s-1;return s===0&&(a=this._edgeList.size()-1),this._edgeList.get(a)}},{key:"propagateSideLabels",value:function(p){for(var s=q.NONE,a=this.iterator();a.hasNext();){var d=a.next().getLabel();d.isArea(p)&&d.getLocation(p,Re.LEFT)!==q.NONE&&(s=d.getLocation(p,Re.LEFT))}if(s===q.NONE)return null;for(var b=s,M=this.iterator();M.hasNext();){var N=M.next(),j=N.getLabel();if(j.getLocation(p,Re.ON)===q.NONE&&j.setLocation(p,Re.ON,b),j.isArea(p)){var te=j.getLocation(p,Re.LEFT),fe=j.getLocation(p,Re.RIGHT);if(fe!==q.NONE){if(fe!==b)throw new W("side location conflict",N.getCoordinate());te===q.NONE&&ri.shouldNeverReachHere("found single null side (at "+N.getCoordinate()+")"),b=te}else ri.isTrue(j.getLocation(p,Re.LEFT)===q.NONE,"found single null side"),j.setLocation(p,Re.RIGHT,b),j.setLocation(p,Re.LEFT,b)}}}},{key:"getCoordinate",value:function(){var p=this.iterator();return p.hasNext()?p.next().getCoordinate():null}},{key:"print",value:function(p){Le.out.println("EdgeEndStar:   "+this.getCoordinate());for(var s=this.iterator();s.hasNext();)s.next().print(p)}},{key:"isAreaLabelsConsistent",value:function(p){return this.computeEdgeEndLabels(p.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(p){var s=this.getEdges();if(s.size()<=0)return!0;var a=s.size()-1,d=s.get(a).getLabel().getLocation(p,Re.LEFT);ri.isTrue(d!==q.NONE,"Found unlabelled area edge");for(var b=d,M=this.iterator();M.hasNext();){var N=M.next().getLabel();ri.isTrue(N.isArea(p),"Found non-area edge");var j=N.getLocation(p,Re.LEFT),te=N.getLocation(p,Re.RIGHT);if(j===te||te!==b)return!1;b=j}return!0}},{key:"findIndex",value:function(p){this.iterator();for(var s=0;s<this._edgeList.size();s++)if(this._edgeList.get(s)===p)return s;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new Q(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(p,s,a){return this._ptInAreaLocation[p]===q.NONE&&(this._ptInAreaLocation[p]=Kl.locate(s,a[p].getGeometry())),this._ptInAreaLocation[p]}},{key:"toString",value:function(){var p=new Qt;p.append("EdgeEndStar:   "+this.getCoordinate()),p.append(`
`);for(var s=this.iterator();s.hasNext();){var a=s.next();p.append(a),p.append(`
`)}return p.toString()}},{key:"computeEdgeEndLabels",value:function(p){for(var s=this.iterator();s.hasNext();)s.next().computeLabel(p)}},{key:"computeLabelling",value:function(p){this.computeEdgeEndLabels(p[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var s=[!1,!1],a=this.iterator();a.hasNext();)for(var d=a.next().getLabel(),b=0;b<2;b++)d.isLine(b)&&d.getLocation(b)===q.BOUNDARY&&(s[b]=!0);for(var M=this.iterator();M.hasNext();)for(var N=M.next(),j=N.getLabel(),te=0;te<2;te++)if(j.isAnyNull(te)){var fe=q.NONE;if(s[te])fe=q.EXTERIOR;else{var Me=N.getCoordinate();fe=this.getLocation(te,Me,p)}j.setAllLocationsIfNull(te,fe)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(p,s){this._edgeMap.put(p,s),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new hi,this._edgeList=null,this._ptInAreaLocation=[q.NONE,q.NONE]}}])}(),Jl=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var a=null,d=null,b=this._SCANNING_FOR_INCOMING,M=0;M<this._resultAreaEdgeList.size();M++){var N=this._resultAreaEdgeList.get(M),j=N.getSym();if(N.getLabel().isArea())switch(a===null&&N.isInResult()&&(a=N),b){case this._SCANNING_FOR_INCOMING:if(!j.isInResult())continue;d=j,b=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!N.isInResult())continue;d.setNext(N),b=this._SCANNING_FOR_INCOMING}}if(b===this._LINKING_TO_OUTGOING){if(a===null)throw new W("no outgoing dirEdge found",this.getCoordinate());ri.isTrue(a.isInResult(),"unable to link last incoming dirEdge"),d.setNext(a)}}},{key:"insert",value:function(a){var d=a;this.insertEdgeEnd(d,d)}},{key:"getRightmostEdge",value:function(){var a=this.getEdges(),d=a.size();if(d<1)return null;var b=a.get(0);if(d===1)return b;var M=a.get(d-1),N=b.getQuadrant(),j=M.getQuadrant();return Vt.isNorthern(N)&&Vt.isNorthern(j)?b:Vt.isNorthern(N)||Vt.isNorthern(j)?b.getDy()!==0?b:M.getDy()!==0?M:(ri.shouldNeverReachHere("found two horizontal edges incident on node"),null):M}},{key:"print",value:function(a){Le.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var d=this.iterator();d.hasNext();){var b=d.next();a.print("out "),b.print(a),a.println(),a.print("in "),b.getSym().print(a),a.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Q;for(var a=this.iterator();a.hasNext();){var d=a.next();(d.isInResult()||d.getSym().isInResult())&&this._resultAreaEdgeList.add(d)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(a){for(var d=this.iterator();d.hasNext();){var b=d.next().getLabel();b.setAllLocationsIfNull(0,a.getLocation(0)),b.setAllLocationsIfNull(1,a.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var a=null,d=null,b=this._edgeList.size()-1;b>=0;b--){var M=this._edgeList.get(b),N=M.getSym();d===null&&(d=N),a!==null&&N.setNext(a),a=M}d.setNext(a)}},{key:"computeDepths",value:function(){if(arguments.length===1){var a=arguments[0],d=this.findIndex(a),b=a.getDepth(Re.LEFT),M=a.getDepth(Re.RIGHT),N=this.computeDepths(d+1,this._edgeList.size(),b);if(this.computeDepths(0,d,N)!==M)throw new W("depth mismatch at "+a.getCoordinate())}else if(arguments.length===3){for(var j=arguments[1],te=arguments[2],fe=arguments[0];fe<j;fe++){var Me=this._edgeList.get(fe);Me.setEdgeDepths(Re.RIGHT,te),te=Me.getDepth(Re.LEFT)}return te}}},{key:"mergeSymLabels",value:function(){for(var a=this.iterator();a.hasNext();){var d=a.next();d.getLabel().merge(d.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(a){for(var d=null,b=null,M=this._SCANNING_FOR_INCOMING,N=this._resultAreaEdgeList.size()-1;N>=0;N--){var j=this._resultAreaEdgeList.get(N),te=j.getSym();switch(d===null&&j.getEdgeRing()===a&&(d=j),M){case this._SCANNING_FOR_INCOMING:if(te.getEdgeRing()!==a)continue;b=te,M=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(j.getEdgeRing()!==a)continue;b.setNextMin(j),M=this._SCANNING_FOR_INCOMING}}M===this._LINKING_TO_OUTGOING&&(ri.isTrue(d!==null,"found null for first outgoing dirEdge"),ri.isTrue(d.getEdgeRing()===a,"unable to link last incoming dirEdge"),b.setNextMin(d))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var a=0,d=this.iterator();d.hasNext();)d.next().isInResult()&&a++;return a}if(arguments.length===1){for(var b=arguments[0],M=0,N=this.iterator();N.hasNext();)N.next().getEdgeRing()===b&&M++;return M}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var a=q.NONE,d=this.iterator();d.hasNext();){var b=d.next(),M=b.getSym();if(!b.isLineEdge()){if(b.isInResult()){a=q.INTERIOR;break}if(M.isInResult()){a=q.EXTERIOR;break}}}if(a===q.NONE)return null;for(var N=a,j=this.iterator();j.hasNext();){var te=j.next(),fe=te.getSym();te.isLineEdge()?te.getEdge().setCovered(N===q.INTERIOR):(te.isInResult()&&(N=q.EXTERIOR),fe.isInResult()&&(N=q.INTERIOR))}}},{key:"computeLabelling",value:function(a){le(s,"computeLabelling",this,1).call(this,a),this._label=new Un(q.NONE);for(var d=this.iterator();d.hasNext();)for(var b=d.next().getEdge().getLabel(),M=0;M<2;M++){var N=b.getLocation(M);N!==q.INTERIOR&&N!==q.BOUNDARY||this._label.setLocation(M,q.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(Ua),da=function(p){function s(){return E(this,s),I(this,s)}return ie(s,p),o(s,[{key:"createNode",value:function(a){return new In(a,new Jl)}}])}(Xs),Ql=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"compareTo",value:function(s){var a=s;return p.compareOriented(this._pts,this._orientation,a._pts,a._orientation)}},{key:"interfaces_",get:function(){return[pt]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var s=arguments[0];this._pts=s,this._orientation=p.orientation(s)}},{key:"orientation",value:function(s){return Wt.increasingDirection(s)===1}},{key:"compareOriented",value:function(s,a,d,b){for(var M=a?1:-1,N=b?1:-1,j=a?s.length:-1,te=b?d.length:-1,fe=a?0:s.length-1,Me=b?0:d.length-1;;){var Fe=s[fe].compareTo(d[Me]);if(Fe!==0)return Fe;var lt=(fe+=M)===j,Rt=(Me+=N)===te;if(lt&&!Rt)return-1;if(!lt&&Rt)return 1;if(lt&&Rt)return 0}}}])}(),eu=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"print",value:function(p){p.print("MULTILINESTRING ( ");for(var s=0;s<this._edges.size();s++){var a=this._edges.get(s);s>0&&p.print(","),p.print("(");for(var d=a.getCoordinates(),b=0;b<d.length;b++)b>0&&p.print(","),p.print(d[b].x+" "+d[b].y);p.println(")")}p.print(")  ")}},{key:"addAll",value:function(p){for(var s=p.iterator();s.hasNext();)this.add(s.next())}},{key:"findEdgeIndex",value:function(p){for(var s=0;s<this._edges.size();s++)if(this._edges.get(s).equals(p))return s;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(p){return this._edges.get(p)}},{key:"findEqualEdge",value:function(p){var s=new Ql(p.getCoordinates());return this._ocaMap.get(s)}},{key:"add",value:function(p){this._edges.add(p);var s=new Ql(p.getCoordinates());this._ocaMap.put(s,p)}}],[{key:"constructor_",value:function(){this._edges=new Q,this._ocaMap=new hi}}])}(),tu=function(){return o(function p(){E(this,p)},[{key:"processIntersections",value:function(p,s,a,d){}},{key:"isDone",value:function(){}}])}(),co=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"isTrivialIntersection",value:function(s,a,d,b){if(s===d&&this._li.getIntersectionNum()===1){if(p.isAdjacentSegments(a,b))return!0;if(s.isClosed()){var M=s.size()-1;if(a===0&&b===M||b===0&&a===M)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(s,a,d,b){if(s===d&&a===b)return null;this.numTests++;var M=s.getCoordinates()[a],N=s.getCoordinates()[a+1],j=d.getCoordinates()[b],te=d.getCoordinates()[b+1];this._li.computeIntersection(M,N,j,te),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(s,a,d,b)||(this._hasIntersection=!0,s.addIntersections(this._li,a,0),d.addIntersections(this._li,b,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[tu]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var s=arguments[0];this._li=s}},{key:"isAdjacentSegments",value:function(s,a){return Math.abs(s-a)===1}}])}(),Qo=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(p){p.print(this.coord),p.print(" seg # = "+this.segmentIndex),p.println(" dist = "+this.dist)}},{key:"compareTo",value:function(p){var s=p;return this.compare(s.segmentIndex,s.dist)}},{key:"isEndPoint",value:function(p){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===p}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(p,s){return this.segmentIndex<p?-1:this.segmentIndex>p?1:this.dist<s?-1:this.dist>s?1:0}},{key:"interfaces_",get:function(){return[pt]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var p=arguments[0],s=arguments[1],a=arguments[2];this.coord=new Ne(p),this.segmentIndex=s,this.dist=a}}])}(),iu=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"print",value:function(p){p.println("Intersections:");for(var s=this.iterator();s.hasNext();)s.next().print(p)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(p){this.addEndpoints();for(var s=this.iterator(),a=s.next();s.hasNext();){var d=s.next(),b=this.createSplitEdge(a,d);p.add(b),a=d}}},{key:"addEndpoints",value:function(){var p=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[p],p,0)}},{key:"createSplitEdge",value:function(p,s){var a=s.segmentIndex-p.segmentIndex+2,d=this.edge.pts[s.segmentIndex],b=s.dist>0||!s.coord.equals2D(d);b||a--;var M=new Array(a).fill(null),N=0;M[N++]=new Ne(p.coord);for(var j=p.segmentIndex+1;j<=s.segmentIndex;j++)M[N++]=this.edge.pts[j];return b&&(M[N]=s.coord),new ho(M,new Un(this.edge._label))}},{key:"add",value:function(p,s,a){var d=new Qo(p,s,a),b=this._nodeMap.get(d);return b!==null?b:(this._nodeMap.put(d,d),d)}},{key:"isIntersection",value:function(p){for(var s=this.iterator();s.hasNext();)if(s.next().coord.equals(p))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new hi,this.edge=null;var p=arguments[0];this.edge=p}}])}(),nu=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(p.isTrue(this._matrix[q.INTERIOR][q.INTERIOR])||p.isTrue(this._matrix[q.INTERIOR][q.BOUNDARY])||p.isTrue(this._matrix[q.BOUNDARY][q.INTERIOR])||p.isTrue(this._matrix[q.BOUNDARY][q.BOUNDARY]))&&this._matrix[q.EXTERIOR][q.INTERIOR]===He.FALSE&&this._matrix[q.EXTERIOR][q.BOUNDARY]===He.FALSE}},{key:"isCoveredBy",value:function(){return(p.isTrue(this._matrix[q.INTERIOR][q.INTERIOR])||p.isTrue(this._matrix[q.INTERIOR][q.BOUNDARY])||p.isTrue(this._matrix[q.BOUNDARY][q.INTERIOR])||p.isTrue(this._matrix[q.BOUNDARY][q.BOUNDARY]))&&this._matrix[q.INTERIOR][q.EXTERIOR]===He.FALSE&&this._matrix[q.BOUNDARY][q.EXTERIOR]===He.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var s=arguments[0],a=0;a<s.length;a++){var d=Math.trunc(a/3),b=a%3;this._matrix[d][b]=He.toDimensionValue(s.charAt(a))}else if(arguments.length===3){var M=arguments[0],N=arguments[1],j=arguments[2];this._matrix[M][N]=j}}},{key:"isContains",value:function(){return p.isTrue(this._matrix[q.INTERIOR][q.INTERIOR])&&this._matrix[q.EXTERIOR][q.INTERIOR]===He.FALSE&&this._matrix[q.EXTERIOR][q.BOUNDARY]===He.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var s=arguments[0],a=0;a<s.length;a++){var d=Math.trunc(a/3),b=a%3;this.setAtLeast(d,b,He.toDimensionValue(s.charAt(a)))}else if(arguments.length===3){var M=arguments[0],N=arguments[1],j=arguments[2];this._matrix[M][N]<j&&(this._matrix[M][N]=j)}}},{key:"setAtLeastIfValid",value:function(s,a,d){s>=0&&a>=0&&this.setAtLeast(s,a,d)}},{key:"isWithin",value:function(){return p.isTrue(this._matrix[q.INTERIOR][q.INTERIOR])&&this._matrix[q.INTERIOR][q.EXTERIOR]===He.FALSE&&this._matrix[q.BOUNDARY][q.EXTERIOR]===He.FALSE}},{key:"isTouches",value:function(s,a){return s>a?this.isTouches(a,s):(s===He.A&&a===He.A||s===He.L&&a===He.L||s===He.L&&a===He.A||s===He.P&&a===He.A||s===He.P&&a===He.L)&&this._matrix[q.INTERIOR][q.INTERIOR]===He.FALSE&&(p.isTrue(this._matrix[q.INTERIOR][q.BOUNDARY])||p.isTrue(this._matrix[q.BOUNDARY][q.INTERIOR])||p.isTrue(this._matrix[q.BOUNDARY][q.BOUNDARY]))}},{key:"isOverlaps",value:function(s,a){return s===He.P&&a===He.P||s===He.A&&a===He.A?p.isTrue(this._matrix[q.INTERIOR][q.INTERIOR])&&p.isTrue(this._matrix[q.INTERIOR][q.EXTERIOR])&&p.isTrue(this._matrix[q.EXTERIOR][q.INTERIOR]):s===He.L&&a===He.L&&this._matrix[q.INTERIOR][q.INTERIOR]===1&&p.isTrue(this._matrix[q.INTERIOR][q.EXTERIOR])&&p.isTrue(this._matrix[q.EXTERIOR][q.INTERIOR])}},{key:"isEquals",value:function(s,a){return s===a&&p.isTrue(this._matrix[q.INTERIOR][q.INTERIOR])&&this._matrix[q.INTERIOR][q.EXTERIOR]===He.FALSE&&this._matrix[q.BOUNDARY][q.EXTERIOR]===He.FALSE&&this._matrix[q.EXTERIOR][q.INTERIOR]===He.FALSE&&this._matrix[q.EXTERIOR][q.BOUNDARY]===He.FALSE}},{key:"toString",value:function(){for(var s=new Ji("123456789"),a=0;a<3;a++)for(var d=0;d<3;d++)s.setCharAt(3*a+d,He.toDimensionSymbol(this._matrix[a][d]));return s.toString()}},{key:"setAll",value:function(s){for(var a=0;a<3;a++)for(var d=0;d<3;d++)this._matrix[a][d]=s}},{key:"get",value:function(s,a){return this._matrix[s][a]}},{key:"transpose",value:function(){var s=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=s,s=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=s,s=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=s,this}},{key:"matches",value:function(s){if(s.length!==9)throw new qe("Should be length 9: "+s);for(var a=0;a<3;a++)for(var d=0;d<3;d++)if(!p.matches(this._matrix[a][d],s.charAt(3*a+d)))return!1;return!0}},{key:"add",value:function(s){for(var a=0;a<3;a++)for(var d=0;d<3;d++)this.setAtLeast(a,d,s.get(a,d))}},{key:"isDisjoint",value:function(){return this._matrix[q.INTERIOR][q.INTERIOR]===He.FALSE&&this._matrix[q.INTERIOR][q.BOUNDARY]===He.FALSE&&this._matrix[q.BOUNDARY][q.INTERIOR]===He.FALSE&&this._matrix[q.BOUNDARY][q.BOUNDARY]===He.FALSE}},{key:"isCrosses",value:function(s,a){return s===He.P&&a===He.L||s===He.P&&a===He.A||s===He.L&&a===He.A?p.isTrue(this._matrix[q.INTERIOR][q.INTERIOR])&&p.isTrue(this._matrix[q.INTERIOR][q.EXTERIOR]):s===He.L&&a===He.P||s===He.A&&a===He.P||s===He.A&&a===He.L?p.isTrue(this._matrix[q.INTERIOR][q.INTERIOR])&&p.isTrue(this._matrix[q.EXTERIOR][q.INTERIOR]):s===He.L&&a===He.L&&this._matrix[q.INTERIOR][q.INTERIOR]===0}},{key:"interfaces_",get:function(){return[dt]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(He.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var s=arguments[0];p.constructor_.call(this),this.set(s)}else if(arguments[0]instanceof p){var a=arguments[0];p.constructor_.call(this),this._matrix[q.INTERIOR][q.INTERIOR]=a._matrix[q.INTERIOR][q.INTERIOR],this._matrix[q.INTERIOR][q.BOUNDARY]=a._matrix[q.INTERIOR][q.BOUNDARY],this._matrix[q.INTERIOR][q.EXTERIOR]=a._matrix[q.INTERIOR][q.EXTERIOR],this._matrix[q.BOUNDARY][q.INTERIOR]=a._matrix[q.BOUNDARY][q.INTERIOR],this._matrix[q.BOUNDARY][q.BOUNDARY]=a._matrix[q.BOUNDARY][q.BOUNDARY],this._matrix[q.BOUNDARY][q.EXTERIOR]=a._matrix[q.BOUNDARY][q.EXTERIOR],this._matrix[q.EXTERIOR][q.INTERIOR]=a._matrix[q.EXTERIOR][q.INTERIOR],this._matrix[q.EXTERIOR][q.BOUNDARY]=a._matrix[q.EXTERIOR][q.BOUNDARY],this._matrix[q.EXTERIOR][q.EXTERIOR]=a._matrix[q.EXTERIOR][q.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var s=arguments[0],a=arguments[1];return a===He.SYM_DONTCARE||a===He.SYM_TRUE&&(s>=0||s===He.TRUE)||a===He.SYM_FALSE&&s===He.FALSE||a===He.SYM_P&&s===He.P||a===He.SYM_L&&s===He.L||a===He.SYM_A&&s===He.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var d=arguments[1];return new p(arguments[0]).matches(d)}}},{key:"isTrue",value:function(s){return s>=0||s===He.TRUE}}])}(),el=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(s){return s===null||s.length===0?null:(this.ensureCapacity(this._size+s.length),Le.arraycopy(s,0,this._data,this._size,s.length),void(this._size+=s.length))}},{key:"ensureCapacity",value:function(s){if(s<=this._data.length)return null;var a=Math.max(s,2*this._data.length);this._data=Yt.copyOf(this._data,a)}},{key:"toArray",value:function(){var s=new Array(this._size).fill(null);return Le.arraycopy(this._data,0,s,0,this._size),s}},{key:"add",value:function(s){this.ensureCapacity(this._size+1),this._data[this._size]=s,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)p.constructor_.call(this,10);else if(arguments.length===1){var s=arguments[0];this._data=new Array(s).fill(null)}}}])}(),tl=function(){function p(){E(this,p)}return o(p,[{key:"getChainStartIndices",value:function(s){var a=0,d=new el(Math.trunc(s.length/2));d.add(a);do{var b=this.findChainEnd(s,a);d.add(b),a=b}while(a<s.length-1);return d.toArray()}},{key:"findChainEnd",value:function(s,a){for(var d=Vt.quadrant(s[a],s[a+1]),b=a+1;b<s.length&&Vt.quadrant(s[b-1],s[b])===d;)b++;return b-1}},{key:"OLDgetChainStartIndices",value:function(s){var a=0,d=new Q;d.add(a);do{var b=this.findChainEnd(s,a);d.add(b),a=b}while(a<s.length-1);return p.toIntArray(d)}}],[{key:"toIntArray",value:function(s){for(var a=new Array(s.size()).fill(null),d=0;d<a.length;d++)a[d]=s.get(d).intValue();return a}}])}(),Ys=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(p){var s=this.pts[this.startIndex[p]].x,a=this.pts[this.startIndex[p+1]].x;return s>a?s:a}},{key:"getMinX",value:function(p){var s=this.pts[this.startIndex[p]].x,a=this.pts[this.startIndex[p+1]].x;return s<a?s:a}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var p=arguments[0],s=arguments[1],a=arguments[2],d=arguments[3];this.computeIntersectsForChain(this.startIndex[p],this.startIndex[p+1],s,s.startIndex[a],s.startIndex[a+1],d)}else if(arguments.length===6){var b=arguments[0],M=arguments[1],N=arguments[2],j=arguments[3],te=arguments[4],fe=arguments[5];if(M-b==1&&te-j==1)return fe.addIntersections(this.e,b,N.e,j),null;if(!this.overlaps(b,M,N,j,te))return null;var Me=Math.trunc((b+M)/2),Fe=Math.trunc((j+te)/2);b<Me&&(j<Fe&&this.computeIntersectsForChain(b,Me,N,j,Fe,fe),Fe<te&&this.computeIntersectsForChain(b,Me,N,Fe,te,fe)),Me<M&&(j<Fe&&this.computeIntersectsForChain(Me,M,N,j,Fe,fe),Fe<te&&this.computeIntersectsForChain(Me,M,N,Fe,te,fe))}}},{key:"overlaps",value:function(p,s,a,d,b){return Ci.intersects(this.pts[p],this.pts[s],a.pts[d],a.pts[b])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(p,s){for(var a=0;a<this.startIndex.length-1;a++)for(var d=0;d<p.startIndex.length-1;d++)this.computeIntersectsForChain(a,p,d,s)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var p=arguments[0];this.e=p,this.pts=p.getCoordinates();var s=new tl;this.startIndex=s.getChainStartIndices(this.pts)}}])}(),il=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"getDepth",value:function(s,a){return this._depth[s][a]}},{key:"setDepth",value:function(s,a,d){this._depth[s][a]=d}},{key:"isNull",value:function(){if(arguments.length===0){for(var s=0;s<2;s++)for(var a=0;a<3;a++)if(this._depth[s][a]!==p.NULL_VALUE)return!1;return!0}if(arguments.length===1){var d=arguments[0];return this._depth[d][1]===p.NULL_VALUE}if(arguments.length===2){var b=arguments[0],M=arguments[1];return this._depth[b][M]===p.NULL_VALUE}}},{key:"normalize",value:function(){for(var s=0;s<2;s++)if(!this.isNull(s)){var a=this._depth[s][1];this._depth[s][2]<a&&(a=this._depth[s][2]),a<0&&(a=0);for(var d=1;d<3;d++){var b=0;this._depth[s][d]>a&&(b=1),this._depth[s][d]=b}}}},{key:"getDelta",value:function(s){return this._depth[s][Re.RIGHT]-this._depth[s][Re.LEFT]}},{key:"getLocation",value:function(s,a){return this._depth[s][a]<=0?q.EXTERIOR:q.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var s=arguments[0],a=0;a<2;a++)for(var d=1;d<3;d++){var b=s.getLocation(a,d);b!==q.EXTERIOR&&b!==q.INTERIOR||(this.isNull(a,d)?this._depth[a][d]=p.depthAtLocation(b):this._depth[a][d]+=p.depthAtLocation(b))}else if(arguments.length===3){var M=arguments[0],N=arguments[1];arguments[2]===q.INTERIOR&&this._depth[M][N]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var s=0;s<2;s++)for(var a=0;a<3;a++)this._depth[s][a]=p.NULL_VALUE}},{key:"depthAtLocation",value:function(s){return s===q.EXTERIOR?0:s===q.INTERIOR?1:p.NULL_VALUE}}])}();il.NULL_VALUE=-1;var ho=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var a=new Array(2).fill(null);return a[0]=this.pts[0],a[1]=this.pts[1],new s(a,Un.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(a){this._isIsolated=a}},{key:"setName",value:function(a){this._name=a}},{key:"equals",value:function(a){if(!(a instanceof s))return!1;var d=a;if(this.pts.length!==d.pts.length)return!1;for(var b=!0,M=!0,N=this.pts.length,j=0;j<this.pts.length;j++)if(this.pts[j].equals2D(d.pts[j])||(b=!1),this.pts[j].equals2D(d.pts[--N])||(M=!1),!b&&!M)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var a=arguments[0];return this.pts[a]}}},{key:"print",value:function(a){a.print("edge "+this._name+": "),a.print("LINESTRING (");for(var d=0;d<this.pts.length;d++)d>0&&a.print(","),a.print(this.pts[d].x+" "+this.pts[d].y);a.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(a){s.updateIM(this._label,a)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(a){a.print("edge "+this._name+": ");for(var d=this.pts.length-1;d>=0;d--)a.print(this.pts[d]+" ");a.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Ys(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Ci;for(var a=0;a<this.pts.length;a++)this._env.expandToInclude(this.pts[a])}return this._env}},{key:"addIntersection",value:function(a,d,b,M){var N=new Ne(a.getIntersection(M)),j=d,te=a.getEdgeDistance(b,M),fe=j+1;if(fe<this.pts.length){var Me=this.pts[fe];N.equals2D(Me)&&(j=fe,te=0)}this.eiList.add(N,j,te)}},{key:"toString",value:function(){var a=new Ji;a.append("edge "+this._name+": "),a.append("LINESTRING (");for(var d=0;d<this.pts.length;d++)d>0&&a.append(","),a.append(this.pts[d].x+" "+this.pts[d].y);return a.append(")  "+this._label+" "+this._depthDelta),a.toString()}},{key:"isPointwiseEqual",value:function(a){if(this.pts.length!==a.pts.length)return!1;for(var d=0;d<this.pts.length;d++)if(!this.pts[d].equals2D(a.pts[d]))return!1;return!0}},{key:"setDepthDelta",value:function(a){this._depthDelta=a}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(a,d,b){for(var M=0;M<a.getIntersectionNum();M++)this.addIntersection(a,d,b,M)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new iu(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new il,this._depthDelta=0,arguments.length===1){var a=arguments[0];s.constructor_.call(this,a,null)}else if(arguments.length===2){var d=arguments[0],b=arguments[1];this.pts=d,this._label=b}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof nu&&arguments[0]instanceof Un))return le(s,"updateIM",this).apply(this,arguments);var a=arguments[0],d=arguments[1];d.setAtLeastIfValid(a.getLocation(0,Re.ON),a.getLocation(1,Re.ON),1),a.isArea()&&(d.setAtLeastIfValid(a.getLocation(0,Re.LEFT),a.getLocation(1,Re.LEFT),2),d.setAtLeastIfValid(a.getLocation(0,Re.RIGHT),a.getLocation(1,Re.RIGHT),2))}}])}(pn),Ks=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"setWorkingPrecisionModel",value:function(s){this._workingPrecisionModel=s}},{key:"insertUniqueEdge",value:function(s){var a=this._edgeList.findEqualEdge(s);if(a!==null){var d=a.getLabel(),b=s.getLabel();a.isPointwiseEqual(s)||(b=new Un(s.getLabel())).flip(),d.merge(b);var M=p.depthDelta(b),N=a.getDepthDelta()+M;a.setDepthDelta(N)}else this._edgeList.add(s),s.setDepthDelta(p.depthDelta(s.getLabel()))}},{key:"buildSubgraphs",value:function(s,a){for(var d=new Q,b=s.iterator();b.hasNext();){var M=b.next(),N=M.getRightmostCoordinate(),j=new fa(d).getDepth(N);M.computeDepth(j),M.findResultEdges(),d.add(M),a.add(M.getDirectedEdges(),M.getNodes())}}},{key:"createSubgraphs",value:function(s){for(var a=new Q,d=s.getNodes().iterator();d.hasNext();){var b=d.next();if(!b.isVisited()){var M=new Se;M.create(b),a.add(M)}}return Zn.sort(a,Zn.reverseOrder()),a}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(s){if(this._workingNoder!==null)return this._workingNoder;var a=new Ko,d=new hs;return d.setPrecisionModel(s),a.setSegmentIntersector(new co(d)),a}},{key:"buffer",value:function(s,a){var d=this._workingPrecisionModel;d===null&&(d=s.getPrecisionModel()),this._geomFact=s.getFactory();var b=new lo(d,this._bufParams),M=new Jo(s,a,b).getCurves();if(M.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(M,d),this._graph=new tr(new da),this._graph.addEdges(this._edgeList.getEdges());var N=this.createSubgraphs(this._graph),j=new Wo(this._geomFact);this.buildSubgraphs(N,j);var te=j.getPolygons();return te.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(te)}},{key:"computeNodedEdges",value:function(s,a){var d=this.getNoder(a);d.computeNodes(s);for(var b=d.getNodedSubstrings().iterator();b.hasNext();){var M=b.next(),N=M.getCoordinates();if(N.length!==2||!N[0].equals2D(N[1])){var j=M.getData(),te=new ho(M.getCoordinates(),new Un(j));this.insertUniqueEdge(te)}}}},{key:"setNoder",value:function(s){this._workingNoder=s}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new eu;var s=arguments[0];this._bufParams=s}},{key:"depthDelta",value:function(s){var a=s.getLocation(0,Re.LEFT),d=s.getLocation(0,Re.RIGHT);return a===q.INTERIOR&&d===q.EXTERIOR?1:a===q.EXTERIOR&&d===q.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(s){for(var a=new os,d=new Q;s.hasNext();){var b=s.next(),M=a.createLineString(b.getCoordinates());d.add(M)}return a.buildGeometry(d)}}])}(),ic=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"rescale",value:function(){if(mt(arguments[0],Te))for(var s=arguments[0].iterator();s.hasNext();){var a=s.next();this.rescale(a.getCoordinates())}else if(arguments[0]instanceof Array){for(var d=arguments[0],b=0;b<d.length;b++)d[b].x=d[b].x/this._scaleFactor+this._offsetX,d[b].y=d[b].y/this._scaleFactor+this._offsetY;d.length===2&&d[0].equals2D(d[1])&&Le.out.println(d)}}},{key:"scale",value:function(){if(mt(arguments[0],Te)){for(var s=arguments[0],a=new Q(s.size()),d=s.iterator();d.hasNext();){var b=d.next();a.add(new Pr(this.scale(b.getCoordinates()),b.getData()))}return a}if(arguments[0]instanceof Array){for(var M=arguments[0],N=new Array(M.length).fill(null),j=0;j<M.length;j++)N[j]=new Ne(Math.round((M[j].x-this._offsetX)*this._scaleFactor),Math.round((M[j].y-this._offsetY)*this._scaleFactor),M[j].getZ());return Wt.removeRepeatedPoints(N)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var s=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(s),s}},{key:"computeNodes",value:function(s){var a=s;this._isScaled&&(a=this.scale(s)),this._noder.computeNodes(a)}},{key:"interfaces_",get:function(){return[Es]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var s=arguments[0],a=arguments[1];p.constructor_.call(this,s,a,0,0)}else if(arguments.length===4){var d=arguments[0],b=arguments[1];this._noder=d,this._scaleFactor=b,this._isScaled=!this.isIntegerPrecision()}}}])}(),Ga=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var a=s.next().getCoordinates();this.checkEndPtVertexIntersections(a[0],this._segStrings),this.checkEndPtVertexIntersections(a[a.length-1],this._segStrings)}else if(arguments.length===2){for(var d=arguments[0],b=arguments[1].iterator();b.hasNext();)for(var M=b.next().getCoordinates(),N=1;N<M.length-1;N++)if(M[N].equals(d))throw new Jt("found endpt/interior pt intersection at index "+N+" :pt "+d)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();)for(var a=s.next(),d=this._segStrings.iterator();d.hasNext();){var b=d.next();this.checkInteriorIntersections(a,b)}else if(arguments.length===2)for(var M=arguments[0],N=arguments[1],j=M.getCoordinates(),te=N.getCoordinates(),fe=0;fe<j.length-1;fe++)for(var Me=0;Me<te.length-1;Me++)this.checkInteriorIntersections(M,fe,N,Me);else if(arguments.length===4){var Fe=arguments[0],lt=arguments[1],Rt=arguments[2],Xt=arguments[3];if(Fe===Rt&&lt===Xt)return null;var ti=Fe.getCoordinates()[lt],vi=Fe.getCoordinates()[lt+1],bi=Rt.getCoordinates()[Xt],zi=Rt.getCoordinates()[Xt+1];if(this._li.computeIntersection(ti,vi,bi,zi),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ti,vi)||this.hasInteriorIntersection(this._li,bi,zi)))throw new Jt("found non-noded intersection at "+ti+"-"+vi+" and "+bi+"-"+zi)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var a=s.next();this.checkCollapses(a)}else if(arguments.length===1)for(var d=arguments[0].getCoordinates(),b=0;b<d.length-2;b++)this.checkCollapse(d[b],d[b+1],d[b+2])}},{key:"hasInteriorIntersection",value:function(s,a,d){for(var b=0;b<s.getIntersectionNum();b++){var M=s.getIntersection(b);if(!M.equals(a)&&!M.equals(d))return!0}return!1}},{key:"checkCollapse",value:function(s,a,d){if(s.equals(d))throw new Jt("found non-noded collapse at "+p.fact.createLineString([s,a,d]))}}],[{key:"constructor_",value:function(){this._li=new hs,this._segStrings=null;var s=arguments[0];this._segStrings=s}}])}();Ga.fact=new os;var nl=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"intersectsScaled",value:function(s,a){var d=Math.min(s.x,a.x),b=Math.max(s.x,a.x),M=Math.min(s.y,a.y),N=Math.max(s.y,a.y),j=this._maxx<d||this._minx>b||this._maxy<M||this._miny>N;if(j)return!1;var te=this.intersectsToleranceSquare(s,a);return ri.isTrue(!(j&&te),"Found bad envelope test"),te}},{key:"initCorners",value:function(s){var a=.5;this._minx=s.x-a,this._maxx=s.x+a,this._miny=s.y-a,this._maxy=s.y+a,this._corner[0]=new Ne(this._maxx,this._maxy),this._corner[1]=new Ne(this._minx,this._maxy),this._corner[2]=new Ne(this._minx,this._miny),this._corner[3]=new Ne(this._maxx,this._miny)}},{key:"intersects",value:function(s,a){return this._scaleFactor===1?this.intersectsScaled(s,a):(this.copyScaled(s,this._p0Scaled),this.copyScaled(a,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(s){return Math.round(s*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(s,a){a.x=this.scale(s.x),a.y=this.scale(s.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var s=p.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Ci(this._originalPt.x-s,this._originalPt.x+s,this._originalPt.y-s,this._originalPt.y+s)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(s,a){return this._li.computeIntersection(s,a,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,a,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,a,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,a,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(s,a){var d=!1,b=!1;return this._li.computeIntersection(s,a,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(s,a,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(d=!0),this._li.computeIntersection(s,a,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(b=!0),this._li.computeIntersection(s,a,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!d||!b)||!!s.equals(this._pt)||!!a.equals(this._pt))))}},{key:"addSnappedNode",value:function(s,a){var d=s.getCoordinate(a),b=s.getCoordinate(a+1);return!!this.intersects(d,b)&&(s.addIntersection(this.getCoordinate(),a),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var s=arguments[0],a=arguments[1],d=arguments[2];if(this._originalPt=s,this._pt=s,this._scaleFactor=a,this._li=d,a<=0)throw new qe("Scale factor must be non-zero");a!==1&&(this._pt=new Ne(this.scale(s.x),this.scale(s.y)),this._p0Scaled=new Ne,this._p1Scaled=new Ne),this.initCorners(this._pt)}}])}();nl.SAFE_ENV_EXPANSION_FACTOR=.75;var ru=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var p=arguments[1];arguments[0].getLineSegment(p,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Yi}}])}(),rl=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(arguments.length===1){var p=arguments[0];return this.snap(p,null,-1)}if(arguments.length===3){var s=arguments[0],a=arguments[1],d=arguments[2],b=s.getSafeEnvelope(),M=new sl(s,a,d);return this._index.query(b,new(function(){return o(function N(){E(this,N)},[{key:"interfaces_",get:function(){return[ca]}},{key:"visitItem",value:function(N){N.select(b,M)}}])}())),M.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var p=arguments[0];this._index=p}}])}(),sl=function(p){function s(){var a;return E(this,s),a=I(this,s),s.constructor_.apply(a,arguments),a}return ie(s,p),o(s,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof ao))return le(s,"select",this,1).apply(this,arguments);var a=arguments[1],d=arguments[0].getContext();if(this._parentEdge===d&&(a===this._hotPixelVertexIndex||a+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(d,a)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var a=arguments[0],d=arguments[1],b=arguments[2];this._hotPixel=a,this._parentEdge=d,this._hotPixelVertexIndex=b}}])}(ru);rl.HotPixelSnapAction=sl;var su=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(p,s,a,d){if(p===a&&s===d)return null;var b=p.getCoordinates()[s],M=p.getCoordinates()[s+1],N=a.getCoordinates()[d],j=a.getCoordinates()[d+1];if(this._li.computeIntersection(b,M,N,j),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var te=0;te<this._li.getIntersectionNum();te++)this._interiorIntersections.add(this._li.getIntersection(te));p.addIntersections(this._li,s,0),a.addIntersections(this._li,d,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[tu]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var p=arguments[0];this._li=p,this._interiorIntersections=new Q}}])}(),al=function(){return o(function p(){E(this,p),p.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(p){var s=Pr.getNodedSubstrings(p),a=new Ga(s);try{a.checkValid()}catch(d){if(!(d instanceof We))throw d;d.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return Pr.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(p,s){var a=this.findInteriorIntersections(p,s);this.computeIntersectionSnaps(a),this.computeVertexSnaps(p)}},{key:"findInteriorIntersections",value:function(p,s){var a=new su(s);return this._noder.setSegmentIntersector(a),this._noder.computeNodes(p),a.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(mt(arguments[0],Te))for(var p=arguments[0].iterator();p.hasNext();){var s=p.next();this.computeVertexSnaps(s)}else if(arguments[0]instanceof Pr)for(var a=arguments[0],d=a.getCoordinates(),b=0;b<d.length;b++){var M=new nl(d[b],this._scaleFactor,this._li);this._pointSnapper.snap(M,a,b)&&a.addIntersection(d[b],b)}}},{key:"computeNodes",value:function(p){this._nodedSegStrings=p,this._noder=new Ko,this._pointSnapper=new rl(this._noder.getIndex()),this.snapRound(p,this._li)}},{key:"computeIntersectionSnaps",value:function(p){for(var s=p.iterator();s.hasNext();){var a=s.next(),d=new nl(a,this._scaleFactor,this._li);this._pointSnapper.snap(d)}}},{key:"interfaces_",get:function(){return[Es]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var p=arguments[0];this._pm=p,this._li=new hs,this._li.setPrecisionModel(p),this._scaleFactor=p.getScale()}}])}(),wi=function(){function p(){E(this,p),p.constructor_.apply(this,arguments)}return o(p,[{key:"bufferFixedPrecision",value:function(s){var a=new ic(new al(new Ai(1)),s.getScale()),d=new Ks(this._bufParams);d.setWorkingPrecisionModel(s),d.setNoder(a),this._resultGeometry=d.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var s=p.MAX_PRECISION_DIGITS;s>=0;s--){try{this.bufferReducedPrecision(s)}catch(M){if(!(M instanceof W))throw M;this._saveException=M}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var a=arguments[0],d=p.precisionScaleFactor(this._argGeom,this._distance,a),b=new Ai(d);this.bufferFixedPrecision(b)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var s=this._argGeom.getFactory().getPrecisionModel();s.getType()===Ai.FIXED?this.bufferFixedPrecision(s):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(s){this._bufParams.setQuadrantSegments(s)}},{key:"bufferOriginalPrecision",value:function(){try{var s=new Ks(this._bufParams);this._resultGeometry=s.buffer(this._argGeom,this._distance)}catch(a){if(!(a instanceof Jt))throw a;this._saveException=a}}},{key:"getResultGeometry",value:function(s){return this._distance=s,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(s){this._bufParams.setEndCapStyle(s)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new tt,this._resultGeometry=null,this._saveException=null,arguments.length===1){var s=arguments[0];this._argGeom=s}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this._argGeom=a,this._bufParams=d}}},{key:"bufferOp",value:function(){if(arguments.length===2){var s=arguments[1];return new p(arguments[0]).getResultGeometry(s)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof jt&&typeof arguments[1]=="number"){var a=arguments[1],d=arguments[2],b=new p(arguments[0]);return b.setQuadrantSegments(d),b.getResultGeometry(a)}if(arguments[2]instanceof tt&&arguments[0]instanceof jt&&typeof arguments[1]=="number"){var M=arguments[1];return new p(arguments[0],arguments[2]).getResultGeometry(M)}}else if(arguments.length===4){var N=arguments[1],j=arguments[2],te=arguments[3],fe=new p(arguments[0]);return fe.setQuadrantSegments(j),fe.setEndCapStyle(te),fe.getResultGeometry(N)}}},{key:"precisionScaleFactor",value:function(s,a,d){var b=s.getEnvelopeInternal(),M=ke.max(Math.abs(b.getMaxX()),Math.abs(b.getMaxY()),Math.abs(b.getMinX()),Math.abs(b.getMinY()))+2*(a>0?a:0),N=d-Math.trunc(Math.log(M)/Math.log(10)+1);return Math.pow(10,N)}}])}();wi.CAP_ROUND=tt.CAP_ROUND,wi.CAP_BUTT=tt.CAP_FLAT,wi.CAP_FLAT=tt.CAP_FLAT,wi.CAP_SQUARE=tt.CAP_SQUARE,wi.MAX_PRECISION_DIGITS=12;var fo=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],es=function(){return o(function p(s){E(this,p),this.geometryFactory=s||new os},[{key:"read",value:function(p){var s,a=(s=typeof p=="string"?JSON.parse(p):p).type;if(!dr[a])throw new Error("Unknown GeoJSON type: "+s.type);return fo.indexOf(a)!==-1?dr[a].call(this,s.coordinates):a==="GeometryCollection"?dr[a].call(this,s.geometries):dr[a].call(this,s)}},{key:"write",value:function(p){var s=p.getGeometryType();if(!Ar[s])throw new Error("Geometry is not supported");return Ar[s].call(this,p)}}])}(),dr={Feature:function(p){var s={};for(var a in p)s[a]=p[a];if(p.geometry){var d=p.geometry.type;if(!dr[d])throw new Error("Unknown GeoJSON type: "+p.type);s.geometry=this.read(p.geometry)}return p.bbox&&(s.bbox=dr.bbox.call(this,p.bbox)),s},FeatureCollection:function(p){var s={};if(p.features){s.features=[];for(var a=0;a<p.features.length;++a)s.features.push(this.read(p.features[a]))}return p.bbox&&(s.bbox=this.parse.bbox.call(this,p.bbox)),s},coordinates:function(p){for(var s=[],a=0;a<p.length;++a){var d=p[a];s.push(z(Ne,Xe(d)))}return s},bbox:function(p){return this.geometryFactory.createLinearRing([new Ne(p[0],p[1]),new Ne(p[2],p[1]),new Ne(p[2],p[3]),new Ne(p[0],p[3]),new Ne(p[0],p[1])])},Point:function(p){var s=z(Ne,Xe(p));return this.geometryFactory.createPoint(s)},MultiPoint:function(p){for(var s=[],a=0;a<p.length;++a)s.push(dr.Point.call(this,p[a]));return this.geometryFactory.createMultiPoint(s)},LineString:function(p){var s=dr.coordinates.call(this,p);return this.geometryFactory.createLineString(s)},MultiLineString:function(p){for(var s=[],a=0;a<p.length;++a)s.push(dr.LineString.call(this,p[a]));return this.geometryFactory.createMultiLineString(s)},Polygon:function(p){for(var s=dr.coordinates.call(this,p[0]),a=this.geometryFactory.createLinearRing(s),d=[],b=1;b<p.length;++b){var M=p[b],N=dr.coordinates.call(this,M),j=this.geometryFactory.createLinearRing(N);d.push(j)}return this.geometryFactory.createPolygon(a,d)},MultiPolygon:function(p){for(var s=[],a=0;a<p.length;++a){var d=p[a];s.push(dr.Polygon.call(this,d))}return this.geometryFactory.createMultiPolygon(s)},GeometryCollection:function(p){for(var s=[],a=0;a<p.length;++a){var d=p[a];s.push(this.read(d))}return this.geometryFactory.createGeometryCollection(s)}},Ar={coordinate:function(p){var s=[p.x,p.y];return p.z&&s.push(p.z),p.m&&s.push(p.m),s},Point:function(p){return{type:"Point",coordinates:Ar.coordinate.call(this,p.getCoordinate())}},MultiPoint:function(p){for(var s=[],a=0;a<p._geometries.length;++a){var d=p._geometries[a],b=Ar.Point.call(this,d);s.push(b.coordinates)}return{type:"MultiPoint",coordinates:s}},LineString:function(p){for(var s=[],a=p.getCoordinates(),d=0;d<a.length;++d){var b=a[d];s.push(Ar.coordinate.call(this,b))}return{type:"LineString",coordinates:s}},MultiLineString:function(p){for(var s=[],a=0;a<p._geometries.length;++a){var d=p._geometries[a],b=Ar.LineString.call(this,d);s.push(b.coordinates)}return{type:"MultiLineString",coordinates:s}},Polygon:function(p){var s=[],a=Ar.LineString.call(this,p._shell);s.push(a.coordinates);for(var d=0;d<p._holes.length;++d){var b=p._holes[d],M=Ar.LineString.call(this,b);s.push(M.coordinates)}return{type:"Polygon",coordinates:s}},MultiPolygon:function(p){for(var s=[],a=0;a<p._geometries.length;++a){var d=p._geometries[a],b=Ar.Polygon.call(this,d);s.push(b.coordinates)}return{type:"MultiPolygon",coordinates:s}},GeometryCollection:function(p){for(var s=[],a=0;a<p._geometries.length;++a){var d=p._geometries[a],b=d.getGeometryType();s.push(Ar[b].call(this,d))}return{type:"GeometryCollection",geometries:s}}};return{BufferOp:wi,GeoJSONReader:function(){return o(function p(s){E(this,p),this.parser=new es(s||new os)},[{key:"read",value:function(p){return this.parser.read(p)}}])}(),GeoJSONWriter:function(){return o(function p(){E(this,p),this.parser=new es(this.geometryFactory)},[{key:"write",value:function(p){return this.parser.write(p)}}])}()}})}(bf)),bf.exports}var mT=pT();const gT=mm(mT);function qo(){return new Df}function Df(){this.reset()}Df.prototype={constructor:Df,reset:function(){this.s=this.t=0},add:function(c){Y_(ff,c,this.t),Y_(this,ff.s,this.s),this.s?this.t+=ff.t:this.s=ff.t},valueOf:function(){return this.s}};var ff=new Df;function Y_(c,y,T){var I=c.s=y+T,E=I-y,z=I-E;c.t=y-z+(T-E)}var fn=1e-6,Vi=Math.PI,Pa=Vi/2,K_=Vi/4,Ra=Vi*2,Ro=180/Vi,Os=Vi/180,_r=Math.abs,_T=Math.atan,Zu=Math.atan2,En=Math.cos,Cn=Math.sin,Ku=Math.sqrt;function s0(c){return c>1?0:c<-1?Vi:Math.acos(c)}function Gl(c){return c>1?Pa:c<-1?-Pa:Math.asin(c)}function Xc(){}function zf(c,y){c&&Q_.hasOwnProperty(c.type)&&Q_[c.type](c,y)}var J_={Feature:function(c,y){zf(c.geometry,y)},FeatureCollection:function(c,y){for(var T=c.features,I=-1,E=T.length;++I<E;)zf(T[I].geometry,y)}},Q_={Sphere:function(c,y){y.sphere()},Point:function(c,y){c=c.coordinates,y.point(c[0],c[1],c[2])},MultiPoint:function(c,y){for(var T=c.coordinates,I=-1,E=T.length;++I<E;)c=T[I],y.point(c[0],c[1],c[2])},LineString:function(c,y){Gp(c.coordinates,y,0)},MultiLineString:function(c,y){for(var T=c.coordinates,I=-1,E=T.length;++I<E;)Gp(T[I],y,0)},Polygon:function(c,y){ey(c.coordinates,y)},MultiPolygon:function(c,y){for(var T=c.coordinates,I=-1,E=T.length;++I<E;)ey(T[I],y)},GeometryCollection:function(c,y){for(var T=c.geometries,I=-1,E=T.length;++I<E;)zf(T[I],y)}};function Gp(c,y,T){var I=-1,E=c.length-T,z;for(y.lineStart();++I<E;)z=c[I],y.point(z[0],z[1],z[2]);y.lineEnd()}function ey(c,y){var T=-1,I=c.length;for(y.polygonStart();++T<I;)Gp(c[T],y,1);y.polygonEnd()}function yT(c,y){c&&J_.hasOwnProperty(c.type)?J_[c.type](c,y):zf(c,y)}qo();qo();function qp(c){return[Zu(c[1],c[0]),Gl(c[2])]}function Hu(c){var y=c[0],T=c[1],I=En(T);return[I*En(y),I*Cn(y),Cn(T)]}function df(c,y){return c[0]*y[0]+c[1]*y[1]+c[2]*y[2]}function Nf(c,y){return[c[1]*y[2]-c[2]*y[1],c[2]*y[0]-c[0]*y[2],c[0]*y[1]-c[1]*y[0]]}function fp(c,y){c[0]+=y[0],c[1]+=y[1],c[2]+=y[2]}function pf(c,y){return[c[0]*y,c[1]*y,c[2]*y]}function $p(c){var y=Ku(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]/=y,c[1]/=y,c[2]/=y}qo();function a0(c,y){function T(I,E){return I=c(I,E),y(I[0],I[1])}return c.invert&&y.invert&&(T.invert=function(I,E){return I=y.invert(I,E),I&&c.invert(I[0],I[1])}),T}function Zp(c,y){return[c>Vi?c-Ra:c<-Vi?c+Ra:c,y]}Zp.invert=Zp;function vT(c,y,T){return(c%=Ra)?y||T?a0(iy(c),ny(y,T)):iy(c):y||T?ny(y,T):Zp}function ty(c){return function(y,T){return y+=c,[y>Vi?y-Ra:y<-Vi?y+Ra:y,T]}}function iy(c){var y=ty(c);return y.invert=ty(-c),y}function ny(c,y){var T=En(c),I=Cn(c),E=En(y),z=Cn(y);function P(o,J){var re=En(J),H=En(o)*re,ie=Cn(o)*re,ce=Cn(J),Y=ce*T+H*I;return[Zu(ie*E-Y*z,H*T-ce*I),Gl(Y*E+ie*z)]}return P.invert=function(o,J){var re=En(J),H=En(o)*re,ie=Cn(o)*re,ce=Cn(J),Y=ce*E-ie*z;return[Zu(ie*E+ce*z,H*T+Y*I),Gl(Y*T-H*I)]},P}function xT(c,y,T,I,E,z){if(T){var P=En(y),o=Cn(y),J=I*T;E==null?(E=y+I*Ra,z=y-J/2):(E=ry(P,E),z=ry(P,z),(I>0?E<z:E>z)&&(E+=I*Ra));for(var re,H=E;I>0?H>z:H<z;H-=J)re=qp([P,-o*En(H),-o*Cn(H)]),c.point(re[0],re[1])}}function ry(c,y){y=Hu(y),y[0]-=c,$p(y);var T=s0(-y[1]);return((-y[2]<0?-T:T)+Ra-fn)%Ra}function o0(){var c=[],y;return{point:function(T,I){y.push([T,I])},lineStart:function(){c.push(y=[])},lineEnd:Xc,rejoin:function(){c.length>1&&c.push(c.pop().concat(c.shift()))},result:function(){var T=c;return c=[],y=null,T}}}function bT(c,y,T,I,E,z){var P=c[0],o=c[1],J=y[0],re=y[1],H=0,ie=1,ce=J-P,Y=re-o,le;if(le=T-P,!(!ce&&le>0)){if(le/=ce,ce<0){if(le<H)return;le<ie&&(ie=le)}else if(ce>0){if(le>ie)return;le>H&&(H=le)}if(le=E-P,!(!ce&&le<0)){if(le/=ce,ce<0){if(le>ie)return;le>H&&(H=le)}else if(ce>0){if(le<H)return;le<ie&&(ie=le)}if(le=I-o,!(!Y&&le>0)){if(le/=Y,Y<0){if(le<H)return;le<ie&&(ie=le)}else if(Y>0){if(le>ie)return;le>H&&(H=le)}if(le=z-o,!(!Y&&le<0)){if(le/=Y,Y<0){if(le>ie)return;le>H&&(H=le)}else if(Y>0){if(le<H)return;le<ie&&(ie=le)}return H>0&&(c[0]=P+H*ce,c[1]=o+H*Y),ie<1&&(y[0]=P+ie*ce,y[1]=o+ie*Y),!0}}}}}function wf(c,y){return _r(c[0]-y[0])<fn&&_r(c[1]-y[1])<fn}function mf(c,y,T,I){this.x=c,this.z=y,this.o=T,this.e=I,this.v=!1,this.n=this.p=null}function l0(c,y,T,I,E){var z=[],P=[],o,J;if(c.forEach(function(le){if(!((Xe=le.length-1)<=0)){var Xe,ft=le[0],it=le[Xe],Qe;if(wf(ft,it)){for(E.lineStart(),o=0;o<Xe;++o)E.point((ft=le[o])[0],ft[1]);E.lineEnd();return}z.push(Qe=new mf(ft,le,null,!0)),P.push(Qe.o=new mf(ft,null,Qe,!1)),z.push(Qe=new mf(it,le,null,!1)),P.push(Qe.o=new mf(it,null,Qe,!0))}}),!!z.length){for(P.sort(y),sy(z),sy(P),o=0,J=P.length;o<J;++o)P[o].e=T=!T;for(var re=z[0],H,ie;;){for(var ce=re,Y=!0;ce.v;)if((ce=ce.n)===re)return;H=ce.z,E.lineStart();do{if(ce.v=ce.o.v=!0,ce.e){if(Y)for(o=0,J=H.length;o<J;++o)E.point((ie=H[o])[0],ie[1]);else I(ce.x,ce.n.x,1,E);ce=ce.n}else{if(Y)for(H=ce.p.z,o=H.length-1;o>=0;--o)E.point((ie=H[o])[0],ie[1]);else I(ce.x,ce.p.x,-1,E);ce=ce.p}ce=ce.o,H=ce.z,Y=!Y}while(!ce.v);E.lineEnd()}}}function sy(c){if(y=c.length){for(var y,T=0,I=c[0],E;++T<y;)I.n=E=c[T],E.p=I,I=E;I.n=E=c[0],E.p=I}}function u0(c,y){return c<y?-1:c>y?1:c>=y?0:NaN}function wT(c){return c.length===1&&(c=TT(c)),{left:function(y,T,I,E){for(I==null&&(I=0),E==null&&(E=y.length);I<E;){var z=I+E>>>1;c(y[z],T)<0?I=z+1:E=z}return I},right:function(y,T,I,E){for(I==null&&(I=0),E==null&&(E=y.length);I<E;){var z=I+E>>>1;c(y[z],T)>0?E=z:I=z+1}return I}}}function TT(c){return function(y,T){return u0(c(y),T)}}wT(u0);function c0(c){for(var y=c.length,T,I=-1,E=0,z,P;++I<y;)E+=c[I].length;for(z=new Array(E);--y>=0;)for(P=c[y],T=P.length;--T>=0;)z[--E]=P[T];return z}var Wc=1e9,gf=-Wc;function ST(c,y,T,I){function E(re,H){return c<=re&&re<=T&&y<=H&&H<=I}function z(re,H,ie,ce){var Y=0,le=0;if(re==null||(Y=P(re,ie))!==(le=P(H,ie))||J(re,H)<0^ie>0)do ce.point(Y===0||Y===3?c:T,Y>1?I:y);while((Y=(Y+ie+4)%4)!==le);else ce.point(H[0],H[1])}function P(re,H){return _r(re[0]-c)<fn?H>0?0:3:_r(re[0]-T)<fn?H>0?2:1:_r(re[1]-y)<fn?H>0?1:0:H>0?3:2}function o(re,H){return J(re.x,H.x)}function J(re,H){var ie=P(re,1),ce=P(H,1);return ie!==ce?ie-ce:ie===0?H[1]-re[1]:ie===1?re[0]-H[0]:ie===2?re[1]-H[1]:H[0]-re[0]}return function(re){var H=re,ie=o0(),ce,Y,le,Xe,ft,it,Qe,tt,We,qe,Ke,pt={point:dt,lineStart:ct,lineEnd:Pt,polygonStart:Ct,polygonEnd:Dt};function dt(Bt,qt){E(Bt,qt)&&H.point(Bt,qt)}function Ye(){for(var Bt=0,qt=0,Ut=Y.length;qt<Ut;++qt)for(var ui=Y[qt],Ni=1,Ot=ui.length,Ei=ui[0],Jt,Ui,ri=Ei[0],Pn=Ei[1];Ni<Ot;++Ni)Jt=ri,Ui=Pn,Ei=ui[Ni],ri=Ei[0],Pn=Ei[1],Ui<=I?Pn>I&&(ri-Jt)*(I-Ui)>(Pn-Ui)*(c-Jt)&&++Bt:Pn<=I&&(ri-Jt)*(I-Ui)<(Pn-Ui)*(c-Jt)&&--Bt;return Bt}function Ct(){H=ie,ce=[],Y=[],Ke=!0}function Dt(){var Bt=Ye(),qt=Ke&&Bt,Ut=(ce=c0(ce)).length;(qt||Ut)&&(re.polygonStart(),qt&&(re.lineStart(),z(null,null,1,re),re.lineEnd()),Ut&&l0(ce,o,Bt,z,re),re.polygonEnd()),H=re,ce=Y=le=null}function ct(){pt.point=ut,Y&&Y.push(le=[]),qe=!0,We=!1,Qe=tt=NaN}function Pt(){ce&&(ut(Xe,ft),it&&We&&ie.rejoin(),ce.push(ie.result())),pt.point=dt,We&&H.lineEnd()}function ut(Bt,qt){var Ut=E(Bt,qt);if(Y&&le.push([Bt,qt]),qe)Xe=Bt,ft=qt,it=Ut,qe=!1,Ut&&(H.lineStart(),H.point(Bt,qt));else if(Ut&&We)H.point(Bt,qt);else{var ui=[Qe=Math.max(gf,Math.min(Wc,Qe)),tt=Math.max(gf,Math.min(Wc,tt))],Ni=[Bt=Math.max(gf,Math.min(Wc,Bt)),qt=Math.max(gf,Math.min(Wc,qt))];bT(ui,Ni,c,y,T,I)?(We||(H.lineStart(),H.point(ui[0],ui[1])),H.point(Ni[0],Ni[1]),Ut||H.lineEnd(),Ke=!1):Ut&&(H.lineStart(),H.point(Bt,qt),Ke=!1)}Qe=Bt,tt=qt,We=Ut}return pt}}var dp=qo();function IT(c,y){var T=y[0],I=y[1],E=[Cn(T),-En(T),0],z=0,P=0;dp.reset();for(var o=0,J=c.length;o<J;++o)if(H=(re=c[o]).length)for(var re,H,ie=re[H-1],ce=ie[0],Y=ie[1]/2+K_,le=Cn(Y),Xe=En(Y),ft=0;ft<H;++ft,ce=Qe,le=We,Xe=qe,ie=it){var it=re[ft],Qe=it[0],tt=it[1]/2+K_,We=Cn(tt),qe=En(tt),Ke=Qe-ce,pt=Ke>=0?1:-1,dt=pt*Ke,Ye=dt>Vi,Ct=le*We;if(dp.add(Zu(Ct*pt*Cn(dt),Xe*qe+Ct*En(dt))),z+=Ye?Ke+pt*Ra:Ke,Ye^ce>=T^Qe>=T){var Dt=Nf(Hu(ie),Hu(it));$p(Dt);var ct=Nf(E,Dt);$p(ct);var Pt=(Ye^Ke>=0?-1:1)*Gl(ct[2]);(I>Pt||I===Pt&&(Dt[0]||Dt[1]))&&(P+=Ye^Ke>=0?1:-1)}}return(z<-fn||z<fn&&dp<-fn)^P&1}qo();function ay(c){return c}qo();qo();var Xu=1/0,Of=Xu,hh=-Xu,Ff=hh,oy={point:kT,lineStart:Xc,lineEnd:Xc,polygonStart:Xc,polygonEnd:Xc,result:function(){var c=[[Xu,Of],[hh,Ff]];return hh=Ff=-(Of=Xu=1/0),c}};function kT(c,y){c<Xu&&(Xu=c),c>hh&&(hh=c),y<Of&&(Of=y),y>Ff&&(Ff=y)}qo();function h0(c,y,T,I){return function(E,z){var P=y(z),o=E.invert(I[0],I[1]),J=o0(),re=y(J),H=!1,ie,ce,Y,le={point:Xe,lineStart:it,lineEnd:Qe,polygonStart:function(){le.point=tt,le.lineStart=We,le.lineEnd=qe,ce=[],ie=[]},polygonEnd:function(){le.point=Xe,le.lineStart=it,le.lineEnd=Qe,ce=c0(ce);var Ke=IT(ie,o);ce.length?(H||(z.polygonStart(),H=!0),l0(ce,CT,Ke,T,z)):Ke&&(H||(z.polygonStart(),H=!0),z.lineStart(),T(null,null,1,z),z.lineEnd()),H&&(z.polygonEnd(),H=!1),ce=ie=null},sphere:function(){z.polygonStart(),z.lineStart(),T(null,null,1,z),z.lineEnd(),z.polygonEnd()}};function Xe(Ke,pt){var dt=E(Ke,pt);c(Ke=dt[0],pt=dt[1])&&z.point(Ke,pt)}function ft(Ke,pt){var dt=E(Ke,pt);P.point(dt[0],dt[1])}function it(){le.point=ft,P.lineStart()}function Qe(){le.point=Xe,P.lineEnd()}function tt(Ke,pt){Y.push([Ke,pt]);var dt=E(Ke,pt);re.point(dt[0],dt[1])}function We(){re.lineStart(),Y=[]}function qe(){tt(Y[0][0],Y[0][1]),re.lineEnd();var Ke=re.clean(),pt=J.result(),dt,Ye=pt.length,Ct,Dt,ct;if(Y.pop(),ie.push(Y),Y=null,!!Ye){if(Ke&1){if(Dt=pt[0],(Ct=Dt.length-1)>0){for(H||(z.polygonStart(),H=!0),z.lineStart(),dt=0;dt<Ct;++dt)z.point((ct=Dt[dt])[0],ct[1]);z.lineEnd()}return}Ye>1&&Ke&2&&pt.push(pt.pop().concat(pt.shift())),ce.push(pt.filter(ET))}}return le}}function ET(c){return c.length>1}function CT(c,y){return((c=c.x)[0]<0?c[1]-Pa-fn:Pa-c[1])-((y=y.x)[0]<0?y[1]-Pa-fn:Pa-y[1])}const ly=h0(function(){return!0},PT,AT,[-Vi,-Pa]);function PT(c){var y=NaN,T=NaN,I=NaN,E;return{lineStart:function(){c.lineStart(),E=1},point:function(z,P){var o=z>0?Vi:-Vi,J=_r(z-y);_r(J-Vi)<fn?(c.point(y,T=(T+P)/2>0?Pa:-Pa),c.point(I,T),c.lineEnd(),c.lineStart(),c.point(o,T),c.point(z,T),E=0):I!==o&&J>=Vi&&(_r(y-I)<fn&&(y-=I*fn),_r(z-o)<fn&&(z-=o*fn),T=MT(y,T,z,P),c.point(I,T),c.lineEnd(),c.lineStart(),c.point(o,T),E=0),c.point(y=z,T=P),I=o},lineEnd:function(){c.lineEnd(),y=T=NaN},clean:function(){return 2-E}}}function MT(c,y,T,I){var E,z,P=Cn(c-T);return _r(P)>fn?_T((Cn(y)*(z=En(I))*Cn(T)-Cn(I)*(E=En(y))*Cn(c))/(E*z*P)):(y+I)/2}function AT(c,y,T,I){var E;if(c==null)E=T*Pa,I.point(-Vi,E),I.point(0,E),I.point(Vi,E),I.point(Vi,0),I.point(Vi,-E),I.point(0,-E),I.point(-Vi,-E),I.point(-Vi,0),I.point(-Vi,E);else if(_r(c[0]-y[0])>fn){var z=c[0]<y[0]?Vi:-Vi;E=T*z/2,I.point(-z,E),I.point(0,E),I.point(z,E)}else I.point(y[0],y[1])}function RT(c,y){var T=En(c),I=T>0,E=_r(T)>fn;function z(H,ie,ce,Y){xT(Y,c,y,ce,H,ie)}function P(H,ie){return En(H)*En(ie)>T}function o(H){var ie,ce,Y,le,Xe;return{lineStart:function(){le=Y=!1,Xe=1},point:function(ft,it){var Qe=[ft,it],tt,We=P(ft,it),qe=I?We?0:re(ft,it):We?re(ft+(ft<0?Vi:-Vi),it):0;if(!ie&&(le=Y=We)&&H.lineStart(),We!==Y&&(tt=J(ie,Qe),(!tt||wf(ie,tt)||wf(Qe,tt))&&(Qe[0]+=fn,Qe[1]+=fn,We=P(Qe[0],Qe[1]))),We!==Y)Xe=0,We?(H.lineStart(),tt=J(Qe,ie),H.point(tt[0],tt[1])):(tt=J(ie,Qe),H.point(tt[0],tt[1]),H.lineEnd()),ie=tt;else if(E&&ie&&I^We){var Ke;!(qe&ce)&&(Ke=J(Qe,ie,!0))&&(Xe=0,I?(H.lineStart(),H.point(Ke[0][0],Ke[0][1]),H.point(Ke[1][0],Ke[1][1]),H.lineEnd()):(H.point(Ke[1][0],Ke[1][1]),H.lineEnd(),H.lineStart(),H.point(Ke[0][0],Ke[0][1])))}We&&(!ie||!wf(ie,Qe))&&H.point(Qe[0],Qe[1]),ie=Qe,Y=We,ce=qe},lineEnd:function(){Y&&H.lineEnd(),ie=null},clean:function(){return Xe|(le&&Y)<<1}}}function J(H,ie,ce){var Y=Hu(H),le=Hu(ie),Xe=[1,0,0],ft=Nf(Y,le),it=df(ft,ft),Qe=ft[0],tt=it-Qe*Qe;if(!tt)return!ce&&H;var We=T*it/tt,qe=-T*Qe/tt,Ke=Nf(Xe,ft),pt=pf(Xe,We),dt=pf(ft,qe);fp(pt,dt);var Ye=Ke,Ct=df(pt,Ye),Dt=df(Ye,Ye),ct=Ct*Ct-Dt*(df(pt,pt)-1);if(!(ct<0)){var Pt=Ku(ct),ut=pf(Ye,(-Ct-Pt)/Dt);if(fp(ut,pt),ut=qp(ut),!ce)return ut;var Bt=H[0],qt=ie[0],Ut=H[1],ui=ie[1],Ni;qt<Bt&&(Ni=Bt,Bt=qt,qt=Ni);var Ot=qt-Bt,Ei=_r(Ot-Vi)<fn,Jt=Ei||Ot<fn;if(!Ei&&ui<Ut&&(Ni=Ut,Ut=ui,ui=Ni),Jt?Ei?Ut+ui>0^ut[1]<(_r(ut[0]-Bt)<fn?Ut:ui):Ut<=ut[1]&&ut[1]<=ui:Ot>Vi^(Bt<=ut[0]&&ut[0]<=qt)){var Ui=pf(Ye,(-Ct+Pt)/Dt);return fp(Ui,pt),[ut,qp(Ui)]}}}function re(H,ie){var ce=I?c:Vi-c,Y=0;return H<-ce?Y|=1:H>ce&&(Y|=2),ie<-ce?Y|=4:ie>ce&&(Y|=8),Y}return h0(P,o,z,I?[0,-c]:[-Vi,c-Vi])}function f0(c){return function(y){var T=new Hp;for(var I in c)T[I]=c[I];return T.stream=y,T}}function Hp(){}Hp.prototype={constructor:Hp,point:function(c,y){this.stream.point(c,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function d0(c,y,T){var I=y[1][0]-y[0][0],E=y[1][1]-y[0][1],z=c.clipExtent&&c.clipExtent();c.scale(150).translate([0,0]),z!=null&&c.clipExtent(null),yT(T,c.stream(oy));var P=oy.result(),o=Math.min(I/(P[1][0]-P[0][0]),E/(P[1][1]-P[0][1])),J=+y[0][0]+(I-o*(P[1][0]+P[0][0]))/2,re=+y[0][1]+(E-o*(P[1][1]+P[0][1]))/2;return z!=null&&c.clipExtent(z),c.scale(o*150).translate([J,re])}function LT(c,y,T){return d0(c,[[0,0],y],T)}var uy=16,DT=En(30*Os);function cy(c,y){return+y?NT(c,y):zT(c)}function zT(c){return f0({point:function(y,T){y=c(y,T),this.stream.point(y[0],y[1])}})}function NT(c,y){function T(I,E,z,P,o,J,re,H,ie,ce,Y,le,Xe,ft){var it=re-I,Qe=H-E,tt=it*it+Qe*Qe;if(tt>4*y&&Xe--){var We=P+ce,qe=o+Y,Ke=J+le,pt=Ku(We*We+qe*qe+Ke*Ke),dt=Gl(Ke/=pt),Ye=_r(_r(Ke)-1)<fn||_r(z-ie)<fn?(z+ie)/2:Zu(qe,We),Ct=c(Ye,dt),Dt=Ct[0],ct=Ct[1],Pt=Dt-I,ut=ct-E,Bt=Qe*Pt-it*ut;(Bt*Bt/tt>y||_r((it*Pt+Qe*ut)/tt-.5)>.3||P*ce+o*Y+J*le<DT)&&(T(I,E,z,P,o,J,Dt,ct,Ye,We/=pt,qe/=pt,Ke,Xe,ft),ft.point(Dt,ct),T(Dt,ct,Ye,We,qe,Ke,re,H,ie,ce,Y,le,Xe,ft))}}return function(I){var E,z,P,o,J,re,H,ie,ce,Y,le,Xe,ft={point:it,lineStart:Qe,lineEnd:We,polygonStart:function(){I.polygonStart(),ft.lineStart=qe},polygonEnd:function(){I.polygonEnd(),ft.lineStart=Qe}};function it(dt,Ye){dt=c(dt,Ye),I.point(dt[0],dt[1])}function Qe(){ie=NaN,ft.point=tt,I.lineStart()}function tt(dt,Ye){var Ct=Hu([dt,Ye]),Dt=c(dt,Ye);T(ie,ce,H,Y,le,Xe,ie=Dt[0],ce=Dt[1],H=dt,Y=Ct[0],le=Ct[1],Xe=Ct[2],uy,I),I.point(ie,ce)}function We(){ft.point=it,I.lineEnd()}function qe(){Qe(),ft.point=Ke,ft.lineEnd=pt}function Ke(dt,Ye){tt(E=dt,Ye),z=ie,P=ce,o=Y,J=le,re=Xe,ft.point=tt}function pt(){T(ie,ce,H,Y,le,Xe,z,P,E,o,J,re,uy,I),ft.lineEnd=We,We()}return ft}}var OT=f0({point:function(c,y){this.stream.point(c*Os,y*Os)}});function FT(c){return BT(function(){return c})()}function BT(c){var y,T=150,I=480,E=250,z,P,o=0,J=0,re=0,H=0,ie=0,ce,Y,le=null,Xe=ly,ft=null,it,Qe,tt,We=ay,qe=.5,Ke=cy(Dt,qe),pt,dt;function Ye(ut){return ut=Y(ut[0]*Os,ut[1]*Os),[ut[0]*T+z,P-ut[1]*T]}function Ct(ut){return ut=Y.invert((ut[0]-z)/T,(P-ut[1])/T),ut&&[ut[0]*Ro,ut[1]*Ro]}function Dt(ut,Bt){return ut=y(ut,Bt),[ut[0]*T+z,P-ut[1]*T]}Ye.stream=function(ut){return pt&&dt===ut?pt:pt=OT(Xe(ce,Ke(We(dt=ut))))},Ye.clipAngle=function(ut){return arguments.length?(Xe=+ut?RT(le=ut*Os,6*Os):(le=null,ly),Pt()):le*Ro},Ye.clipExtent=function(ut){return arguments.length?(We=ut==null?(ft=it=Qe=tt=null,ay):ST(ft=+ut[0][0],it=+ut[0][1],Qe=+ut[1][0],tt=+ut[1][1]),Pt()):ft==null?null:[[ft,it],[Qe,tt]]},Ye.scale=function(ut){return arguments.length?(T=+ut,ct()):T},Ye.translate=function(ut){return arguments.length?(I=+ut[0],E=+ut[1],ct()):[I,E]},Ye.center=function(ut){return arguments.length?(o=ut[0]%360*Os,J=ut[1]%360*Os,ct()):[o*Ro,J*Ro]},Ye.rotate=function(ut){return arguments.length?(re=ut[0]%360*Os,H=ut[1]%360*Os,ie=ut.length>2?ut[2]%360*Os:0,ct()):[re*Ro,H*Ro,ie*Ro]},Ye.precision=function(ut){return arguments.length?(Ke=cy(Dt,qe=ut*ut),Pt()):Ku(qe)},Ye.fitExtent=function(ut,Bt){return d0(Ye,ut,Bt)},Ye.fitSize=function(ut,Bt){return LT(Ye,ut,Bt)};function ct(){Y=a0(ce=vT(re,H,ie),y);var ut=y(o,J);return z=I-ut[0]*T,P=E+ut[1]*T,Pt()}function Pt(){return pt=dt=null,Ye}return function(){return y=c.apply(this,arguments),Ye.invert=y.invert&&Ct,ct()}}function p0(c){return function(y,T){var I=En(y),E=En(T),z=c(I*E);return[z*E*Cn(y),z*Cn(T)]}}function m0(c){return function(y,T){var I=Ku(y*y+T*T),E=c(I),z=Cn(E),P=En(E);return[Zu(y*z,I*P),Gl(I&&T*z/I)]}}var jT=p0(function(c){return Ku(2/(1+c))});jT.invert=m0(function(c){return 2*Gl(c/2)});var g0=p0(function(c){return(c=s0(c))&&c/Cn(c)});g0.invert=m0(function(c){return c});function VT(){return FT(g0).scale(79.4188).clipAngle(180-.001)}function hy(c,y){return[c,y]}hy.invert=hy;var{BufferOp:UT,GeoJSONReader:GT,GeoJSONWriter:qT}=gT;function fy(c,y,T){T=T||{};var I=T.units||"kilometers",E=T.steps||8;if(!c)throw new Error("geojson is required");if(typeof T!="object")throw new Error("options must be an object");if(typeof E!="number")throw new Error("steps must be an number");if(y===void 0)throw new Error("radius is required");if(E<=0)throw new Error("steps must be greater than 0");var z=[];switch(c.type){case"GeometryCollection":return n0(c,function(P){var o=Tf(P,y,I,E);o&&z.push(o)}),Up(z);case"FeatureCollection":return X_(c,function(P){var o=Tf(P,y,I,E);o&&X_(o,function(J){J&&z.push(J)})}),Up(z)}return Tf(c,y,I,E)}function Tf(c,y,T,I){var E=c.properties||{},z=c.type==="Feature"?c.geometry:c;if(z.type==="GeometryCollection"){var P=[];return n0(c,function(Xe){var ft=Tf(Xe,y,T,I);ft&&P.push(ft)}),Up(P)}var o=$T(z),J={type:z.type,coordinates:y0(z.coordinates,o)},re=new GT,H=re.read(J),ie=e0(hT(y,T),"meters"),ce=UT.bufferOp(H,ie,I),Y=new qT;if(ce=Y.write(ce),!_0(ce.coordinates)){var le={type:ce.type,coordinates:v0(ce.coordinates,o)};return Qv(le,E)}}function _0(c){return Array.isArray(c[0])?_0(c[0]):isNaN(c[0])}function y0(c,y){return typeof c[0]!="object"?y(c):c.map(function(T){return y0(T,y)})}function v0(c,y){return typeof c[0]!="object"?y.invert(c):c.map(function(T){return v0(T,y)})}function $T(c){var y=fT(c).geometry.coordinates,T=[-y[0],-y[1]];return VT().rotate(T).scale(ns)}const Ju=Yu("player",{state:()=>({firstOpenedAt:null,totalDistance:0,totalHantu:0,totalKawasanAngker:0,unlockedAchievements:[],lastCoords:null,latestUnlocked:null}),getters:{formattedDistance:c=>{const y=c.totalDistance;return y<1?"0 m":y<1e3?`${y.toFixed(0)} m`:y<1609.34?`${(y/1e3).toFixed(2)} km`:y<1e4?`${(y/1e3).toFixed(1)} km`:y<1e6?`${(y/1e3).toFixed(0)} km`:y>=1e6?`${(y/1e6).toFixed(1)}k km`:`${(y/1e3).toFixed(0)} km`}},actions:{updateDistance(c,y){if(!this.lastCoords){this.lastCoords=c;return}const T=$u(this.lastCoords),I=$u(c),E=t0(T,I,{units:"meters"});E>.5&&(this.totalDistance+=E,this.lastCoords=c,this.evaluateAchievements(y))},countHantuCaught(c){return this.totalHantu+=1,this.evaluateAchievements(c)},evaluateAchievements(c){this.firstOpenedAt||(this.firstOpenedAt=Date.now()),this.totalHantu,this.totalDistance,this.totalKawasanAngker;const y=cT({unlockedIds:this.unlockedAchievements});return this.unlockedAchievements.push(...y),y},resetPlayer(){this.totalDistance=0,this.lastCoords=null}},persist:!0}),gm="./assets/background-B4ry_7vL.png",ZT={key:0,class:"fixed inset-0 z-[60] bg-black bg-opacity-90 flex items-center justify-center p-6"},HT={__name:"IntroModal",props:{visible:Boolean},emits:["start"],setup(c,{emit:y}){const T=y,I=()=>{T("start")};return(E,z)=>c.visible?(mi(),Di("div",ZT,[vt("div",{class:"relative bg-transparent font-horror rounded-xl max-w-3xl w-full shadow-2xl p-6 overflow-auto",style:Wu({backgroundImage:`url(${xn(gm)})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[z[0]||(z[0]=rw('<h1 class="text-center text-4xl text-red-800 font-bold mb-6 break-words">Penampakan</h1><div class="text-wrapper space-y-4 px-8"><p class="text-black text-sm leading-relaxed break-words"> Welcome to <span class="text-red-800 text-xl ont-semibold">Penampakan</span> - Alpha 0.07 released <br> a ghost-hunting experience like no other. </p><p class="text-black text-sm leading-relaxed break-words"> As a daring scientist, your mission is to uncover the truth behind urban legends across the world. Venture into cursed zones (<span class="font-bold text-red-700">Kawasan Angker</span>), gather mysterious materials, and use them to summon and capture spectral entities. Each ghost (<span class="font-bold text-red-700">Hantu</span>) you photograph is part of a deeper mystery  from haunted folklore in Asia to chilling tales from the West. Your research may become the first scientific breakthrough in the paranormal world. <br> Use the map to locate ghost sightings, collect <span class="font-bold">Materials</span>, and capture various types of Hantu before they disappear! </p><p class="text-black text-sm leading-relaxed break-words"> This is an early <span class="font-bold text-red-700">alpha release</span>. If you encounter any strange activity (bugs or ideas), let us know at [baikuni.perdana@gmail.com]. <br> Are you ready to begin your fieldwork? </p></div>',2)),vt("div",{class:"flex justify-center mt-8"},[vt("button",{onClick:I,class:"bg-red-700 hover:bg-red-800 transition text-white font-bold py-2 px-6 rounded-lg text-lg shadow-md"}," Yes, I am ready! ")]),vt("button",{onClick:I,class:"absolute top-3 right-2 text-white text-2xl hover:text-red-400"},"  ")],4)])):jn("",!0)}},dy="./assets/geolokasi-CmThI_8d.png",XT="./assets/geolokasi_close-B0RhCIg0.png",WT={key:0,class:"absolute inset-0 z-[53] flex items-center justify-center bg-black/80"},YT={key:0,class:"flex flex-col items-center"},KT={disabled:"",class:"p-4 rounded-full shadow-lg hover:scale-110 transition border border-red-600 hover:bg-red-900"},JT=["src"],QT={key:1,class:"relative flex flex-col items-center"},eS=["src"],tS={key:2,class:"absolute bottom-10 text-center text-[20px] px-1 py-1 rounded font-horror text-red-600"},iS={__name:"Geolocator",setup(c){const y=jo("isPanningMode"),T=vn(!0),I=vn(!1),E=vn(""),z=gh(),P=Jf();let o=null;const J=()=>{z.mapInstance&&(o!==null&&navigator.geolocation.clearWatch(o),o=navigator.geolocation.watchPosition(H,ie,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}))},re=()=>{o!==null&&(navigator.geolocation.clearWatch(o),o=null)},H=Y=>{const le=z.mapInstance,{latitude:Xe,longitude:ft,heading:it}=Y.coords,Qe=Ju();Qe.updateDistance([ft,Xe],qe=>{Qe.latestUnlocked=qe});const We={type:"Feature",geometry:{type:"Point",coordinates:[ft,Xe]},properties:{heading:it??0}};le.once("moveend",()=>{const qe=le.getBounds(),Ke=16,pt=qe.getWest(),dt=qe.getEast(),Ye=qe.getSouth(),Ct=qe.getNorth(),Dt=(pt+dt)/2,ct=(Ye+Ct)/2,Pt=(dt-pt)/2,ut=(Ct-Ye)/2,Bt=[[Dt-Pt*Ke,ct-ut*Ke],[Dt+Pt*Ke,ct+ut*Ke]];P.generateMaterialData(Bt),P.generateKawasanData(Bt),le.getSource("material")&&le.getSource("material").setData(P.materialData),le.getSource("kawasan")&&le.getSource("kawasan").setData(P.kawasanData),z.setPlayerPoint(We);const qt=fy(We,100,{units:"meters"});le.getSource("user-location")?le.getSource("user-location").setData(qt):(le.addSource("user-location",{type:"geojson",data:fy($u([0,0]),100,{units:"meters"})}),le.getLayer("user-location-buffer-layer")||le.addLayer({id:"user-location-buffer-layer",type:"fill",source:"user-location",paint:{"fill-color":"rgba(255, 244, 219, 0.1)","fill-outline-color":"transparent"}})),le.getSource("player-location")?le.getSource("player-location").setData({type:"FeatureCollection",features:[We]}):(le.addSource("player-location",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),le.getLayer("user-location-icon-layer")||le.addLayer({id:"user-location-icon-layer",type:"symbol",source:"player-location",layout:{"icon-image":"user-location-icon","icon-size":.3,"icon-anchor":"center","icon-rotate":["get","heading"]},filter:["==","$type","Point"]}))}),y.value||le.jumpTo({center:[ft,Xe],zoom:17}),T.value=!1},ie=Y=>{switch(I.value=!0,Y.code){case 1:E.value="Akses lokasi ditolak. Silakan izinkan dari pengaturan browser.";break;case 2:E.value="Lokasi tidak tersedia. Coba lagi nanti atau periksa koneksi.";break;case 3:E.value="Permintaan lokasi terlalu lama. Silakan coba lagi.";break;default:E.value="Terjadi kesalahan saat mendeteksi lokasi.";break}};Ul(y,Y=>{Y?re():J()});const ce=()=>{z.mapInstance&&J()};return dh(()=>{const Y=z.mapInstance;if(Y)if(Y.hasImage("user-location-icon"))ce();else{const le=new Image;le.src=dy,le.onload=()=>{Y.addImage("user-location-icon",le),ce()}}}),(Y,le)=>T.value?(mi(),Di("div",WT,[xn(z).mapReady?T.value?(mi(),Di("div",QT,[vt("button",{onClick:J,class:"p-4 rounded-full shadow-lg hover:scale-110 transition border border-red-600 hover:bg-red-900"},[vt("img",{src:xn(dy),alt:"Geolocate",class:"w-40 h-40"},null,8,eS)]),le[1]||(le[1]=vt("span",{class:"absolute -bottom-4 bg-red-800 text-white text-[10px] font-horror px-2 py-0.5 rounded-full shadow-md"}," Penampakan ",-1))])):jn("",!0):(mi(),Di("div",YT,[vt("button",KT,[vt("img",{src:xn(XT),alt:"Geolocate",class:"w-40 h-40"},null,8,JT)]),le[0]||(le[0]=vt("p",{class:"text-white mt-2 text-sm font-horror"},"Loading map...",-1))])),I.value?(mi(),Di("span",tS,yn(E.value),1)):jn("",!0)])):jn("",!0)}};var Sf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.1/LICENSE.txt
 */var nS=Sf.exports,py;function rS(){return py||(py=1,function(c,y){(function(T,I){c.exports=I()})(nS,function(){var T={},I={};function E(P,o,J){if(I[P]=J,P==="index"){var re="var sharedModule = {}; ("+I.shared+")(sharedModule); ("+I.worker+")(sharedModule);",H={};return I.shared(H),I.index(T,H),typeof window<"u"&&T.setWorkerUrl(window.URL.createObjectURL(new Blob([re],{type:"text/javascript"}))),T}}E("shared",["exports"],function(P){function o(r,t,n,l){return new(n||(n=Promise))(function(f,_){function v(A){try{k(l.next(A))}catch(L){_(L)}}function w(A){try{k(l.throw(A))}catch(L){_(L)}}function k(A){var L;A.done?f(A.value):(L=A.value,L instanceof n?L:new n(function(O){O(L)})).then(v,w)}k((l=l.apply(r,t||[])).next())})}function J(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var re,H;function ie(){if(H)return re;function r(t,n){this.x=t,this.y=n}return H=1,re=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,l=t.y-this.y;return n*n+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),l=Math.sin(t),f=l*this.x+n*this.y;return this.x=n*this.x-l*this.y,this.y=f,this},_rotateAround:function(t,n){var l=Math.cos(t),f=Math.sin(t),_=n.y+f*(this.x-n.x)+l*(this.y-n.y);return this.x=n.x+l*(this.x-n.x)-f*(this.y-n.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t},re}typeof SuppressedError=="function"&&SuppressedError;var ce,Y,le=J(ie()),Xe=function(){if(Y)return ce;function r(t,n,l,f){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=l,this.p2y=f}return Y=1,ce=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,f=0;f<8;f++){var _=this.sampleCurveX(l)-t;if(Math.abs(_)<n)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=_/v}var w=0,k=1;for(l=t,f=0;f<20&&(_=this.sampleCurveX(l),!(Math.abs(_-t)<n));f++)t>_?w=l:k=l,l=.5*(k-w)+w;return l},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},ce}(),ft=J(Xe);let it,Qe;function tt(){return it==null&&(it=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),it}function We(){if(Qe==null&&(Qe=!1,tt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const f=4*l;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&n[l]!==l){Qe=!0;break}}}return Qe||!1}var qe=1e-6,Ke=typeof Float32Array<"u"?Float32Array:Array;function pt(){var r=new Ke(9);return Ke!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function dt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ye(){var r=new Ke(3);return Ke!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ct(r){return Math.hypot(r[0],r[1],r[2])}function Dt(r,t,n){var l=new Ke(3);return l[0]=r,l[1]=t,l[2]=n,l}function ct(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function Pt(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r}function ut(r,t,n){var l=t[0],f=t[1],_=t[2],v=n[0],w=n[1],k=n[2];return r[0]=f*k-_*w,r[1]=_*v-l*k,r[2]=l*w-f*v,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Bt,qt=Ct;function Ut(r,t,n){var l=t[0],f=t[1],_=t[2],v=t[3];return r[0]=n[0]*l+n[4]*f+n[8]*_+n[12]*v,r[1]=n[1]*l+n[5]*f+n[9]*_+n[13]*v,r[2]=n[2]*l+n[6]*f+n[10]*_+n[14]*v,r[3]=n[3]*l+n[7]*f+n[11]*_+n[15]*v,r}function ui(){var r=new Ke(4);return Ke!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Ni(r,t,n,l){var f=.5*Math.PI/180;t*=f,n*=f,l*=f;var _=Math.sin(t),v=Math.cos(t),w=Math.sin(n),k=Math.cos(n),A=Math.sin(l),L=Math.cos(l);return r[0]=_*k*L-v*w*A,r[1]=v*w*L+_*k*A,r[2]=v*k*A-_*w*L,r[3]=v*k*L+_*w*A,r}function Ot(){var r=new Ke(2);return Ke!=Float32Array&&(r[0]=0,r[1]=0),r}function Ei(r,t){var n=new Ke(2);return n[0]=r,n[1]=t,n}Ye(),Bt=new Ke(4),Ke!=Float32Array&&(Bt[0]=0,Bt[1]=0,Bt[2]=0,Bt[3]=0),Ye(),Dt(1,0,0),Dt(0,1,0),ui(),ui(),pt(),Ot();const Jt=8192;function Ui(r,t,n){return t*(Jt/(r.tileSize*Math.pow(2,n-r.tileID.overscaledZ)))}function ri(r,t){return(r%t+t)%t}function Pn(r,t,n){return r*(1-n)+t*n}function yr(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,n=t*r;return 4*(r<.5?n:3*(r-t)+n-.75)}function kr(r,t,n,l){const f=new ft(r,t,n,l);return _=>f.solve(_)}const Ne=kr(.25,.1,.25,1);function rn(r,t,n){return Math.min(n,Math.max(t,r))}function Ci(r,t,n){const l=n-t,f=((r-t)%l+l)%l+t;return f===t?n:f}function jt(r,...t){for(const n of t)for(const l in n)r[l]=n[l];return r}let q=1;function Te(r,t,n){const l={};for(const f in r)l[f]=t.call(this,r[f],f,r);return l}function Ze(r,t,n){const l={};for(const f in r)t.call(this,r[f],f,r)&&(l[f]=r[f]);return l}function ot(r){return Array.isArray(r)?r.map(ot):typeof r=="object"&&r?Te(r,ot):r}const ht={};function rt(r){ht[r]||(typeof console<"u"&&console.warn(r),ht[r]=!0)}function kt(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Re(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let It=null;function _t(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function At(r,t,n,l,f){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(r,{timestamp:0});try{const v=_?.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const w=v.startsWith("BGR"),k=new Uint8ClampedArray(l*f*4);if(yield _.copyTo(k,function(A,L,O,V,$){const Z=4*Math.max(-L,0),K=(Math.max(0,O)-O)*V*4+Z,se=4*V,he=Math.max(0,L),Ie=Math.max(0,O);return{rect:{x:he,y:Ie,width:Math.min(A.width,L+V)-he,height:Math.min(A.height,O+$)-Ie},layout:[{offset:K,stride:se}]}}(r,t,n,l,f)),w)for(let A=0;A<k.length;A+=4){const L=k[A];k[A]=k[A+2],k[A+2]=L}return k}finally{_.close()}})}let mt,Qt;function fi(r,t,n,l){return r.addEventListener(t,n,l),{unsubscribe:()=>{r.removeEventListener(t,n,l)}}}function gi(r){return r*Math.PI/180}function Et(r){return r/Math.PI*180}const sn={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},si={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Zt="AbortError";function Ee(){return new Error(Zt)}const W={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ee(r){return W.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Q="global-dispatcher";class pe extends Error{constructor(t,n,l,f){super(`AJAXError: ${n} (${t}): ${l}`),this.status=t,this.statusText=n,this.url=l,this.body=f}}const Se=()=>Re(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Pe=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const l=ee(r.url);if(l)return l(r,t);if(Re(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:Q},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(Se())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,f){return o(this,void 0,void 0,function*(){const _=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Se(),signal:f.signal});let v,w;l.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{v=yield fetch(_)}catch(A){throw new pe(0,A.message,l.url,new Blob)}if(!v.ok){const A=yield v.blob();throw new pe(v.status,v.statusText,l.url,A)}w=l.type==="arrayBuffer"||l.type==="image"?v.arrayBuffer():l.type==="json"?v.json():v.text();const k=yield w;if(f.signal.aborted)throw Ee();return{data:k,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}})}(r,t);if(Re(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:Q},t)}var n;return function(l,f){return new Promise((_,v)=>{var w;const k=new XMLHttpRequest;k.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(k.responseType="arraybuffer");for(const A in l.headers)k.setRequestHeader(A,l.headers[A]);l.type==="json"&&(k.responseType="text",!((w=l.headers)===null||w===void 0)&&w.Accept||k.setRequestHeader("Accept","application/json")),k.withCredentials=l.credentials==="include",k.onerror=()=>{v(new Error(k.statusText))},k.onload=()=>{if(!f.signal.aborted)if((k.status>=200&&k.status<300||k.status===0)&&k.response!==null){let A=k.response;if(l.type==="json")try{A=JSON.parse(k.response)}catch(L){return void v(L)}_({data:A,cacheControl:k.getResponseHeader("Cache-Control"),expires:k.getResponseHeader("Expires")})}else{const A=new Blob([k.response],{type:k.getResponseHeader("Content-Type")});v(new pe(k.status,k.statusText,l.url,A))}},f.signal.addEventListener("abort",()=>{k.abort(),v(Ee())}),k.send(l.body)})}(r,t)};function Le(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ke(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Ge(r,t,n){if(n&&n[r]){const l=n[r].indexOf(t);l!==-1&&n[r].splice(l,1)}}class Ue{constructor(t,n={}){jt(this,n),this.type=t}}class Ae extends Ue{constructor(t,n={}){super("error",jt({error:t},n))}}class et{on(t,n){return this._listeners=this._listeners||{},ke(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Ge(t,n,this._listeners),Ge(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ke(t,n,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,n){typeof t=="string"&&(t=new Ue(t,n||{}));const l=t.type;if(this.listens(l)){t.target=this;const f=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of f)w.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of _)Ge(l,w,this._oneTimeListeners),w.call(this,t);const v=this._eventedParent;v&&(jt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof Ae&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Tt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function He(r,t){const n={};for(const l in r)l!=="ref"&&(n[l]=r[l]);return Tt.forEach(l=>{l in t&&(n[l]=t[l])}),n}function Mt(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!Mt(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!Mt(r[n],t[n]))return!1;return!0}return r===t}function Ht(r,t){r.push(t)}function ii(r,t,n){Ht(n,{command:"addSource",args:[r,t[r]]})}function Bi(r,t,n){Ht(t,{command:"removeSource",args:[r]}),n[r]=!0}function Li(r,t,n,l){Bi(r,n,l),ii(r,t,n)}function Pi(r,t,n){let l;for(l in r[n])if(Object.prototype.hasOwnProperty.call(r[n],l)&&l!=="data"&&!Mt(r[n][l],t[n][l]))return!1;for(l in t[n])if(Object.prototype.hasOwnProperty.call(t[n],l)&&l!=="data"&&!Mt(r[n][l],t[n][l]))return!1;return!0}function Yt(r,t,n,l,f,_){r=r||{},t=t||{};for(const v in r)Object.prototype.hasOwnProperty.call(r,v)&&(Mt(r[v],t[v])||n.push({command:_,args:[l,v,t[v],f]}));for(const v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(r,v)&&(Mt(r[v],t[v])||n.push({command:_,args:[l,v,t[v],f]}))}function xi(r){return r.id}function dn(r,t){return r[t.id]=t,r}class xt{constructor(t,n,l,f){this.message=(t?`${t}: `:"")+l,f&&(this.identifier=f),n!=null&&n.__line__&&(this.line=n.__line__)}}function Mn(r,...t){for(const n of t)for(const l in n)r[l]=n[l];return r}class Ki extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class wn{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[l,f]of n)this.bindings[l]=f}concat(t){return new wn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const rs={kind:"null"},bt={kind:"number"},oi={kind:"string"},li={kind:"boolean"},er={kind:"color"},js={kind:"projectionDefinition"},cr={kind:"object"},Wt={kind:"value"},ss={kind:"collator"},Vs={kind:"formatted"},Ji={kind:"padding"},as={kind:"colorArray"},Us={kind:"numberArray"},Or={kind:"resolvedImage"},la={kind:"variableAnchorOffsetCollection"};function vr(r,t){return{kind:"array",itemType:r,N:t}}function Ai(r){if(r.kind==="array"){const t=Ai(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const Gs=[rs,bt,oi,li,er,js,Vs,cr,vr(Wt),Ji,Us,as,Or,la];function qs(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!qs(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of Gs)if(!qs(n,t))return null}}return`Expected ${Ai(r)} but found ${Ai(t)} instead.`}function os(r,t){return t.some(n=>n.kind===r.kind)}function ls(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function ws(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const $l=.96422,Zl=.82521,$o=4/29,$s=6/29,La=3*$s*$s,Kr=$s*$s*$s,Er=Math.PI/180,Hl=180/Math.PI;function Zs(r){return(r%=360)<0&&(r+=360),r}function ua([r,t,n,l]){let f,_;const v=Ho((.2225045*(r=Zo(r))+.7168786*(t=Zo(t))+.0606169*(n=Zo(n)))/1);r===t&&t===n?f=_=v:(f=Ho((.4360747*r+.3850649*t+.1430804*n)/$l),_=Ho((.0139322*r+.0971045*t+.7141733*n)/Zl));const w=116*v-16;return[w<0?0:w,500*(f-v),200*(v-_),l]}function Zo(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ho(r){return r>Kr?Math.pow(r,1/3):r/La+$o}function Xl([r,t,n,l]){let f=(r+16)/116,_=isNaN(t)?f:f+t/500,v=isNaN(n)?f:f-n/200;return f=1*Ts(f),_=$l*Ts(_),v=Zl*Ts(v),[Da(3.1338561*_-1.6168667*f-.4906146*v),Da(-.9787684*_+1.9161415*f+.033454*v),Da(.0719453*_-.2289914*f+1.4052427*v),l]}function Da(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Ts(r){return r>$s?r*r*r:La*(r-$o)}const Fr=Object.hasOwn||function(r,t){return Object.prototype.hasOwnProperty.call(r,t)};function yi(r,t){return Fr(r,t)?r[t]:void 0}function Jr(r){return parseInt(r.padEnd(2,r),16)/255}function us(r,t){return cs(t?r/100:r,0,1)}function cs(r,t,n){return Math.min(Math.max(t,r),n)}function $i(r){return!r.some(Number.isNaN)}const hs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Cr(r,t,n){return r+n*(t-r)}function Br(r,t,n){return r.map((l,f)=>Cr(l,t[f],n))}class ai{constructor(t,n,l,f=1,_=!0){this.r=t,this.g=n,this.b=l,this.a=f,_||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,n,l,f]))}static parse(t){if(t instanceof ai)return t;if(typeof t!="string")return;const n=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=yi(hs,l);if(f){const[v,w,k]=f;return[v/255,w/255,k/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const v=l.length<6?1:2;let w=1;return[Jr(l.slice(w,w+=v)),Jr(l.slice(w,w+=v)),Jr(l.slice(w,w+=v)),Jr(l.slice(w,w+v)||"ff")]}if(l.startsWith("rgb")){const v=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,k,A,L,O,V,$,Z,K,se,he,Ie]=v,ye=[L||" ",$||" ",se].join("");if(ye==="  "||ye==="  /"||ye===",,"||ye===",,,"){const G=[A,V,K].join(""),ne=G==="%%%"?100:G===""?255:0;if(ne){const ve=[cs(+k/ne,0,1),cs(+O/ne,0,1),cs(+Z/ne,0,1),he?us(+he,Ie):1];if($i(ve))return ve}}return}}const _=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,w,k,A,L,O,V,$,Z]=_,K=[k||" ",L||" ",V].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const se=[+w,cs(+A,0,100),cs(+O,0,100),$?us(+$,Z):1];if($i(se))return function([he,Ie,ye,G]){function ne(ve){const Oe=(ve+he/30)%12,nt=Ie*Math.min(ye,1-ye);return ye-nt*Math.max(-1,Math.min(Oe-3,9-Oe,1))}return he=Zs(he),Ie/=100,ye/=100,[ne(0),ne(8),ne(4),G]}(se)}}}(t);return n?new ai(...n,!1):void 0}get rgb(){const{r:t,g:n,b:l,a:f}=this,_=f||1/0;return this.overwriteGetter("rgb",[t/_,n/_,l/_,f])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,l,f,_]=ua(t),v=Math.sqrt(l*l+f*f);return[Math.round(1e4*v)?Zs(Math.atan2(f,l)*Hl):NaN,v,n,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ua(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,l,f]=this.rgb;return`rgba(${[t,n,l].map(_=>Math.round(255*_)).join(",")},${f})`}static interpolate(t,n,l,f="rgb"){switch(f){case"rgb":{const[_,v,w,k]=Br(t.rgb,n.rgb,l);return new ai(_,v,w,k,!1)}case"hcl":{const[_,v,w,k]=t.hcl,[A,L,O,V]=n.hcl;let $,Z;if(isNaN(_)||isNaN(A))isNaN(_)?isNaN(A)?$=NaN:($=A,w!==1&&w!==0||(Z=L)):($=_,O!==1&&O!==0||(Z=v));else{let ye=A-_;A>_&&ye>180?ye-=360:A<_&&_-A>180&&(ye+=360),$=_+l*ye}const[K,se,he,Ie]=function([ye,G,ne,ve]){return ye=isNaN(ye)?0:ye*Er,Xl([ne,Math.cos(ye)*G,Math.sin(ye)*G,ve])}([$,Z??Cr(v,L,l),Cr(w,O,l),Cr(k,V,l)]);return new ai(K,se,he,Ie,!1)}case"lab":{const[_,v,w,k]=Xl(Br(t.lab,n.lab,l));return new ai(_,v,w,k,!1)}}}}ai.black=new ai(0,0,0,1),ai.white=new ai(1,1,1,1),ai.transparent=new ai(0,0,0,0),ai.red=new ai(1,0,0,1);class Un{constructor(t,n,l){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Hs=["bottom","center","top"];class Xo{constructor(t,n,l,f,_,v){this.text=t,this.image=n,this.scale=l,this.fontStack=f,this.textColor=_,this.verticalAlign=v}}class Gn{constructor(t){this.sections=t}static fromString(t){return new Gn([new Xo(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Gn?t:Gn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class pn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof pn)return t;if(typeof t=="number")return new pn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new pn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,l){return new pn(Br(t.values,n.values,l))}}class In{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof In)return t;if(typeof t=="number")return new In([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new In(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,l){return new In(Br(t.values,n.values,l))}}class An{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof An)return t;if(typeof t=="string"){const l=ai.parse(t);return l?new An([l]):void 0}if(!Array.isArray(t))return;const n=[];for(const l of t){if(typeof l!="string")return;const f=ai.parse(l);if(!f)return;n.push(f)}return new An(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,l,f="rgb"){const _=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let v=0;v<t.values.length;v++)_.push(ai.interpolate(t.values[v],n.values[v],l,f));return new An(_)}}class Wi extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Ri=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class di{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof di)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const l=t[n],f=t[n+1];if(typeof l!="string"||!Ri.has(l)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new di(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,l){const f=t.values,_=n.values;if(f.length!==_.length)throw new Wi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const v=[];for(let w=0;w<f.length;w+=2){if(f[w]!==_[w])throw new Wi(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${_[w]}`);v.push(f[w]);const[k,A]=f[w+1],[L,O]=_[w+1];v.push([Cr(k,L,l),Cr(A,O,l)])}return new di(v)}}class qn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new qn({name:t,available:!1}):null}}class ci{constructor(t,n,l){this.from=t,this.to=n,this.transition=l}static interpolate(t,n,l){return new ci(t,n,l)}static parse(t){return t instanceof ci?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new ci(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new ci(t.from,t.to,t.transition):typeof t=="string"?new ci(t,t,1):void 0}}function hi(r,t,n,l){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,t,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,t,n,l]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ss(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof ci||r instanceof ai||r instanceof Un||r instanceof Gn||r instanceof pn||r instanceof In||r instanceof An||r instanceof di||r instanceof qn)return!0;if(Array.isArray(r)){for(const t of r)if(!Ss(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Ss(r[t]))return!1;return!0}return!1}function Vt(r){if(r===null)return rs;if(typeof r=="string")return oi;if(typeof r=="boolean")return li;if(typeof r=="number")return bt;if(r instanceof ai)return er;if(r instanceof ci)return js;if(r instanceof Un)return ss;if(r instanceof Gn)return Vs;if(r instanceof pn)return Ji;if(r instanceof In)return Us;if(r instanceof An)return as;if(r instanceof di)return la;if(r instanceof qn)return Or;if(Array.isArray(r)){const t=r.length;let n;for(const l of r){const f=Vt(l);if(n){if(n===f)continue;n=Wt;break}n=f}return vr(n||Wt,t)}return cr}function Is(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof ai||r instanceof ci||r instanceof Gn||r instanceof pn||r instanceof In||r instanceof An||r instanceof di||r instanceof qn?r.toString():JSON.stringify(r)}class zn{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ss(t[1]))return n.error("invalid value");const l=t[1];let f=Vt(l);const _=n.expectedType;return f.kind!=="array"||f.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(f=_),new zn(f,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Xs={string:oi,number:bt,boolean:li,object:cr};class tr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let l,f=1;const _=t[0];if(_==="array"){let w,k;if(t.length>2){const A=t[1];if(typeof A!="string"||!(A in Xs)||A==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=Xs[A],f++}else w=Wt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);k=t[2],f++}l=vr(w,k)}else{if(!Xs[_])throw new Error(`Types doesn't contain name = ${_}`);l=Xs[_]}const v=[];for(;f<t.length;f++){const w=n.parse(t[f],f,Wt);if(!w)return null;v.push(w)}return new tr(l,v)}evaluate(t){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(t);if(!qs(this.type,Vt(l)))return l;if(n===this.args.length-1)throw new Wi(`Expected value to be of type ${Ai(this.type)}, but found ${Ai(Vt(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Wo={"to-boolean":li,"to-color":er,"to-number":bt,"to-string":oi};class jr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const l=t[0];if(!Wo[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return n.error("Expected one argument.");const f=Wo[l],_=[];for(let v=1;v<t.length;v++){const w=n.parse(t[v],v,Wt);if(!w)return null;_.push(w)}return new jr(f,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,l;for(const f of this.args){if(n=f.evaluate(t),l=null,n instanceof ai)return n;if(typeof n=="string"){const _=t.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:hi(n[0],n[1],n[2],n[3]),!l))return new ai(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Wi(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(t);const f=pn.parse(n);if(f)return f}throw new Wi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const l of this.args){n=l.evaluate(t);const f=In.parse(n);if(f)return f}throw new Wi(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const l of this.args){n=l.evaluate(t);const f=An.parse(n);if(f)return f}throw new Wi(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(t);const f=di.parse(n);if(f)return f}throw new Wi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(t),n===null)return 0;const f=Number(n);if(!isNaN(f))return f}throw new Wi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Gn.fromString(Is(this.args[0].evaluate(t)));case"resolvedImage":return qn.fromString(Is(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Is(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Qr=["Unknown","Point","LineString","Polygon"];class za{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=ai.parse(t),this._parseColorCache.set(t,n)),n}}class Na{constructor(t,n,l=[],f,_=new wn,v=[]){this.registry=t,this.path=l,this.key=l.map(w=>`[${w}]`).join(""),this.scope=_,this.errors=v,this.expectedType=f,this._isConstant=n}parse(t,n,l,f,_={}){return n?this.concat(n,l,f)._parse(t,_):this._parse(t,_)}_parse(t,n){function l(f,_,v){return v==="assert"?new tr(_,[f]):v==="coerce"?new jr(_,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[f];if(_){let v=_.parse(t,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,k=v.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||k.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(k.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(k.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(k.kind)||w.kind==="colorArray"&&["value","string","array"].includes(k.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(k.kind))v=l(v,w,n.typeAnnotation||"coerce");else if(this.checkSubtype(w,k))return null}else v=l(v,w,n.typeAnnotation||"assert")}if(!(v instanceof zn)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const w=new za;try{v=new zn(v.type,v.evaluate(w))}catch(k){return this.error(k.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,l){const f=typeof t=="number"?this.path.concat(t):this.path,_=l?this.scope.concat(l):this.scope;return new Na(this.registry,this._isConstant,f,n||null,_,this.errors)}error(t,...n){const l=`${this.key}${n.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ki(l,t))}checkSubtype(t,n){const l=qs(t,n);return l&&this.error(l),l}}class $n{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return n.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=n.parse(t[_+1],_+1);if(!w)return null;l.push([v,w])}const f=n.parse(t[t.length-1],t.length-1,n.expectedType,l);return f?new $n(l,f):null}outputDefined(){return this.result.outputDefined()}}class Zn{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=t[1];return n.scope.has(l)?new Zn(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Rn{constructor(t,n,l){this.type=t,this.index=n,this.input=l}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,bt),f=n.parse(t[2],2,vr(n.expectedType||Wt));return l&&f?new Rn(f.type.itemType,l,f):null}evaluate(t){const n=this.index.evaluate(t),l=this.input.evaluate(t);if(n<0)throw new Wi(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new Wi(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new Wi(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Vr{constructor(t,n){this.type=li,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,Wt),f=n.parse(t[2],2,Wt);return l&&f?os(l.type,[li,oi,bt,rs,Wt])?new Vr(l,f):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(l.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!ls(n,["boolean","string","number","null"]))throw new Wi(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(Vt(n))} instead.`);if(!ls(l,["string","array"]))throw new Wi(`Expected second argument to be of type array or string, but found ${Ai(Vt(l))} instead.`);return l.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ca{constructor(t,n,l){this.type=bt,this.needle=t,this.haystack=n,this.fromIndex=l}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,Wt),f=n.parse(t[2],2,Wt);if(!l||!f)return null;if(!os(l.type,[li,oi,bt,rs,Wt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(l.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,bt);return _?new ca(l,f,_):null}return new ca(l,f)}evaluate(t){const n=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!ls(n,["boolean","string","number","null"]))throw new Wi(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(Vt(n))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(t)),ls(l,["string"])){const _=l.indexOf(n,f);return _===-1?-1:[...l.slice(0,_)].length}if(ls(l,["array"]))return l.indexOf(n,f);throw new Wi(`Expected second argument to be of type array or string, but found ${Ai(Vt(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Ur{constructor(t,n,l,f,_,v){this.inputType=t,this.type=n,this.input=l,this.cases=f,this.outputs=_,this.otherwise=v}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let l,f;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);const _={},v=[];for(let A=2;A<t.length-1;A+=2){let L=t[A];const O=t[A+1];Array.isArray(L)||(L=[L]);const V=n.concat(A);if(L.length===0)return V.error("Expected at least one branch label.");for(const Z of L){if(typeof Z!="number"&&typeof Z!="string")return V.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return V.error("Numeric branch labels must be integer values.");if(l){if(V.checkSubtype(l,Vt(Z)))return null}else l=Vt(Z);if(_[String(Z)]!==void 0)return V.error("Branch labels must be unique.");_[String(Z)]=v.length}const $=n.parse(O,A,f);if(!$)return null;f=f||$.type,v.push($)}const w=n.parse(t[1],1,Wt);if(!w)return null;const k=n.parse(t[t.length-1],t.length-1,f);return k?w.type.kind!=="value"&&n.concat(1).checkSubtype(l,w.type)?null:new Ur(l,f,w,_,v,k):null}evaluate(t){const n=this.input.evaluate(t);return(Vt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Tn{constructor(t,n,l){this.type=t,this.branches=n,this.otherwise=l}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const f=[];for(let v=1;v<t.length-1;v+=2){const w=n.parse(t[v],v,li);if(!w)return null;const k=n.parse(t[v+1],v+1,l);if(!k)return null;f.push([w,k]),l=l||k.type}const _=n.parse(t[t.length-1],t.length-1,l);if(!_)return null;if(!l)throw new Error("Can't infer output type");return new Tn(l,f,_)}evaluate(t){for(const[n,l]of this.branches)if(n.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,l]of this.branches)t(n),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class hr{constructor(t,n,l,f){this.type=t,this.input=n,this.beginIndex=l,this.endIndex=f}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,Wt),f=n.parse(t[2],2,bt);if(!l||!f)return null;if(!os(l.type,[vr(Wt),oi,Wt]))return n.error(`Expected first argument to be of type array or string, but found ${Ai(l.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,bt);return _?new hr(l.type,l,f,_):null}return new hr(l.type,l,f)}evaluate(t){const n=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let f;if(this.endIndex&&(f=this.endIndex.evaluate(t)),ls(n,["string"]))return[...n].slice(l,f).join("");if(ls(n,["array"]))return n.slice(l,f);throw new Wi(`Expected first argument to be of type array or string, but found ${Ai(Vt(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ws(r,t){const n=r.length-1;let l,f,_=0,v=n,w=0;for(;_<=v;)if(w=Math.floor((_+v)/2),l=r[w],f=r[w+1],l<=t){if(w===n||t<f)return w;_=w+1}else{if(!(l>t))throw new Wi("Input is not a number.");v=w-1}return 0}class ha{constructor(t,n,l){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[f,_]of l)this.labels.push(f),this.outputs.push(_)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(t[1],1,bt);if(!l)return null;const f=[];let _=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let v=1;v<t.length;v+=2){const w=v===1?-1/0:t[v],k=t[v+1],A=v,L=v+1;if(typeof w!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const O=n.parse(k,L,_);if(!O)return null;_=_||O.type,f.push([w,O])}return new ha(_,l,f)}evaluate(t){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(t);const f=this.input.evaluate(t);if(f<=n[0])return l[0].evaluate(t);const _=n.length;return f>=n[_-1]?l[_-1].evaluate(t):l[Ws(n,f)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Qu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ks,Oa,Yo=function(){if(Oa)return ks;function r(t,n,l,f){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=l,this.p2y=f}return Oa=1,ks=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,f=0;f<8;f++){var _=this.sampleCurveX(l)-t;if(Math.abs(_)<n)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=_/v}var w=0,k=1;for(l=t,f=0;f<20&&(_=this.sampleCurveX(l),!(Math.abs(_-t)<n));f++)t>_?w=l:k=l,l=.5*(k-w)+w;return l},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},ks}(),ec=Qu(Yo);class ir{constructor(t,n,l,f,_){this.type=t,this.operator=n,this.interpolation=l,this.input=f,this.labels=[],this.outputs=[];for(const[v,w]of _)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(t,n,l,f){let _=0;if(t.name==="exponential")_=Pr(n,t.base,l,f);else if(t.name==="linear")_=Pr(n,1,l,f);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new ec(v[0],v[1],v[2],v[3]).solve(Pr(n,1,l,f))}return _}static parse(t,n){let[l,f,_,...v]=t;if(!Array.isArray(f)||f.length===0)return n.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const A=f[1];if(typeof A!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:A}}else{if(f[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const A=f.slice(1);if(A.length!==4||A.some(L=>typeof L!="number"||L<0||L>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,bt),!_)return null;const w=[];let k=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||n.expectedType==as?n.expectedType&&n.expectedType.kind!=="value"&&(k=n.expectedType):k=er;for(let A=0;A<v.length;A+=2){const L=v[A],O=v[A+1],V=A+3,$=A+4;if(typeof L!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(w.length&&w[w.length-1][0]>=L)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const Z=n.parse(O,$,k);if(!Z)return null;k=k||Z.type,w.push([L,Z])}return ws(k,bt)||ws(k,js)||ws(k,er)||ws(k,Ji)||ws(k,Us)||ws(k,as)||ws(k,la)||ws(k,vr(bt))?new ir(k,l,f,_,w):n.error(`Type ${Ai(k)} is not interpolatable.`)}evaluate(t){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(t);const f=this.input.evaluate(t);if(f<=n[0])return l[0].evaluate(t);const _=n.length;if(f>=n[_-1])return l[_-1].evaluate(t);const v=Ws(n,f),w=ir.interpolationFactor(this.interpolation,f,n[v],n[v+1]),k=l[v].evaluate(t),A=l[v+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Cr(k,A,w);case"color":return ai.interpolate(k,A,w);case"padding":return pn.interpolate(k,A,w);case"colorArray":return An.interpolate(k,A,w);case"numberArray":return In.interpolate(k,A,w);case"variableAnchorOffsetCollection":return di.interpolate(k,A,w);case"array":return Br(k,A,w);case"projectionDefinition":return ci.interpolate(k,A,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return ai.interpolate(k,A,w,"hcl");case"colorArray":return An.interpolate(k,A,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ai.interpolate(k,A,w,"lab");case"colorArray":return An.interpolate(k,A,w,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Pr(r,t,n,l){const f=l-n,_=r-n;return f===0?0:t===1?_/f:(Math.pow(t,_)-1)/(Math.pow(t,f)-1)}const Yi={color:ai.interpolate,number:Cr,padding:pn.interpolate,numberArray:In.interpolate,colorArray:An.interpolate,variableAnchorOffsetCollection:di.interpolate,array:Br};class fr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let l=null;const f=n.expectedType;f&&f.kind!=="value"&&(l=f);const _=[];for(const w of t.slice(1)){const k=n.parse(w,1+_.length,l,void 0,{typeAnnotation:"omit"});if(!k)return null;l=l||k.type,_.push(k)}if(!l)throw new Error("No output type");const v=f&&_.some(w=>qs(f,w.type));return new fr(v?Wt:l,_)}evaluate(t){let n,l=null,f=0;for(const _ of this.args)if(f++,l=_.evaluate(t),l&&l instanceof qn&&!l.available&&(n||(n=l.name),l=null,f===this.args.length&&(l=n)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function ao(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Fa(r,t,n,l){return l.compare(t,n)===0}function Es(r,t,n){const l=r!=="=="&&r!=="!=";return class x0{constructor(_,v,w){this.type=li,this.lhs=_,this.rhs=v,this.collator=w,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const w=_[0];let k=v.parse(_[1],1,Wt);if(!k)return null;if(!ao(w,k.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${Ai(k.type)}'.`);let A=v.parse(_[2],2,Wt);if(!A)return null;if(!ao(w,A.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${Ai(A.type)}'.`);if(k.type.kind!==A.type.kind&&k.type.kind!=="value"&&A.type.kind!=="value")return v.error(`Cannot compare types '${Ai(k.type)}' and '${Ai(A.type)}'.`);l&&(k.type.kind==="value"&&A.type.kind!=="value"?k=new tr(A.type,[k]):k.type.kind!=="value"&&A.type.kind==="value"&&(A=new tr(k.type,[A])));let L=null;if(_.length===4){if(k.type.kind!=="string"&&A.type.kind!=="string"&&k.type.kind!=="value"&&A.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(L=v.parse(_[3],3,ss),!L)return null}return new x0(k,A,L)}evaluate(_){const v=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(l&&this.hasUntypedArgument){const k=Vt(v),A=Vt(w);if(k.kind!==A.kind||k.kind!=="string"&&k.kind!=="number")throw new Wi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${k.kind}, ${A.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const k=Vt(v),A=Vt(w);if(k.kind!=="string"||A.kind!=="string")return t(_,v,w)}return this.collator?n(_,v,w,this.collator.evaluate(_)):t(_,v,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const oo=Es("==",function(r,t,n){return t===n},Fa),Ko=Es("!=",function(r,t,n){return t!==n},function(r,t,n,l){return!Fa(0,t,n,l)}),Wl=Es("<",function(r,t,n){return t<n},function(r,t,n,l){return l.compare(t,n)<0}),Gr=Es(">",function(r,t,n){return t>n},function(r,t,n,l){return l.compare(t,n)>0}),Yl=Es("<=",function(r,t,n){return t<=n},function(r,t,n,l){return l.compare(t,n)<=0}),Hn=Es(">=",function(r,t,n){return t>=n},function(r,t,n,l){return l.compare(t,n)>=0});class Cs{constructor(t,n,l){this.type=ss,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const f=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,li);if(!f)return null;const _=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,li);if(!_)return null;let v=null;return l.locale&&(v=n.parse(l.locale,1,oi),!v)?null:new Cs(f,_,v)}evaluate(t){return new Un(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class lo{constructor(t,n,l,f,_){this.type=oi,this.number=t,this.locale=n,this.currency=l,this.minFractionDigits=f,this.maxFractionDigits=_}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const l=n.parse(t[1],1,bt);if(!l)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return n.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=n.parse(f.locale,1,oi),!_))return null;let v=null;if(f.currency&&(v=n.parse(f.currency,1,oi),!v))return null;let w=null;if(f["min-fraction-digits"]&&(w=n.parse(f["min-fraction-digits"],1,bt),!w))return null;let k=null;return f["max-fraction-digits"]&&(k=n.parse(f["max-fraction-digits"],1,bt),!k)?null:new lo(l,_,v,w,k)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class fa{constructor(t){this.type=Vs,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const f=[];let _=!1;for(let v=1;v<=t.length-1;++v){const w=t[v];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;let k=null;if(w["font-scale"]&&(k=n.parse(w["font-scale"],1,bt),!k))return null;let A=null;if(w["text-font"]&&(A=n.parse(w["text-font"],1,vr(oi)),!A))return null;let L=null;if(w["text-color"]&&(L=n.parse(w["text-color"],1,er),!L))return null;let O=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!Hs.includes(w["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(O=n.parse(w["vertical-align"],1,oi),!O)return null}const V=f[f.length-1];V.scale=k,V.font=A,V.textColor=L,V.verticalAlign=O}else{const k=n.parse(t[v],1,Wt);if(!k)return null;const A=k.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:k,scale:null,font:null,textColor:null,verticalAlign:null})}}return new fa(f)}evaluate(t){return new Gn(this.sections.map(n=>{const l=n.content.evaluate(t);return Vt(l)===Or?new Xo("",l,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new Xo(Is(l),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class uo{constructor(t){this.type=Or,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const l=n.parse(t[1],1,oi);return l?new uo(l):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),l=qn.fromString(n);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(n)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ba{constructor(t){this.type=bt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=n.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ai(l.type)} instead.`):new Ba(l):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Wi(`Expected value to be of type string or array, but found ${Ai(Vt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Mr=8192;function tc(r,t){const n=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(n*f*Mr),Math.round(l*f*Mr)]}function Jo(r,t){const n=Math.pow(2,t.z);return[(f=(r[0]/Mr+t.x)/n,360*f-180),(l=(r[1]/Mr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,f}function ja(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Va(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Kl(r,t,n){const l=r[0]-t[0],f=r[1]-t[1],_=r[0]-n[0],v=r[1]-n[1];return l*v-_*f==0&&l*_<=0&&f*v<=0}function Ua(r,t,n,l){return(f=[l[0]-n[0],l[1]-n[1]])[0]*(_=[t[0]-r[0],t[1]-r[1]])[1]-f[1]*_[0]!=0&&!(!co(r,t,n,l)||!co(n,l,r,t));var f,_}function Jl(r,t,n){for(const l of n)for(let f=0;f<l.length-1;++f)if(Ua(r,t,l[f],l[f+1]))return!0;return!1}function da(r,t,n=!1){let l=!1;for(const w of t)for(let k=0;k<w.length-1;k++){if(Kl(r,w[k],w[k+1]))return n;(_=w[k])[1]>(f=r)[1]!=(v=w[k+1])[1]>f[1]&&f[0]<(v[0]-_[0])*(f[1]-_[1])/(v[1]-_[1])+_[0]&&(l=!l)}var f,_,v;return l}function Ql(r,t){for(const n of t)if(da(r,n))return!0;return!1}function eu(r,t){for(const n of r)if(!da(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Jl(r[n],r[n+1],t))return!1;return!0}function tu(r,t){for(const n of t)if(eu(r,n))return!0;return!1}function co(r,t,n,l){const f=l[0]-n[0],_=l[1]-n[1],v=(r[0]-n[0])*_-f*(r[1]-n[1]),w=(t[0]-n[0])*_-f*(t[1]-n[1]);return v>0&&w<0||v<0&&w>0}function Qo(r,t,n){const l=[];for(let f=0;f<r.length;f++){const _=[];for(let v=0;v<r[f].length;v++){const w=tc(r[f][v],n);ja(t,w),_.push(w)}l.push(_)}return l}function iu(r,t,n){const l=[];for(let f=0;f<r.length;f++){const _=Qo(r[f],t,n);l.push(_)}return l}function nu(r,t,n,l){if(r[0]<n[0]||r[0]>n[2]){const f=.5*l;let _=r[0]-n[0]>f?-l:n[0]-r[0]>f?l:0;_===0&&(_=r[0]-n[2]>f?-l:n[2]-r[0]>f?l:0),r[0]+=_}ja(t,r)}function el(r,t,n,l){const f=Math.pow(2,l.z)*Mr,_=[l.x*Mr,l.y*Mr],v=[];for(const w of r)for(const k of w){const A=[k.x+_[0],k.y+_[1]];nu(A,t,n,f),v.push(A)}return v}function tl(r,t,n,l){const f=Math.pow(2,l.z)*Mr,_=[l.x*Mr,l.y*Mr],v=[];for(const k of r){const A=[];for(const L of k){const O=[L.x+_[0],L.y+_[1]];ja(t,O),A.push(O)}v.push(A)}if(t[2]-t[0]<=f/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const k of v)for(const A of k)nu(A,t,n,f)}var w;return v}class Ys{constructor(t,n){this.type=li,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ss(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const f=[];for(const _ of l.features){const{type:v,coordinates:w}=_.geometry;v==="Polygon"&&f.push(w),v==="MultiPolygon"&&f.push(...w)}if(f.length)return new Ys(l,{type:"MultiPolygon",coordinates:f})}else if(l.type==="Feature"){const f=l.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Ys(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Ys(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,l){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=n.canonicalID();if(l.type==="Polygon"){const w=Qo(l.coordinates,_,v),k=el(n.geometry(),f,_,v);if(!Va(f,_))return!1;for(const A of k)if(!da(A,w))return!1}if(l.type==="MultiPolygon"){const w=iu(l.coordinates,_,v),k=el(n.geometry(),f,_,v);if(!Va(f,_))return!1;for(const A of k)if(!Ql(A,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,l){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=n.canonicalID();if(l.type==="Polygon"){const w=Qo(l.coordinates,_,v),k=tl(n.geometry(),f,_,v);if(!Va(f,_))return!1;for(const A of k)if(!eu(A,w))return!1}if(l.type==="MultiPolygon"){const w=iu(l.coordinates,_,v),k=tl(n.geometry(),f,_,v);if(!Va(f,_))return!1;for(const A of k)if(!tu(A,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let il=class{constructor(r=[],t=(n,l)=>n<l?-1:n>l?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,l=t[r];for(;r>0;){const f=r-1>>1,_=t[f];if(n(l,_)>=0)break;t[r]=_,r=f}t[r]=l}_down(r){const{data:t,compare:n}=this,l=this.length>>1,f=t[r];for(;r<l;){let _=1+(r<<1);const v=_+1;if(v<this.length&&n(t[v],t[_])<0&&(_=v),n(t[_],f)>=0)break;t[r]=t[_],r=_}t[r]=f}};function ho(r,t,n=0,l=r.length-1,f=ic){for(;l>n;){if(l-n>600){const k=l-n+1,A=t-n+1,L=Math.log(k),O=.5*Math.exp(2*L/3),V=.5*Math.sqrt(L*O*(k-O)/k)*(A-k/2<0?-1:1);ho(r,t,Math.max(n,Math.floor(t-A*O/k+V)),Math.min(l,Math.floor(t+(k-A)*O/k+V)),f)}const _=r[t];let v=n,w=l;for(Ks(r,n,t),f(r[l],_)>0&&Ks(r,n,l);v<w;){for(Ks(r,v,w),v++,w--;f(r[v],_)<0;)v++;for(;f(r[w],_)>0;)w--}f(r[n],_)===0?Ks(r,n,w):(w++,Ks(r,w,l)),w<=t&&(n=w+1),t<=w&&(l=w-1)}}function Ks(r,t,n){const l=r[t];r[t]=r[n],r[n]=l}function ic(r,t){return r<t?-1:r>t?1:0}function Ga(r,t){if(r.length<=1)return[r];const n=[];let l,f;for(const _ of r){const v=ru(_);v!==0&&(_.area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(l&&n.push(l),l=[_]):l.push(_))}if(l&&n.push(l),t>1)for(let _=0;_<n.length;_++)n[_].length<=t||(ho(n[_],t,1,n[_].length-1,nl),n[_]=n[_].slice(0,t));return n}function nl(r,t){return t.area-r.area}function ru(r){let t=0;for(let n,l,f=0,_=r.length,v=_-1;f<_;v=f++)n=r[f],l=r[v],t+=(l.x-n.x)*(n.y+l.y);return t}const rl=1/298.257223563,sl=rl*(2-rl),su=Math.PI/180;class al{constructor(t){const n=6378.137*su*1e3,l=Math.cos(t*su),f=1/(1-sl*(1-l*l)),_=Math.sqrt(f);this.kx=n*_*l,this.ky=n*_*f*(1-sl)}distance(t,n){const l=this.wrap(t[0]-n[0])*this.kx,f=(t[1]-n[1])*this.ky;return Math.sqrt(l*l+f*f)}pointOnLine(t,n){let l,f,_,v,w=1/0;for(let k=0;k<t.length-1;k++){let A=t[k][0],L=t[k][1],O=this.wrap(t[k+1][0]-A)*this.kx,V=(t[k+1][1]-L)*this.ky,$=0;O===0&&V===0||($=(this.wrap(n[0]-A)*this.kx*O+(n[1]-L)*this.ky*V)/(O*O+V*V),$>1?(A=t[k+1][0],L=t[k+1][1]):$>0&&(A+=O/this.kx*$,L+=V/this.ky*$)),O=this.wrap(n[0]-A)*this.kx,V=(n[1]-L)*this.ky;const Z=O*O+V*V;Z<w&&(w=Z,l=A,f=L,_=k,v=$)}return{point:[l,f],index:_,t:Math.max(0,Math.min(1,v))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function wi(r,t){return t[0]-r[0]}function fo(r){return r[1]-r[0]+1}function es(r,t){return r[1]>=r[0]&&r[1]<t}function dr(r,t){if(r[0]>r[1])return[null,null];const n=fo(r);if(t){if(n===2)return[r,null];const f=Math.floor(n/2);return[[r[0],r[0]+f],[r[0]+f,r[1]]]}if(n===1)return[r,null];const l=Math.floor(n/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}function Ar(r,t){if(!es(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)ja(n,r[l]);return n}function p(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const l of n)ja(t,l);return t}function s(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function a(r,t,n){if(!s(r)||!s(t))return NaN;let l=0,f=0;return r[2]<t[0]&&(l=t[0]-r[2]),r[0]>t[2]&&(l=r[0]-t[2]),r[1]>t[3]&&(f=r[1]-t[3]),r[3]<t[1]&&(f=t[1]-r[3]),n.distance([0,0],[l,f])}function d(r,t,n){const l=n.pointOnLine(t,r);return n.distance(r,l.point)}function b(r,t,n,l,f){const _=Math.min(d(r,[n,l],f),d(t,[n,l],f)),v=Math.min(d(n,[r,t],f),d(l,[r,t],f));return Math.min(_,v)}function M(r,t,n,l,f){if(!es(t,r.length)||!es(l,n.length))return 1/0;let _=1/0;for(let v=t[0];v<t[1];++v){const w=r[v],k=r[v+1];for(let A=l[0];A<l[1];++A){const L=n[A],O=n[A+1];if(Ua(w,k,L,O))return 0;_=Math.min(_,b(w,k,L,O,f))}}return _}function N(r,t,n,l,f){if(!es(t,r.length)||!es(l,n.length))return NaN;let _=1/0;for(let v=t[0];v<=t[1];++v)for(let w=l[0];w<=l[1];++w)if(_=Math.min(_,f.distance(r[v],n[w])),_===0)return _;return _}function j(r,t,n){if(da(r,t,!0))return 0;let l=1/0;for(const f of t){const _=f[0],v=f[f.length-1];if(_!==v&&(l=Math.min(l,d(r,[v,_],n)),l===0))return l;const w=n.pointOnLine(f,r);if(l=Math.min(l,n.distance(r,w.point)),l===0)return l}return l}function te(r,t,n,l){if(!es(t,r.length))return NaN;for(let _=t[0];_<=t[1];++_)if(da(r[_],n,!0))return 0;let f=1/0;for(let _=t[0];_<t[1];++_){const v=r[_],w=r[_+1];for(const k of n)for(let A=0,L=k.length,O=L-1;A<L;O=A++){const V=k[O],$=k[A];if(Ua(v,w,V,$))return 0;f=Math.min(f,b(v,w,V,$,l))}}return f}function fe(r,t){for(const n of r)for(const l of n)if(da(l,t,!0))return!0;return!1}function Me(r,t,n,l=1/0){const f=p(r),_=p(t);if(l!==1/0&&a(f,_,n)>=l)return l;if(Va(f,_)){if(fe(r,t))return 0}else if(fe(t,r))return 0;let v=1/0;for(const w of r)for(let k=0,A=w.length,L=A-1;k<A;L=k++){const O=w[L],V=w[k];for(const $ of t)for(let Z=0,K=$.length,se=K-1;Z<K;se=Z++){const he=$[se],Ie=$[Z];if(Ua(O,V,he,Ie))return 0;v=Math.min(v,b(O,V,he,Ie,n))}}return v}function Fe(r,t,n,l,f,_){if(!_)return;const v=a(Ar(l,_),f,n);v<t&&r.push([v,_,[0,0]])}function lt(r,t,n,l,f,_,v){if(!_||!v)return;const w=a(Ar(l,_),Ar(f,v),n);w<t&&r.push([w,_,v])}function Rt(r,t,n,l,f=1/0){let _=Math.min(l.distance(r[0],n[0][0]),f);if(_===0)return _;const v=new il([[0,[0,r.length-1],[0,0]]],wi),w=p(n);for(;v.length>0;){const k=v.pop();if(k[0]>=_)continue;const A=k[1],L=t?50:100;if(fo(A)<=L){if(!es(A,r.length))return NaN;if(t){const O=te(r,A,n,l);if(isNaN(O)||O===0)return O;_=Math.min(_,O)}else for(let O=A[0];O<=A[1];++O){const V=j(r[O],n,l);if(_=Math.min(_,V),_===0)return 0}}else{const O=dr(A,t);Fe(v,_,l,r,w,O[0]),Fe(v,_,l,r,w,O[1])}}return _}function Xt(r,t,n,l,f,_=1/0){let v=Math.min(_,f.distance(r[0],n[0]));if(v===0)return v;const w=new il([[0,[0,r.length-1],[0,n.length-1]]],wi);for(;w.length>0;){const k=w.pop();if(k[0]>=v)continue;const A=k[1],L=k[2],O=t?50:100,V=l?50:100;if(fo(A)<=O&&fo(L)<=V){if(!es(A,r.length)&&es(L,n.length))return NaN;let $;if(t&&l)$=M(r,A,n,L,f),v=Math.min(v,$);else if(t&&!l){const Z=r.slice(A[0],A[1]+1);for(let K=L[0];K<=L[1];++K)if($=d(n[K],Z,f),v=Math.min(v,$),v===0)return v}else if(!t&&l){const Z=n.slice(L[0],L[1]+1);for(let K=A[0];K<=A[1];++K)if($=d(r[K],Z,f),v=Math.min(v,$),v===0)return v}else $=N(r,A,n,L,f),v=Math.min(v,$)}else{const $=dr(A,t),Z=dr(L,l);lt(w,v,f,r,n,$[0],Z[0]),lt(w,v,f,r,n,$[0],Z[1]),lt(w,v,f,r,n,$[1],Z[0]),lt(w,v,f,r,n,$[1],Z[1])}}return v}function ti(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class vi{constructor(t,n){this.type=bt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ss(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new vi(l,l.features.map(f=>ti(f.geometry)).flat());if(l.type==="Feature")return new vi(l,ti(l.geometry));if("type"in l&&"coordinates"in l)return new vi(l,ti(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,l){const f=n.geometry(),_=f.flat().map(k=>Jo([k.x,k.y],n.canonical));if(f.length===0)return NaN;const v=new al(_[0][1]);let w=1/0;for(const k of l){switch(k.type){case"Point":w=Math.min(w,Xt(_,!1,[k.coordinates],!1,v,w));break;case"LineString":w=Math.min(w,Xt(_,!1,k.coordinates,!0,v,w));break;case"Polygon":w=Math.min(w,Rt(_,!1,k.coordinates,v,w))}if(w===0)return w}return w}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,l){const f=n.geometry(),_=f.flat().map(k=>Jo([k.x,k.y],n.canonical));if(f.length===0)return NaN;const v=new al(_[0][1]);let w=1/0;for(const k of l){switch(k.type){case"Point":w=Math.min(w,Xt(_,!0,[k.coordinates],!1,v,w));break;case"LineString":w=Math.min(w,Xt(_,!0,k.coordinates,!0,v,w));break;case"Polygon":w=Math.min(w,Rt(_,!0,k.coordinates,v,w))}if(w===0)return w}return w}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,l){const f=n.geometry();if(f.length===0||f[0].length===0)return NaN;const _=Ga(f,0).map(k=>k.map(A=>A.map(L=>Jo([L.x,L.y],n.canonical)))),v=new al(_[0][0][0][1]);let w=1/0;for(const k of l)for(const A of _){switch(k.type){case"Point":w=Math.min(w,Rt([k.coordinates],!1,A,v,w));break;case"LineString":w=Math.min(w,Rt(k.coordinates,!0,A,v,w));break;case"Polygon":w=Math.min(w,Me(A,k.coordinates,v,w))}if(w===0)return w}return w}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class bi{constructor(t){this.type=Wt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=t[1];return l==null?n.error("Global state property must be defined."):typeof l!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new bi(l)}evaluate(t){var n;const l=(n=t.globals)===null||n===void 0?void 0:n.globalState;return l&&Object.keys(l).length!==0?yi(l,this.key):null}eachChild(){}outputDefined(){return!1}}const zi={"==":oo,"!=":Ko,">":Gr,"<":Wl,">=":Hn,"<=":Yl,array:tr,at:Rn,boolean:tr,case:Tn,coalesce:fr,collator:Cs,format:fa,image:uo,in:Vr,"index-of":ca,interpolate:ir,"interpolate-hcl":ir,"interpolate-lab":ir,length:Ba,let:$n,literal:zn,match:Ur,number:tr,"number-format":lo,object:tr,slice:hr,step:ha,string:tr,"to-boolean":jr,"to-color":jr,"to-number":jr,"to-string":jr,var:Zn,within:Ys,distance:vi,"global-state":bi};class ji{constructor(t,n,l,f){this.name=t,this.type=n,this._evaluate=l,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const l=t[0],f=ji.definitions[l];if(!f)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=v.filter(([A])=>!Array.isArray(A)||A.length===t.length-1);let k=null;for(const[A,L]of w){k=new Na(n.registry,qa,n.path,null,n.scope);const O=[];let V=!1;for(let $=1;$<t.length;$++){const Z=t[$],K=Array.isArray(A)?A[$-1]:A.type,se=k.parse(Z,1+O.length,K);if(!se){V=!0;break}O.push(se)}if(!V)if(Array.isArray(A)&&A.length!==O.length)k.error(`Expected ${A.length} arguments, but found ${O.length} instead.`);else{for(let $=0;$<O.length;$++){const Z=Array.isArray(A)?A[$]:A.type,K=O[$];k.concat($+1).checkSubtype(Z,K.type)}if(k.errors.length===0)return new ji(l,_,L,O)}}if(w.length===1)n.errors.push(...k.errors);else{const A=(w.length?w:v).map(([O])=>{return V=O,Array.isArray(V)?`(${V.map(Ai).join(", ")})`:`(${Ai(V.type)}...)`;var V}).join(" | "),L=[];for(let O=1;O<t.length;O++){const V=n.parse(t[O],1+L.length);if(!V)return null;L.push(Ai(V.type))}n.error(`Expected arguments of type ${A}, but found (${L.join(", ")}) instead.`)}return null}static register(t,n){ji.definitions=n;for(const l in n)t[l]=ji}}function Nn(r,[t,n,l,f]){t=t.evaluate(r),n=n.evaluate(r),l=l.evaluate(r);const _=f?f.evaluate(r):1,v=hi(t,n,l,_);if(v)throw new Wi(v);return new ai(t/255,n/255,l/255,_,!1)}function Ps(r,t){return r in t}function Js(r,t){const n=t[r];return n===void 0?null:n}function Ms(r){return{type:r}}function qa(r){if(r instanceof Zn)return qa(r.boundExpression);if(r instanceof ji&&r.name==="error"||r instanceof Cs||r instanceof Ys||r instanceof vi||r instanceof bi)return!1;const t=r instanceof jr||r instanceof tr;let n=!0;return r.eachChild(l=>{n=t?n&&qa(l):n&&l instanceof zn}),!!n&&$a(r)&&Qs(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function $a(r){if(r instanceof ji&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Ys||r instanceof vi)return!1;let t=!0;return r.eachChild(n=>{t&&!$a(n)&&(t=!1)}),t}function pa(r){if(r instanceof ji&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!pa(n)&&(t=!1)}),t}function Qs(r,t){if(r instanceof ji&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(l=>{n&&!Qs(l,t)&&(n=!1)}),n}function ol(r){return{result:"success",value:r}}function As(r){return{result:"error",value:r}}function Rs(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function nc(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function rc(r){return!!r.expression&&r.expression.interpolated}function Ti(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Za(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Vt(r)===cr}function xh(r){return r}function bh(r,t){const n=r.stops&&typeof r.stops[0][0]=="object",l=n||!(n||r.property!==void 0),f=r.type||(rc(t)?"exponential":"interval"),_=function(L){switch(L.type){case"color":return ai.parse;case"padding":return pn.parse;case"numberArray":return In.parse;case"colorArray":return An.parse;default:return null}}(t);if(_&&((r=Mn({},r)).stops&&(r.stops=r.stops.map(L=>[L[0],_(L[1])])),r.default=_(r.default?r.default:t.default)),r.colorSpace&&(v=r.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var v;const w=function(L){switch(L){case"exponential":return wh;case"interval":return td;case"categorical":return ed;case"identity":return Th;default:throw new Error(`Unknown function type "${L}"`)}}(f);let k,A;if(f==="categorical"){k=Object.create(null);for(const L of r.stops)k[L[0]]=L[1];A=typeof r.stops[0][0]}if(n){const L={},O=[];for(let Z=0;Z<r.stops.length;Z++){const K=r.stops[Z],se=K[0].zoom;L[se]===void 0&&(L[se]={zoom:se,type:r.type,property:r.property,default:r.default,stops:[]},O.push(se)),L[se].stops.push([K[0].value,K[1]])}const V=[];for(const Z of O)V.push([L[Z].zoom,bh(L[Z],t)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:ir.interpolationFactor.bind(void 0,$),zoomStops:V.map(Z=>Z[0]),evaluate:({zoom:Z},K)=>wh({stops:V,base:r.base},t,Z).evaluate(Z,K)}}if(l){const L=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:ir.interpolationFactor.bind(void 0,L),zoomStops:r.stops.map(O=>O[0]),evaluate:({zoom:O})=>w(r,t,O,k,A)}}return{kind:"source",evaluate(L,O){const V=O&&O.properties?O.properties[r.property]:void 0;return V===void 0?ll(r.default,t.default):w(r,t,V,k,A)}}}function ll(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function ed(r,t,n,l,f){return ll(typeof n===f?l[n]:void 0,r.default,t.default)}function td(r,t,n){if(Ti(n)!=="number")return ll(r.default,t.default);const l=r.stops.length;if(l===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[l-1][0])return r.stops[l-1][1];const f=Ws(r.stops.map(_=>_[0]),n);return r.stops[f][1]}function wh(r,t,n){const l=r.base!==void 0?r.base:1;if(Ti(n)!=="number")return ll(r.default,t.default);const f=r.stops.length;if(f===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[f-1][0])return r.stops[f-1][1];const _=Ws(r.stops.map(L=>L[0]),n),v=function(L,O,V,$){const Z=$-V,K=L-V;return Z===0?0:O===1?K/Z:(Math.pow(O,K)-1)/(Math.pow(O,Z)-1)}(n,l,r.stops[_][0],r.stops[_+1][0]),w=r.stops[_][1],k=r.stops[_+1][1],A=Yi[t.type]||xh;return typeof w.evaluate=="function"?{evaluate(...L){const O=w.evaluate.apply(void 0,L),V=k.evaluate.apply(void 0,L);if(O!==void 0&&V!==void 0)return A(O,V,v,r.colorSpace)}}:A(w,k,v,r.colorSpace)}function Th(r,t,n){switch(t.type){case"color":n=ai.parse(n);break;case"formatted":n=Gn.fromString(n.toString());break;case"resolvedImage":n=qn.fromString(n.toString());break;case"padding":n=pn.parse(n);break;case"colorArray":n=An.parse(n);break;case"numberArray":n=In.parse(n);break;default:Ti(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return ll(n,r.default,t.default)}ji.register(zi,{error:[{kind:"error"},[oi],(r,[t])=>{throw new Wi(t.evaluate(r))}],typeof:[oi,[Wt],(r,[t])=>Ai(Vt(t.evaluate(r)))],"to-rgba":[vr(bt,4),[er],(r,[t])=>{const[n,l,f,_]=t.evaluate(r).rgb;return[255*n,255*l,255*f,_]}],rgb:[er,[bt,bt,bt],Nn],rgba:[er,[bt,bt,bt,bt],Nn],has:{type:li,overloads:[[[oi],(r,[t])=>Ps(t.evaluate(r),r.properties())],[[oi,cr],(r,[t,n])=>Ps(t.evaluate(r),n.evaluate(r))]]},get:{type:Wt,overloads:[[[oi],(r,[t])=>Js(t.evaluate(r),r.properties())],[[oi,cr],(r,[t,n])=>Js(t.evaluate(r),n.evaluate(r))]]},"feature-state":[Wt,[oi],(r,[t])=>Js(t.evaluate(r),r.featureState||{})],properties:[cr,[],r=>r.properties()],"geometry-type":[oi,[],r=>r.geometryType()],id:[Wt,[],r=>r.id()],zoom:[bt,[],r=>r.globals.zoom],"heatmap-density":[bt,[],r=>r.globals.heatmapDensity||0],elevation:[bt,[],r=>r.globals.elevation||0],"line-progress":[bt,[],r=>r.globals.lineProgress||0],accumulated:[Wt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[bt,Ms(bt),(r,t)=>{let n=0;for(const l of t)n+=l.evaluate(r);return n}],"*":[bt,Ms(bt),(r,t)=>{let n=1;for(const l of t)n*=l.evaluate(r);return n}],"-":{type:bt,overloads:[[[bt,bt],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[bt],(r,[t])=>-t.evaluate(r)]]},"/":[bt,[bt,bt],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[bt,[bt,bt],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[bt,[bt],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[bt,[bt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[bt,[bt],(r,[t])=>Math.log(t.evaluate(r))],log2:[bt,[bt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[bt,[bt],(r,[t])=>Math.sin(t.evaluate(r))],cos:[bt,[bt],(r,[t])=>Math.cos(t.evaluate(r))],tan:[bt,[bt],(r,[t])=>Math.tan(t.evaluate(r))],asin:[bt,[bt],(r,[t])=>Math.asin(t.evaluate(r))],acos:[bt,[bt],(r,[t])=>Math.acos(t.evaluate(r))],atan:[bt,[bt],(r,[t])=>Math.atan(t.evaluate(r))],min:[bt,Ms(bt),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[bt,Ms(bt),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[bt,[bt],(r,[t])=>Math.abs(t.evaluate(r))],round:[bt,[bt],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[bt,[bt],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[bt,[bt],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[li,[oi,Wt],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[li,[Wt],(r,[t])=>r.id()===t.value],"filter-type-==":[li,[oi],(r,[t])=>r.geometryType()===t.value],"filter-<":[li,[oi,Wt],(r,[t,n])=>{const l=r.properties()[t.value],f=n.value;return typeof l==typeof f&&l<f}],"filter-id-<":[li,[Wt],(r,[t])=>{const n=r.id(),l=t.value;return typeof n==typeof l&&n<l}],"filter->":[li,[oi,Wt],(r,[t,n])=>{const l=r.properties()[t.value],f=n.value;return typeof l==typeof f&&l>f}],"filter-id->":[li,[Wt],(r,[t])=>{const n=r.id(),l=t.value;return typeof n==typeof l&&n>l}],"filter-<=":[li,[oi,Wt],(r,[t,n])=>{const l=r.properties()[t.value],f=n.value;return typeof l==typeof f&&l<=f}],"filter-id-<=":[li,[Wt],(r,[t])=>{const n=r.id(),l=t.value;return typeof n==typeof l&&n<=l}],"filter->=":[li,[oi,Wt],(r,[t,n])=>{const l=r.properties()[t.value],f=n.value;return typeof l==typeof f&&l>=f}],"filter-id->=":[li,[Wt],(r,[t])=>{const n=r.id(),l=t.value;return typeof n==typeof l&&n>=l}],"filter-has":[li,[Wt],(r,[t])=>t.value in r.properties()],"filter-has-id":[li,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[li,[vr(oi)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[li,[vr(Wt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[li,[oi,vr(Wt)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[li,[oi,vr(Wt)],(r,[t,n])=>function(l,f,_,v){for(;_<=v;){const w=_+v>>1;if(f[w]===l)return!0;f[w]>l?v=w-1:_=w+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:li,overloads:[[[li,li],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[Ms(li),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:li,overloads:[[[li,li],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[Ms(li),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[li,[li],(r,[t])=>!t.evaluate(r)],"is-supported-script":[li,[oi],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[oi,[oi],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[oi,[oi],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[oi,Ms(Wt),(r,t)=>t.map(n=>Is(n.evaluate(r))).join("")],"resolved-locale":[oi,[ss],(r,[t])=>t.evaluate(r).resolvedLocale()]});class au{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new za,this._defaultValue=n?function(l){if(l.type==="color"&&Za(l.default))return new ai(0,0,0,0);switch(l.type){case"color":return ai.parse(l.default)||null;case"padding":return pn.parse(l.default)||null;case"numberArray":return In.parse(l.default)||null;case"colorArray":return An.parse(l.default)||null;case"variableAnchorOffsetCollection":return di.parse(l.default)||null;case"projectionDefinition":return ci.parse(l.default)||null;default:return l.default===void 0?null:l.default}}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,l,f,_,v){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,n,l,f,_,v){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Wi(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function ou(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in zi}function lu(r,t){const n=new Na(zi,qa,[],t?function(f){const _={color:er,string:oi,number:bt,enum:oi,boolean:li,formatted:Vs,padding:Ji,numberArray:Us,colorArray:as,projectionDefinition:js,resolvedImage:Or,variableAnchorOffsetCollection:la};return f.type==="array"?vr(_[f.value]||Wt,f.length):_[f.type]}(t):void 0),l=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?ol(new au(l,t)):As(n.errors)}class ul{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!pa(n.expression),this.globalStateRefs=mo(n.expression)}evaluateWithoutErrorHandling(t,n,l,f,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,n,l,f,_,v)}evaluate(t,n,l,f,_,v){return this._styleExpression.evaluate(t,n,l,f,_,v)}}class uu{constructor(t,n,l,f){this.kind=t,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!pa(n.expression),this.globalStateRefs=mo(n.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,n,l,f,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,n,l,f,_,v)}evaluate(t,n,l,f,_,v){return this._styleExpression.evaluate(t,n,l,f,_,v)}interpolationFactor(t,n,l){return this.interpolationType?ir.interpolationFactor(this.interpolationType,t,n,l):0}}function sc(r,t){const n=lu(r,t);if(n.result==="error")return n;const l=n.value.expression,f=$a(l);if(!f&&!Rs(t))return As([new Ki("","data expressions not supported")]);const _=Qs(l,["zoom"]);if(!_&&!nc(t))return As([new Ki("","zoom expressions not supported")]);const v=po(l);return v||_?v instanceof Ki?As([v]):v instanceof ir&&!rc(t)?As([new Ki("",'"interpolate" expressions cannot be used with this property')]):ol(v?new uu(f?"camera":"composite",n.value,v.labels,v instanceof ir?v.interpolation:void 0):new ul(f?"constant":"source",n.value)):As([new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class cl{constructor(t,n){this._parameters=t,this._specification=n,Mn(this,bh(this._parameters,this._specification))}static deserialize(t){return new cl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function po(r){let t=null;if(r instanceof $n)t=po(r.result);else if(r instanceof fr){for(const n of r.args)if(t=po(n),t)break}else(r instanceof ha||r instanceof ir)&&r.input instanceof ji&&r.input.name==="zoom"&&(t=r);return t instanceof Ki||r.eachChild(n=>{const l=po(n);l instanceof Ki?t=l:!t&&l?t=new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new Ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function mo(r,t=new Set){return r instanceof bi&&t.add(r.key),r.eachChild(n=>{mo(n,t)}),t}function hl(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!hl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ac={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ma(r){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};hl(r)||(r=cu(r));const t=lu(r,ac);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,l,f)=>t.value.evaluate(n,l,{},f),needGeometry:Sh(r),getGlobalStateRefs:()=>mo(t.value.expression)}}function id(r,t){return r<t?-1:r>t?1:0}function Sh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Sh(r[t]))return!0;return!1}function cu(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?oc(r[1],r[2],"=="):t==="!="?fl(oc(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?oc(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(cu))):t==="all"?["all"].concat(r.slice(1).map(cu)):t==="none"?["all"].concat(r.slice(1).map(cu).map(fl)):t==="in"?Ih(r[1],r.slice(2)):t==="!in"?fl(Ih(r[1],r.slice(2))):t==="has"?kh(r[1]):t!=="!has"||fl(kh(r[1]));var n}function oc(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function Ih(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(id)]]:["filter-in-small",r,["literal",t]]}}function kh(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function fl(r){return["!",r]}function hu(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let f="[";for(const _ of r)f+=`${hu(_)},`;return`${f}]`}const n=Object.keys(r).sort();let l="{";for(let f=0;f<n.length;f++)l+=`${JSON.stringify(n[f])}:${hu(r[n[f]])},`;return`${l}}`}function fu(r){let t="";for(const n of Tt)t+=`/${hu(r[n])}`;return t}function Eh(r){const t=r.value;return t?[new xt(r.key,t,"constants have been deprecated as of v8")]:[]}function mn(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ga(r){if(Array.isArray(r))return r.map(ga);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=ga(r[n]);return t}return mn(r)}function ts(r){const t=r.key,n=r.value,l=r.valueSpec||{},f=r.objectElementValidators||{},_=r.style,v=r.styleSpec,w=r.validateSpec;let k=[];const A=Ti(n);if(A!=="object")return[new xt(t,n,`object expected, ${A} found`)];for(const L in n){const O=L.split(".")[0],V=yi(l,O)||l["*"];let $;if(yi(f,O))$=f[O];else if(yi(l,O))$=w;else if(f["*"])$=f["*"];else{if(!l["*"]){k.push(new xt(t,n[L],`unknown property "${L}"`));continue}$=w}k=k.concat($({key:(t&&`${t}.`)+L,value:n[L],valueSpec:V,style:_,styleSpec:v,object:n,objectKey:L,validateSpec:w},n))}for(const L in l)f[L]||l[L].required&&l[L].default===void 0&&n[L]===void 0&&k.push(new xt(t,n,`missing required property "${L}"`));return k}function du(r){const t=r.value,n=r.valueSpec,l=r.style,f=r.styleSpec,_=r.key,v=r.arrayElementValidator||r.validateSpec;if(Ti(t)!=="array")return[new xt(_,t,`array expected, ${Ti(t)} found`)];if(n.length&&t.length!==n.length)return[new xt(_,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new xt(_,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let w={type:n.value,values:n.values};f.$version<7&&(w.function=n.function),Ti(n.value)==="object"&&(w=n.value);let k=[];for(let A=0;A<t.length;A++)k=k.concat(v({array:t,arrayIndex:A,value:t[A],valueSpec:w,validateSpec:r.validateSpec,style:l,styleSpec:f,key:`${_}[${A}]`}));return k}function dl(r){const t=r.key,n=r.value,l=r.valueSpec;let f=Ti(n);return f==="number"&&n!=n&&(f="NaN"),f!=="number"?[new xt(t,n,`number expected, ${f} found`)]:"minimum"in l&&n<l.minimum?[new xt(t,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new xt(t,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function go(r){const t=r.valueSpec,n=mn(r.value.type);let l,f,_,v={};const w=n!=="categorical"&&r.value.property===void 0,k=!w,A=Ti(r.value.stops)==="array"&&Ti(r.value.stops[0])==="array"&&Ti(r.value.stops[0][0])==="object",L=ts({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function($){if(n==="identity")return[new xt($.key,$.value,'identity function may not have a "stops" property')];let Z=[];const K=$.value;return Z=Z.concat(du({key:$.key,value:K,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:O})),Ti(K)==="array"&&K.length===0&&Z.push(new xt($.key,K,"array must have at least one stop")),Z},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:t,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return n==="identity"&&w&&L.push(new xt(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||L.push(new xt(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!rc(r.valueSpec)&&L.push(new xt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(k&&!Rs(r.valueSpec)?L.push(new xt(r.key,r.value,"property functions not supported")):w&&!nc(r.valueSpec)&&L.push(new xt(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!A||r.value.property!==void 0||L.push(new xt(r.key,r.value,'"property" property is required')),L;function O($){let Z=[];const K=$.value,se=$.key;if(Ti(K)!=="array")return[new xt(se,K,`array expected, ${Ti(K)} found`)];if(K.length!==2)return[new xt(se,K,`array length 2 expected, length ${K.length} found`)];if(A){if(Ti(K[0])!=="object")return[new xt(se,K,`object expected, ${Ti(K[0])} found`)];if(K[0].zoom===void 0)return[new xt(se,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new xt(se,K,"object stop key must have value")];if(_&&_>mn(K[0].zoom))return[new xt(se,K[0].zoom,"stop zoom values must appear in ascending order")];mn(K[0].zoom)!==_&&(_=mn(K[0].zoom),f=void 0,v={}),Z=Z.concat(ts({key:`${se}[0]`,value:K[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:dl,value:V}}))}else Z=Z.concat(V({key:`${se}[0]`,value:K[0],validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},K));return ou(ga(K[1]))?Z.concat([new xt(`${se}[1]`,K[1],"expressions are not allowed in function stops.")]):Z.concat($.validateSpec({key:`${se}[1]`,value:K[1],valueSpec:t,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function V($,Z){const K=Ti($.value),se=mn($.value),he=$.value!==null?$.value:Z;if(l){if(K!==l)return[new xt($.key,he,`${K} stop domain type must match previous stop domain type ${l}`)]}else l=K;if(K!=="number"&&K!=="string"&&K!=="boolean")return[new xt($.key,he,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&n!=="categorical"){let Ie=`number expected, ${K} found`;return Rs(t)&&n===void 0&&(Ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt($.key,he,Ie)]}return n!=="categorical"||K!=="number"||isFinite(se)&&Math.floor(se)===se?n!=="categorical"&&K==="number"&&f!==void 0&&se<f?[new xt($.key,he,"stop domain values must appear in ascending order")]:(f=se,n==="categorical"&&se in v?[new xt($.key,he,"stop domain values must be unique")]:(v[se]=!0,[])):[new xt($.key,he,`integer expected, found ${se}`)]}}function _o(r){const t=(r.expressionContext==="property"?sc:lu)(ga(r.value),r.valueSpec);if(t.result==="error")return t.value.map(l=>new xt(`${r.key}${l.key}`,r.value,l.message));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new xt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!pa(n))return[new xt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!pa(n))return[new xt(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Qs(n,["zoom","feature-state"]))return[new xt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!$a(n))return[new xt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lc(r){const t=r.key,n=r.value,l=Ti(n);return l!=="string"?[new xt(t,n,`color expected, ${l} found`)]:ai.parse(String(n))?[]:[new xt(t,n,`color expected, "${n}" found`)]}function pl(r){const t=r.key,n=r.value,l=r.valueSpec,f=[];return Array.isArray(l.values)?l.values.indexOf(mn(n))===-1&&f.push(new xt(t,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(mn(n))===-1&&f.push(new xt(t,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),f}function uc(r){return hl(ga(r.value))?_o(Mn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ch(r)}function Ch(r){const t=r.value,n=r.key;if(Ti(t)!=="array")return[new xt(n,t,`array expected, ${Ti(t)} found`)];const l=r.styleSpec;let f,_=[];if(t.length<1)return[new xt(n,t,"filter array must have at least 1 element")];switch(_=_.concat(pl({key:`${n}[0]`,value:t[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),mn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&mn(t[1])==="$type"&&_.push(new xt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new xt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=Ti(t[1]),f!=="string"&&_.push(new xt(`${n}[1]`,t[1],`string expected, ${f} found`)));for(let v=2;v<t.length;v++)f=Ti(t[v]),mn(t[1])==="$type"?_=_.concat(pl({key:`${n}[${v}]`,value:t[v],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&_.push(new xt(`${n}[${v}]`,t[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(Ch({key:`${n}[${v}]`,value:t[v],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":f=Ti(t[1]),t.length!==2?_.push(new xt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&_.push(new xt(`${n}[1]`,t[1],`string expected, ${f} found`))}return _}function Ph(r,t){const n=r.key,l=r.validateSpec,f=r.style,_=r.styleSpec,v=r.value,w=r.objectKey,k=_[`${t}_${r.layerType}`];if(!k)return[];const A=w.match(/^(.*)-transition$/);if(t==="paint"&&A&&k[A[1]]&&k[A[1]].transition)return l({key:n,value:v,valueSpec:_.transition,style:f,styleSpec:_});const L=r.valueSpec||k[w];if(!L)return[new xt(n,v,`unknown property "${w}"`)];let O;if(Ti(v)==="string"&&Rs(L)&&!L.tokens&&(O=/^{([^}]+)}$/.exec(v)))return[new xt(n,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const V=[];return r.layerType==="symbol"&&(w==="text-field"&&f&&!f.glyphs&&V.push(new xt(n,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Za(ga(v))&&mn(v.type)==="identity"&&V.push(new xt(n,v,'"text-font" does not support identity functions'))),V.concat(l({key:r.key,value:v,valueSpec:L,style:f,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:w}))}function yo(r){return Ph(r,"paint")}function vo(r){return Ph(r,"layout")}function Rr(r){let t=[];const n=r.value,l=r.key,f=r.style,_=r.styleSpec;if(Ti(n)!=="object")return[new xt(l,n,`object expected, ${Ti(n)} found`)];n.type||n.ref||t.push(new xt(l,n,'either "type" or "ref" is required'));let v=mn(n.type);const w=mn(n.ref);if(n.id){const k=mn(n.id);for(let A=0;A<r.arrayIndex;A++){const L=f.layers[A];mn(L.id)===k&&t.push(new xt(l,n.id,`duplicate layer id "${n.id}", previously used at line ${L.id.__line__}`))}}if("ref"in n){let k;["type","source","source-layer","filter","layout"].forEach(A=>{A in n&&t.push(new xt(l,n[A],`"${A}" is prohibited for ref layers`))}),f.layers.forEach(A=>{mn(A.id)===w&&(k=A)}),k?k.ref?t.push(new xt(l,n.ref,"ref cannot reference another ref layer")):v=mn(k.type):t.push(new xt(l,n.ref,`ref layer "${w}" not found`))}else if(v!=="background")if(n.source){const k=f.sources&&f.sources[n.source],A=k&&mn(k.type);k?A==="vector"&&v==="raster"?t.push(new xt(l,n.source,`layer "${n.id}" requires a raster source`)):A!=="raster-dem"&&v==="hillshade"||A!=="raster-dem"&&v==="color-relief"?t.push(new xt(l,n.source,`layer "${n.id}" requires a raster-dem source`)):A==="raster"&&v!=="raster"?t.push(new xt(l,n.source,`layer "${n.id}" requires a vector source`)):A!=="vector"||n["source-layer"]?A==="raster-dem"&&v!=="hillshade"&&v!=="color-relief"?t.push(new xt(l,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):v!=="line"||!n.paint||!n.paint["line-gradient"]||A==="geojson"&&k.lineMetrics||t.push(new xt(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new xt(l,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new xt(l,n.source,`source "${n.source}" not found`))}else t.push(new xt(l,n,'missing required property "source"'));return t=t.concat(ts({key:l,value:n,valueSpec:_.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${l}.type`,value:n.type,valueSpec:_.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:uc,layout:k=>ts({layer:n,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":A=>vo(Mn({layerType:v},A))}}),paint:k=>ts({layer:n,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":A=>yo(Mn({layerType:v},A))}})}})),t}function fs(r){const t=r.value,n=r.key,l=Ti(t);return l!=="string"?[new xt(n,t,`string expected, ${l} found`)]:[]}const cc={promoteId:function({key:r,value:t}){if(Ti(t)==="string")return fs({key:r,value:t});{const n=[];for(const l in t)n.push(...fs({key:`${r}.${l}`,value:t[l]}));return n}}};function Mh(r){const t=r.value,n=r.key,l=r.styleSpec,f=r.style,_=r.validateSpec;if(!t.type)return[new xt(n,t,'"type" is required')];const v=mn(t.type);let w;switch(v){case"vector":case"raster":return w=ts({key:n,value:t,valueSpec:l[`source_${v.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:cc,validateSpec:_}),w;case"raster-dem":return w=function(k){var A;const L=(A=k.sourceName)!==null&&A!==void 0?A:"",O=k.value,V=k.styleSpec,$=V.source_raster_dem,Z=k.style;let K=[];const se=Ti(O);if(O===void 0)return K;if(se!=="object")return K.push(new xt("source_raster_dem",O,`object expected, ${se} found`)),K;const he=mn(O.encoding)==="custom",Ie=["redFactor","greenFactor","blueFactor","baseShift"],ye=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const G in O)!he&&Ie.includes(G)?K.push(new xt(G,O[G],`In "${L}": "${G}" is only valid when "encoding" is set to "custom". ${ye} encoding found`)):$[G]?K=K.concat(k.validateSpec({key:G,value:O[G],valueSpec:$[G],validateSpec:k.validateSpec,style:Z,styleSpec:V})):K.push(new xt(G,O[G],`unknown property "${G}"`));return K}({sourceName:n,value:t,style:r.style,styleSpec:l,validateSpec:_}),w;case"geojson":if(w=ts({key:n,value:t,valueSpec:l.source_geojson,style:f,styleSpec:l,validateSpec:_,objectElementValidators:cc}),t.cluster)for(const k in t.clusterProperties){const[A,L]=t.clusterProperties[k],O=typeof A=="string"?[A,["accumulated"],["get",k]]:A;w.push(..._o({key:`${n}.${k}.map`,value:L,expressionContext:"cluster-map"})),w.push(..._o({key:`${n}.${k}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return w;case"video":return ts({key:n,value:t,valueSpec:l.source_video,style:f,validateSpec:_,styleSpec:l});case"image":return ts({key:n,value:t,valueSpec:l.source_image,style:f,validateSpec:_,styleSpec:l});case"canvas":return[new xt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pl({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ah(r){const t=r.value,n=r.styleSpec,l=n.light,f=r.style;let _=[];const v=Ti(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new xt("light",t,`object expected, ${v} found`)]),_;for(const w in t){const k=w.match(/^(.*)-transition$/);_=_.concat(k&&l[k[1]]&&l[k[1]].transition?r.validateSpec({key:w,value:t[w],valueSpec:n.transition,validateSpec:r.validateSpec,style:f,styleSpec:n}):l[w]?r.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:r.validateSpec,style:f,styleSpec:n}):[new xt(w,t[w],`unknown property "${w}"`)])}return _}function xo(r){const t=r.value,n=r.styleSpec,l=n.sky,f=r.style,_=Ti(t);if(t===void 0)return[];if(_!=="object")return[new xt("sky",t,`object expected, ${_} found`)];let v=[];for(const w in t)v=v.concat(l[w]?r.validateSpec({key:w,value:t[w],valueSpec:l[w],style:f,styleSpec:n}):[new xt(w,t[w],`unknown property "${w}"`)]);return v}function hc(r){const t=r.value,n=r.styleSpec,l=n.terrain,f=r.style;let _=[];const v=Ti(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new xt("terrain",t,`object expected, ${v} found`)]),_;for(const w in t)_=_.concat(l[w]?r.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:r.validateSpec,style:f,styleSpec:n}):[new xt(w,t[w],`unknown property "${w}"`)]);return _}function pu(r){let t=[];const n=r.value,l=r.key;if(Array.isArray(n)){const f=[],_=[];for(const v in n)n[v].id&&f.includes(n[v].id)&&t.push(new xt(l,n,`all the sprites' ids must be unique, but ${n[v].id} is duplicated`)),f.push(n[v].id),n[v].url&&_.includes(n[v].url)&&t.push(new xt(l,n,`all the sprites' URLs must be unique, but ${n[v].url} is duplicated`)),_.push(n[v].url),t=t.concat(ts({key:`${l}[${v}]`,value:n[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return fs({key:l,value:n})}function Rh(r){return t=r.value,t&&t.constructor===Object?[]:[new xt(r.key,r.value,`object expected, ${Ti(r.value)} found`)];var t}const mu={"*":()=>[],array:du,boolean:function(r){const t=r.value,n=r.key,l=Ti(t);return l!=="boolean"?[new xt(n,t,`boolean expected, ${l} found`)]:[]},number:dl,color:lc,constants:Eh,enum:pl,filter:uc,function:go,layer:Rr,object:ts,source:Mh,light:Ah,sky:xo,terrain:hc,projection:function(r){const t=r.value,n=r.styleSpec,l=n.projection,f=r.style,_=Ti(t);if(t===void 0)return[];if(_!=="object")return[new xt("projection",t,`object expected, ${_} found`)];let v=[];for(const w in t)v=v.concat(l[w]?r.validateSpec({key:w,value:t[w],valueSpec:l[w],style:f,styleSpec:n}):[new xt(w,t[w],`unknown property "${w}"`)]);return v},projectionDefinition:function(r){const t=r.key;let n=r.value;n=n instanceof String?n.valueOf():n;const l=Ti(n);return l!=="array"||function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"}(n)||function(f){return!!["interpolate","step","literal"].includes(f[0])}(n)?["array","string"].includes(l)?[]:[new xt(t,n,`projection expected, invalid type "${l}" found`)]:[new xt(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:fs,formatted:function(r){return fs(r).length===0?[]:_o(r)},resolvedImage:function(r){return fs(r).length===0?[]:_o(r)},padding:function(r){const t=r.key,n=r.value;if(Ti(n)==="array"){if(n.length<1||n.length>4)return[new xt(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let f=[];for(let _=0;_<n.length;_++)f=f.concat(r.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:r.validateSpec,valueSpec:l}));return f}return dl({key:t,value:n,valueSpec:{}})},numberArray:function(r){const t=r.key,n=r.value;if(Ti(n)==="array"){const l={type:"number"};if(n.length<1)return[new xt(t,n,"array length at least 1 expected, length 0 found")];let f=[];for(let _=0;_<n.length;_++)f=f.concat(r.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:r.validateSpec,valueSpec:l}));return f}return dl({key:t,value:n,valueSpec:{}})},colorArray:function(r){const t=r.key,n=r.value;if(Ti(n)==="array"){if(n.length<1)return[new xt(t,n,"array length at least 1 expected, length 0 found")];let l=[];for(let f=0;f<n.length;f++)l=l.concat(lc({key:`${t}[${f}]`,value:n[f]}));return l}return lc({key:t,value:n})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,l=Ti(n),f=r.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new xt(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let v=0;v<n.length;v+=2)_=_.concat(pl({key:`${t}[${v}]`,value:n[v],valueSpec:f.layout_symbol["text-anchor"]})),_=_.concat(du({key:`${t}[${v+1}]`,value:n[v+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:f}));return _},sprite:pu,state:Rh};function gu(r){const t=r.value,n=r.valueSpec,l=r.styleSpec;return r.validateSpec=gu,n.expression&&Za(mn(t))?go(r):n.expression&&ou(ga(t))?_o(r):n.type&&mu[n.type]?mu[n.type](r):ts(Mn({},r,{valueSpec:n.type?l[n.type]:n}))}function bo(r){const t=r.value,n=r.key,l=fs(r);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new xt(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new xt(n,t,'"glyphs" url must include a "{range}" token'))),l}function is(r,t=be){let n=[];return n=n.concat(gu({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:gu,objectElementValidators:{glyphs:bo,"*":()=>[]}})),r.constants&&(n=n.concat(Eh({key:"constants",value:r.constants}))),Lh(n)}function ds(r){return function(t){return r({...t,validateSpec:gu})}}function Lh(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function xr(r){return function(...t){return Lh(r.apply(this,t))}}is.source=xr(ds(Mh)),is.sprite=xr(ds(pu)),is.glyphs=xr(ds(bo)),is.light=xr(ds(Ah)),is.sky=xr(ds(xo)),is.terrain=xr(ds(hc)),is.state=xr(ds(Rh)),is.layer=xr(ds(Rr)),is.filter=xr(ds(uc)),is.paintProperty=xr(ds(yo)),is.layoutProperty=xr(ds(vo));const wo=is,nd=wo.light,_u=wo.sky,rd=wo.paintProperty,fc=wo.layoutProperty;function ml(r,t){let n=!1;if(t&&t.length)for(const l of t)r.fire(new Ae(new Error(l.message))),n=!0;return n}class To{constructor(t,n,l){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(n=v[1])+2*(l=v[2]);for(let k=0;k<this.d*this.d;k++){const A=v[3+k],L=v[3+k+1];f.push(A===L?null:v.subarray(A,L))}const w=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let v=0;v<this.d*this.d;v++)f.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=l,this.scale=n/t,this.uid=0;const _=l/n*t;this.min=-_,this.max=t+_}insert(t,n,l,f,_){this._forEachCell(n,l,f,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,l,f,_,v){this.cells[_].push(v)}query(t,n,l,f,_){const v=this.min,w=this.max;if(t<=v&&n<=v&&w<=l&&w<=f&&!_)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(t,n,l,f,this._queryCell,k,{},_),k}}_queryCell(t,n,l,f,_,v,w,k){const A=this.cells[_];if(A!==null){const L=this.keys,O=this.bboxes;for(let V=0;V<A.length;V++){const $=A[V];if(w[$]===void 0){const Z=4*$;(k?k(O[Z+0],O[Z+1],O[Z+2],O[Z+3]):t<=O[Z+2]&&n<=O[Z+3]&&l>=O[Z+0]&&f>=O[Z+1])?(w[$]=!0,v.push(L[$])):w[$]=!1}}}}_forEachCell(t,n,l,f,_,v,w,k){const A=this._convertToCellCoord(t),L=this._convertToCellCoord(n),O=this._convertToCellCoord(l),V=this._convertToCellCoord(f);for(let $=A;$<=O;$++)for(let Z=L;Z<=V;Z++){const K=this.d*Z+$;if((!k||k(this._convertFromCellCoord($),this._convertFromCellCoord(Z),this._convertFromCellCoord($+1),this._convertFromCellCoord(Z+1)))&&_.call(this,t,n,l,f,K,v,w,k))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let l=0;for(let v=0;v<this.cells.length;v++)l+=this.cells[v].length;const f=new Int32Array(n+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let _=n;for(let v=0;v<t.length;v++){const w=t[v];f[3+v]=_,f.set(w,_),_+=w.length}return f[3+t.length]=_,f.set(this.keys,_),_+=this.keys.length,f[3+t.length+1]=_,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer}static serialize(t,n){const l=t.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(t){return new To(t.buffer)}}const Ls={};function Lt(r,t,n={}){if(Ls[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Ls[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Lt("Object",Object),Lt("Set",Set),Lt("TransferableGridIndex",To),Lt("Color",ai),Lt("Error",Error),Lt("AJAXError",pe),Lt("ResolvedImage",qn),Lt("StylePropertyFunction",cl),Lt("StyleExpression",au,{omit:["_evaluator"]}),Lt("ZoomDependentExpression",uu),Lt("ZoomConstantExpression",ul),Lt("CompoundExpression",ji,{omit:["_evaluate"]});for(const r in zi)zi[r]._classRegistryKey||Lt(`Expression_${r}`,zi[r]);function dc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function gl(r){return r.$name||r.constructor._classRegistryKey}function pc(r){return!function(t){if(t===null||typeof t!="object")return!1;const n=gl(t);return!(!n||n==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||dc(r)||_t(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function _l(r,t){if(pc(r))return(dc(r)||_t(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const _=[];for(const v of r)_.push(_l(v,t));return _}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=gl(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Ls[n])throw new Error(`${n} is not registered.`);const{klass:l}=Ls[n],f=l.serialize?l.serialize(r,t):{};if(l.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in r){if(!r.hasOwnProperty(_)||Ls[n].omit.indexOf(_)>=0)continue;const v=r[_];f[_]=Ls[n].shallow.indexOf(_)>=0?v:_l(v,t)}r instanceof Error&&(f.message=r.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(f.$name=n),f}function So(r){if(pc(r))return r;if(Array.isArray(r))return r.map(So);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=gl(r)||"Object";if(!Ls[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Ls[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const l=Object.create(n.prototype);for(const f of Object.keys(r)){if(f==="$name")continue;const _=r[f];l[f]=Ls[t].shallow.indexOf(f)>=0?_:So(_)}return l}class mc{constructor(){this.first=!0}update(t,n){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const Si={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Hangul Syllables":r=>r>=44032&&r<=55215,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function gc(r){for(const t of r)if(vu(t.charCodeAt(0)))return!0;return!1}function Dh(r){for(const t of r)if(!ad(t.charCodeAt(0)))return!1;return!0}function yu(r){const t=r.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const sd=yu(["Arab","Dupl","Mong","Ougr","Syrc"]);function ad(r){return!sd.test(String.fromCodePoint(r))}const _c=yu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function vu(r){return!(r!==746&&r!==747&&(r<4352||!(Si["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Si["CJK Compatibility"](r)||Si["CJK Strokes"](r)||!(!Si["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Si["Enclosed CJK Letters and Months"](r)||Si["Ideographic Description Characters"](r)||Si.Kanbun(r)||Si.Katakana(r)&&r!==12540||!(!Si["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Si["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Si["Vertical Forms"](r)||Si["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||_c.test(String.fromCodePoint(r)))))}function yc(r){return!(vu(r)||function(t){return!!(Si["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Si["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Si["Letterlike Symbols"](t)||Si["Number Forms"](t)||Si["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Si["Control Pictures"](t)&&t!==9251||Si["Optical Character Recognition"](t)||Si["Enclosed Alphanumerics"](t)||Si["Geometric Shapes"](t)||Si["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Si["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Si["CJK Symbols and Punctuation"](t)||Si.Katakana(t)||Si["Private Use Area"](t)||Si["CJK Compatibility Forms"](t)||Si["Small Form Variants"](t)||Si["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const zh=yu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function yl(r){return zh.test(String.fromCodePoint(r))}function od(r,t){return!(!t&&yl(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Si.Khmer(r))}function vc(r){for(const t of r)if(yl(t.charCodeAt(0)))return!0;return!1}const _a=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(_a.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,t){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const n=r.pluginURL,l=new Promise(_=>{this.loadScriptResolve=_});t(n);const f=new Promise(_=>setTimeout(()=>_(),this.TIMEOUT));if(yield Promise.race([l,f]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:n};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)})}};class nn{constructor(t,n){this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new mc,this.transition=n.transition||{},this.globalState=n.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mc,this.transition={},this.globalState={})}isSupportedScript(t){return function(n,l){for(const f of n)if(!od(f.charCodeAt(0),l))return!1;return!0}(t,_a.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}class vl{constructor(t,n){this.property=t,this.value=n,this.expression=function(l,f){if(Za(l))return new cl(l,f);if(ou(l)){const _=sc(l,f);if(_.result==="error")throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));return _.value}{let _=l;return f.type==="color"&&typeof l=="string"?_=ai.parse(l):f.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?f.type!=="numberArray"||typeof l!="number"&&!Array.isArray(l)?f.type!=="colorArray"||typeof l!="string"&&!Array.isArray(l)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(l)?_=di.parse(l):f.type==="projectionDefinition"&&typeof l=="string"&&(_=ci.parse(l)):_=An.parse(l):_=In.parse(l):_=pn.parse(l),{globalStateRefs:new Set,kind:"constant",evaluate:()=>_}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,l){return this.property.possiblyEvaluate(this,t,n,l)}}class xu{constructor(t){this.property=t,this.value=new vl(t,void 0)}transitioned(t,n){return new Nh(this.property,this.value,n,jt({},t.transition,this.transition),t.now)}untransitioned(){return new Nh(this.property,this.value,null,{},0)}}class xc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ot(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new xu(this._values[t].property)),this._values[t].value=new vl(this._values[t].property,n===null?void 0:ot(n))}getTransition(t){return ot(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new xu(this._values[t].property)),this._values[t].transition=ot(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(t[n]=l);const f=this.getTransition(n);f!==void 0&&(t[`${n}-transition`]=f)}return t}transitioned(t,n){const l=new Oh(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].transitioned(t,n._values[f]);return l}untransitioned(){const t=new Oh(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Nh{constructor(t,n,l,f,_){this.property=t,this.value=n,this.begin=_+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=l)}possiblyEvaluate(t,n,l){const f=t.now||0,_=this.value.possiblyEvaluate(t,n,l),v=this.prior;if(v){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return v.possiblyEvaluate(t,n,l);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,n,l),_,yr(w))}}return _}}class Oh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,l){const f=new bu(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(t,n,l);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ld{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ot(this._values[t].value)}setValue(t,n){this._values[t]=new vl(this._values[t].property,n===null?void 0:ot(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(t[n]=l)}return t}possiblyEvaluate(t,n,l){const f=new bu(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(t,n,l);return f}}class Ds{constructor(t,n,l){this.property=t,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,l,f){return this.property.evaluate(this.value,this.parameters,t,n,l,f)}}class bu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ft{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,l){const f=Yi[this.specification.type];return f?f(t,n,l):t}}class ni{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,l,f){return new Ds(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},l,f)}:t.expression,n)}interpolate(t,n,l){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Ds(this,{kind:"constant",value:void 0},t.parameters);const f=Yi[this.specification.type];if(f){const _=f(t.value.value,n.value.value,l);return new Ds(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,n,l,f,_,v){return t.kind==="constant"?t.value:t.evaluate(n,l,f,_,v)}}class wu extends ni{possiblyEvaluate(t,n,l,f){if(t.value===void 0)return new Ds(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const _=t.expression.evaluate(n,null,{},l,f),v=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,w=this._calculate(v,v,v,n);return new Ds(this,{kind:"constant",value:w},n)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Ds(this,{kind:"constant",value:_},n)}return new Ds(this,t.expression,n)}evaluate(t,n,l,f,_,v){if(t.kind==="source"){const w=t.evaluate(n,l,f,_,v);return this._calculate(w,w,w,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},l,f),t.evaluate({zoom:Math.floor(n.zoom)},l,f),t.evaluate({zoom:Math.floor(n.zoom)+1},l,f),n):t.value}_calculate(t,n,l,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:l,to:n}}interpolate(t){return t}}class bc{constructor(t){this.specification=t}possiblyEvaluate(t,n,l,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(n,null,{},l,f);return this._calculate(_,_,_,n)}return this._calculate(t.expression.evaluate(new nn(Math.floor(n.zoom-1),n)),t.expression.evaluate(new nn(Math.floor(n.zoom),n)),t.expression.evaluate(new nn(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,l,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:l,to:n}}interpolate(t){return t}}class xl{constructor(t){this.specification=t}possiblyEvaluate(t,n,l,f){return!!t.expression.evaluate(n,null,{},l,f)}interpolate(){return!1}}class br{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const l=t[n];l.specification.overridable&&this.overridableProperties.push(n);const f=this.defaultPropertyValues[n]=new vl(l,void 0),_=this.defaultTransitionablePropertyValues[n]=new xu(l);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=f.possiblyEvaluate({})}}}Lt("DataDrivenProperty",ni),Lt("DataConstantProperty",Ft),Lt("CrossFadedDataDrivenProperty",wu),Lt("CrossFadedProperty",bc),Lt("ColorRampProperty",xl);const Fh="-transition";class nr extends et{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=ma(t.filter)),n.layout&&(this._unevaluatedLayout=new ld(n.layout)),n.paint)){this._transitionablePaint=new xc(n.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new bu(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=ma(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[n];for(const f of l.getGlobalStateRefs())t.add(f)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}setLayoutProperty(t,n,l={}){n!=null&&this._validate(fc,`layers.${this.id}.layout.${t}`,t,n,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Fh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,l={}){if(n!=null&&this._validate(rd,`layers.${this.id}.paint.${t}`,t,n,l))return!1;if(t.endsWith(Fh))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const f=this._transitionablePaint._values[t],_=f.property.specification["property-type"]==="cross-faded-data-driven",v=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const k=this._transitionablePaint._values[t].value;return k.isDataDriven()||v||_||this._handleOverridablePaintPropertyUpdate(t,w,k)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ze(t,(n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length))}_validate(t,n,l,f,_={}){return(!_||_.validate!==!1)&&ml(this,t.call(wo,{key:n,layerType:this.type,objectKey:l,value:f,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Ds&&Rs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Bh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ha{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class an{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function gn(r,t=1){let n=0,l=0;return{members:r.map(f=>{const _=Bh[f.type].BYTES_PER_ELEMENT,v=n=jh(n,Math.max(t,_)),w=f.components||1;return l=Math.max(l,_),n+=_*w,{name:f.name,type:f.type,components:w,offset:v}}),size:jh(n,Math.max(l,t)),alignment:t}}function jh(r,t){return Math.ceil(r/t)*t}class ya extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const f=2*t;return this.int16[f+0]=n,this.int16[f+1]=l,t}}ya.prototype.bytesPerElement=4,Lt("StructArrayLayout2i4",ya);class va extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,l)}emplace(t,n,l,f){const _=3*t;return this.int16[_+0]=n,this.int16[_+1]=l,this.int16[_+2]=f,t}}va.prototype.bytesPerElement=6,Lt("StructArrayLayout3i6",va);class wc extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,l,f)}emplace(t,n,l,f,_){const v=4*t;return this.int16[v+0]=n,this.int16[v+1]=l,this.int16[v+2]=f,this.int16[v+3]=_,t}}wc.prototype.bytesPerElement=8,Lt("StructArrayLayout4i8",wc);class Tu extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,l,f,_,v)}emplace(t,n,l,f,_,v,w){const k=6*t;return this.int16[k+0]=n,this.int16[k+1]=l,this.int16[k+2]=f,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=w,t}}Tu.prototype.bytesPerElement=12,Lt("StructArrayLayout2i4i12",Tu);class Xa extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,l,f,_,v)}emplace(t,n,l,f,_,v,w){const k=4*t,A=8*t;return this.int16[k+0]=n,this.int16[k+1]=l,this.uint8[A+4]=f,this.uint8[A+5]=_,this.uint8[A+6]=v,this.uint8[A+7]=w,t}}Xa.prototype.bytesPerElement=8,Lt("StructArrayLayout2i4ub8",Xa);class bl extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const f=2*t;return this.float32[f+0]=n,this.float32[f+1]=l,t}}bl.prototype.bytesPerElement=8,Lt("StructArrayLayout2f8",bl);class Tc extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v,w,k,A,L){const O=this.length;return this.resize(O+1),this.emplace(O,t,n,l,f,_,v,w,k,A,L)}emplace(t,n,l,f,_,v,w,k,A,L,O){const V=10*t;return this.uint16[V+0]=n,this.uint16[V+1]=l,this.uint16[V+2]=f,this.uint16[V+3]=_,this.uint16[V+4]=v,this.uint16[V+5]=w,this.uint16[V+6]=k,this.uint16[V+7]=A,this.uint16[V+8]=L,this.uint16[V+9]=O,t}}Tc.prototype.bytesPerElement=20,Lt("StructArrayLayout10ui20",Tc);class Su extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v,w,k,A,L,O,V){const $=this.length;return this.resize($+1),this.emplace($,t,n,l,f,_,v,w,k,A,L,O,V)}emplace(t,n,l,f,_,v,w,k,A,L,O,V,$){const Z=12*t;return this.int16[Z+0]=n,this.int16[Z+1]=l,this.int16[Z+2]=f,this.int16[Z+3]=_,this.uint16[Z+4]=v,this.uint16[Z+5]=w,this.uint16[Z+6]=k,this.uint16[Z+7]=A,this.int16[Z+8]=L,this.int16[Z+9]=O,this.int16[Z+10]=V,this.int16[Z+11]=$,t}}Su.prototype.bytesPerElement=24,Lt("StructArrayLayout4i4ui4i24",Su);class Sc extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,l)}emplace(t,n,l,f){const _=3*t;return this.float32[_+0]=n,this.float32[_+1]=l,this.float32[_+2]=f,t}}Sc.prototype.bytesPerElement=12,Lt("StructArrayLayout3f12",Sc);class m extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}m.prototype.bytesPerElement=4,Lt("StructArrayLayout1ul4",m);class e extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v,w,k,A){const L=this.length;return this.resize(L+1),this.emplace(L,t,n,l,f,_,v,w,k,A)}emplace(t,n,l,f,_,v,w,k,A,L){const O=10*t,V=5*t;return this.int16[O+0]=n,this.int16[O+1]=l,this.int16[O+2]=f,this.int16[O+3]=_,this.int16[O+4]=v,this.int16[O+5]=w,this.uint32[V+3]=k,this.uint16[O+8]=A,this.uint16[O+9]=L,t}}e.prototype.bytesPerElement=20,Lt("StructArrayLayout6i1ul2ui20",e);class i extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,l,f,_,v)}emplace(t,n,l,f,_,v,w){const k=6*t;return this.int16[k+0]=n,this.int16[k+1]=l,this.int16[k+2]=f,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=w,t}}i.prototype.bytesPerElement=12,Lt("StructArrayLayout2i2i2i12",i);class u extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,l,f,_)}emplace(t,n,l,f,_,v){const w=4*t,k=8*t;return this.float32[w+0]=n,this.float32[w+1]=l,this.float32[w+2]=f,this.int16[k+6]=_,this.int16[k+7]=v,t}}u.prototype.bytesPerElement=16,Lt("StructArrayLayout2f1f2i16",u);class h extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,l,f,_,v)}emplace(t,n,l,f,_,v,w){const k=16*t,A=4*t,L=8*t;return this.uint8[k+0]=n,this.uint8[k+1]=l,this.float32[A+1]=f,this.float32[A+2]=_,this.int16[L+6]=v,this.int16[L+7]=w,t}}h.prototype.bytesPerElement=16,Lt("StructArrayLayout2ub2f2i16",h);class g extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,l)}emplace(t,n,l,f){const _=3*t;return this.uint16[_+0]=n,this.uint16[_+1]=l,this.uint16[_+2]=f,t}}g.prototype.bytesPerElement=6,Lt("StructArrayLayout3ui6",g);class x extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v,w,k,A,L,O,V,$,Z,K,se,he){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,t,n,l,f,_,v,w,k,A,L,O,V,$,Z,K,se,he)}emplace(t,n,l,f,_,v,w,k,A,L,O,V,$,Z,K,se,he,Ie){const ye=24*t,G=12*t,ne=48*t;return this.int16[ye+0]=n,this.int16[ye+1]=l,this.uint16[ye+2]=f,this.uint16[ye+3]=_,this.uint32[G+2]=v,this.uint32[G+3]=w,this.uint32[G+4]=k,this.uint16[ye+10]=A,this.uint16[ye+11]=L,this.uint16[ye+12]=O,this.float32[G+7]=V,this.float32[G+8]=$,this.uint8[ne+36]=Z,this.uint8[ne+37]=K,this.uint8[ne+38]=se,this.uint32[G+10]=he,this.int16[ye+22]=Ie,t}}x.prototype.bytesPerElement=48,Lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class S extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,f,_,v,w,k,A,L,O,V,$,Z,K,se,he,Ie,ye,G,ne,ve,Oe,nt,Ve,$e,gt,at){const yt=this.length;return this.resize(yt+1),this.emplace(yt,t,n,l,f,_,v,w,k,A,L,O,V,$,Z,K,se,he,Ie,ye,G,ne,ve,Oe,nt,Ve,$e,gt,at)}emplace(t,n,l,f,_,v,w,k,A,L,O,V,$,Z,K,se,he,Ie,ye,G,ne,ve,Oe,nt,Ve,$e,gt,at,yt){const Je=32*t,Nt=16*t;return this.int16[Je+0]=n,this.int16[Je+1]=l,this.int16[Je+2]=f,this.int16[Je+3]=_,this.int16[Je+4]=v,this.int16[Je+5]=w,this.int16[Je+6]=k,this.int16[Je+7]=A,this.uint16[Je+8]=L,this.uint16[Je+9]=O,this.uint16[Je+10]=V,this.uint16[Je+11]=$,this.uint16[Je+12]=Z,this.uint16[Je+13]=K,this.uint16[Je+14]=se,this.uint16[Je+15]=he,this.uint16[Je+16]=Ie,this.uint16[Je+17]=ye,this.uint16[Je+18]=G,this.uint16[Je+19]=ne,this.uint16[Je+20]=ve,this.uint16[Je+21]=Oe,this.uint16[Je+22]=nt,this.uint32[Nt+12]=Ve,this.float32[Nt+13]=$e,this.float32[Nt+14]=gt,this.uint16[Je+30]=at,this.uint16[Je+31]=yt,t}}S.prototype.bytesPerElement=64,Lt("StructArrayLayout8i15ui1ul2f2ui64",S);class C extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}C.prototype.bytesPerElement=4,Lt("StructArrayLayout1f4",C);class R extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,l)}emplace(t,n,l,f){const _=3*t;return this.uint16[6*t+0]=n,this.float32[_+1]=l,this.float32[_+2]=f,t}}R.prototype.bytesPerElement=12,Lt("StructArrayLayout1ui2f12",R);class D extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,l)}emplace(t,n,l,f){const _=4*t;return this.uint32[2*t+0]=n,this.uint16[_+2]=l,this.uint16[_+3]=f,t}}D.prototype.bytesPerElement=8,Lt("StructArrayLayout1ul2ui8",D);class B extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const f=2*t;return this.uint16[f+0]=n,this.uint16[f+1]=l,t}}B.prototype.bytesPerElement=4,Lt("StructArrayLayout2ui4",B);class F extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}F.prototype.bytesPerElement=2,Lt("StructArrayLayout1ui2",F);class U extends an{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,l,f)}emplace(t,n,l,f,_){const v=4*t;return this.float32[v+0]=n,this.float32[v+1]=l,this.float32[v+2]=f,this.float32[v+3]=_,t}}U.prototype.bytesPerElement=16,Lt("StructArrayLayout4f16",U);class X extends Ha{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new le(this.anchorPointX,this.anchorPointY)}}X.prototype.size=20;class oe extends e{get(t){return new X(this,t)}}Lt("CollisionBoxArray",oe);class ae extends Ha{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ae.prototype.size=48;class ue extends x{get(t){return new ae(this,t)}}Lt("PlacedSymbolArray",ue);class de extends Ha{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}de.prototype.size=64;class _e extends S{get(t){return new de(this,t)}}Lt("SymbolInstanceArray",_e);class me extends C{getoffsetX(t){return this.float32[1*t+0]}}Lt("GlyphOffsetArray",me);class xe extends va{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Lt("SymbolLineVertexArray",xe);class we extends Ha{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}we.prototype.size=12;class ge extends R{get(t){return new we(this,t)}}Lt("TextAnchorOffsetArray",ge);class Ce extends Ha{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ce.prototype.size=8;class Be extends D{get(t){return new Ce(this,t)}}Lt("FeatureIndexArray",Be);class De extends ya{}class ze extends ya{}class je extends ya{}class St extends Tu{}class wt extends Xa{}class st extends bl{}class zt extends Tc{}class _i extends Su{}class Oi extends Sc{}class on extends m{}class Gi extends i{}class ln extends h{}class Zi extends g{}class qi extends B{}const Hi=gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:rr}=Hi;class Mi{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,l,f){const _=this.segments[this.segments.length-1];return t>Mi.MAX_VERTEX_ARRAY_LENGTH&&rt(`Max vertices per segment is ${Mi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Mi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+t>Mi.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f?this.createNewSegment(n,l,f):_}createNewSegment(t,n,l){const f={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(f.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(t,n,l){return this.prepareSegment(0,t,n,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,l,f){return new Mi([{vertexOffset:t,primitiveOffset:n,vertexLength:l,primitiveLength:f,vaos:{},sortKey:0}])}}function Xn(r,t){return 256*(r=rn(Math.floor(r),0,255))+rn(Math.floor(t),0,255)}Mi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt("SegmentVector",Mi);const sr=gn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xa,ba,wa,zs={exports:{}},wl={exports:{}},Tl={exports:{}},Io=function(){if(wa)return zs.exports;wa=1;var r=(xa||(xa=1,wl.exports=function(n,l){var f,_,v,w,k,A,L,O;for(_=n.length-(f=3&n.length),v=l,k=3432918353,A=461845907,O=0;O<_;)L=255&n.charCodeAt(O)|(255&n.charCodeAt(++O))<<8|(255&n.charCodeAt(++O))<<16|(255&n.charCodeAt(++O))<<24,++O,v=27492+(65535&(w=5*(65535&(v=(v^=L=(65535&(L=(L=(65535&L)*k+(((L>>>16)*k&65535)<<16)&4294967295)<<15|L>>>17))*A+(((L>>>16)*A&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(L=0,f){case 3:L^=(255&n.charCodeAt(O+2))<<16;case 2:L^=(255&n.charCodeAt(O+1))<<8;case 1:v^=L=(65535&(L=(L=(65535&(L^=255&n.charCodeAt(O)))*k+(((L>>>16)*k&65535)<<16)&4294967295)<<15|L>>>17))*A+(((L>>>16)*A&65535)<<16)&4294967295}return v^=n.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),wl.exports),t=(ba||(ba=1,Tl.exports=function(n,l){for(var f,_=n.length,v=l^_,w=0;_>=4;)f=1540483477*(65535&(f=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(f>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),_-=4,++w;switch(_){case 3:v^=(255&n.charCodeAt(w+2))<<16;case 2:v^=(255&n.charCodeAt(w+1))<<8;case 1:v=1540483477*(65535&(v^=255&n.charCodeAt(w)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),Tl.exports);return zs.exports=r,zs.exports.murmur3=r,zs.exports.murmur2=t,zs.exports}(),Lr=J(Io);class ps{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,l,f){this.ids.push(Ta(t)),this.positions.push(n,l,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Ta(t);let l=0,f=this.ids.length-1;for(;l<f;){const v=l+f>>1;this.ids[v]>=n?f=v:l=v+1}const _=[];for(;this.ids[l]===n;)_.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return _}static serialize(t,n){const l=new Float64Array(t.ids),f=new Uint32Array(t.positions);return Wa(l,f,0,l.length-1),n&&n.push(l.buffer,f.buffer),{ids:l,positions:f}}static deserialize(t){const n=new ps;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Ta(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Lr(String(r))}function Wa(r,t,n,l){for(;n<l;){const f=r[n+l>>1];let _=n-1,v=l+1;for(;;){do _++;while(r[_]<f);do v--;while(r[v]>f);if(_>=v)break;Sn(r,_,v),Sn(t,3*_,3*v),Sn(t,3*_+1,3*v+1),Sn(t,3*_+2,3*v+2)}v-n<l-v?(Wa(r,t,n,v),n=v+1):(Wa(r,t,v+1,l),l=v)}}function Sn(r,t,n){const l=r[t];r[t]=r[n],r[n]=l}Lt("FeaturePositionMap",ps);class Qi{constructor(t,n){this.gl=t.gl,this.location=n}}class wr extends Qi{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class On extends Qi{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Vh extends Qi{constructor(t,n){super(t,n),this.current=ai.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ud=new Float32Array(16);function Ic(r){return[Xn(255*r.r,255*r.g),Xn(255*r.b,255*r.a)]}class Sl{constructor(t,n,l){this.value=t,this.uniformNames=n.map(f=>`u_${f}`),this.type=l}setUniform(t,n,l){t.set(l.constantOr(this.value))}getBinding(t,n,l){return this.type==="color"?new Vh(t,n):new wr(t,n)}}class ko{constructor(t,n){this.uniformNames=n.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,l,f){const _=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,n,l){return l.substr(0,9)==="u_pattern"?new On(t,n):new wr(t,n)}}class ea{constructor(t,n,l,f){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,n,l,f,_){const v=this.paintVertexArray.length,w=this.expression.evaluate(new nn(0),n,{},f,[],_);this.paintVertexArray.resize(t),this._setPaintValue(v,t,w)}updatePaintArray(t,n,l,f){const _=this.expression.evaluate({zoom:0},l,f);this._setPaintValue(t,n,_)}_setPaintValue(t,n,l){if(this.type==="color"){const f=Ic(l);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=t;f<n;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ar{constructor(t,n,l,f,_,v){this.expression=t,this.uniformNames=n.map(w=>`u_${w}_t`),this.type=l,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map(w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,n,l,f,_){const v=this.expression.evaluate(new nn(this.zoom),n,{},f,[],_),w=this.expression.evaluate(new nn(this.zoom+1),n,{},f,[],_),k=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(k,t,v,w)}updatePaintArray(t,n,l,f){const _=this.expression.evaluate({zoom:this.zoom},l,f),v=this.expression.evaluate({zoom:this.zoom+1},l,f);this._setPaintValue(t,n,_,v)}_setPaintValue(t,n,l,f){if(this.type==="color"){const _=Ic(l),v=Ic(f);for(let w=t;w<n;w++)this.paintVertexArray.emplace(w,_[0],_[1],v[0],v[1])}else{for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,l,f);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,f=rn(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,n,l){return new wr(t,n)}}class ta{constructor(t,n,l,f,_,v){this.expression=t,this.type=n,this.useIntegerZoom=l,this.zoom=f,this.layerId=v,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,n,l){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,n.patterns&&n.patterns[this.layerId],l)}updatePaintArray(t,n,l,f,_){this._setPaintValues(t,n,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(t,n,l,f){if(!f||!l)return;const{min:_,mid:v,max:w}=l,k=f[_],A=f[v],L=f[w];if(k&&A&&L)for(let O=t;O<n;O++)this.zoomInPaintVertexArray.emplace(O,A.tl[0],A.tl[1],A.br[0],A.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],A.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,A.tl[0],A.tl[1],A.br[0],A.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],A.pixelRatio,L.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,sr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,sr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class kc{constructor(t,n,l){this.binders={},this._buffers=[];const f=[];for(const _ in t.paint._values){if(!l(_))continue;const v=t.paint.get(_);if(!(v instanceof Ds&&Rs(v.property.specification)))continue;const w=Ec(_,t.type),k=v.value,A=v.property.specification.type,L=v.property.useIntegerZoom,O=v.property.specification["property-type"],V=O==="cross-faded"||O==="cross-faded-data-driven";if(k.kind==="constant")this.binders[_]=V?new ko(k.value,w):new Sl(k.value,w,A),f.push(`/u_${_}`);else if(k.kind==="source"||V){const $=Cc(_,A,"source");this.binders[_]=V?new ta(k,A,L,n,$,t.id):new ea(k,w,A,$),f.push(`/a_${_}`)}else{const $=Cc(_,A,"composite");this.binders[_]=new ar(k,w,A,L,n,$),f.push(`/z_${_}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof ea||n instanceof ar?n.maxValue:0}populatePaintArrays(t,n,l,f,_){for(const v in this.binders){const w=this.binders[v];(w instanceof ea||w instanceof ar||w instanceof ta)&&w.populatePaintArray(t,n,l,f,_)}}setConstantPatternPositions(t,n){for(const l in this.binders){const f=this.binders[l];f instanceof ko&&f.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,l,f,_){let v=!1;for(const w in t){const k=n.getPositions(w);for(const A of k){const L=l.feature(A.index);for(const O in this.binders){const V=this.binders[O];if((V instanceof ea||V instanceof ar||V instanceof ta)&&V.expression.isStateDependent===!0){const $=f.paint.get(O);V.expression=$.value,V.updatePaintArray(A.start,A.end,L,t[w],_),v=!0}}}}return v}defines(){const t=[];for(const n in this.binders){const l=this.binders[n];(l instanceof Sl||l instanceof ko)&&t.push(...l.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof ea||l instanceof ar)for(let f=0;f<l.paintVertexAttributes.length;f++)t.push(l.paintVertexAttributes[f].name);else if(l instanceof ta)for(let f=0;f<sr.members.length;f++)t.push(sr.members[f].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Sl||l instanceof ko||l instanceof ar)for(const f of l.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const l=[];for(const f in this.binders){const _=this.binders[f];if(_ instanceof Sl||_ instanceof ko||_ instanceof ar){for(const v of _.uniformNames)if(n[v]){const w=_.getBinding(t,n[v],v);l.push({name:v,property:f,binding:w})}}}return l}setUniforms(t,n,l,f){for(const{name:_,property:v,binding:w}of n)this.binders[v].setUniform(w,f,l.get(v),_)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(t&&l instanceof ta){const f=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(l instanceof ea||l instanceof ar)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const n in this.binders){const l=this.binders[n];(l instanceof ea||l instanceof ar||l instanceof ta)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof ea||n instanceof ar||n instanceof ta)&&n.destroy()}}}class Sa{constructor(t,n,l=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new kc(f,n,l);this.needsUpload=!1,this._featureMap=new ps,this._bufferOffset=0}populatePaintArrays(t,n,l,f,_,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,n,f,_,v);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,l,f){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,n,_,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ec(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Cc(r,t,n){const l={color:{source:bl,composite:U},number:{source:C,composite:bl}},f=function(_){return{"line-pattern":{source:zt,composite:zt},"fill-pattern":{source:zt,composite:zt},"fill-extrusion-pattern":{source:zt,composite:zt}}[_]}(r);return f&&f[n]||l[t][n]}Lt("ConstantBinder",Sl),Lt("CrossFadedConstantBinder",ko),Lt("SourceExpressionBinder",ea),Lt("CrossFadedCompositeBinder",ta),Lt("CompositeExpressionBinder",ar),Lt("ProgramConfiguration",kc,{omit:["_buffers"]}),Lt("ProgramConfigurationSet",Sa);const Il=Math.pow(2,14)-1,bm=-Il-1;function kl(r){const t=Jt/r.extent,n=r.loadGeometry();for(let l=0;l<n.length;l++){const f=n[l];for(let _=0;_<f.length;_++){const v=f[_],w=Math.round(v.x*t),k=Math.round(v.y*t);v.x=rn(w,bm,Il),v.y=rn(k,bm,Il),(w<v.x||w>v.x+1||k<v.y||k>v.y+1)&&rt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function El(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?kl(r):[]}}const wm=-32768;function L0(r,t,n,l,f){r.emplaceBack(wm+8*t+l,wm+8*n+f)}class cd{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ze,this.indexArray=new Zi,this.segments=new Mi,this.programConfigurations=new Sa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,l){const f=this.layers[0],_=[];let v=null,w=!1,k=f.type==="heatmap";if(f.type==="circle"){const L=f;v=L.layout.get("circle-sort-key"),w=!v.isConstant(),k=k||L.paint.get("circle-pitch-alignment")==="map"}const A=k?n.subdivisionGranularity.circle:1;for(const{feature:L,id:O,index:V,sourceLayerIndex:$}of t){const Z=this.layers[0]._featureFilter.needGeometry,K=El(L,Z);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom,{globalState:this.globalState}),K,l))continue;const se=w?v.evaluate(K,{},l):void 0,he={id:O,properties:L.properties,type:L.type,sourceLayerIndex:$,index:V,geometry:Z?K.geometry:kl(L),patterns:{},sortKey:se};_.push(he)}w&&_.sort((L,O)=>L.sortKey-O.sortKey);for(const L of _){const{geometry:O,index:V,sourceLayerIndex:$}=L,Z=t[V].feature;this.addFeature(L,O,V,l,A),n.featureIndex.insert(Z,O,V,$,this.index)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,l,f,_=1){let v;switch(_){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const w=v.length;for(const k of n)for(const A of k){const L=A.x,O=A.y;if(L<0||L>=Jt||O<0||O>=Jt)continue;const V=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,t.sortKey),$=V.vertexLength;for(let Z=0;Z<w;Z++)for(let K=0;K<w;K++)L0(this.layoutVertexArray,L,O,v[K],v[Z]);for(let Z=0;Z<w-1;Z++)for(let K=0;K<w-1;K++){const se=$+Z*w+K,he=$+(Z+1)*w+K;this.indexArray.emplaceBack(se,he+1,se+1),this.indexArray.emplaceBack(se,he,he+1)}V.vertexLength+=w*w,V.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},f)}}function Tm(r,t){for(let n=0;n<r.length;n++)if(Iu(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Iu(r,t[n]))return!0;return!!hd(r,t)}function D0(r,t,n){return!!Iu(r,t)||!!fd(t,r,n)}function Sm(r,t){if(r.length===1)return km(t,r[0]);for(let n=0;n<t.length;n++){const l=t[n];for(let f=0;f<l.length;f++)if(Iu(r,l[f]))return!0}for(let n=0;n<r.length;n++)if(km(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(hd(r,t[n]))return!0;return!1}function z0(r,t,n){if(r.length>1){if(hd(r,t))return!0;for(let l=0;l<t.length;l++)if(fd(t[l],r,n))return!0}for(let l=0;l<r.length;l++)if(fd(r[l],t,n))return!0;return!1}function hd(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const l=r[n],f=r[n+1];for(let _=0;_<t.length-1;_++)if(N0(l,f,t[_],t[_+1]))return!0}return!1}function N0(r,t,n,l){return kt(r,n,l)!==kt(t,n,l)&&kt(r,t,n)!==kt(r,t,l)}function fd(r,t,n){const l=n*n;if(t.length===1)return r.distSqr(t[0])<l;for(let f=1;f<t.length;f++)if(Im(r,t[f-1],t[f])<l)return!0;return!1}function Im(r,t,n){const l=t.distSqr(n);if(l===0)return r.distSqr(t);const f=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/l;return r.distSqr(f<0?t:f>1?n:n.sub(t)._mult(f)._add(t))}function km(r,t){let n,l,f,_=!1;for(let v=0;v<r.length;v++){n=r[v];for(let w=0,k=n.length-1;w<n.length;k=w++)l=n[w],f=n[k],l.y>t.y!=f.y>t.y&&t.x<(f.x-l.x)*(t.y-l.y)/(f.y-l.y)+l.x&&(_=!_)}return _}function Iu(r,t){let n=!1;for(let l=0,f=r.length-1;l<r.length;f=l++){const _=r[l],v=r[f];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(n=!n)}return n}function O0(r,t,n){const l=n[0],f=n[2];if(r.x<l.x&&t.x<l.x||r.x>f.x&&t.x>f.x||r.y<l.y&&t.y<l.y||r.y>f.y&&t.y>f.y)return!1;const _=kt(r,t,n[0]);return _!==kt(r,t,n[1])||_!==kt(r,t,n[2])||_!==kt(r,t,n[3])}function Pc(r,t,n){const l=t.paint.get(r).value;return l.kind==="constant"?l.value:n.programConfigurations.get(t.id).getMaxValue(r)}function Uh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Gh(r,t,n,l,f){if(!t[0]&&!t[1])return r;const _=le.convert(t)._mult(f);n==="viewport"&&_._rotate(-l);const v=[];for(let w=0;w<r.length;w++)v.push(r[w].sub(_));return v}let Em,Cm;Lt("CircleBucket",cd,{omit:["layers"]});var F0={get paint(){return Cm=Cm||new br({"circle-radius":new ni(be.paint_circle["circle-radius"]),"circle-color":new ni(be.paint_circle["circle-color"]),"circle-blur":new ni(be.paint_circle["circle-blur"]),"circle-opacity":new ni(be.paint_circle["circle-opacity"]),"circle-translate":new Ft(be.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ni(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ni(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ni(be.paint_circle["circle-stroke-opacity"])})},get layout(){return Em=Em||new br({"circle-sort-key":new ni(be.layout_circle["circle-sort-key"])})}};class B0 extends nr{constructor(t){super(t,F0)}createBucket(t){return new cd(t)}queryRadius(t){const n=t;return Pc("circle-radius",this,n)+Pc("circle-stroke-width",this,n)+Uh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:l,geometry:f,transform:_,pixelsToTileUnits:v,unwrappedTileID:w,getElevation:k}){const A=Gh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,v),L=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),O=this.paint.get("circle-pitch-alignment")==="map",V=O?A:function(Z,K,se,he){return Z.map(Ie=>Pm(Ie,K,se,he))}(A,_,w,k),$=O?L*v:L;for(const Z of f)for(const K of Z){const se=O?K:Pm(K,_,w,k);let he=$;const Ie=_.projectTileCoordinates(K.x,K.y,w,k).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=Ie/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=_.cameraToCenterDistance/Ie),D0(V,se,he))return!0}return!1}}function Pm(r,t,n,l){const f=t.projectTileCoordinates(r.x,r.y,n,l).point;return new le((.5*f.x+.5)*t.width,(.5*-f.y+.5)*t.height)}class Mm extends cd{}let Am;Lt("HeatmapBucket",Mm,{omit:["layers"]});var j0={get paint(){return Am=Am||new br({"heatmap-radius":new ni(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ni(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xl(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft(be.paint_heatmap["heatmap-opacity"])})}};function dd(r,{width:t,height:n},l,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*n*l)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*n*l}`)}else f=new Uint8Array(t*n*l);return r.width=t,r.height=n,r.data=f,r}function Rm(r,{width:t,height:n},l){if(t===r.width&&n===r.height)return;const f=dd({},{width:t,height:n},l);pd(r,f,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},l),r.width=t,r.height=n,r.data=f.data}function pd(r,t,n,l,f,_){if(f.width===0||f.height===0)return t;if(f.width>r.width||f.height>r.height||n.x>r.width-f.width||n.y>r.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||l.x>t.width-f.width||l.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=r.data,w=t.data;if(v===w)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<f.height;k++){const A=((n.y+k)*r.width+n.x)*_,L=((l.y+k)*t.width+l.x)*_;for(let O=0;O<f.width*_;O++)w[L+O]=v[A+O]}return t}class Mc{constructor(t,n){dd(this,t,1,n)}resize(t){Rm(this,t,1)}clone(){return new Mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,l,f,_){pd(t,n,l,f,_,1)}}class qr{constructor(t,n){dd(this,t,4,n)}resize(t){Rm(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,l,f,_){pd(t,n,l,f,_,4)}setPixel(t,n,l){const f=4*(t*this.width+n);this.data[f+0]=Math.round(255*l.r/l.a),this.data[f+1]=Math.round(255*l.g/l.a),this.data[f+2]=Math.round(255*l.b/l.a),this.data[f+3]=Math.round(255*l.a)}}function Lm(r){const t={},n=r.resolution||256,l=r.clips?r.clips.length:1,f=r.image||new qr({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const _=(v,w,k)=>{t[r.evaluationKey]=k;const A=r.expression.evaluate(t);f.setPixel(v/4/n,w/4,A)};if(r.clips)for(let v=0,w=0;v<l;++v,w+=4*n)for(let k=0,A=0;k<n;k++,A+=4){const L=k/(n-1),{start:O,end:V}=r.clips[v];_(w,A,O*(1-L)+V*L)}else for(let v=0,w=0;v<n;v++,w+=4)_(0,w,v/(n-1));return f}Lt("AlphaImage",Mc),Lt("RGBAImage",qr);const md="big-fb";class V0 extends nr{createBucket(t){return new Mm(t)}constructor(t){super(t,j0),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(md)&&this.heatmapFbos.delete(md)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Dm;var U0={get paint(){return Dm=Dm||new br({"hillshade-illumination-direction":new Ft(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ft(be.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ft(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft(be.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ft(be.paint_hillshade["hillshade-method"])})}};class G0 extends nr{constructor(t){super(t,U0),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values;const _=Math.max(t.length,n.length,l.length,f.length);t=t.concat(Array(_-t.length).fill(t.at(-1))),n=n.concat(Array(_-n.length).fill(n.at(-1))),l=l.concat(Array(_-l.length).fill(l.at(-1))),f=f.concat(Array(_-f.length).fill(f.at(-1)));const v=n.map(gi);return{directionRadians:t.map(gi),altitudeRadians:v,shadowColor:f,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let zm;var q0={get paint(){return zm=zm||new br({"color-relief-opacity":new Ft(be["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new xl(be["paint_color-relief"]["color-relief-color"])})}};class gd{constructor(t,n,l,f){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(n,f)}update(t,n,l){const{width:f,height:_}=t,v=!(this.size&&this.size[0]===f&&this.size[1]===_||l),{context:w}=this,{gl:k}=w;if(this.useMipmap=!!(n&&n.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!n||n.premultiply!==!1)),v)this.size=[f,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||_t(t)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,t):k.texImage2D(k.TEXTURE_2D,0,this.format,f,_,0,this.format,k.UNSIGNED_BYTE,t.data);else{const{x:A,y:L}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||_t(t)?k.texSubImage2D(k.TEXTURE_2D,0,A,L,k.RGBA,k.UNSIGNED_BYTE,t):k.texSubImage2D(k.TEXTURE_2D,0,A,L,f,_,k.RGBA,k.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,l){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),l!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l||t),this.filter=t),n!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Nm{constructor(t,n,l,f=1,_=1,v=1,w=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void rt(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const k=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=_,this.blueFactor=v,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<k;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(k,A)]=this.data[this._idx(k-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,k)]=this.data[this._idx(A,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<k;A++)for(let L=0;L<k;L++){const O=this.get(A,L);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,n){const l=new Uint8Array(this.data.buffer),f=4*this._idx(t,n);return this.unpack(l[f],l[f+1],l[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,l){return t*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}pack(t){return Om(t,this.getUnpackVector())}getPixels(){return new qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=n*this.dim,_=n*this.dim+this.dim,v=l*this.dim,w=l*this.dim+this.dim;switch(n){case-1:f=_-1;break;case 1:_=f+1}switch(l){case-1:v=w-1;break;case 1:w=v+1}const k=-n*this.dim,A=-l*this.dim;for(let L=v;L<w;L++)for(let O=f;O<_;O++)this.data[this._idx(O,L)]=t.data[this._idx(O+k,L+A)]}}function Om(r,t){const n=t[0],l=t[1],f=t[2],_=t[3],v=Math.min(n,l,f),w=Math.round((r+_)/v);return{r:Math.floor(w*v/n)%256,g:Math.floor(w*v/l)%256,b:Math.floor(w*v/f)%256}}Lt("DEMData",Nm);class $0 extends nr{constructor(t){super(t,q0)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof ul&&l._styleExpression.expression instanceof ir){this.colorRampExpression=l;const v=l._styleExpression.expression;n.elevationStops=v.labels,n.colorStops=[];for(const w of n.elevationStops)n.colorStops.push(v.evaluate({globals:{elevation:w}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[ai.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const f={elevationStops:[],colorStops:[]},_=(n.elevationStops.length-1)/(t-1);for(let v=0;v<n.elevationStops.length-.5;v+=_)f.elevationStops.push(n.elevationStops[Math.round(v)]),f.colorStops.push(n.colorStops[Math.round(v)]);return rt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),f}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const f=this._createColorRamp(n),_=new qr({width:f.colorStops.length,height:1}),v=new qr({width:f.colorStops.length,height:1});for(let w=0;w<f.elevationStops.length;w++){const k=Om(f.elevationStops[w],l);v.setPixel(0,w,new ai(k.r/255,k.g/255,k.b/255,1)),_.setPixel(0,w,f.colorStops[w])}return this.colorRampTextures={elevationTexture:new gd(t,v,t.gl.RGBA),colorTexture:new gd(t,_,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Z0=gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:H0}=Z0;function _d(r,t,n){const l=n.patternDependencies;let f=!1;for(const _ of t){const v=_.paint.get(`${r}-pattern`);v.isConstant()||(f=!0);const w=v.constantOr(null);w&&(f=!0,l[w.to]=!0,l[w.from]=!0)}return f}function yd(r,t,n,l,f){const _=f.patternDependencies;for(const v of t){const w=v.paint.get(`${r}-pattern`).value;if(w.kind!=="constant"){let k=w.evaluate({zoom:l-1},n,{},f.availableImages),A=w.evaluate({zoom:l},n,{},f.availableImages),L=w.evaluate({zoom:l+1},n,{},f.availableImages);k=k&&k.name?k.name:k,A=A&&A.name?A.name:A,L=L&&L.name?L.name:L,_[k]=!0,_[A]=!0,_[L]=!0,n.patterns[v.id]={min:k,mid:A,max:L}}}return n}function Fm(r,t,n,l,f){let _;if(f===function(v,w,k,A){let L=0;for(let O=w,V=k-A;O<k;O+=A)L+=(v[V]-v[O])*(v[O+1]+v[V+1]),V=O;return L}(r,t,n,l)>0)for(let v=t;v<n;v+=l)_=Um(v/l|0,r[v],r[v+1],_);else for(let v=n-l;v>=t;v-=l)_=Um(v/l|0,r[v],r[v+1],_);return _&&ku(_,_.next)&&(Dc(_),_=_.next),_}function Cl(r,t){if(!r)return r;t||(t=r);let n,l=r;do if(n=!1,l.steiner||!ku(l,l.next)&&kn(l.prev,l,l.next)!==0)l=l.next;else{if(Dc(l),l=t=l.prev,l===l.next)break;n=!0}while(n||l!==t);return t}function Ac(r,t,n,l,f,_,v){if(!r)return;!v&&_&&function(k,A,L,O){let V=k;do V.z===0&&(V.z=vd(V.x,V.y,A,L,O)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==k);V.prevZ.nextZ=null,V.prevZ=null,function($){let Z,K=1;do{let se,he=$;$=null;let Ie=null;for(Z=0;he;){Z++;let ye=he,G=0;for(let ve=0;ve<K&&(G++,ye=ye.nextZ,ye);ve++);let ne=K;for(;G>0||ne>0&&ye;)G!==0&&(ne===0||!ye||he.z<=ye.z)?(se=he,he=he.nextZ,G--):(se=ye,ye=ye.nextZ,ne--),Ie?Ie.nextZ=se:$=se,se.prevZ=Ie,Ie=se;he=ye}Ie.nextZ=null,K*=2}while(Z>1)}(V)}(r,l,f,_);let w=r;for(;r.prev!==r.next;){const k=r.prev,A=r.next;if(_?W0(r,l,f,_):X0(r))t.push(k.i,r.i,A.i),Dc(r),r=A.next,w=A.next;else if((r=A)===w){v?v===1?Ac(r=Y0(Cl(r),t),t,n,l,f,_,2):v===2&&K0(r,t,n,l,f,_):Ac(Cl(r),t,n,l,f,_,1);break}}}function X0(r){const t=r.prev,n=r,l=r.next;if(kn(t,n,l)>=0)return!1;const f=t.x,_=n.x,v=l.x,w=t.y,k=n.y,A=l.y,L=Math.min(f,_,v),O=Math.min(w,k,A),V=Math.max(f,_,v),$=Math.max(w,k,A);let Z=l.next;for(;Z!==t;){if(Z.x>=L&&Z.x<=V&&Z.y>=O&&Z.y<=$&&Rc(f,w,_,k,v,A,Z.x,Z.y)&&kn(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function W0(r,t,n,l){const f=r.prev,_=r,v=r.next;if(kn(f,_,v)>=0)return!1;const w=f.x,k=_.x,A=v.x,L=f.y,O=_.y,V=v.y,$=Math.min(w,k,A),Z=Math.min(L,O,V),K=Math.max(w,k,A),se=Math.max(L,O,V),he=vd($,Z,t,n,l),Ie=vd(K,se,t,n,l);let ye=r.prevZ,G=r.nextZ;for(;ye&&ye.z>=he&&G&&G.z<=Ie;){if(ye.x>=$&&ye.x<=K&&ye.y>=Z&&ye.y<=se&&ye!==f&&ye!==v&&Rc(w,L,k,O,A,V,ye.x,ye.y)&&kn(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,G.x>=$&&G.x<=K&&G.y>=Z&&G.y<=se&&G!==f&&G!==v&&Rc(w,L,k,O,A,V,G.x,G.y)&&kn(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;ye&&ye.z>=he;){if(ye.x>=$&&ye.x<=K&&ye.y>=Z&&ye.y<=se&&ye!==f&&ye!==v&&Rc(w,L,k,O,A,V,ye.x,ye.y)&&kn(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;G&&G.z<=Ie;){if(G.x>=$&&G.x<=K&&G.y>=Z&&G.y<=se&&G!==f&&G!==v&&Rc(w,L,k,O,A,V,G.x,G.y)&&kn(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function Y0(r,t){let n=r;do{const l=n.prev,f=n.next.next;!ku(l,f)&&jm(l,n,n.next,f)&&Lc(l,f)&&Lc(f,l)&&(t.push(l.i,n.i,f.i),Dc(n),Dc(n.next),n=r=f),n=n.next}while(n!==r);return Cl(n)}function K0(r,t,n,l,f,_){let v=r;do{let w=v.next.next;for(;w!==v.prev;){if(v.i!==w.i&&ix(v,w)){let k=Vm(v,w);return v=Cl(v,v.next),k=Cl(k,k.next),Ac(v,t,n,l,f,_,0),void Ac(k,t,n,l,f,_,0)}w=w.next}v=v.next}while(v!==r)}function J0(r,t){let n=r.x-t.x;return n===0&&(n=r.y-t.y,n===0)&&(n=(r.next.y-r.y)/(r.next.x-r.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Q0(r,t){const n=function(f,_){let v=_;const w=f.x,k=f.y;let A,L=-1/0;if(ku(f,v))return v;do{if(ku(f,v.next))return v.next;if(k<=v.y&&k>=v.next.y&&v.next.y!==v.y){const K=v.x+(k-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(K<=w&&K>L&&(L=K,A=v.x<v.next.x?v:v.next,K===w))return A}v=v.next}while(v!==_);if(!A)return null;const O=A,V=A.x,$=A.y;let Z=1/0;v=A;do{if(w>=v.x&&v.x>=V&&w!==v.x&&Bm(k<$?w:L,k,V,$,k<$?L:w,k,v.x,v.y)){const K=Math.abs(k-v.y)/(w-v.x);Lc(v,f)&&(K<Z||K===Z&&(v.x>A.x||v.x===A.x&&ex(A,v)))&&(A=v,Z=K)}v=v.next}while(v!==O);return A}(r,t);if(!n)return t;const l=Vm(n,r);return Cl(l,l.next),Cl(n,n.next)}function ex(r,t){return kn(r.prev,r,t.prev)<0&&kn(t.next,r,r.next)<0}function vd(r,t,n,l,f){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function tx(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function Bm(r,t,n,l,f,_,v,w){return(f-v)*(t-w)>=(r-v)*(_-w)&&(r-v)*(l-w)>=(n-v)*(t-w)&&(n-v)*(_-w)>=(f-v)*(l-w)}function Rc(r,t,n,l,f,_,v,w){return!(r===v&&t===w)&&Bm(r,t,n,l,f,_,v,w)}function ix(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,l){let f=n;do{if(f.i!==n.i&&f.next.i!==n.i&&f.i!==l.i&&f.next.i!==l.i&&jm(f,f.next,n,l))return!0;f=f.next}while(f!==n);return!1}(r,t)&&(Lc(r,t)&&Lc(t,r)&&function(n,l){let f=n,_=!1;const v=(n.x+l.x)/2,w=(n.y+l.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&v<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next;while(f!==n);return _}(r,t)&&(kn(r.prev,r,t.prev)||kn(r,t.prev,t))||ku(r,t)&&kn(r.prev,r,r.next)>0&&kn(t.prev,t,t.next)>0)}function kn(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function ku(r,t){return r.x===t.x&&r.y===t.y}function jm(r,t,n,l){const f=$h(kn(r,t,n)),_=$h(kn(r,t,l)),v=$h(kn(n,l,r)),w=$h(kn(n,l,t));return f!==_&&v!==w||!(f!==0||!qh(r,n,t))||!(_!==0||!qh(r,l,t))||!(v!==0||!qh(n,r,l))||!(w!==0||!qh(n,t,l))}function qh(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function $h(r){return r>0?1:r<0?-1:0}function Lc(r,t){return kn(r.prev,r,r.next)<0?kn(r,t,r.next)>=0&&kn(r,r.prev,t)>=0:kn(r,t,r.prev)<0||kn(r,r.next,t)<0}function Vm(r,t){const n=xd(r.i,r.x,r.y),l=xd(t.i,t.x,t.y),f=r.next,_=t.prev;return r.next=t,t.prev=r,n.next=f,f.prev=n,l.next=n,n.prev=l,_.next=l,l.prev=_,l}function Um(r,t,n,l){const f=xd(r,t,n);return l?(f.next=l.next,f.prev=l,l.next.prev=f,l.next=f):(f.prev=f,f.next=f),f}function Dc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function xd(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Eu{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Zh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Zh.noSubdivision=new Zh({fill:new Eu(0,0),line:new Eu(0,0),tile:new Eu(0,0),stencil:new Eu(0,0),circle:1}),Lt("SubdivisionGranularityExpression",Eu),Lt("SubdivisionGranularitySetting",Zh);const Cu=-32768,zc=32767;class nx{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Jt/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(t),f=0|Math.round(n),_=this._getKey(l,f);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,v),this._vertexBuffer.push(l,f),v}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(f,_){const v=[];for(let w=0;w<_.length;w+=3){const k=_[w],A=_[w+1],L=_[w+2],O=f[2*k],V=f[2*k+1];(f[2*A]-O)*(f[2*L+1]-V)-(f[2*A+1]-V)*(f[2*L]-O)>0?(v.push(k),v.push(L),v.push(A)):(v.push(k),v.push(A),v.push(L))}return v}(this._vertexBuffer,t);const n=[],l=t.length;for(let f=0;f<l;f+=3){const _=[t[f+0],t[f+1],t[f+2]],v=[this._vertexBuffer[2*t[f+0]+0],this._vertexBuffer[2*t[f+0]+1],this._vertexBuffer[2*t[f+1]+0],this._vertexBuffer[2*t[f+1]+1],this._vertexBuffer[2*t[f+2]+0],this._vertexBuffer[2*t[f+2]+1]];let w=1/0,k=1/0,A=-1/0,L=-1/0;for(let K=0;K<3;K++){const se=v[2*K],he=v[2*K+1];w=Math.min(w,se),A=Math.max(A,se),k=Math.min(k,he),L=Math.max(L,he)}if(w===A||k===L)continue;const O=Math.floor(w/this._granularityCellSize),V=Math.ceil(A/this._granularityCellSize),$=Math.floor(k/this._granularityCellSize),Z=Math.ceil(L/this._granularityCellSize);if(O!==V||$!==Z)for(let K=$;K<Z;K++){const se=this._scanlineGenerateVertexRingForCellRow(K,v,_);rx(this._vertexBuffer,se,n)}else n.push(..._)}return n}_scanlineGenerateVertexRingForCellRow(t,n,l){const f=t*this._granularityCellSize,_=f+this._granularityCellSize,v=[];for(let w=0;w<3;w++){const k=n[2*w],A=n[2*w+1],L=n[2*(w+1)%6],O=n[(2*(w+1)+1)%6],V=n[2*(w+2)%6],$=n[(2*(w+2)+1)%6],Z=L-k,K=O-A,se=Z===0,he=K===0,Ie=(f-A)/K,ye=(_-A)/K,G=Math.min(Ie,ye),ne=Math.max(Ie,ye);if(!he&&(G>=1||ne<=0)||he&&(A<f||A>_)){O>=f&&O<=_&&v.push(l[(w+1)%3]);continue}!he&&G>0&&v.push(this._vertexToIndex(k+Z*G,A+K*G));const ve=k+Z*Math.max(G,0),Oe=k+Z*Math.min(ne,1);se||this._generateIntraEdgeVertices(v,k,A,L,O,ve,Oe),!he&&ne<1&&v.push(this._vertexToIndex(k+Z*ne,A+K*ne)),(he||O>=f&&O<=_)&&v.push(l[(w+1)%3]),!he&&(O<=f||O>=_)&&this._generateInterEdgeVertices(v,k,A,L,O,V,$,Oe,f,_)}return v}_generateIntraEdgeVertices(t,n,l,f,_,v,w){const k=f-n,A=_-l,L=A===0,O=L?Math.min(n,f):Math.min(v,w),V=L?Math.max(n,f):Math.max(v,w),$=Math.floor(O/this._granularityCellSize)+1,Z=Math.ceil(V/this._granularityCellSize)-1;if(L?n<f:v<w)for(let K=$;K<=Z;K++){const se=K*this._granularityCellSize;t.push(this._vertexToIndex(se,l+A*(se-n)/k))}else for(let K=Z;K>=$;K--){const se=K*this._granularityCellSize;t.push(this._vertexToIndex(se,l+A*(se-n)/k))}}_generateInterEdgeVertices(t,n,l,f,_,v,w,k,A,L){const O=_-l,V=v-f,$=w-_,Z=(A-_)/$,K=(L-_)/$,se=Math.min(Z,K),he=Math.max(Z,K),Ie=f+V*se;let ye=Math.floor(Math.min(Ie,k)/this._granularityCellSize)+1,G=Math.ceil(Math.max(Ie,k)/this._granularityCellSize)-1,ne=k<Ie;const ve=$===0;if(ve&&(w===A||w===L))return;if(ve||se>=1||he<=0){const nt=l-w,Ve=v+(n-v)*Math.min((A-w)/nt,(L-w)/nt);ye=Math.floor(Math.min(Ve,k)/this._granularityCellSize)+1,G=Math.ceil(Math.max(Ve,k)/this._granularityCellSize)-1,ne=k<Ve}const Oe=O>0?L:A;if(ne)for(let nt=ye;nt<=G;nt++)t.push(this._vertexToIndex(nt*this._granularityCellSize,Oe));else for(let nt=G;nt>=ye;nt--)t.push(this._vertexToIndex(nt*this._granularityCellSize,Oe))}_generateOutline(t){const n=[];for(const l of t){const f=Pl(l,this._granularity,!0),_=this._pointArrayToIndices(f),v=[];for(let w=1;w<_.length;w++)v.push(_[w-1]),v.push(_[w]);n.push(v)}return n}_handlePoles(t){let n=!1,l=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(n||l)&&this._fillPoles(t,n,l)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const l=t[n+1];l===Cu&&(t[n+1]=-32767),l===zc&&(t[n+1]=32766)}}_generatePoleQuad(t,n,l,f,_,v){f>_!=(v===Cu)?(t.push(n),t.push(l),t.push(this._vertexToIndex(f,v)),t.push(l),t.push(this._vertexToIndex(_,v)),t.push(this._vertexToIndex(f,v))):(t.push(l),t.push(n),t.push(this._vertexToIndex(f,v)),t.push(this._vertexToIndex(_,v)),t.push(l),t.push(this._vertexToIndex(f,v)))}_fillPoles(t,n,l){const f=this._vertexBuffer,_=Jt,v=t.length;for(let w=2;w<v;w+=3){const k=t[w-2],A=t[w-1],L=t[w],O=f[2*k],V=f[2*k+1],$=f[2*A],Z=f[2*A+1],K=f[2*L],se=f[2*L+1];n&&(V===0&&Z===0&&this._generatePoleQuad(t,k,A,O,$,Cu),Z===0&&se===0&&this._generatePoleQuad(t,A,L,$,K,Cu),se===0&&V===0&&this._generatePoleQuad(t,L,k,K,O,Cu)),l&&(V===_&&Z===_&&this._generatePoleQuad(t,k,A,O,$,zc),Z===_&&se===_&&this._generatePoleQuad(t,A,L,$,K,zc),se===_&&V===_&&this._generatePoleQuad(t,L,k,K,O,zc))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:f}=function(w){const k=[],A=[];for(const L of w)if(L.length!==0){L!==w[0]&&k.push(A.length/2);for(let O=0;O<L.length;O++)A.push(L[O].x),A.push(L[O].y)}return{flattened:A,holeIndices:k}}(t);let _;this._initializeVertices(l);try{const w=function(A,L,O=2){const V=L&&L.length,$=V?L[0]*O:A.length;let Z=Fm(A,0,$,O,!0);const K=[];if(!Z||Z.next===Z.prev)return K;let se,he,Ie;if(V&&(Z=function(ye,G,ne,ve){const Oe=[];for(let nt=0,Ve=G.length;nt<Ve;nt++){const $e=Fm(ye,G[nt]*ve,nt<Ve-1?G[nt+1]*ve:ye.length,ve,!1);$e===$e.next&&($e.steiner=!0),Oe.push(tx($e))}Oe.sort(J0);for(let nt=0;nt<Oe.length;nt++)ne=Q0(Oe[nt],ne);return ne}(A,L,Z,O)),A.length>80*O){se=1/0,he=1/0;let ye=-1/0,G=-1/0;for(let ne=O;ne<$;ne+=O){const ve=A[ne],Oe=A[ne+1];ve<se&&(se=ve),Oe<he&&(he=Oe),ve>ye&&(ye=ve),Oe>G&&(G=Oe)}Ie=Math.max(ye-se,G-he),Ie=Ie!==0?32767/Ie:0}return Ac(Z,K,O,se,he,Ie,0),K}(l,f),k=this._convertIndices(l,w);_=this._subdivideTrianglesScanline(k)}catch(w){console.error(w)}let v=[];return n&&(v=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:v}}_convertIndices(t,n){const l=[];for(let f=0;f<n.length;f++)l.push(this._vertexToIndex(t[2*n[f]],t[2*n[f]+1]));return l}_pointArrayToIndices(t){const n=[];for(let l=0;l<t.length;l++){const f=t[l];n.push(this._vertexToIndex(f.x,f.y))}return n}}function Gm(r,t,n,l=!0){return new nx(n,t).subdividePolygonInternal(r,l)}function Pl(r,t,n=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const l=r[0],f=r[r.length-1],_=n&&(l.x!==f.x||l.y!==f.y);if(t<2)return _?[...r,r[0]]:[...r];const v=Math.floor(Jt/t),w=[];w.push(new le(r[0].x,r[0].y));const k=r.length,A=_?k:k-1;for(let L=0;L<A;L++){const O=r[L],V=L<k-1?r[L+1]:r[0],$=O.x,Z=O.y,K=V.x,se=V.y,he=$!==K,Ie=Z!==se;if(!he&&!Ie)continue;const ye=K-$,G=se-Z,ne=Math.abs(ye),ve=Math.abs(G);let Oe=$,nt=Z;for(;;){const $e=ye>0?(Math.floor(Oe/v)+1)*v:(Math.ceil(Oe/v)-1)*v,gt=G>0?(Math.floor(nt/v)+1)*v:(Math.ceil(nt/v)-1)*v,at=Math.abs(Oe-$e),yt=Math.abs(nt-gt),Je=Math.abs(Oe-K),Nt=Math.abs(nt-se),ei=he?at/ne:Number.POSITIVE_INFINITY,Kt=Ie?yt/ve:Number.POSITIVE_INFINITY;if((Je<=at||!he)&&(Nt<=yt||!Ie))break;if(ei<Kt&&he||!Ie){Oe=$e,nt+=G*ei;const Gt=new le(Oe,Math.round(nt));w[w.length-1].x===Gt.x&&w[w.length-1].y===Gt.y||w.push(Gt)}else{Oe+=ye*Kt,nt=gt;const Gt=new le(Math.round(Oe),nt);w[w.length-1].x===Gt.x&&w[w.length-1].y===Gt.y||w.push(Gt)}}const Ve=new le(K,se);w[w.length-1].x===Ve.x&&w[w.length-1].y===Ve.y||w.push(Ve)}return w}function rx(r,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,f=r[2*t[0]];for(let k=1;k<t.length;k++){const A=r[2*t[k]];A<f&&(f=A,l=k)}const _=t.length;let v=l,w=(v+1)%_;for(;;){const k=v-1>=0?v-1:_-1,A=(w+1)%_,L=r[2*t[k]],O=r[2*t[A]],V=r[2*t[v]],$=r[2*t[v]+1],Z=r[2*t[w]+1];let K=!1;if(L<O)K=!0;else if(L>O)K=!1;else{const se=Z-$,he=-(r[2*t[w]]-V),Ie=$<Z?1:-1;((L-V)*se+(r[2*t[k]+1]-$)*he)*Ie>((O-V)*se+(r[2*t[A]+1]-$)*he)*Ie&&(K=!0)}if(K){const se=t[k],he=t[v],Ie=t[w];se!==he&&se!==Ie&&he!==Ie&&n.push(Ie,he,se),v--,v<0&&(v=_-1)}else{const se=t[A],he=t[v],Ie=t[w];se!==he&&se!==Ie&&he!==Ie&&n.push(Ie,he,se),w++,w>=_&&(w=0)}if(k===A)break}}function qm(r,t,n,l,f,_,v,w,k){const A=f.length/2,L=v&&w&&k;if(A<Mi.MAX_VERTEX_ARRAY_LENGTH){const O=t.prepareSegment(A,n,l),V=O.vertexLength;for(let K=0;K<_.length;K+=3)l.emplaceBack(V+_[K],V+_[K+1],V+_[K+2]);let $,Z;O.vertexLength+=A,O.primitiveLength+=_.length/3,L&&(Z=v.prepareSegment(A,n,w),$=Z.vertexLength,Z.vertexLength+=A);for(let K=0;K<f.length;K+=2)r(f[K],f[K+1]);if(L)for(let K=0;K<k.length;K++){const se=k[K];for(let he=1;he<se.length;he+=2)w.emplaceBack($+se[he-1],$+se[he]);Z.primitiveLength+=se.length/2}}else(function(O,V,$,Z,K,se){const he=[];for(let ve=0;ve<Z.length/2;ve++)he.push(-1);const Ie={count:0};let ye=0,G=O.getOrCreateLatestSegment(V,$),ne=G.vertexLength;for(let ve=2;ve<K.length;ve+=3){const Oe=K[ve-2],nt=K[ve-1],Ve=K[ve];let $e=he[Oe]<ye,gt=he[nt]<ye,at=he[Ve]<ye;G.vertexLength+(($e?1:0)+(gt?1:0)+(at?1:0))>Mi.MAX_VERTEX_ARRAY_LENGTH&&(G=O.createNewSegment(V,$),ye=Ie.count,$e=!0,gt=!0,at=!0,ne=0);const yt=Nc(he,Z,se,Ie,Oe,$e,G),Je=Nc(he,Z,se,Ie,nt,gt,G),Nt=Nc(he,Z,se,Ie,Ve,at,G);$.emplaceBack(ne+yt-ye,ne+Je-ye,ne+Nt-ye),G.primitiveLength++}})(t,n,l,f,_,r),L&&function(O,V,$,Z,K,se){const he=[];for(let ve=0;ve<Z.length/2;ve++)he.push(-1);const Ie={count:0};let ye=0,G=O.getOrCreateLatestSegment(V,$),ne=G.vertexLength;for(let ve=0;ve<K.length;ve++){const Oe=K[ve];for(let nt=1;nt<K[ve].length;nt+=2){const Ve=Oe[nt-1],$e=Oe[nt];let gt=he[Ve]<ye,at=he[$e]<ye;G.vertexLength+((gt?1:0)+(at?1:0))>Mi.MAX_VERTEX_ARRAY_LENGTH&&(G=O.createNewSegment(V,$),ye=Ie.count,gt=!0,at=!0,ne=0);const yt=Nc(he,Z,se,Ie,Ve,gt,G),Je=Nc(he,Z,se,Ie,$e,at,G);$.emplaceBack(ne+yt-ye,ne+Je-ye),G.primitiveLength++}}}(v,n,w,f,k,r),t.forceNewSegmentOnNextPrepare(),v?.forceNewSegmentOnNextPrepare()}function Nc(r,t,n,l,f,_,v){if(_){const w=l.count;return n(t[2*f],t[2*f+1]),r[f]=l.count,l.count++,v.vertexLength++,w}return r[f]}class bd{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new je,this.indexArray=new Zi,this.indexArray2=new qi,this.programConfigurations=new Sa(t.layers,t.zoom),this.segments=new Mi,this.segments2=new Mi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,l){this.hasPattern=_d("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),_=!f.isConstant(),v=[];for(const{feature:w,id:k,index:A,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,V=El(w,O);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom,{globalState:this.globalState}),V,l))continue;const $=_?f.evaluate(V,{},l,n.availableImages):void 0,Z={id:k,properties:w.properties,type:w.type,sourceLayerIndex:L,index:A,geometry:O?V.geometry:kl(w),patterns:{},sortKey:$};v.push(Z)}_&&v.sort((w,k)=>w.sortKey-k.sortKey);for(const w of v){const{geometry:k,index:A,sourceLayerIndex:L}=w;if(this.hasPattern){const O=yd("fill",this.layers,w,this.zoom,n);this.patternFeatures.push(O)}else this.addFeature(w,k,A,l,{},n.subdivisionGranularity);n.featureIndex.insert(t[A].feature,k,A,L,this.index)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,l)}addFeatures(t,n,l){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,H0),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,l,f,_,v){for(const w of Ga(n,500)){const k=Gm(w,f,v.fill.getGranularityForZoomLevel(f.z)),A=this.layoutVertexArray;qm((L,O)=>{A.emplaceBack(L,O)},this.segments,this.layoutVertexArray,this.indexArray,k.verticesFlattened,k.indicesTriangles,this.segments2,this.indexArray2,k.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,_,f)}}let $m,Zm;Lt("FillBucket",bd,{omit:["layers","patternFeatures"]});var sx={get paint(){return Zm=Zm||new br({"fill-antialias":new Ft(be.paint_fill["fill-antialias"]),"fill-opacity":new ni(be.paint_fill["fill-opacity"]),"fill-color":new ni(be.paint_fill["fill-color"]),"fill-outline-color":new ni(be.paint_fill["fill-outline-color"]),"fill-translate":new Ft(be.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new wu(be.paint_fill["fill-pattern"])})},get layout(){return $m=$m||new br({"fill-sort-key":new ni(be.layout_fill["fill-sort-key"])})}};class ax extends nr{constructor(t){super(t,sx)}recalculate(t,n){super.recalculate(t,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new bd(t)}queryRadius(){return Uh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:l,pixelsToTileUnits:f}){return Sm(Gh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,f),n)}isTileClipped(){return!0}}const ox=gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),lx=gn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ux}=ox;var wd,Hm,Td,Xm,Sd,Wm,Ym,Hh={};function Km(){if(Hm)return wd;Hm=1;var r=ie();function t(f,_,v,w,k){this.properties={},this.extent=v,this.type=0,this._pbf=f,this._geometry=-1,this._keys=w,this._values=k,f.readFields(n,this,_)}function n(f,_,v){f==1?_.id=v.readVarint():f==2?function(w,k){for(var A=w.readVarint()+w.pos;w.pos<A;){var L=k._keys[w.readVarint()],O=k._values[w.readVarint()];k.properties[L]=O}}(v,_):f==3?_.type=v.readVarint():f==4&&(_._geometry=v.pos)}function l(f){for(var _,v,w=0,k=0,A=f.length,L=A-1;k<A;L=k++)w+=((v=f[L]).x-(_=f[k]).x)*(_.y+v.y);return w}return wd=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var _,v=f.readVarint()+f.pos,w=1,k=0,A=0,L=0,O=[];f.pos<v;){if(k<=0){var V=f.readVarint();w=7&V,k=V>>3}if(k--,w===1||w===2)A+=f.readSVarint(),L+=f.readSVarint(),w===1&&(_&&O.push(_),_=[]),_.push(new r(A,L));else{if(w!==7)throw new Error("unknown command "+w);_&&_.push(_[0].clone())}}return _&&O.push(_),O},t.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var _=f.readVarint()+f.pos,v=1,w=0,k=0,A=0,L=1/0,O=-1/0,V=1/0,$=-1/0;f.pos<_;){if(w<=0){var Z=f.readVarint();v=7&Z,w=Z>>3}if(w--,v===1||v===2)(k+=f.readSVarint())<L&&(L=k),k>O&&(O=k),(A+=f.readSVarint())<V&&(V=A),A>$&&($=A);else if(v!==7)throw new Error("unknown command "+v)}return[L,V,O,$]},t.prototype.toGeoJSON=function(f,_,v){var w,k,A=this.extent*Math.pow(2,v),L=this.extent*f,O=this.extent*_,V=this.loadGeometry(),$=t.types[this.type];function Z(he){for(var Ie=0;Ie<he.length;Ie++){var ye=he[Ie];he[Ie]=[360*(ye.x+L)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(ye.y+O)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(w=0;w<V.length;w++)K[w]=V[w][0];Z(V=K);break;case 2:for(w=0;w<V.length;w++)Z(V[w]);break;case 3:for(V=function(he){var Ie=he.length;if(Ie<=1)return[he];for(var ye,G,ne=[],ve=0;ve<Ie;ve++){var Oe=l(he[ve]);Oe!==0&&(G===void 0&&(G=Oe<0),G===Oe<0?(ye&&ne.push(ye),ye=[he[ve]]):ye.push(he[ve]))}return ye&&ne.push(ye),ne}(V),w=0;w<V.length;w++)for(k=0;k<V[w].length;k++)Z(V[w][k])}V.length===1?V=V[0]:$="Multi"+$;var se={type:"Feature",geometry:{type:$,coordinates:V},properties:this.properties};return"id"in this&&(se.id=this.id),se},wd}function Jm(){if(Xm)return Td;Xm=1;var r=Km();function t(l,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(n,this,f),this.length=this._features.length}function n(l,f,_){l===15?f.version=_.readVarint():l===1?f.name=_.readString():l===5?f.extent=_.readVarint():l===2?f._features.push(_.pos):l===3?f._keys.push(_.readString()):l===4&&f._values.push(function(v){for(var w=null,k=v.readVarint()+v.pos;v.pos<k;){var A=v.readVarint()>>3;w=A===1?v.readString():A===2?v.readFloat():A===3?v.readDouble():A===4?v.readVarint64():A===5?v.readVarint():A===6?v.readSVarint():A===7?v.readBoolean():null}return w}(_))}return Td=t,t.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var f=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,f,this.extent,this._keys,this._values)},Td}function Qm(){return Ym||(Ym=1,Hh.VectorTile=function(){if(Wm)return Sd;Wm=1;var r=Jm();function t(n,l,f){if(n===3){var _=new r(f,f.readVarint()+f.pos);_.length&&(l[_.name]=_)}}return Sd=function(n,l){this.layers=n.readFields(t,{},l)},Sd}(),Hh.VectorTileFeature=Km(),Hh.VectorTileLayer=Jm()),Hh}var Oc=J(Qm());const cx=Oc.VectorTileFeature.types,Id=Math.pow(2,13);function Fc(r,t,n,l,f,_,v,w){r.emplaceBack(t,n,2*Math.floor(l*Id)+v,f*Id*2,_*Id*2,Math.round(w))}class kd{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new St,this.centroidVertexArray=new De,this.indexArray=new Zi,this.programConfigurations=new Sa(t.layers,t.zoom),this.segments=new Mi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,l){this.features=[],this.hasPattern=_d("fill-extrusion",this.layers,n);for(const{feature:f,id:_,index:v,sourceLayerIndex:w}of t){const k=this.layers[0]._featureFilter.needGeometry,A=El(f,k);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom,{globalState:this.globalState}),A,l))continue;const L={id:_,sourceLayerIndex:w,index:v,geometry:k?A.geometry:kl(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(yd("fill-extrusion",this.layers,L,this.zoom,n)):this.addFeature(L,L.geometry,v,l,{},n.subdivisionGranularity),n.featureIndex.insert(f,L.geometry,v,w,this.index,!0)}}addFeatures(t,n,l){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,n,l,t.subdivisionGranularity)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ux),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,lx.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,l,f,_,v){for(const w of Ga(n,500)){const k={x:0,y:0,sampleCount:0},A=this.layoutVertexArray.length;this.processPolygon(k,f,t,w,v);const L=this.layoutVertexArray.length-A,O=Math.floor(k.x/k.sampleCount),V=Math.floor(k.y/k.sampleCount);for(let $=0;$<L;$++)this.centroidVertexArray.emplaceBack(O,V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,_,f)}processPolygon(t,n,l,f,_){if(f.length<1||eg(f[0]))return;for(const O of f)O.length!==0&&hx(t,O);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=_.fill.getGranularityForZoomLevel(n.z),k=cx[l.type]==="Polygon";for(const O of f){if(O.length===0||eg(O))continue;const V=Pl(O,w,k);this._generateSideFaces(V,v)}if(!k)return;const A=Gm(f,n,w,!1),L=this.layoutVertexArray;qm((O,V)=>{Fc(L,O,V,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles)}_generateSideFaces(t,n){let l=0;for(let f=1;f<t.length;f++){const _=t[f],v=t[f-1];if(fx(_,v))continue;n.segment.vertexLength+4>Mi.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=_.sub(v)._perp()._unit(),k=v.dist(_);l+k>32768&&(l=0),Fc(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,0,l),Fc(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,1,l),l+=k,Fc(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,0,l),Fc(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,1,l);const A=n.segment.vertexLength;this.indexArray.emplaceBack(A,A+2,A+1),this.indexArray.emplaceBack(A+1,A+2,A+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function hx(r,t){for(let n=0;n<t.length;n++){const l=t[n];n===t.length-1&&t[0].x===l.x&&t[0].y===l.y||(r.x+=l.x,r.y+=l.y,r.sampleCount++)}}function fx(r,t){return r.x===t.x&&(r.x<0||r.x>Jt)||r.y===t.y&&(r.y<0||r.y>Jt)}function eg(r){return r.every(t=>t.x<0)||r.every(t=>t.x>Jt)||r.every(t=>t.y<0)||r.every(t=>t.y>Jt)}let tg;Lt("FillExtrusionBucket",kd,{omit:["layers","features"]});var dx={get paint(){return tg=tg||new br({"fill-extrusion-opacity":new Ft(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ni(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wu(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ni(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ni(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class px extends nr{constructor(t){super(t,dx)}createBucket(t){return new kd(t)}queryRadius(){return Uh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:l,geometry:f,transform:_,pixelsToTileUnits:v,pixelPosMatrix:w}){const k=Gh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,v),A=this.paint.get("fill-extrusion-height").evaluate(n,l),L=this.paint.get("fill-extrusion-base").evaluate(n,l),O=function($,Z){const K=[];for(const se of $){const he=[se.x,se.y,0,1];Ut(he,he,Z),K.push(new le(he[0]/he[3],he[1]/he[3]))}return K}(k,w),V=function($,Z,K,se){const he=[],Ie=[],ye=se[8]*Z,G=se[9]*Z,ne=se[10]*Z,ve=se[11]*Z,Oe=se[8]*K,nt=se[9]*K,Ve=se[10]*K,$e=se[11]*K;for(const gt of $){const at=[],yt=[];for(const Je of gt){const Nt=Je.x,ei=Je.y,Kt=se[0]*Nt+se[4]*ei+se[12],Gt=se[1]*Nt+se[5]*ei+se[13],ki=se[2]*Nt+se[6]*ei+se[14],_n=se[3]*Nt+se[7]*ei+se[15],Fn=ki+ne,mr=_n+ve,gs=Kt+Oe,$r=Gt+nt,or=ki+Ve,un=_n+$e,Yn=new le((Kt+ye)/mr,(Gt+G)/mr);Yn.z=Fn/mr,at.push(Yn);const lr=new le(gs/un,$r/un);lr.z=or/un,yt.push(lr)}he.push(at),Ie.push(yt)}return[he,Ie]}(f,L,A,w);return function($,Z,K){let se=1/0;Sm(K,Z)&&(se=ig(K,Z[0]));for(let he=0;he<Z.length;he++){const Ie=Z[he],ye=$[he];for(let G=0;G<Ie.length-1;G++){const ne=Ie[G],ve=[ne,Ie[G+1],ye[G+1],ye[G],ne];Tm(K,ve)&&(se=Math.min(se,ig(K,ve)))}}return se!==1/0&&se}(V[0],V[1],O)}}function Bc(r,t){return r.x*t.x+r.y*t.y}function ig(r,t){if(r.length===1){let n=0;const l=t[n++];let f;for(;!f||l.equals(f);)if(f=t[n++],!f)return 1/0;for(;n<t.length;n++){const _=t[n],v=r[0],w=f.sub(l),k=_.sub(l),A=v.sub(l),L=Bc(w,w),O=Bc(w,k),V=Bc(k,k),$=Bc(A,w),Z=Bc(A,k),K=L*V-O*O,se=(V*$-O*Z)/K,he=(L*Z-O*$)/K,Ie=l.z*(1-se-he)+f.z*se+_.z*he;if(isFinite(Ie))return Ie}return 1/0}{let n=1/0;for(const l of t)n=Math.min(n,l.z);return n}}const mx=gn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gx}=mx,_x=gn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:yx}=_x,vx=Oc.VectorTileFeature.types,xx=Math.cos(Math.PI/180*37.5),ng=Math.pow(2,14)/.5;class Ed{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new wt,this.layoutVertexArray2=new st,this.indexArray=new Zi,this.programConfigurations=new Sa(t.layers,t.zoom),this.segments=new Mi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,l){this.hasPattern=_d("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),_=!f.isConstant(),v=[];for(const{feature:w,id:k,index:A,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,V=El(w,O);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom,{globalState:this.globalState}),V,l))continue;const $=_?f.evaluate(V,{},l):void 0,Z={id:k,properties:w.properties,type:w.type,sourceLayerIndex:L,index:A,geometry:O?V.geometry:kl(w),patterns:{},sortKey:$};v.push(Z)}_&&v.sort((w,k)=>w.sortKey-k.sortKey);for(const w of v){const{geometry:k,index:A,sourceLayerIndex:L}=w;if(this.hasPattern){const O=yd("line",this.layers,w,this.zoom,n);this.patternFeatures.push(O)}else this.addFeature(w,k,A,l,{},n.subdivisionGranularity);n.featureIndex.insert(t[A].feature,k,A,L,this.index)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,l)}addFeatures(t,n,l){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,yx)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gx),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,l,f,_,v){const w=this.layers[0].layout,k=w.get("line-join").evaluate(t,{}),A=w.get("line-cap"),L=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const V of n)this.addLine(V,t,k,A,L,O,f,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,_,f)}addLine(t,n,l,f,_,v,w,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Pl(t,w?k.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<t.length-1;ye++)this.totalDistance+=t[ye].dist(t[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=vx[n.type]==="Polygon";let L=t.length;for(;L>=2&&t[L-1].equals(t[L-2]);)L--;let O=0;for(;O<L-1&&t[O].equals(t[O+1]);)O++;if(L<(A?3:2))return;l==="bevel"&&(_=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let Z,K,se,he,Ie;this.e1=this.e2=-1,A&&(Z=t[L-2],Ie=t[O].sub(Z)._unit()._perp());for(let ye=O;ye<L;ye++){if(se=ye===L-1?A?t[O+1]:void 0:t[ye+1],se&&t[ye].equals(se))continue;Ie&&(he=Ie),Z&&(K=Z),Z=t[ye],Ie=se?se.sub(Z)._unit()._perp():he,he=he||Ie;let G=he.add(Ie);G.x===0&&G.y===0||G._unit();const ne=he.x*Ie.x+he.y*Ie.y,ve=G.x*Ie.x+G.y*Ie.y,Oe=ve!==0?1/ve:1/0,nt=2*Math.sqrt(2-2*ve),Ve=ve<xx&&K&&se,$e=he.x*Ie.y-he.y*Ie.x>0;if(Ve&&ye>O){const yt=Z.dist(K);if(yt>2*V){const Je=Z.sub(Z.sub(K)._mult(V/yt)._round());this.updateDistance(K,Je),this.addCurrentVertex(Je,he,0,0,$),K=Je}}const gt=K&&se;let at=gt?l:A?"butt":f;if(gt&&at==="round"&&(Oe<v?at="miter":Oe<=2&&(at="fakeround")),at==="miter"&&Oe>_&&(at="bevel"),at==="bevel"&&(Oe>2&&(at="flipbevel"),Oe<_&&(at="miter")),K&&this.updateDistance(K,Z),at==="miter")G._mult(Oe),this.addCurrentVertex(Z,G,0,0,$);else if(at==="flipbevel"){if(Oe>100)G=Ie.mult(-1);else{const yt=Oe*he.add(Ie).mag()/he.sub(Ie).mag();G._perp()._mult(yt*($e?-1:1))}this.addCurrentVertex(Z,G,0,0,$),this.addCurrentVertex(Z,G.mult(-1),0,0,$)}else if(at==="bevel"||at==="fakeround"){const yt=-Math.sqrt(Oe*Oe-1),Je=$e?yt:0,Nt=$e?0:yt;if(K&&this.addCurrentVertex(Z,he,Je,Nt,$),at==="fakeround"){const ei=Math.round(180*nt/Math.PI/20);for(let Kt=1;Kt<ei;Kt++){let Gt=Kt/ei;if(Gt!==.5){const _n=Gt-.5;Gt+=Gt*_n*(Gt-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*_n*_n+(.848013+ne*(.215638*ne-1.06021)))}const ki=Ie.sub(he)._mult(Gt)._add(he)._unit()._mult($e?-1:1);this.addHalfVertex(Z,ki.x,ki.y,!1,$e,0,$)}}se&&this.addCurrentVertex(Z,Ie,-Je,-Nt,$)}else if(at==="butt")this.addCurrentVertex(Z,G,0,0,$);else if(at==="square"){const yt=K?1:-1;this.addCurrentVertex(Z,G,yt,yt,$)}else at==="round"&&(K&&(this.addCurrentVertex(Z,he,0,0,$),this.addCurrentVertex(Z,he,1,1,$,!0)),se&&(this.addCurrentVertex(Z,Ie,-1,-1,$,!0),this.addCurrentVertex(Z,Ie,0,0,$)));if(Ve&&ye<L-1){const yt=Z.dist(se);if(yt>2*V){const Je=Z.add(se.sub(Z)._mult(V/yt)._round());this.updateDistance(Z,Je),this.addCurrentVertex(Je,Ie,0,0,$),Z=Je}}}}addCurrentVertex(t,n,l,f,_,v=!1){const w=n.y*f-n.x,k=-n.y-n.x*f;this.addHalfVertex(t,n.x+n.y*l,n.y-n.x*l,v,!1,l,_),this.addHalfVertex(t,w,k,v,!0,-f,_),this.distance>ng/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,l,f,_,v))}addHalfVertex({x:t,y:n},l,f,_,v,w,k){const A=.5*(this.lineClips?this.scaledDistance*(ng-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(n<<1)+(v?1:0),Math.round(63*l)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,L,this.e2),k.primitiveLength++),v?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let rg,sg;Lt("LineBucket",Ed,{omit:["layers","patternFeatures"]});var ag={get paint(){return sg=sg||new br({"line-opacity":new ni(be.paint_line["line-opacity"]),"line-color":new ni(be.paint_line["line-color"]),"line-translate":new Ft(be.paint_line["line-translate"]),"line-translate-anchor":new Ft(be.paint_line["line-translate-anchor"]),"line-width":new ni(be.paint_line["line-width"]),"line-gap-width":new ni(be.paint_line["line-gap-width"]),"line-offset":new ni(be.paint_line["line-offset"]),"line-blur":new ni(be.paint_line["line-blur"]),"line-dasharray":new bc(be.paint_line["line-dasharray"]),"line-pattern":new wu(be.paint_line["line-pattern"]),"line-gradient":new xl(be.paint_line["line-gradient"])})},get layout(){return rg=rg||new br({"line-cap":new Ft(be.layout_line["line-cap"]),"line-join":new ni(be.layout_line["line-join"]),"line-miter-limit":new Ft(be.layout_line["line-miter-limit"]),"line-round-limit":new Ft(be.layout_line["line-round-limit"]),"line-sort-key":new ni(be.layout_line["line-sort-key"])})}};class bx extends ni{possiblyEvaluate(t,n){return n=new nn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,l,f){return n=jt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,l,f)}}let Xh;class wx extends nr{constructor(t){super(t,ag),this.gradientVersion=0,Xh||(Xh=new bx(ag.paint.properties["line-width"].specification),Xh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof ha,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Xh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ed(t)}queryRadius(t){const n=t,l=og(Pc("line-width",this,n),Pc("line-gap-width",this,n)),f=Pc("line-offset",this,n);return l/2+Math.abs(f)+Uh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:l,geometry:f,transform:_,pixelsToTileUnits:v}){const w=Gh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,v),k=v/2*og(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),A=this.paint.get("line-offset").evaluate(n,l);return A&&(f=function(L,O){const V=[];for(let $=0;$<L.length;$++){const Z=L[$],K=[];for(let se=0;se<Z.length;se++){const he=Z[se-1],Ie=Z[se],ye=Z[se+1],G=se===0?new le(0,0):Ie.sub(he)._unit()._perp(),ne=se===Z.length-1?new le(0,0):ye.sub(Ie)._unit()._perp(),ve=G._add(ne)._unit(),Oe=ve.x*ne.x+ve.y*ne.y;Oe!==0&&ve._mult(1/Oe),K.push(ve._mult(O)._add(Ie))}V.push(K)}return V}(f,A*v)),function(L,O,V){for(let $=0;$<O.length;$++){const Z=O[$];if(L.length>=3){for(let K=0;K<Z.length;K++)if(Iu(L,Z[K]))return!0}if(z0(L,Z,V))return!0}return!1}(w,f,k)}isTileClipped(){return!0}}function og(r,t){return t>0?t+2*r:r}const Tx=gn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sx=gn([{name:"a_projected_pos",components:3,type:"Float32"}],4);gn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ix=gn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);gn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lg=gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kx=gn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ex(r,t,n){return r.sections.forEach(l=>{l.text=function(f,_,v){const w=_.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),_a.applyArabicShaping&&(f=_a.applyArabicShaping(f)),f}(l.text,t,n)}),r}gn([{name:"triangle",components:3,type:"Uint16"}]),gn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),gn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),gn([{type:"Float32",name:"offsetX"}]),gn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),gn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const jc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ug,Cd,cg,Wn=24,Pd={};function Cx(){return ug||(ug=1,Pd.read=function(r,t,n,l,f){var _,v,w=8*f-l-1,k=(1<<w)-1,A=k>>1,L=-7,O=n?f-1:0,V=n?-1:1,$=r[t+O];for(O+=V,_=$&(1<<-L)-1,$>>=-L,L+=w;L>0;_=256*_+r[t+O],O+=V,L-=8);for(v=_&(1<<-L)-1,_>>=-L,L+=l;L>0;v=256*v+r[t+O],O+=V,L-=8);if(_===0)_=1-A;else{if(_===k)return v?NaN:1/0*($?-1:1);v+=Math.pow(2,l),_-=A}return($?-1:1)*v*Math.pow(2,_-l)},Pd.write=function(r,t,n,l,f,_){var v,w,k,A=8*_-f-1,L=(1<<A)-1,O=L>>1,V=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=l?0:_-1,Z=l?1:-1,K=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,v=L):(v=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-v))<1&&(v--,k*=2),(t+=v+O>=1?V/k:V*Math.pow(2,1-O))*k>=2&&(v++,k/=2),v+O>=L?(w=0,v=L):v+O>=1?(w=(t*k-1)*Math.pow(2,f),v+=O):(w=t*Math.pow(2,O-1)*Math.pow(2,f),v=0));f>=8;r[n+$]=255&w,$+=Z,w/=256,f-=8);for(v=v<<f|w,A+=f;A>0;r[n+$]=255&v,$+=Z,v/=256,A-=8);r[n+$-Z]|=128*K}),Pd}function hg(){if(cg)return Cd;cg=1,Cd=t;var r=Cx();function t(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=4294967296,l=1/n,f=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function _(G){return G.type===t.Bytes?G.readVarint()+G.pos:G.pos+1}function v(G,ne,ve){return ve?4294967296*ne+(G>>>0):4294967296*(ne>>>0)+(G>>>0)}function w(G,ne,ve){var Oe=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(7*Math.LN2));ve.realloc(Oe);for(var nt=ve.pos-1;nt>=G;nt--)ve.buf[nt+Oe]=ve.buf[nt]}function k(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeVarint(G[ve])}function A(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeSVarint(G[ve])}function L(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeFloat(G[ve])}function O(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeDouble(G[ve])}function V(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeBoolean(G[ve])}function $(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeFixed32(G[ve])}function Z(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeSFixed32(G[ve])}function K(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeFixed64(G[ve])}function se(G,ne){for(var ve=0;ve<G.length;ve++)ne.writeSFixed64(G[ve])}function he(G,ne){return(G[ne]|G[ne+1]<<8|G[ne+2]<<16)+16777216*G[ne+3]}function Ie(G,ne,ve){G[ve]=ne,G[ve+1]=ne>>>8,G[ve+2]=ne>>>16,G[ve+3]=ne>>>24}function ye(G,ne){return(G[ne]|G[ne+1]<<8|G[ne+2]<<16)+(G[ne+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(G,ne,ve){for(ve=ve||this.length;this.pos<ve;){var Oe=this.readVarint(),nt=Oe>>3,Ve=this.pos;this.type=7&Oe,G(nt,ne,this),this.pos===Ve&&this.skip(Oe)}return ne},readMessage:function(G,ne){return this.readFields(G,ne,this.readVarint()+this.pos)},readFixed32:function(){var G=he(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=ye(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=he(this.buf,this.pos)+he(this.buf,this.pos+4)*n;return this.pos+=8,G},readSFixed64:function(){var G=he(this.buf,this.pos)+ye(this.buf,this.pos+4)*n;return this.pos+=8,G},readFloat:function(){var G=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var ne,ve,Oe=this.buf;return ne=127&(ve=Oe[this.pos++]),ve<128?ne:(ne|=(127&(ve=Oe[this.pos++]))<<7,ve<128?ne:(ne|=(127&(ve=Oe[this.pos++]))<<14,ve<128?ne:(ne|=(127&(ve=Oe[this.pos++]))<<21,ve<128?ne:function(nt,Ve,$e){var gt,at,yt=$e.buf;if(gt=(112&(at=yt[$e.pos++]))>>4,at<128||(gt|=(127&(at=yt[$e.pos++]))<<3,at<128)||(gt|=(127&(at=yt[$e.pos++]))<<10,at<128)||(gt|=(127&(at=yt[$e.pos++]))<<17,at<128)||(gt|=(127&(at=yt[$e.pos++]))<<24,at<128)||(gt|=(1&(at=yt[$e.pos++]))<<31,at<128))return v(nt,gt,Ve);throw new Error("Expected varint not more than 10 bytes")}(ne|=(15&(ve=Oe[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,ne=this.pos;return this.pos=G,G-ne>=12&&f?function(ve,Oe,nt){return f.decode(ve.subarray(Oe,nt))}(this.buf,ne,G):function(ve,Oe,nt){for(var Ve="",$e=Oe;$e<nt;){var gt,at,yt,Je=ve[$e],Nt=null,ei=Je>239?4:Je>223?3:Je>191?2:1;if($e+ei>nt)break;ei===1?Je<128&&(Nt=Je):ei===2?(192&(gt=ve[$e+1]))==128&&(Nt=(31&Je)<<6|63&gt)<=127&&(Nt=null):ei===3?(at=ve[$e+2],(192&(gt=ve[$e+1]))==128&&(192&at)==128&&((Nt=(15&Je)<<12|(63&gt)<<6|63&at)<=2047||Nt>=55296&&Nt<=57343)&&(Nt=null)):ei===4&&(at=ve[$e+2],yt=ve[$e+3],(192&(gt=ve[$e+1]))==128&&(192&at)==128&&(192&yt)==128&&((Nt=(15&Je)<<18|(63&gt)<<12|(63&at)<<6|63&yt)<=65535||Nt>=1114112)&&(Nt=null)),Nt===null?(Nt=65533,ei=1):Nt>65535&&(Nt-=65536,Ve+=String.fromCharCode(Nt>>>10&1023|55296),Nt=56320|1023&Nt),Ve+=String.fromCharCode(Nt),$e+=ei}return Ve}(this.buf,ne,G)},readBytes:function(){var G=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,G);return this.pos=G,ne},readPackedVarint:function(G,ne){if(this.type!==t.Bytes)return G.push(this.readVarint(ne));var ve=_(this);for(G=G||[];this.pos<ve;)G.push(this.readVarint(ne));return G},readPackedSVarint:function(G){if(this.type!==t.Bytes)return G.push(this.readSVarint());var ne=_(this);for(G=G||[];this.pos<ne;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==t.Bytes)return G.push(this.readBoolean());var ne=_(this);for(G=G||[];this.pos<ne;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==t.Bytes)return G.push(this.readFloat());var ne=_(this);for(G=G||[];this.pos<ne;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==t.Bytes)return G.push(this.readDouble());var ne=_(this);for(G=G||[];this.pos<ne;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==t.Bytes)return G.push(this.readFixed32());var ne=_(this);for(G=G||[];this.pos<ne;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==t.Bytes)return G.push(this.readSFixed32());var ne=_(this);for(G=G||[];this.pos<ne;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==t.Bytes)return G.push(this.readFixed64());var ne=_(this);for(G=G||[];this.pos<ne;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==t.Bytes)return G.push(this.readSFixed64());var ne=_(this);for(G=G||[];this.pos<ne;)G.push(this.readSFixed64());return G},skip:function(G){var ne=7&G;if(ne===t.Varint)for(;this.buf[this.pos++]>127;);else if(ne===t.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===t.Fixed32)this.pos+=4;else{if(ne!==t.Fixed64)throw new Error("Unimplemented type: "+ne);this.pos+=8}},writeTag:function(G,ne){this.writeVarint(G<<3|ne)},realloc:function(G){for(var ne=this.length||16;ne<this.pos+G;)ne*=2;if(ne!==this.length){var ve=new Uint8Array(ne);ve.set(this.buf),this.buf=ve,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),Ie(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),Ie(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),Ie(this.buf,-1&G,this.pos),Ie(this.buf,Math.floor(G*l),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),Ie(this.buf,-1&G,this.pos),Ie(this.buf,Math.floor(G*l),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(ne,ve){var Oe,nt;if(ne>=0?(Oe=ne%4294967296|0,nt=ne/4294967296|0):(nt=~(-ne/4294967296),4294967295^(Oe=~(-ne%4294967296))?Oe=Oe+1|0:(Oe=0,nt=nt+1|0)),ne>=18446744073709552e3||ne<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ve.realloc(10),function(Ve,$e,gt){gt.buf[gt.pos++]=127&Ve|128,Ve>>>=7,gt.buf[gt.pos++]=127&Ve|128,Ve>>>=7,gt.buf[gt.pos++]=127&Ve|128,Ve>>>=7,gt.buf[gt.pos++]=127&Ve|128,gt.buf[gt.pos]=127&(Ve>>>=7)}(Oe,0,ve),function(Ve,$e){var gt=(7&Ve)<<4;$e.buf[$e.pos++]|=gt|((Ve>>>=3)?128:0),Ve&&($e.buf[$e.pos++]=127&Ve|((Ve>>>=7)?128:0),Ve&&($e.buf[$e.pos++]=127&Ve|((Ve>>>=7)?128:0),Ve&&($e.buf[$e.pos++]=127&Ve|((Ve>>>=7)?128:0),Ve&&($e.buf[$e.pos++]=127&Ve|((Ve>>>=7)?128:0),Ve&&($e.buf[$e.pos++]=127&Ve)))))}(nt,ve)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var ne=this.pos;this.pos=function(Oe,nt,Ve){for(var $e,gt,at=0;at<nt.length;at++){if(($e=nt.charCodeAt(at))>55295&&$e<57344){if(!gt){$e>56319||at+1===nt.length?(Oe[Ve++]=239,Oe[Ve++]=191,Oe[Ve++]=189):gt=$e;continue}if($e<56320){Oe[Ve++]=239,Oe[Ve++]=191,Oe[Ve++]=189,gt=$e;continue}$e=gt-55296<<10|$e-56320|65536,gt=null}else gt&&(Oe[Ve++]=239,Oe[Ve++]=191,Oe[Ve++]=189,gt=null);$e<128?Oe[Ve++]=$e:($e<2048?Oe[Ve++]=$e>>6|192:($e<65536?Oe[Ve++]=$e>>12|224:(Oe[Ve++]=$e>>18|240,Oe[Ve++]=$e>>12&63|128),Oe[Ve++]=$e>>6&63|128),Oe[Ve++]=63&$e|128)}return Ve}(this.buf,G,this.pos);var ve=this.pos-ne;ve>=128&&w(ne,ve,this),this.pos=ne-1,this.writeVarint(ve),this.pos+=ve},writeFloat:function(G){this.realloc(4),r.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),r.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var ne=G.length;this.writeVarint(ne),this.realloc(ne);for(var ve=0;ve<ne;ve++)this.buf[this.pos++]=G[ve]},writeRawMessage:function(G,ne){this.pos++;var ve=this.pos;G(ne,this);var Oe=this.pos-ve;Oe>=128&&w(ve,Oe,this),this.pos=ve-1,this.writeVarint(Oe),this.pos+=Oe},writeMessage:function(G,ne,ve){this.writeTag(G,t.Bytes),this.writeRawMessage(ne,ve)},writePackedVarint:function(G,ne){ne.length&&this.writeMessage(G,k,ne)},writePackedSVarint:function(G,ne){ne.length&&this.writeMessage(G,A,ne)},writePackedBoolean:function(G,ne){ne.length&&this.writeMessage(G,V,ne)},writePackedFloat:function(G,ne){ne.length&&this.writeMessage(G,L,ne)},writePackedDouble:function(G,ne){ne.length&&this.writeMessage(G,O,ne)},writePackedFixed32:function(G,ne){ne.length&&this.writeMessage(G,$,ne)},writePackedSFixed32:function(G,ne){ne.length&&this.writeMessage(G,Z,ne)},writePackedFixed64:function(G,ne){ne.length&&this.writeMessage(G,K,ne)},writePackedSFixed64:function(G,ne){ne.length&&this.writeMessage(G,se,ne)},writeBytesField:function(G,ne){this.writeTag(G,t.Bytes),this.writeBytes(ne)},writeFixed32Field:function(G,ne){this.writeTag(G,t.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function(G,ne){this.writeTag(G,t.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function(G,ne){this.writeTag(G,t.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function(G,ne){this.writeTag(G,t.Fixed64),this.writeSFixed64(ne)},writeVarintField:function(G,ne){this.writeTag(G,t.Varint),this.writeVarint(ne)},writeSVarintField:function(G,ne){this.writeTag(G,t.Varint),this.writeSVarint(ne)},writeStringField:function(G,ne){this.writeTag(G,t.Bytes),this.writeString(ne)},writeFloatField:function(G,ne){this.writeTag(G,t.Fixed32),this.writeFloat(ne)},writeDoubleField:function(G,ne){this.writeTag(G,t.Fixed64),this.writeDouble(ne)},writeBooleanField:function(G,ne){this.writeVarintField(G,!!ne)}},Cd}var Eo,Md=J(hg());function Px(r,t,n){r===1&&n.readMessage(Mx,t)}function Mx(r,t,n){if(r===3){const{id:l,bitmap:f,width:_,height:v,left:w,top:k,advance:A}=n.readMessage(Ax,{});t.push({id:l,bitmap:new Mc({width:_+6,height:v+6},f),metrics:{width:_,height:v,left:w,top:k,advance:A}})}}function Ax(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}function fg(r){let t=0,n=0;for(const v of r)t+=v.w*v.h,n=Math.max(n,v.w);r.sort((v,w)=>w.h-v.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let f=0,_=0;for(const v of r)for(let w=l.length-1;w>=0;w--){const k=l[w];if(!(v.w>k.w||v.h>k.h)){if(v.x=k.x,v.y=k.y,_=Math.max(_,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===k.w&&v.h===k.h){const A=l.pop();w<l.length&&(l[w]=A)}else v.h===k.h?(k.x+=v.w,k.w-=v.w):v.w===k.w?(k.y+=v.h,k.h-=v.h):(l.push({x:k.x+v.w,y:k.y,w:k.w-v.w,h:v.h}),k.y+=v.h,k.h-=v.h);break}}return{w:f,h:_,fill:t/(f*_)||0}}class Ad{constructor(t,{pixelRatio:n,version:l,stretchX:f,stretchY:_,content:v,textFitWidth:w,textFitHeight:k}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=f,this.stretchY=_,this.content=v,this.version=l,this.textFitWidth=w,this.textFitHeight=k}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class dg{constructor(t,n){const l={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,l,_),this.addImages(n,f,_);const{w:v,h:w}=fg(_),k=new qr({width:v||1,height:w||1});for(const A in t){const L=t[A],O=l[A].paddedRect;qr.copy(L.data,k,{x:0,y:0},{x:O.x+1,y:O.y+1},L.data)}for(const A in n){const L=n[A],O=f[A].paddedRect,V=O.x+1,$=O.y+1,Z=L.data.width,K=L.data.height;qr.copy(L.data,k,{x:0,y:0},{x:V,y:$},L.data),qr.copy(L.data,k,{x:0,y:K-1},{x:V,y:$-1},{width:Z,height:1}),qr.copy(L.data,k,{x:0,y:0},{x:V,y:$+K},{width:Z,height:1}),qr.copy(L.data,k,{x:Z-1,y:0},{x:V-1,y:$},{width:1,height:K}),qr.copy(L.data,k,{x:0,y:0},{x:V+Z,y:$},{width:1,height:K})}this.image=k,this.iconPositions=l,this.patternPositions=f}addImages(t,n,l){for(const f in t){const _=t[f],v={x:0,y:0,w:_.data.width+2,h:_.data.height+2};l.push(v),n[f]=new Ad(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),n)}patchUpdatedImage(t,n,l){if(!t||!n||t.version===n.version)return;t.version=n.version;const[f,_]=t.tl;l.update(n.data,void 0,{x:f,y:_})}}Lt("ImagePosition",Ad),Lt("ImageAtlas",dg),P.an=void 0,(Eo=P.an||(P.an={}))[Eo.none=0]="none",Eo[Eo.horizontal=1]="horizontal",Eo[Eo.vertical=2]="vertical",Eo[Eo.horizontalOnly=3]="horizontalOnly";class Vc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,l){const f=new Vc;return f.scale=t||1,f.fontStack=n,f.verticalAlign=l||"bottom",f}static forImage(t,n){const l=new Vc;return l.imageName=t,l.verticalAlign=n||"bottom",l}}class Pu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const l=new Pu;for(let f=0;f<t.sections.length;f++){const _=t.sections[f];_.image?l.addImageSection(_):l.addTextSection(_,n)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let l=0;l<t.length;l++){const f=t.charCodeAt(l+1)||null,_=t.charCodeAt(l-1)||null;n+=f&&yc(f)&&!jc[t[l+1]]||_&&yc(_)&&!jc[t[l-1]]||!jc[t[l]]?t[l]:jc[t[l]]}return n}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&Yh[this.text.charCodeAt(l)];l++)t++;let n=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Yh[this.text.charCodeAt(l)];l--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const l=new Pu;return l.text=this.text.substring(t,n),l.sectionIndex=this.sectionIndex.slice(t,n),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}getMaxImageSize(t){let n=0,l=0;for(let f=0;f<this.length();f++){const _=this.getSection(f);if(_.imageName){const v=t[_.imageName];if(!v)continue;const w=v.displaySize;n=Math.max(n,w[0]),l=Math.max(l,w[1])}}return{maxImageWidth:n,maxImageHeight:l}}addTextSection(t,n){this.text+=t.text,this.sections.push(Vc.forText(t.scale,t.fontStack||n,t.verticalAlign));const l=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(l)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void rt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Vc.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):rt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wh(r,t,n,l,f,_,v,w,k,A,L,O,V,$,Z){const K=Pu.fromFeature(r,f);let se;O===P.an.vertical&&K.verticalizePunctuation();const{processBidirectionalText:he,processStyledBidirectionalText:Ie}=_a;if(he&&K.sections.length===1){se=[];const ne=he(K.toString(),Rd(K,A,_,t,l,$));for(const ve of ne){const Oe=new Pu;Oe.text=ve,Oe.sections=K.sections;for(let nt=0;nt<ve.length;nt++)Oe.sectionIndex.push(0);se.push(Oe)}}else if(Ie){se=[];const ne=Ie(K.text,K.sectionIndex,Rd(K,A,_,t,l,$));for(const ve of ne){const Oe=new Pu;Oe.text=ve[0],Oe.sectionIndex=ve[1],Oe.sections=K.sections,se.push(Oe)}}else se=function(ne,ve){const Oe=[],nt=ne.text;let Ve=0;for(const $e of ve)Oe.push(ne.substring(Ve,$e)),Ve=$e;return Ve<nt.length&&Oe.push(ne.substring(Ve,nt.length)),Oe}(K,Rd(K,A,_,t,l,$));const ye=[],G={positionedLines:ye,text:K.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(ne,ve,Oe,nt,Ve,$e,gt,at,yt,Je,Nt,ei){let Kt=0,Gt=0,ki=0,_n=0;const Fn=at==="right"?1:at==="left"?0:.5,mr=Wn/ei;let gs=0;for(const un of Ve){un.trim();const Yn=un.getMaxScale(),lr={positionedGlyphs:[],lineOffset:0};ne.positionedLines[gs]=lr;const ur=lr.positionedGlyphs;let Dr=0;if(!un.length()){Gt+=$e,++gs;continue}const _s=zx(nt,un,mr);for(let Zr=0;Zr<un.length();Zr++){const Bn=un.getSection(Zr),Jn=un.getSectionIndex(Zr),Qn=un.getCharCode(Zr),Ln=Nx(yt,Nt,Qn);let en;if(Bn.imageName){if(ne.iconsInText=!0,Bn.scale=Bn.scale*mr,en=Fx(Bn,Ln,Yn,_s,nt),!en)continue;Dr=Math.max(Dr,en.imageOffset)}else if(en=Ox(Bn,Qn,Ln,_s,ve,Oe),!en)continue;const{rect:ia,metrics:Lu,baselineOffset:na}=en;ur.push({glyph:Qn,imageName:Bn.imageName,x:Kt,y:Gt+na+-17,vertical:Ln,scale:Bn.scale,fontStack:Bn.fontStack,sectionIndex:Jn,metrics:Lu,rect:ia}),Ln?(ne.verticalizable=!0,Kt+=(Bn.imageName?Lu.advance:Wn)*Bn.scale+Je):Kt+=Lu.advance*Bn.scale+Je}ur.length!==0&&(ki=Math.max(Kt-Je,ki),Bx(ur,0,ur.length-1,Fn)),Kt=0,lr.lineOffset=Math.max(Dr,(Yn-1)*Wn);const Kn=$e*Yn+Dr;Gt+=Kn,_n=Math.max(Kn,_n),++gs}const{horizontalAlign:$r,verticalAlign:or}=Ld(gt);(function(un,Yn,lr,ur,Dr,_s,Kn,Zr,Bn){const Jn=(Yn-lr)*Dr;let Qn=0;Qn=_s!==Kn?-Zr*ur- -17:-ur*Bn*Kn+.5*Kn;for(const Ln of un)for(const en of Ln.positionedGlyphs)en.x+=Jn,en.y+=Qn})(ne.positionedLines,Fn,$r,or,ki,_n,$e,Gt,Ve.length),ne.top+=-or*Gt,ne.bottom=ne.top+Gt,ne.left+=-$r*ki,ne.right=ne.left+ki}(G,t,n,l,se,v,w,k,O,A,V,Z),!function(ne){for(const ve of ne)if(ve.positionedGlyphs.length!==0)return!1;return!0}(ye)&&G}const Yh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rx={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Lx={40:!0};function pg(r,t,n,l,f,_){if(t.imageName){const v=l[t.imageName];return v?v.displaySize[0]*t.scale*Wn/_+f:0}{const v=n[t.fontStack],w=v&&v[r];return w?w.metrics.advance*t.scale+f:0}}function mg(r,t,n,l){const f=Math.pow(r-t,2);return l?r<t?f/2:2*f:f+Math.abs(n)*n}function Dx(r,t,n){let l=0;return r===10&&(l-=1e4),n&&(l+=150),r!==40&&r!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function gg(r,t,n,l,f,_){let v=null,w=mg(t,n,f,_);for(const k of l){const A=mg(t-k.x,n,f,_)+k.badness;A<=w&&(v=k,w=A)}return{index:r,x:t,priorBreak:v,badness:w}}function _g(r){return r?_g(r.priorBreak).concat(r.index):[]}function Rd(r,t,n,l,f,_){if(!r)return[];const v=[],w=function(O,V,$,Z,K,se){let he=0;for(let Ie=0;Ie<O.length();Ie++){const ye=O.getSection(Ie);he+=pg(O.getCharCode(Ie),ye,Z,K,V,se)}return he/Math.max(1,Math.ceil(he/$))}(r,t,n,l,f,_),k=r.text.indexOf("")>=0;let A=0;for(let O=0;O<r.length();O++){const V=r.getSection(O),$=r.getCharCode(O);if(Yh[$]||(A+=pg($,V,l,f,t,_)),O<r.length()-1){const Z=!((L=$)<11904)&&(!!Si["CJK Compatibility Forms"](L)||!!Si["CJK Compatibility"](L)||!!Si["CJK Strokes"](L)||!!Si["CJK Symbols and Punctuation"](L)||!!Si["Enclosed CJK Letters and Months"](L)||!!Si["Halfwidth and Fullwidth Forms"](L)||!!Si["Ideographic Description Characters"](L)||!!Si["Vertical Forms"](L)||_c.test(String.fromCodePoint(L)));(Rx[$]||Z||V.imageName||O!==r.length()-2&&Lx[r.getCharCode(O+1)])&&v.push(gg(O+1,A,w,v,Dx($,r.getCharCode(O+1),Z&&k),!1))}}var L;return _g(gg(r.length(),A,w,v,0,!0))}function Ld(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function zx(r,t,n){const l=t.getMaxScale()*Wn,{maxImageWidth:f,maxImageHeight:_}=t.getMaxImageSize(r),v=Math.max(l,_*n);return{verticalLineContentWidth:Math.max(l,f*n),horizontalLineContentHeight:v}}function yg(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function Nx(r,t,n){return!(r===P.an.horizontal||!t&&!vu(n)||t&&(Yh[n]||(l=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function Ox(r,t,n,l,f,_){const v=_[r.fontStack],w=function(A,L,O,V){if(A&&A.rect)return A;const $=L[O.fontStack],Z=$&&$[V];return Z?{rect:null,metrics:Z.metrics}:null}(v&&v[t],f,r,t);if(w===null)return null;let k;if(n)k=l.verticalLineContentWidth-r.scale*Wn;else{const A=yg(r.verticalAlign);k=(l.horizontalLineContentHeight-r.scale*Wn)*A}return{rect:w.rect,metrics:w.metrics,baselineOffset:k}}function Fx(r,t,n,l,f){const _=f[r.imageName];if(!_)return null;const v=_.paddedRect,w=_.displaySize,k={width:w[0],height:w[1],left:1,top:-3,advance:t?w[1]:w[0]};let A;if(t)A=l.verticalLineContentWidth-w[1]*r.scale;else{const L=yg(r.verticalAlign);A=(l.horizontalLineContentHeight-w[1]*r.scale)*L}return{rect:v,metrics:k,baselineOffset:A,imageOffset:(t?w[0]:w[1])*r.scale-Wn*n}}function Bx(r,t,n,l){if(l===0)return;const f=r[n],_=(r[n].x+f.metrics.advance*f.scale)*l;for(let v=t;v<=n;v++)r[v].x-=_}function jx(r,t,n){const{horizontalAlign:l,verticalAlign:f}=Ld(n),_=t[0]-r.displaySize[0]*l,v=t[1]-r.displaySize[1]*f;return{image:r,top:v,bottom:v+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function vg(r){var t,n;let l=r.left,f=r.top,_=r.right-l,v=r.bottom-f;const w=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",k=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",A=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(k==="proportional"){if(w==="stretchOnly"&&_/v<A||w==="proportional"){const L=Math.ceil(v*A);l*=L/_,_=L}}else if(w==="proportional"&&k==="stretchOnly"&&A!==0&&_/v>A){const L=Math.ceil(_/A);f*=L/v,v=L}return{x1:l,y1:f,x2:l+_,y2:f+v}}function xg(r,t,n,l,f,_){const v=r.image;let w;if(v.content){const se=v.content,he=v.pixelRatio||1;w=[se[0]/he,se[1]/he,v.displaySize[0]-se[2]/he,v.displaySize[1]-se[3]/he]}const k=t.left*_,A=t.right*_;let L,O,V,$;n==="width"||n==="both"?($=f[0]+k-l[3],O=f[0]+A+l[1]):($=f[0]+(k+A-v.displaySize[0])/2,O=$+v.displaySize[0]);const Z=t.top*_,K=t.bottom*_;return n==="height"||n==="both"?(L=f[1]+Z-l[0],V=f[1]+K+l[2]):(L=f[1]+(Z+K-v.displaySize[1])/2,V=L+v.displaySize[1]),{image:v,top:L,right:O,bottom:V,left:$,collisionPadding:w}}const Ya=128,Co=32640;function bg(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new nn(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:f}=n;let _=0;for(;_<l.length&&l[_]<=r;)_++;_=Math.max(0,_-1);let v=_;for(;v<l.length&&l[v]<r+1;)v++;v=Math.min(l.length-1,v);const w=l[_],k=l[v];return n.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:k,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:k,minSize:n.evaluate(new nn(w)),maxSize:n.evaluate(new nn(k)),interpolationType:f}}}function Dd(r,t,n){let l="never";const f=r.get(t);return f?l=f:r.get(n)&&(l="always"),l}const Vx=Oc.VectorTileFeature.types,Ux=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kh(r,t,n,l,f,_,v,w,k,A,L,O,V){const $=w?Math.min(Co,Math.round(w[0])):0,Z=w?Math.min(Co,Math.round(w[1])):0;r.emplaceBack(t,n,Math.round(32*l),Math.round(32*f),_,v,($<<1)+(k?1:0),Z,16*A,16*L,256*O,256*V)}function zd(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function Gx(r){for(const t of r.sections)if(vc(t.text))return!0;return!1}class Nd{constructor(t){this.layoutVertexArray=new _i,this.indexArray=new Zi,this.programConfigurations=t,this.segments=new Mi,this.dynamicLayoutVertexArray=new Oi,this.opacityVertexArray=new on,this.hasVisibleVertices=!1,this.placedSymbolArray=new ue}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,l,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Sx.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ux,!0),this.opacityVertexBuffer.itemSize=1),(l||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Lt("SymbolBuffers",Nd);class Od{constructor(t,n,l){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new l,this.segments=new Mi,this.collisionVertexArray=new ln}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ix.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Lt("CollisionBuffers",Od);class Mu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bg(this.zoom,n["text-size"]),this.iconSizeData=bg(this.zoom,n["icon-size"]);const l=this.layers[0].layout,f=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=Dd(l,"text-overlap","text-allow-overlap")!=="never"||Dd(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(v=>P.an[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new Nd(new Sa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Nd(new Sa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new me,this.lineVertexArray=new xe,this.symbolInstances=new _e,this.textAnchorOffsets=new ge}calculateGlyphDependencies(t,n,l,f,_){for(let v=0;v<t.length;v++)if(n[t.charCodeAt(v)]=!0,(l||f)&&_){const w=jc[t.charAt(v)];w&&(n[w.charCodeAt(0)]=!0)}}populate(t,n,l){const f=this.layers[0],_=f.layout,v=_.get("text-font"),w=_.get("text-field"),k=_.get("icon-image"),A=(w.value.kind!=="constant"||w.value.value instanceof Gn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),L=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,O=_.get("symbol-sort-key");if(this.features=[],!A&&!L)return;const V=n.iconDependencies,$=n.glyphDependencies,Z=n.availableImages,K=new nn(this.zoom,{globalState:this.globalState});for(const{feature:se,id:he,index:Ie,sourceLayerIndex:ye}of t){const G=f._featureFilter.needGeometry,ne=El(se,G);if(!f._featureFilter.filter(K,ne,l))continue;let ve,Oe;if(G||(ne.geometry=kl(se)),A){const Ve=f.getValueAndResolveTokens("text-field",ne,l,Z),$e=Gn.factory(Ve),gt=this.hasRTLText=this.hasRTLText||Gx($e);(!gt||_a.getRTLTextPluginStatus()==="unavailable"||gt&&_a.isParsed())&&(ve=Ex($e,f,ne))}if(L){const Ve=f.getValueAndResolveTokens("icon-image",ne,l,Z);Oe=Ve instanceof qn?Ve:qn.fromString(Ve)}if(!ve&&!Oe)continue;const nt=this.sortFeaturesByKey?O.evaluate(ne,{},l):void 0;if(this.features.push({id:he,text:ve,icon:Oe,index:Ie,sourceLayerIndex:ye,geometry:ne.geometry,properties:se.properties,type:Vx[se.type],sortKey:nt}),Oe&&(V[Oe.name]=!0),ve){const Ve=v.evaluate(ne,{},l).join(","),$e=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(P.an.vertical)>=0;for(const gt of ve.sections)if(gt.image)V[gt.image.name]=!0;else{const at=gc(ve.toString()),yt=gt.fontStack||Ve,Je=$[yt]=$[yt]||{};this.calculateGlyphDependencies(gt.text,Je,$e,this.allowVerticalPlacement,at)}}}_.get("symbol-placement")==="line"&&(this.features=function(se){const he={},Ie={},ye=[];let G=0;function ne(Ve){ye.push(se[Ve]),G++}function ve(Ve,$e,gt){const at=Ie[Ve];return delete Ie[Ve],Ie[$e]=at,ye[at].geometry[0].pop(),ye[at].geometry[0]=ye[at].geometry[0].concat(gt[0]),at}function Oe(Ve,$e,gt){const at=he[$e];return delete he[$e],he[Ve]=at,ye[at].geometry[0].shift(),ye[at].geometry[0]=gt[0].concat(ye[at].geometry[0]),at}function nt(Ve,$e,gt){const at=gt?$e[0][$e[0].length-1]:$e[0][0];return`${Ve}:${at.x}:${at.y}`}for(let Ve=0;Ve<se.length;Ve++){const $e=se[Ve],gt=$e.geometry,at=$e.text?$e.text.toString():null;if(!at){ne(Ve);continue}const yt=nt(at,gt),Je=nt(at,gt,!0);if(yt in Ie&&Je in he&&Ie[yt]!==he[Je]){const Nt=Oe(yt,Je,gt),ei=ve(yt,Je,ye[Nt].geometry);delete he[yt],delete Ie[Je],Ie[nt(at,ye[ei].geometry,!0)]=ei,ye[Nt].geometry=null}else yt in Ie?ve(yt,Je,gt):Je in he?Oe(yt,Je,gt):(ne(Ve),he[yt]=G-1,Ie[Je]=G-1)}return ye.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,he)=>se.sortKey-he.sortKey)}update(t,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const l=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(n[t.segment+1]),_=t.dist(n[t.segment]);const v={};for(let w=t.segment+1;w<n.length;w++)v[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:f},w<n.length-1&&(f+=n[w+1].dist(n[w]));for(let w=t.segment||0;w>=0;w--)v[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=n[w-1].dist(n[w]));for(let w=0;w<n.length;w++){const k=v[w];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,n,l,f,_,v,w,k,A,L,O,V){const $=t.indexArray,Z=t.layoutVertexArray,K=t.segments.prepareSegment(4*n.length,Z,$,this.canOverlap?v.sortKey:void 0),se=this.glyphOffsetArray.length,he=K.vertexLength,Ie=this.allowVerticalPlacement&&w===P.an.vertical?Math.PI/2:0,ye=v.text&&v.text.sections;for(let G=0;G<n.length;G++){const{tl:ne,tr:ve,bl:Oe,br:nt,tex:Ve,pixelOffsetTL:$e,pixelOffsetBR:gt,minFontScaleX:at,minFontScaleY:yt,glyphOffset:Je,isSDF:Nt,sectionIndex:ei}=n[G],Kt=K.vertexLength,Gt=Je[1];Kh(Z,k.x,k.y,ne.x,Gt+ne.y,Ve.x,Ve.y,l,Nt,$e.x,$e.y,at,yt),Kh(Z,k.x,k.y,ve.x,Gt+ve.y,Ve.x+Ve.w,Ve.y,l,Nt,gt.x,$e.y,at,yt),Kh(Z,k.x,k.y,Oe.x,Gt+Oe.y,Ve.x,Ve.y+Ve.h,l,Nt,$e.x,gt.y,at,yt),Kh(Z,k.x,k.y,nt.x,Gt+nt.y,Ve.x+Ve.w,Ve.y+Ve.h,l,Nt,gt.x,gt.y,at,yt),zd(t.dynamicLayoutVertexArray,k,Ie),$.emplaceBack(Kt,Kt+2,Kt+1),$.emplaceBack(Kt+1,Kt+2,Kt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),G!==n.length-1&&ei===n[G+1].sectionIndex||t.programConfigurations.populatePaintArrays(Z.length,v,v.index,{},V,ye&&ye[ei])}t.placedSymbolArray.emplaceBack(k.x,k.y,se,this.glyphOffsetArray.length-se,he,A,L,k.segment,l?l[0]:0,l?l[1]:0,f[0],f[1],w,0,!1,0,O)}_addCollisionDebugVertex(t,n,l,f,_,v){return n.emplaceBack(0,0),t.emplaceBack(l.x,l.y,f,_,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,n,l,f,_,v,w){const k=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),A=k.vertexLength,L=_.layoutVertexArray,O=_.collisionVertexArray,V=w.anchorX,$=w.anchorY;this._addCollisionDebugVertex(L,O,v,V,$,new le(t,n)),this._addCollisionDebugVertex(L,O,v,V,$,new le(l,n)),this._addCollisionDebugVertex(L,O,v,V,$,new le(l,f)),this._addCollisionDebugVertex(L,O,v,V,$,new le(t,f)),k.vertexLength+=4;const Z=_.indexArray;Z.emplaceBack(A,A+1),Z.emplaceBack(A+1,A+2),Z.emplaceBack(A+2,A+3),Z.emplaceBack(A+3,A),k.primitiveLength+=4}addDebugCollisionBoxes(t,n,l,f){for(let _=t;_<n;_++){const v=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,f?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Od(Gi,lg.members,qi),this.iconCollisionBox=new Od(Gi,lg.members,qi);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,l,f,_,v,w,k,A){const L={};for(let O=n;O<l;O++){const V=t.get(O);L.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},L.textFeatureIndex=V.featureIndex;break}for(let O=f;O<_;O++){const V=t.get(O);L.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},L.verticalTextFeatureIndex=V.featureIndex;break}for(let O=v;O<w;O++){const V=t.get(O);L.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},L.iconFeatureIndex=V.featureIndex;break}for(let O=k;O<A;O++){const V=t.get(O);L.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},L.verticalIconFeatureIndex=V.featureIndex;break}return L}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const l=t.placedSymbolArray.get(n),f=l.vertexStartIndex+4*l.numGlyphs;for(let _=l.vertexStartIndex;_<f;_+=4)t.indexArray.emplaceBack(_,_+2,_+1),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),l=Math.cos(t),f=[],_=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const k=this.symbolInstances.get(w);f.push(0|Math.round(n*k.anchorX+l*k.anchorY)),_.push(k.featureIndex)}return v.sort((w,k)=>f[w]-f[k]||_[k]-_[w]),v}addToSortKeyRanges(t,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((f,_,v)=>{f>=0&&v.indexOf(f)===_&&this.addIndicesForPlacedSymbol(this.text,f)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wg,Tg;Lt("SymbolBucket",Mu,{omit:["layers","collisionBoxArray","features","compareText"]}),Mu.MAX_GLYPHS=65535,Mu.addDynamicAttributes=zd;var Fd={get paint(){return Tg=Tg||new br({"icon-opacity":new ni(be.paint_symbol["icon-opacity"]),"icon-color":new ni(be.paint_symbol["icon-color"]),"icon-halo-color":new ni(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new ni(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ni(be.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new ni(be.paint_symbol["text-opacity"]),"text-color":new ni(be.paint_symbol["text-color"],{runtimeType:er,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ni(be.paint_symbol["text-halo-color"]),"text-halo-width":new ni(be.paint_symbol["text-halo-width"]),"text-halo-blur":new ni(be.paint_symbol["text-halo-blur"]),"text-translate":new Ft(be.paint_symbol["text-translate"]),"text-translate-anchor":new Ft(be.paint_symbol["text-translate-anchor"])})},get layout(){return wg=wg||new br({"symbol-placement":new Ft(be.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ni(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ft(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ft(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new ni(be.layout_symbol["icon-size"]),"icon-text-fit":new Ft(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new ni(be.layout_symbol["icon-image"]),"icon-rotate":new ni(be.layout_symbol["icon-rotate"]),"icon-padding":new ni(be.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft(be.layout_symbol["icon-keep-upright"]),"icon-offset":new ni(be.layout_symbol["icon-offset"]),"icon-anchor":new ni(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft(be.layout_symbol["text-rotation-alignment"]),"text-field":new ni(be.layout_symbol["text-field"]),"text-font":new ni(be.layout_symbol["text-font"]),"text-size":new ni(be.layout_symbol["text-size"]),"text-max-width":new ni(be.layout_symbol["text-max-width"]),"text-line-height":new Ft(be.layout_symbol["text-line-height"]),"text-letter-spacing":new ni(be.layout_symbol["text-letter-spacing"]),"text-justify":new ni(be.layout_symbol["text-justify"]),"text-radial-offset":new ni(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ni(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ni(be.layout_symbol["text-anchor"]),"text-max-angle":new Ft(be.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft(be.layout_symbol["text-writing-mode"]),"text-rotate":new ni(be.layout_symbol["text-rotate"]),"text-padding":new Ft(be.layout_symbol["text-padding"]),"text-keep-upright":new Ft(be.layout_symbol["text-keep-upright"]),"text-transform":new ni(be.layout_symbol["text-transform"]),"text-offset":new ni(be.layout_symbol["text-offset"]),"text-allow-overlap":new Ft(be.layout_symbol["text-allow-overlap"]),"text-overlap":new Ft(be.layout_symbol["text-overlap"]),"text-ignore-placement":new Ft(be.layout_symbol["text-ignore-placement"]),"text-optional":new Ft(be.layout_symbol["text-optional"])})}};class Sg{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:rs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt("FormatSectionOverride",Sg,{omit:["defaultValue"]});class Jh extends nr{constructor(t){super(t,Fd)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const f=[];for(const _ of l)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,l,f){const _=this.layout.get(t).evaluate(n,{},l,f),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||ou(v.value)||!_?_:function(w,k){return k.replace(/{([^{}]+)}/g,(A,L)=>w&&L in w?String(w[L]):"")}(n.properties,_)}createBucket(t){return new Mu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Fd.paint.overridableProperties){if(!Jh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),l=new Sg(n),f=new au(l,n.property.specification);let _=null;_=n.value.kind==="constant"||n.value.kind==="source"?new ul("source",f):new uu("composite",f,n.value.zoomStops),this.paint._values[t]=new Ds(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&Jh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const l=t.get("text-field"),f=Fd.paint.properties[n];let _=!1;const v=w=>{for(const k of w)if(f.overrides&&f.overrides.hasOverride(k))return void(_=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Gn)v(l.value.value.sections);else if(l.value.kind==="source"){const w=A=>{_||(A instanceof zn&&Vt(A.value)===Vs?v(A.value.sections):A instanceof fa?v(A.sections):A.eachChild(w))},k=l.value;k._styleExpression&&w(k._styleExpression.expression)}return _}}let Ig;var qx={get paint(){return Ig=Ig||new br({"background-color":new Ft(be.paint_background["background-color"]),"background-pattern":new bc(be.paint_background["background-pattern"]),"background-opacity":new Ft(be.paint_background["background-opacity"])})}};class $x extends nr{constructor(t){super(t,qx)}}let kg;var Zx={get paint(){return kg=kg||new br({"raster-opacity":new Ft(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft(be.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft(be.paint_raster["raster-saturation"]),"raster-contrast":new Ft(be.paint_raster["raster-contrast"]),"raster-resampling":new Ft(be.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft(be.paint_raster["raster-fade-duration"])})}};class Hx extends nr{constructor(t){super(t,Zx)}}class Xx extends nr{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Wx{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Yx={once:!0},Bd=63710088e-1;class Po{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Po(Ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,l=this.lat*n,f=t.lat*n,_=Math.sin(l)*Math.sin(f)+Math.cos(l)*Math.cos(f)*Math.cos((t.lng-this.lng)*n);return Bd*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof Po)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Po(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Po(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Eg=2*Math.PI*Bd;function Cg(r){return Eg*Math.cos(r*Math.PI/180)}function Pg(r){return(180+r)/360}function Mg(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Ag(r,t){return r/Cg(t)}function jd(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Rg(r,t){return r*Cg(jd(t))}class Uc{constructor(t,n,l=0){this.x=+t,this.y=+n,this.z=+l}static fromLngLat(t,n=0){const l=Po.convert(t);return new Uc(Pg(l.lng),Mg(l.lat),Ag(n,l.lat))}toLngLat(){return new Po(360*this.x-180,jd(this.y))}toAltitude(){return Rg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Eg*(t=jd(this.y),1/Math.cos(t*Math.PI/180));var t}}function Lg(r,t,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[r*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Vd{constructor(t,n,l){if(!function(f,_,v){return!(f<0||f>25||v<0||v>=Math.pow(2,f)||_<0||_>=Math.pow(2,f))}(t,n,l))throw new Error(`x=${n}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=l,this.key=Au(0,t,t,n,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,l){const f=(v=this.y,w=this.z,k=Lg(256*(_=this.x),256*(v=Math.pow(2,w)-v-1),w),A=Lg(256*(_+1),256*(v+1),w),k[0]+","+k[1]+","+A[0]+","+A[1]);var _,v,w,k,A;const L=function(O,V,$){let Z,K="";for(let se=O;se>0;se--)Z=1<<se-1,K+=(V&Z?1:0)+($&Z?2:0);return K}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new le((t.x*n-this.x)*Jt,(t.y*n-this.y)*Jt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dg{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Au(t,n.z,n.z,n.x,n.y)}}class ms{constructor(t,n,l,f,_){if(this.terrainRttPosMatrix32f=null,t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Vd(l,+f,+_),this.key=Au(n,t,l,f,_)}clone(){return new ms(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new ms(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ms(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?Au(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Au(this.wrap*+n,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new ms(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,f=2*this.canonical.y;return[new ms(n,this.wrap,n,l,f),new ms(n,this.wrap,n,l+1,f),new ms(n,this.wrap,n,l,f+1),new ms(n,this.wrap,n,l+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ms(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ms(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Uc(t.x-this.wrap,t.y))}}function Au(r,t,n,l,f){(r*=2)<0&&(r=-1*r-1);const _=1<<n;return(_*_*r+_*f+l).toString(36)+n.toString(36)+t.toString(36)}Lt("CanonicalTileID",Vd),Lt("OverscaledTileID",ms,{omit:["terrainRttPosMatrix32f"]});class Ml{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new Ml;return n.extend(t(new le(this.minX,this.minY))),n.extend(t(new le(this.maxX,this.minY))),n.extend(t(new le(this.minX,this.maxY))),n.extend(t(new le(this.maxX,this.maxY))),n}static fromPoints(t){const n=new Ml;for(const l of t)n.extend(l);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class zg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const l=t[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Ng{constructor(t,n,l,f,_){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=l,t._y=f,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Og{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new To(Jt,16,0),this.grid3D=new To(Jt,16,0),this.featureIndexArray=new Be,this.promoteId=n}insert(t,n,l,f,_,v){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,f,_);const k=v?this.grid3D:this.grid;for(let A=0;A<n.length;A++){const L=n[A],O=[1/0,1/0,-1/0,-1/0];for(let V=0;V<L.length;V++){const $=L[V];O[0]=Math.min(O[0],$.x),O[1]=Math.min(O[1],$.y),O[2]=Math.max(O[2],$.x),O[3]=Math.max(O[3],$.y)}O[0]<Jt&&O[1]<Jt&&O[2]>=0&&O[3]>=0&&k.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Oc.VectorTile(new Md(this.rawTileData)).layers,this.sourceLayerCoder=new zg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,l,f){this.loadVTLayers();const _=t.params,v=Jt/t.tileSize/t.scale,w=ma(_.filter),k=t.queryGeometry,A=t.queryPadding*v,L=Ml.fromPoints(k),O=this.grid.query(L.minX-A,L.minY-A,L.maxX+A,L.maxY+A),V=Ml.fromPoints(t.cameraQueryGeometry).expandBy(A),$=this.grid3D.query(V.minX,V.minY,V.maxX,V.maxY,(se,he,Ie,ye)=>function(G,ne,ve,Oe,nt){for(const $e of G)if(ne<=$e.x&&ve<=$e.y&&Oe>=$e.x&&nt>=$e.y)return!0;const Ve=[new le(ne,ve),new le(ne,nt),new le(Oe,nt),new le(Oe,ve)];if(G.length>2){for(const $e of Ve)if(Iu(G,$e))return!0}for(let $e=0;$e<G.length-1;$e++)if(O0(G[$e],G[$e+1],Ve))return!0;return!1}(t.cameraQueryGeometry,se-A,he-A,Ie+A,ye+A));for(const se of $)O.push(se);O.sort(Kx);const Z={};let K;for(let se=0;se<O.length;se++){const he=O[se];if(he===K)continue;K=he;const Ie=this.featureIndexArray.get(he);let ye=null;this.loadMatchingFeature(Z,Ie.bucketIndex,Ie.sourceLayerIndex,Ie.featureIndex,w,_.layers,_.availableImages,n,l,f,(G,ne,ve)=>(ye||(ye=kl(G)),ne.queryIntersectsFeature({queryGeometry:k,feature:G,featureState:ve,geometry:ye,zoom:this.z,transform:t.transform,pixelsToTileUnits:v,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return Z}loadMatchingFeature(t,n,l,f,_,v,w,k,A,L,O){const V=this.bucketLayerIDs[n];if(v&&!V.some(se=>v.has(se)))return;const $=this.sourceLayerCoder.decode(l),Z=this.vtLayers[$].feature(f);if(_.needGeometry){const se=El(Z,!0);if(!_.filter(new nn(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!_.filter(new nn(this.tileID.overscaledZ),Z))return;const K=this.getId(Z,$);for(let se=0;se<V.length;se++){const he=V[se];if(v&&!v.has(he))continue;const Ie=k[he];if(!Ie)continue;let ye={};K&&L&&(ye=L.getState(Ie.sourceLayer||"_geojsonTileLayer",K));const G=jt({},A[he]);G.paint=Fg(G.paint,Ie.paint,Z,ye,w),G.layout=Fg(G.layout,Ie.layout,Z,ye,w);const ne=!O||O(Z,Ie,ye);if(!ne)continue;const ve=new Ng(Z,this.z,this.x,this.y,K);ve.layer=G;let Oe=t[he];Oe===void 0&&(Oe=t[he]=[]),Oe.push({featureIndex:f,feature:ve,intersectionZ:ne})}}lookupSymbolFeatures(t,n,l,f,_,v,w,k){const A={};this.loadVTLayers();const L=ma(_);for(const O of t)this.loadMatchingFeature(A,l,f,O,L,v,w,k,n);return A}hasLayer(t){for(const n of this.bucketLayerIDs)for(const l of n)if(t===l)return!0;return!1}getId(t,n){var l;let f=t.id;return this.promoteId&&(f=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((l=t.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(f=Number(t.properties.cluster_id))),f}}function Fg(r,t,n,l,f){return Te(r,(_,v)=>{const w=t instanceof bu?t.get(v):null;return w&&w.evaluate?w.evaluate(n,l,f):w})}function Kx(r,t){return t-r}function Bg(r,t,n,l,f){const _=[];for(let v=0;v<r.length;v++){const w=r[v];let k;for(let A=0;A<w.length-1;A++){let L=w[A],O=w[A+1];L.x<t&&O.x<t||(L.x<t?L=new le(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x<t&&(O=new le(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y<n&&O.y<n||(L.y<n?L=new le(L.x+(n-L.y)/(O.y-L.y)*(O.x-L.x),n)._round():O.y<n&&(O=new le(L.x+(n-L.y)/(O.y-L.y)*(O.x-L.x),n)._round()),L.x>=l&&O.x>=l||(L.x>=l?L=new le(l,L.y+(l-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x>=l&&(O=new le(l,L.y+(l-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y>=f&&O.y>=f||(L.y>=f?L=new le(L.x+(f-L.y)/(O.y-L.y)*(O.x-L.x),f)._round():O.y>=f&&(O=new le(L.x+(f-L.y)/(O.y-L.y)*(O.x-L.x),f)._round()),k&&L.equals(k[k.length-1])||(k=[L],_.push(k)),k.push(O)))))}}return _}Lt("FeatureIndex",Og,{omit:["rawTileData","sourceLayerCoder"]});class Mo extends le{constructor(t,n,l,f){super(t,n),this.angle=l,f!==void 0&&(this.segment=f)}clone(){return new Mo(this.x,this.y,this.angle,this.segment)}}function jg(r,t,n,l,f){if(t.segment===void 0||n===0)return!0;let _=t,v=t.segment+1,w=0;for(;w>-n/2;){if(v--,v<0)return!1;w-=r[v].dist(_),_=r[v]}w+=r[v].dist(r[v+1]),v++;const k=[];let A=0;for(;w<n/2;){const L=r[v],O=r[v+1];if(!O)return!1;let V=r[v-1].angleTo(L)-L.angleTo(O);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:w,angleDelta:V}),A+=V;w-k[0].distance>l;)A-=k.shift().angleDelta;if(A>f)return!1;v++,w+=L.dist(O)}return!0}function Vg(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function Ug(r,t,n){return r?.6*t*n:0}function Gg(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Jx(r,t,n,l,f,_){const v=Ug(n,f,_),w=Gg(n,l)*_;let k=0;const A=Vg(r)/2;for(let L=0;L<r.length-1;L++){const O=r[L],V=r[L+1],$=O.dist(V);if(k+$>A){const Z=(A-k)/$,K=Yi.number(O.x,V.x,Z),se=Yi.number(O.y,V.y,Z),he=new Mo(K,se,V.angleTo(O),L);return he._round(),!v||jg(r,he,w,v,t)?he:void 0}k+=$}}function Qx(r,t,n,l,f,_,v,w,k){const A=Ug(l,_,v),L=Gg(l,f),O=L*v,V=r[0].x===0||r[0].x===k||r[0].y===0||r[0].y===k;return t-O<t/4&&(t=O+t/4),qg(r,V?t/2*w%t:(L/2+2*_)*v*w%t,t,A,n,O,V,!1,k)}function qg(r,t,n,l,f,_,v,w,k){const A=_/2,L=Vg(r);let O=0,V=t-n,$=[];for(let Z=0;Z<r.length-1;Z++){const K=r[Z],se=r[Z+1],he=K.dist(se),Ie=se.angleTo(K);for(;V+n<O+he;){V+=n;const ye=(V-O)/he,G=Yi.number(K.x,se.x,ye),ne=Yi.number(K.y,se.y,ye);if(G>=0&&G<k&&ne>=0&&ne<k&&V-A>=0&&V+A<=L){const ve=new Mo(G,ne,Ie,Z);ve._round(),l&&!jg(r,ve,_,l,f)||$.push(ve)}}O+=he}return w||$.length||v||($=qg(r,O/2,n,l,f,_,v,!0,k)),$}function $g(r,t,n,l){const f=[],_=r.image,v=_.pixelRatio,w=_.paddedRect.w-2,k=_.paddedRect.h-2;let A={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const L=_.stretchX||[[0,w]],O=_.stretchY||[[0,k]],V=(Je,Nt)=>Je+Nt[1]-Nt[0],$=L.reduce(V,0),Z=O.reduce(V,0),K=w-$,se=k-Z;let he=0,Ie=$,ye=0,G=Z,ne=0,ve=K,Oe=0,nt=se;if(_.content&&l){const Je=_.content,Nt=Je[2]-Je[0],ei=Je[3]-Je[1];(_.textFitWidth||_.textFitHeight)&&(A=vg(r)),he=Qh(L,0,Je[0]),ye=Qh(O,0,Je[1]),Ie=Qh(L,Je[0],Je[2]),G=Qh(O,Je[1],Je[3]),ne=Je[0]-he,Oe=Je[1]-ye,ve=Nt-Ie,nt=ei-G}const Ve=A.x1,$e=A.y1,gt=A.x2-Ve,at=A.y2-$e,yt=(Je,Nt,ei,Kt)=>{const Gt=ef(Je.stretch-he,Ie,gt,Ve),ki=tf(Je.fixed-ne,ve,Je.stretch,$),_n=ef(Nt.stretch-ye,G,at,$e),Fn=tf(Nt.fixed-Oe,nt,Nt.stretch,Z),mr=ef(ei.stretch-he,Ie,gt,Ve),gs=tf(ei.fixed-ne,ve,ei.stretch,$),$r=ef(Kt.stretch-ye,G,at,$e),or=tf(Kt.fixed-Oe,nt,Kt.stretch,Z),un=new le(Gt,_n),Yn=new le(mr,_n),lr=new le(mr,$r),ur=new le(Gt,$r),Dr=new le(ki/v,Fn/v),_s=new le(gs/v,or/v),Kn=t*Math.PI/180;if(Kn){const Jn=Math.sin(Kn),Qn=Math.cos(Kn),Ln=[Qn,-Jn,Jn,Qn];un._matMult(Ln),Yn._matMult(Ln),ur._matMult(Ln),lr._matMult(Ln)}const Zr=Je.stretch+Je.fixed,Bn=Nt.stretch+Nt.fixed;return{tl:un,tr:Yn,bl:ur,br:lr,tex:{x:_.paddedRect.x+1+Zr,y:_.paddedRect.y+1+Bn,w:ei.stretch+ei.fixed-Zr,h:Kt.stretch+Kt.fixed-Bn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dr,pixelOffsetBR:_s,minFontScaleX:ve/v/gt,minFontScaleY:nt/v/at,isSDF:n}};if(l&&(_.stretchX||_.stretchY)){const Je=Zg(L,K,$),Nt=Zg(O,se,Z);for(let ei=0;ei<Je.length-1;ei++){const Kt=Je[ei],Gt=Je[ei+1];for(let ki=0;ki<Nt.length-1;ki++)f.push(yt(Kt,Nt[ki],Gt,Nt[ki+1]))}}else f.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:k+1}));return f}function Qh(r,t,n){let l=0;for(const f of r)l+=Math.max(t,Math.min(n,f[1]))-Math.max(t,Math.min(n,f[0]));return l}function Zg(r,t,n){const l=[{fixed:-1,stretch:0}];for(const[f,_]of r){const v=l[l.length-1];l.push({fixed:f-v.stretch,stretch:v.stretch}),l.push({fixed:f-v.stretch,stretch:v.stretch+(_-f)})}return l.push({fixed:t+1,stretch:n}),l}function ef(r,t,n,l){return r/t*n+l}function tf(r,t,n,l){return r-t*n/l}Lt("Anchor",Mo);class nf{constructor(t,n,l,f,_,v,w,k,A,L){var O;if(this.boxStartIndex=t.length,A){let V=v.top,$=v.bottom;const Z=v.collisionPadding;Z&&(V-=Z[1],$+=Z[3]);let K=$-V;K>0&&(K=Math.max(10,K),this.circleDiameter=K)}else{const V=!((O=v.image)===null||O===void 0)&&O.content&&(v.image.textFitWidth||v.image.textFitHeight)?vg(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};V.y1=V.y1*w-k[0],V.y2=V.y2*w+k[2],V.x1=V.x1*w-k[3],V.x2=V.x2*w+k[1];const $=v.collisionPadding;if($&&(V.x1-=$[0]*w,V.y1-=$[1]*w,V.x2+=$[2]*w,V.y2+=$[3]*w),L){const Z=new le(V.x1,V.y1),K=new le(V.x2,V.y1),se=new le(V.x1,V.y2),he=new le(V.x2,V.y2),Ie=L*Math.PI/180;Z._rotate(Ie),K._rotate(Ie),se._rotate(Ie),he._rotate(Ie),V.x1=Math.min(Z.x,K.x,se.x,he.x),V.x2=Math.max(Z.x,K.x,se.x,he.x),V.y1=Math.min(Z.y,K.y,se.y,he.y),V.y2=Math.max(Z.y,K.y,se.y,he.y)}t.emplaceBack(n.x,n.y,V.x1,V.y1,V.x2,V.y2,l,f,_)}this.boxEndIndex=t.length}}class eb{constructor(t=[],n=(l,f)=>l<f?-1:l>f?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:l}=this,f=n[t];for(;t>0;){const _=t-1>>1,v=n[_];if(l(f,v)>=0)break;n[t]=v,t=_}n[t]=f}_down(t){const{data:n,compare:l}=this,f=this.length>>1,_=n[t];for(;t<f;){let v=1+(t<<1);const w=v+1;if(w<this.length&&l(n[w],n[v])<0&&(v=w),l(n[v],_)>=0)break;n[t]=n[v],t=v}n[t]=_}}function tb(r,t=1,n=!1){const l=Ml.fromPoints(r[0]),f=Math.min(l.width(),l.height());let _=f/2;const v=new eb([],ib),{minX:w,minY:k,maxX:A,maxY:L}=l;if(f===0)return new le(w,k);for(let $=w;$<A;$+=f)for(let Z=k;Z<L;Z+=f)v.push(new Ru($+_,Z+_,_,r));let O=function($){let Z=0,K=0,se=0;const he=$[0];for(let Ie=0,ye=he.length,G=ye-1;Ie<ye;G=Ie++){const ne=he[Ie],ve=he[G],Oe=ne.x*ve.y-ve.x*ne.y;K+=(ne.x+ve.x)*Oe,se+=(ne.y+ve.y)*Oe,Z+=3*Oe}return new Ru(K/Z,se/Z,0,$)}(r),V=v.length;for(;v.length;){const $=v.pop();($.d>O.d||!O.d)&&(O=$,n&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,V)),$.max-O.d<=t||(_=$.h/2,v.push(new Ru($.p.x-_,$.p.y-_,_,r)),v.push(new Ru($.p.x+_,$.p.y-_,_,r)),v.push(new Ru($.p.x-_,$.p.y+_,_,r)),v.push(new Ru($.p.x+_,$.p.y+_,_,r)),V+=4)}return n&&(console.log(`num probes: ${V}`),console.log(`best distance: ${O.d}`)),O.p}function ib(r,t){return t.max-r.max}function Ru(r,t,n,l){this.p=new le(r,t),this.h=n,this.d=function(f,_){let v=!1,w=1/0;for(let k=0;k<_.length;k++){const A=_[k];for(let L=0,O=A.length,V=O-1;L<O;V=L++){const $=A[L],Z=A[V];$.y>f.y!=Z.y>f.y&&f.x<(Z.x-$.x)*(f.y-$.y)/(Z.y-$.y)+$.x&&(v=!v),w=Math.min(w,Im(f,$,Z))}}return(v?1:-1)*Math.sqrt(w)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var pr;P.aD=void 0,(pr=P.aD||(P.aD={}))[pr.center=1]="center",pr[pr.left=2]="left",pr[pr.right=3]="right",pr[pr.top=4]="top",pr[pr.bottom=5]="bottom",pr[pr["top-left"]=6]="top-left",pr[pr["top-right"]=7]="top-right",pr[pr["bottom-left"]=8]="bottom-left",pr[pr["bottom-right"]=9]="bottom-right";const Ud=Number.POSITIVE_INFINITY;function Hg(r,t){return t[1]!==Ud?function(n,l,f){let _=0,v=0;switch(l=Math.abs(l),f=Math.abs(f),n){case"top-right":case"top-left":case"top":v=f-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-f}switch(n){case"top-right":case"bottom-right":case"right":_=-l;break;case"top-left":case"bottom-left":case"left":_=l}return[_,v]}(r,t[0],t[1]):function(n,l){let f=0,_=0;l<0&&(l=0);const v=l/Math.SQRT2;switch(n){case"top-right":case"top-left":_=v-7;break;case"bottom-right":case"bottom-left":_=7-v;break;case"bottom":_=7-l;break;case"top":_=l-7}switch(n){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=l;break;case"right":f=-l}return[f,_]}(r,t[0])}function Xg(r,t,n){var l;const f=r.layout,_=(l=f.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},n);if(_){const w=_.values,k=[];for(let A=0;A<w.length;A+=2){const L=k[A]=w[A],O=w[A+1].map(V=>V*Wn);L.startsWith("top")?O[1]-=7:L.startsWith("bottom")&&(O[1]+=7),k[A+1]=O}return new di(k)}const v=f.get("text-variable-anchor");if(v){let w;w=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},n)*Wn,Ud]:f.get("text-offset").evaluate(t,{},n).map(A=>A*Wn);const k=[];for(const A of v)k.push(A,Hg(A,w));return new di(k)}return null}function Gd(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nb(r,t,n,l,f,_,v,w,k,A,L,O){let V=_.textMaxSize.evaluate(t,{});V===void 0&&(V=v);const $=r.layers[0].layout,Z=$.get("icon-offset").evaluate(t,{},L),K=Yg(n.horizontal),se=v/24,he=r.tilePixelRatio*se,Ie=r.tilePixelRatio*V/24,ye=r.tilePixelRatio*w,G=r.tilePixelRatio*$.get("symbol-spacing"),ne=$.get("text-padding")*r.tilePixelRatio,ve=function(ei,Kt,Gt,ki=1){const _n=ei.get("icon-padding").evaluate(Kt,{},Gt),Fn=_n&&_n.values;return[Fn[0]*ki,Fn[1]*ki,Fn[2]*ki,Fn[3]*ki]}($,t,L,r.tilePixelRatio),Oe=$.get("text-max-angle")/180*Math.PI,nt=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Ve=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",$e=$.get("symbol-placement"),gt=G/2,at=$.get("icon-text-fit");let yt;l&&at!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(yt=xg(l,n.vertical,at,$.get("icon-text-fit-padding"),Z,se)),K&&(l=xg(l,K,at,$.get("icon-text-fit-padding"),Z,se)));const Je=L?O.line.getGranularityForZoomLevel(L.z):1,Nt=(ei,Kt)=>{Kt.x<0||Kt.x>=Jt||Kt.y<0||Kt.y>=Jt||function(Gt,ki,_n,Fn,mr,gs,$r,or,un,Yn,lr,ur,Dr,_s,Kn,Zr,Bn,Jn,Qn,Ln,en,ia,Lu,na,ab){const Du=Gt.addToLineVertexArray(ki,_n);let Al,zu,Nu,Ou,e_=0,t_=0,i_=0,n_=0,Kd=-1,Jd=-1;const Ka={};let r_=Lr("");if(Gt.allowVerticalPlacement&&Fn.vertical){const Tr=or.layout.get("text-rotate").evaluate(en,{},na)+90;Nu=new nf(un,ki,Yn,lr,ur,Fn.vertical,Dr,_s,Kn,Tr),$r&&(Ou=new nf(un,ki,Yn,lr,ur,$r,Bn,Jn,Kn,Tr))}if(mr){const Tr=or.layout.get("icon-rotate").evaluate(en,{}),ys=or.layout.get("icon-text-fit")!=="none",Rl=$g(mr,Tr,Lu,ys),sa=$r?$g($r,Tr,Lu,ys):void 0;zu=new nf(un,ki,Yn,lr,ur,mr,Bn,Jn,!1,Tr),e_=4*Rl.length;const Ll=Gt.iconSizeData;let Ia=null;Ll.kind==="source"?(Ia=[Ya*or.layout.get("icon-size").evaluate(en,{})],Ia[0]>Co&&rt(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ll.kind==="composite"&&(Ia=[Ya*ia.compositeIconSizes[0].evaluate(en,{},na),Ya*ia.compositeIconSizes[1].evaluate(en,{},na)],(Ia[0]>Co||Ia[1]>Co)&&rt(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,Rl,Ia,Ln,Qn,en,P.an.none,ki,Du.lineStartIndex,Du.lineLength,-1,na),Kd=Gt.icon.placedSymbolArray.length-1,sa&&(t_=4*sa.length,Gt.addSymbols(Gt.icon,sa,Ia,Ln,Qn,en,P.an.vertical,ki,Du.lineStartIndex,Du.lineLength,-1,na),Jd=Gt.icon.placedSymbolArray.length-1)}const s_=Object.keys(Fn.horizontal);for(const Tr of s_){const ys=Fn.horizontal[Tr];if(!Al){r_=Lr(ys.text);const sa=or.layout.get("text-rotate").evaluate(en,{},na);Al=new nf(un,ki,Yn,lr,ur,ys,Dr,_s,Kn,sa)}const Rl=ys.positionedLines.length===1;if(i_+=Wg(Gt,ki,ys,gs,or,Kn,en,Zr,Du,Fn.vertical?P.an.horizontal:P.an.horizontalOnly,Rl?s_:[Tr],Ka,Kd,ia,na),Rl)break}Fn.vertical&&(n_+=Wg(Gt,ki,Fn.vertical,gs,or,Kn,en,Zr,Du,P.an.vertical,["vertical"],Ka,Jd,ia,na));const ob=Al?Al.boxStartIndex:Gt.collisionBoxArray.length,lb=Al?Al.boxEndIndex:Gt.collisionBoxArray.length,ub=Nu?Nu.boxStartIndex:Gt.collisionBoxArray.length,cb=Nu?Nu.boxEndIndex:Gt.collisionBoxArray.length,hb=zu?zu.boxStartIndex:Gt.collisionBoxArray.length,fb=zu?zu.boxEndIndex:Gt.collisionBoxArray.length,db=Ou?Ou.boxStartIndex:Gt.collisionBoxArray.length,pb=Ou?Ou.boxEndIndex:Gt.collisionBoxArray.length;let ra=-1;const sf=(Tr,ys)=>Tr&&Tr.circleDiameter?Math.max(Tr.circleDiameter,ys):ys;ra=sf(Al,ra),ra=sf(Nu,ra),ra=sf(zu,ra),ra=sf(Ou,ra);const a_=ra>-1?1:0;a_&&(ra*=ab/Wn),Gt.glyphOffsetArray.length>=Mu.MAX_GLYPHS&&rt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),en.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,en.sortKey);const mb=Xg(or,en,na),[gb,_b]=function(Tr,ys){const Rl=Tr.length,sa=ys?.values;if(sa?.length>0)for(let Ll=0;Ll<sa.length;Ll+=2){const Ia=sa[Ll+1];Tr.emplaceBack(P.aD[sa[Ll]],Ia[0],Ia[1])}return[Rl,Tr.length]}(Gt.textAnchorOffsets,mb);Gt.symbolInstances.emplaceBack(ki.x,ki.y,Ka.right>=0?Ka.right:-1,Ka.center>=0?Ka.center:-1,Ka.left>=0?Ka.left:-1,Ka.vertical||-1,Kd,Jd,r_,ob,lb,ub,cb,hb,fb,db,pb,Yn,i_,n_,e_,t_,a_,0,Dr,ra,gb,_b)}(r,Kt,ei,n,l,f,yt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,he,[ne,ne,ne,ne],nt,k,ye,ve,Ve,Z,t,_,A,L,v)};if($e==="line")for(const ei of Bg(t.geometry,0,0,Jt,Jt)){const Kt=Pl(ei,Je),Gt=Qx(Kt,G,Oe,n.vertical||K,l,24,Ie,r.overscaling,Jt);for(const ki of Gt)K&&rb(r,K.text,gt,ki)||Nt(Kt,ki)}else if($e==="line-center"){for(const ei of t.geometry)if(ei.length>1){const Kt=Pl(ei,Je),Gt=Jx(Kt,Oe,n.vertical||K,l,24,Ie);Gt&&Nt(Kt,Gt)}}else if(t.type==="Polygon")for(const ei of Ga(t.geometry,0)){const Kt=tb(ei,16);Nt(Pl(ei[0],Je,!0),new Mo(Kt.x,Kt.y,0))}else if(t.type==="LineString")for(const ei of t.geometry){const Kt=Pl(ei,Je);Nt(Kt,new Mo(Kt[0].x,Kt[0].y,0))}else if(t.type==="Point")for(const ei of t.geometry)for(const Kt of ei)Nt([Kt],new Mo(Kt.x,Kt.y,0))}function Wg(r,t,n,l,f,_,v,w,k,A,L,O,V,$,Z){const K=function(Ie,ye,G,ne,ve,Oe,nt,Ve){const $e=ne.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,gt=[];for(const at of ye.positionedLines)for(const yt of at.positionedGlyphs){if(!yt.rect)continue;const Je=yt.rect||{};let Nt=4,ei=!0,Kt=1,Gt=0;const ki=(ve||Ve)&&yt.vertical,_n=yt.metrics.advance*yt.scale/2;if(Ve&&ye.verticalizable&&(Gt=at.lineOffset/2-(yt.imageName?-(Wn-yt.metrics.width*yt.scale)/2:(yt.scale-1)*Wn)),yt.imageName){const Jn=nt[yt.imageName];ei=Jn.sdf,Kt=Jn.pixelRatio,Nt=1/Kt}const Fn=ve?[yt.x+_n,yt.y]:[0,0];let mr=ve?[0,0]:[yt.x+_n+G[0],yt.y+G[1]-Gt],gs=[0,0];ki&&(gs=mr,mr=[0,0]);const $r=yt.metrics.isDoubleResolution?2:1,or=(yt.metrics.left-Nt)*yt.scale-_n+mr[0],un=(-yt.metrics.top-Nt)*yt.scale+mr[1],Yn=or+Je.w/$r*yt.scale/Kt,lr=un+Je.h/$r*yt.scale/Kt,ur=new le(or,un),Dr=new le(Yn,un),_s=new le(or,lr),Kn=new le(Yn,lr);if(ki){const Jn=new le(-_n,_n- -17),Qn=-Math.PI/2,Ln=12-_n,en=new le(22-Ln,-(yt.imageName?Ln:0)),ia=new le(...gs);ur._rotateAround(Qn,Jn)._add(en)._add(ia),Dr._rotateAround(Qn,Jn)._add(en)._add(ia),_s._rotateAround(Qn,Jn)._add(en)._add(ia),Kn._rotateAround(Qn,Jn)._add(en)._add(ia)}if($e){const Jn=Math.sin($e),Qn=Math.cos($e),Ln=[Qn,-Jn,Jn,Qn];ur._matMult(Ln),Dr._matMult(Ln),_s._matMult(Ln),Kn._matMult(Ln)}const Zr=new le(0,0),Bn=new le(0,0);gt.push({tl:ur,tr:Dr,bl:_s,br:Kn,tex:Je,writingMode:ye.writingMode,glyphOffset:Fn,sectionIndex:yt.sectionIndex,isSDF:ei,pixelOffsetTL:Zr,pixelOffsetBR:Bn,minFontScaleX:0,minFontScaleY:0})}return gt}(0,n,w,f,_,v,l,r.allowVerticalPlacement),se=r.textSizeData;let he=null;se.kind==="source"?(he=[Ya*f.layout.get("text-size").evaluate(v,{})],he[0]>Co&&rt(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(he=[Ya*$.compositeTextSizes[0].evaluate(v,{},Z),Ya*$.compositeTextSizes[1].evaluate(v,{},Z)],(he[0]>Co||he[1]>Co)&&rt(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,K,he,w,_,v,A,t,k.lineStartIndex,k.lineLength,V,Z);for(const Ie of L)O[Ie]=r.text.placedSymbolArray.length-1;return 4*K.length}function Yg(r){for(const t in r)return r[t];return null}function rb(r,t,n,l){const f=r.compareText;if(t in f){const _=f[t];for(let v=_.length-1;v>=0;v--)if(l.dist(_[v])<n)return!0}else f[t]=[];return f[t].push(l),!1}const Kg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=l>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const _=Kg[15&l];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new qd(w,v,_,t)}constructor(t,n=64,l=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=Kg.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${l}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+k,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+k),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+k,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=n,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return $d(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:w}=this,k=[0,_.length-1,0],A=[];for(;k.length;){const L=k.pop()||0,O=k.pop()||0,V=k.pop()||0;if(O-V<=w){for(let se=V;se<=O;se++){const he=v[2*se],Ie=v[2*se+1];he>=t&&he<=l&&Ie>=n&&Ie<=f&&A.push(_[se])}continue}const $=V+O>>1,Z=v[2*$],K=v[2*$+1];Z>=t&&Z<=l&&K>=n&&K<=f&&A.push(_[$]),(L===0?t<=Z:n<=K)&&(k.push(V),k.push($-1),k.push(1-L)),(L===0?l>=Z:f>=K)&&(k.push($+1),k.push(O),k.push(1-L))}return A}within(t,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:v}=this,w=[0,f.length-1,0],k=[],A=l*l;for(;w.length;){const L=w.pop()||0,O=w.pop()||0,V=w.pop()||0;if(O-V<=v){for(let se=V;se<=O;se++)Qg(_[2*se],_[2*se+1],t,n)<=A&&k.push(f[se]);continue}const $=V+O>>1,Z=_[2*$],K=_[2*$+1];Qg(Z,K,t,n)<=A&&k.push(f[$]),(L===0?t-l<=Z:n-l<=K)&&(w.push(V),w.push($-1),w.push(1-L)),(L===0?t+l>=Z:n+l>=K)&&(w.push($+1),w.push(O),w.push(1-L))}return k}}function $d(r,t,n,l,f,_){if(f-l<=n)return;const v=l+f>>1;Jg(r,t,v,l,f,_),$d(r,t,n,l,v-1,1-_),$d(r,t,n,v+1,f,1-_)}function Jg(r,t,n,l,f,_){for(;f>l;){if(f-l>600){const A=f-l+1,L=n-l+1,O=Math.log(A),V=.5*Math.exp(2*O/3),$=.5*Math.sqrt(O*V*(A-V)/A)*(L-A/2<0?-1:1);Jg(r,t,n,Math.max(l,Math.floor(n-L*V/A+$)),Math.min(f,Math.floor(n+(A-L)*V/A+$)),_)}const v=t[2*n+_];let w=l,k=f;for(Gc(r,t,l,n),t[2*f+_]>v&&Gc(r,t,l,f);w<k;){for(Gc(r,t,w,k),w++,k--;t[2*w+_]<v;)w++;for(;t[2*k+_]>v;)k--}t[2*l+_]===v?Gc(r,t,l,k):(k++,Gc(r,t,k,f)),k<=n&&(l=k+1),n<=k&&(f=k-1)}}function Gc(r,t,n,l){Zd(r,n,l),Zd(t,2*n,2*l),Zd(t,2*n+1,2*l+1)}function Zd(r,t,n){const l=r[t];r[t]=r[n],r[n]=l}function Qg(r,t,n,l){const f=r-n,_=t-l;return f*f+_*_}var Hd;P.cw=void 0,(Hd=P.cw||(P.cw={})).create="create",Hd.load="load",Hd.fullLoad="fullLoad";let rf=null,qc=[];const Xd=1e3/60,Wd="loadTime",Yd="fullLoadTime",sb={mark(r){performance.mark(r)},frame(r){const t=r;rf!=null&&qc.push(t-rf),rf=t},clearMetrics(){rf=null,qc=[],performance.clearMeasures(Wd),performance.clearMeasures(Yd);for(const r in P.cw)performance.clearMarks(P.cw[r])},getPerformanceMetrics(){performance.measure(Wd,P.cw.create,P.cw.load),performance.measure(Yd,P.cw.create,P.cw.fullLoad);const r=performance.getEntriesByName(Wd)[0].duration,t=performance.getEntriesByName(Yd)[0].duration,n=qc.length,l=1/(qc.reduce((_,v)=>_+v,0)/n/1e3),f=qc.filter(_=>_>Xd).reduce((_,v)=>_+(v-Xd)/Xd,0);return{loadTime:r,fullLoadTime:t,fps:l,percentDroppedFrames:f/(n+f)*100,totalFrames:n}}};P.$=Jt,P.A=Ke,P.B=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},P.C=Yi,P.D=Ft,P.E=et,P.F=nn,P.G=_u,P.H=function(r){if(It==null){const t=r.navigator?r.navigator.userAgent:null;It=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return It},P.I=Ad,P.J=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Wx(()=>this.process()),this.subscription=fi(this.target,"message",n=>this.receive(n),!1),this.globalScope=Re(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((n,l)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=t?fi(t.signal,"abort",()=>{_?.unsubscribe(),delete this.resolveRejects[f];const k={id:f,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(k)},Yx):null;this.resolveRejects[f]={resolve:k=>{_?.unsubscribe(),n(k)},reject:k=>{_?.unsubscribe(),l(k)}};const v=[],w=Object.assign(Object.assign({},r),{id:f,sourceMapId:this.mapId,origin:location.origin,data:_l(r.data,v)});this.target.postMessage(w,{transfer:v})})}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(Re(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return o(this,void 0,void 0,function*(){if(t.type==="<response>"){const f=this.resolveRejects[r];return delete this.resolveRejects[r],f?void(t.error?f.reject(So(t.error)):f.resolve(So(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=So(t.data),l=new AbortController;this.abortControllers[r]=l;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,n,l);this.completeTask(r,null,f)}catch(f){this.completeTask(r,f)}})}completeTask(r,t,n){const l=[];delete this.abortControllers[r];const f={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?_l(t):null,data:_l(n,l)};this.target.postMessage(f,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},P.K=Q,P.L=function(){var r=new Ke(16);return Ke!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},P.M=function(r,t,n){var l,f,_,v,w,k,A,L,O,V,$,Z,K=n[0],se=n[1],he=n[2];return t===r?(r[12]=t[0]*K+t[4]*se+t[8]*he+t[12],r[13]=t[1]*K+t[5]*se+t[9]*he+t[13],r[14]=t[2]*K+t[6]*se+t[10]*he+t[14],r[15]=t[3]*K+t[7]*se+t[11]*he+t[15]):(f=t[1],_=t[2],v=t[3],w=t[4],k=t[5],A=t[6],L=t[7],O=t[8],V=t[9],$=t[10],Z=t[11],r[0]=l=t[0],r[1]=f,r[2]=_,r[3]=v,r[4]=w,r[5]=k,r[6]=A,r[7]=L,r[8]=O,r[9]=V,r[10]=$,r[11]=Z,r[12]=l*K+w*se+O*he+t[12],r[13]=f*K+k*se+V*he+t[13],r[14]=_*K+A*se+$*he+t[14],r[15]=v*K+L*se+Z*he+t[15]),r},P.N=function(r,t,n){var l=n[0],f=n[1],_=n[2];return r[0]=t[0]*l,r[1]=t[1]*l,r[2]=t[2]*l,r[3]=t[3]*l,r[4]=t[4]*f,r[5]=t[5]*f,r[6]=t[6]*f,r[7]=t[7]*f,r[8]=t[8]*_,r[9]=t[9]*_,r[10]=t[10]*_,r[11]=t[11]*_,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},P.O=function(r,t,n){var l=t[0],f=t[1],_=t[2],v=t[3],w=t[4],k=t[5],A=t[6],L=t[7],O=t[8],V=t[9],$=t[10],Z=t[11],K=t[12],se=t[13],he=t[14],Ie=t[15],ye=n[0],G=n[1],ne=n[2],ve=n[3];return r[0]=ye*l+G*w+ne*O+ve*K,r[1]=ye*f+G*k+ne*V+ve*se,r[2]=ye*_+G*A+ne*$+ve*he,r[3]=ye*v+G*L+ne*Z+ve*Ie,r[4]=(ye=n[4])*l+(G=n[5])*w+(ne=n[6])*O+(ve=n[7])*K,r[5]=ye*f+G*k+ne*V+ve*se,r[6]=ye*_+G*A+ne*$+ve*he,r[7]=ye*v+G*L+ne*Z+ve*Ie,r[8]=(ye=n[8])*l+(G=n[9])*w+(ne=n[10])*O+(ve=n[11])*K,r[9]=ye*f+G*k+ne*V+ve*se,r[10]=ye*_+G*A+ne*$+ve*he,r[11]=ye*v+G*L+ne*Z+ve*Ie,r[12]=(ye=n[12])*l+(G=n[13])*w+(ne=n[14])*O+(ve=n[15])*K,r[13]=ye*f+G*k+ne*V+ve*se,r[14]=ye*_+G*A+ne*$+ve*he,r[15]=ye*v+G*L+ne*Z+ve*Ie,r},P.P=le,P.Q=function(r,t){const n={};for(let l=0;l<t.length;l++){const f=t[l];f in r&&(n[f]=r[f])}return n},P.R=qr,P.S=Po,P.T=gd,P.U=Mg,P.V=Pg,P.W=tt,P.X=We,P.Y=At,P.Z=ms,P._=o,P.a=W,P.a$=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r},P.a0=Uc,P.a1=Ml,P.a2=25,P.a3=Vd,P.a4=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const l of r){const f=window.document.createElement("source");Le(l)||(t.crossOrigin="Anonymous"),f.src=l,t.appendChild(f)}})},P.a5=xt,P.a6=function(){return q++},P.a7=oe,P.a8=Mu,P.a9=ma,P.aA=Wn,P.aB=Ui,P.aC=function(r,t,n,l,f=!1){if(!n[0]&&!n[1])return[0,0];const _=f?l==="map"?-r.bearingInRadians:0:l==="viewport"?r.bearingInRadians:0;if(_){const v=Math.sin(_),w=Math.cos(_);n=[n[0]*w-n[1]*v,n[0]*v+n[1]*w]}return[f?n[0]:Ui(t,n[0],r.zoom),f?n[1]:Ui(t,n[1],r.zoom)]},P.aE=Dd,P.aF=Gd,P.aG=Ld,P.aH=qd,P.aI=gn,P.aJ=Zh,P.aK=De,P.aL=Mi,P.aM=Zi,P.aN=Ci,P.aO=Et,P.aP=Rg,P.aQ=Pt,P.aR=ct,P.aS=function(r){var t=new Ke(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},P.aT=function(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r},P.aU=function(r,t){var n=t[0],l=t[1],f=t[2],_=n*n+l*l+f*f;return _>0&&(_=1/Math.sqrt(_)),r[0]=t[0]*_,r[1]=t[1]*_,r[2]=t[2]*_,r},P.aV=ut,P.aW=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]},P.aX=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},P.aY=Ct,P.aZ=function(r,t,n){const l=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return l===0?null:(-(r[0]*n[0]+r[1]*n[1]+r[2]*n[2])-n[3])/l},P.a_=qt,P.aa=El,P.ab=Ng,P.ac=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,l,f,_)=>{const v=f||_;return t[l]=!v||v.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},P.ad=gi,P.ae=function(r){return Math.pow(2,r)},P.af=dt,P.ag=rn,P.ah=85.051129,P.ai=Ag,P.aj=function(r){return Math.log(r)/Math.LN2},P.ak=function(r){var t=r[0],n=r[1];return t*t+n*n},P.al=function(r,t){const n=[];for(const l in r)l in t||n.push(l);return n},P.am=function(r,t){let n=0,l=0;if(r.kind==="constant")l=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:f,minZoom:_,maxZoom:v}=r,w=f?rn(ir.interpolationFactor(f,t,_,v),0,1):0;r.kind==="camera"?l=Yi.number(r.minSize,r.maxSize,w):n=w}return{uSizeT:n,uSize:l}},P.ao=function(r,{uSize:t,uSizeT:n},{lowerSize:l,upperSize:f}){return r.kind==="source"?l/Ya:r.kind==="composite"?Yi.number(l/Ya,f/Ya,n):t},P.ap=function(r,t){var n=t[0],l=t[1],f=t[2],_=t[3],v=t[4],w=t[5],k=t[6],A=t[7],L=t[8],O=t[9],V=t[10],$=t[11],Z=t[12],K=t[13],se=t[14],he=t[15],Ie=n*w-l*v,ye=n*k-f*v,G=n*A-_*v,ne=l*k-f*w,ve=l*A-_*w,Oe=f*A-_*k,nt=L*K-O*Z,Ve=L*se-V*Z,$e=L*he-$*Z,gt=O*se-V*K,at=O*he-$*K,yt=V*he-$*se,Je=Ie*yt-ye*at+G*gt+ne*$e-ve*Ve+Oe*nt;return Je?(r[0]=(w*yt-k*at+A*gt)*(Je=1/Je),r[1]=(f*at-l*yt-_*gt)*Je,r[2]=(K*Oe-se*ve+he*ne)*Je,r[3]=(V*ve-O*Oe-$*ne)*Je,r[4]=(k*$e-v*yt-A*Ve)*Je,r[5]=(n*yt-f*$e+_*Ve)*Je,r[6]=(se*G-Z*Oe-he*ye)*Je,r[7]=(L*Oe-V*G+$*ye)*Je,r[8]=(v*at-w*$e+A*nt)*Je,r[9]=(l*$e-n*at-_*nt)*Je,r[10]=(Z*ve-K*G+he*Ie)*Je,r[11]=(O*G-L*ve-$*Ie)*Je,r[12]=(w*Ve-v*gt-k*nt)*Je,r[13]=(n*gt-l*Ve+f*nt)*Je,r[14]=(K*ye-Z*ne-se*Ie)*Je,r[15]=(L*ne-O*ye+V*Ie)*Je,r):null},P.aq=Ot,P.ar=function(r){return Math.hypot(r[0],r[1])},P.as=function(r){return r[0]=0,r[1]=0,r},P.at=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r},P.au=zd,P.av=Ut,P.aw=function(r,t,n,l){const f=t.y-r.y,_=t.x-r.x,v=l.y-n.y,w=l.x-n.x,k=v*_-w*f;if(k===0)return null;const A=(w*(r.y-n.y)-v*(r.x-n.x))/k;return new le(r.x+A*_,r.y+A*f)},P.ax=Bg,P.ay=Tm,P.az=function(r){let t=1/0,n=1/0,l=-1/0,f=-1/0;for(const _ of r)t=Math.min(t,_.x),n=Math.min(n,_.y),l=Math.max(l,_.x),f=Math.max(f,_.y);return[t,n,l,f]},P.b=_t,P.b$=kx,P.b0=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]},P.b1=Dg,P.b2=Au,P.b3=function(r,t,n,l,f){var _,v=1/Math.tan(t/2);return r[0]=v/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,f!=null&&f!==1/0?(r[10]=(f+l)*(_=1/(l-f)),r[14]=2*f*l*_):(r[10]=-1,r[14]=-2*l),r},P.b4=function(r){var t=new Ke(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},P.b5=function(r,t,n){var l=Math.sin(n),f=Math.cos(n),_=t[0],v=t[1],w=t[2],k=t[3],A=t[4],L=t[5],O=t[6],V=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=_*f+A*l,r[1]=v*f+L*l,r[2]=w*f+O*l,r[3]=k*f+V*l,r[4]=A*f-_*l,r[5]=L*f-v*l,r[6]=O*f-w*l,r[7]=V*f-k*l,r},P.b6=function(r,t,n){var l=Math.sin(n),f=Math.cos(n),_=t[4],v=t[5],w=t[6],k=t[7],A=t[8],L=t[9],O=t[10],V=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=_*f+A*l,r[5]=v*f+L*l,r[6]=w*f+O*l,r[7]=k*f+V*l,r[8]=A*f-_*l,r[9]=L*f-v*l,r[10]=O*f-w*l,r[11]=V*f-k*l,r},P.b7=function(){const r=new Float32Array(16);return dt(r),r},P.b8=function(){const r=new Float64Array(16);return dt(r),r},P.b9=function(){return new Float64Array(16)},P.bA=function(r){return r[0]=0,r[1]=0,r[2]=0,r},P.bB=function(r,t,n,l){const f=Math.sqrt(r*r+t*t),_=Math.sqrt(n*n+l*l);r/=f,t/=f,n/=_,l/=_;const v=Math.acos(r*n+t*l);return-t*n+r*l>0?v:-v},P.bC=function(r,t){const n=ri(r,2*Math.PI),l=ri(t,2*Math.PI);return Math.min(Math.abs(n-l),Math.abs(n-l+2*Math.PI),Math.abs(n-l-2*Math.PI))},P.bD=function(){const r={},t=be.$version;for(const n in be.$root){const l=be.$root[n];if(l.required){let f=null;f=n==="version"?t:l.type==="array"?[]:{},f!=null&&(r[n]=f)}}return r},P.bE=mc,P.bF=Se,P.bG=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let l=0;l<t.length;l++)if(!r(t[l],n[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const l in t)if(!r(t[l],n[l]))return!1;return!0}return t===n},P.bH=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=He(r[n],t[r[n].ref]));return r},P.bI=function(r){if(r.type==="custom")return new Xx(r);switch(r.type){case"background":return new $x(r);case"circle":return new B0(r);case"color-relief":return new $0(r);case"fill":return new ax(r);case"fill-extrusion":return new px(r);case"heatmap":return new V0(r);case"hillshade":return new G0(r);case"line":return new wx(r);case"raster":return new Hx(r);case"symbol":return new Jh(r)}},P.bJ=ot,P.bK=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Mt(r.version,t.version))return[{command:"setStyle",args:[t]}];Mt(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Mt(r.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),Mt(r.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Mt(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Mt(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Mt(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Mt(r.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),Mt(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Mt(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Mt(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Mt(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),Mt(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Mt(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Mt(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const l={},f=[];(function(v,w,k,A){let L;for(L in w=w||{},v=v||{})Object.prototype.hasOwnProperty.call(v,L)&&(Object.prototype.hasOwnProperty.call(w,L)||Bi(L,k,A));for(L in w)Object.prototype.hasOwnProperty.call(w,L)&&(Object.prototype.hasOwnProperty.call(v,L)?Mt(v[L],w[L])||(v[L].type==="geojson"&&w[L].type==="geojson"&&Pi(v,w,L)?Ht(k,{command:"setGeoJSONSourceData",args:[L,w[L].data]}):Li(L,w,k,A)):ii(L,w,k))})(r.sources,t.sources,f,l);const _=[];r.layers&&r.layers.forEach(v=>{"source"in v&&l[v.source]?n.push({command:"removeLayer",args:[v.id]}):_.push(v)}),n=n.concat(f),function(v,w,k){w=w||[];const A=(v=v||[]).map(xi),L=w.map(xi),O=v.reduce(dn,{}),V=w.reduce(dn,{}),$=A.slice(),Z=Object.create(null);let K,se,he,Ie,ye;for(let G=0,ne=0;G<A.length;G++)K=A[G],Object.prototype.hasOwnProperty.call(V,K)?ne++:(Ht(k,{command:"removeLayer",args:[K]}),$.splice($.indexOf(K,ne),1));for(let G=0,ne=0;G<L.length;G++)K=L[L.length-1-G],$[$.length-1-G]!==K&&(Object.prototype.hasOwnProperty.call(O,K)?(Ht(k,{command:"removeLayer",args:[K]}),$.splice($.lastIndexOf(K,$.length-ne),1)):ne++,Ie=$[$.length-G],Ht(k,{command:"addLayer",args:[V[K],Ie]}),$.splice($.length-G,0,K),Z[K]=!0);for(let G=0;G<L.length;G++)if(K=L[G],se=O[K],he=V[K],!Z[K]&&!Mt(se,he))if(Mt(se.source,he.source)&&Mt(se["source-layer"],he["source-layer"])&&Mt(se.type,he.type)){for(ye in Yt(se.layout,he.layout,k,K,null,"setLayoutProperty"),Yt(se.paint,he.paint,k,K,null,"setPaintProperty"),Mt(se.filter,he.filter)||Ht(k,{command:"setFilter",args:[K,he.filter]}),Mt(se.minzoom,he.minzoom)&&Mt(se.maxzoom,he.maxzoom)||Ht(k,{command:"setLayerZoomRange",args:[K,he.minzoom,he.maxzoom]}),se)Object.prototype.hasOwnProperty.call(se,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?Yt(se[ye],he[ye],k,K,ye.slice(6),"setPaintProperty"):Mt(se[ye],he[ye])||Ht(k,{command:"setLayerProperty",args:[K,ye,he[ye]]}));for(ye in he)Object.prototype.hasOwnProperty.call(he,ye)&&!Object.prototype.hasOwnProperty.call(se,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?Yt(se[ye],he[ye],k,K,ye.slice(6),"setPaintProperty"):Mt(se[ye],he[ye])||Ht(k,{command:"setLayerProperty",args:[K,ye,he[ye]]}))}else Ht(k,{command:"removeLayer",args:[K]}),Ie=$[$.lastIndexOf(K)+1],Ht(k,{command:"addLayer",args:[he,Ie]})}(_,t.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[t]}]}return n},P.bL=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},P.bM=Te,P.bN=Ze,P.bO=class extends Qi{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},P.bP=Vh,P.bQ=class extends Qi{constructor(r,t){super(r,t),this.current=ud}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},P.bR=On,P.bS=class extends Qi{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},P.bT=class extends Qi{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},P.bU=pt,P.bV=function(r,t){var n=Math.sin(t),l=Math.cos(t);return r[0]=l,r[1]=n,r[2]=0,r[3]=-n,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},P.bW=function(r,t,n){var l=t[0],f=t[1],_=t[2];return r[0]=l*n[0]+f*n[3]+_*n[6],r[1]=l*n[1]+f*n[4]+_*n[7],r[2]=l*n[2]+f*n[5]+_*n[8],r},P.bX=function(r,t,n,l,f,_,v){var w=1/(t-n),k=1/(l-f),A=1/(_-v);return r[0]=-2*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*k,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*A,r[11]=0,r[12]=(t+n)*w,r[13]=(f+l)*k,r[14]=(v+_)*A,r[15]=1,r},P.bY=class extends Qi{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(4*r.length);for(let n=0;n<r.length;n++)t[4*n]=r[n].r,t[4*n+1]=r[n].g,t[4*n+2]=r[n].b,t[4*n+3]=r[n].a;this.gl.uniform4fv(this.location,t)}}},P.bZ=class extends Qi{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(r);this.gl.uniform1fv(this.location,t)}}},P.b_=class extends u{},P.ba=function(r,t,n){const l=new Float64Array(4);return Ni(l,r,t-90,n),l},P.bb=function(r,t,n,l){var f,_,v,w,k,A=t[0],L=t[1],O=t[2],V=t[3],$=n[0],Z=n[1],K=n[2],se=n[3];return(_=A*$+L*Z+O*K+V*se)<0&&(_=-_,$=-$,Z=-Z,K=-K,se=-se),1-_>qe?(f=Math.acos(_),v=Math.sin(f),w=Math.sin((1-l)*f)/v,k=Math.sin(l*f)/v):(w=1-l,k=l),r[0]=w*A+k*$,r[1]=w*L+k*Z,r[2]=w*O+k*K,r[3]=w*V+k*se,r},P.bc=function(r){const t=new Float64Array(9);var n,l,f,_,v,w,k,A,L,O,V,$,Z,K,se,he,Ie,ye;O=(f=(l=r)[0])*(k=f+f),V=(_=l[1])*k,Z=(v=l[2])*k,K=v*(A=_+_),he=(w=l[3])*k,Ie=w*A,ye=w*(L=v+v),(n=t)[0]=1-($=_*A)-(se=v*L),n[3]=V-ye,n[6]=Z+Ie,n[1]=V+ye,n[4]=1-O-se,n[7]=K-he,n[2]=Z-Ie,n[5]=K+he,n[8]=1-O-$;const G=Et(-Math.asin(rn(t[2],-1,1)));let ne,ve;return Math.hypot(t[5],t[8])<.001?(ne=0,ve=-Et(Math.atan2(t[3],t[4]))):(ne=Et(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),ve=Et(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:ne,pitch:G+90,bearing:ve}},P.bd=function(r,t){return r.roll==t.roll&&r.pitch==t.pitch&&r.bearing==t.bearing},P.be=ai,P.bf=wr,P.bg=Cu,P.bh=zc,P.bi=Eu,P.bj=Pn,P.bk=yr,P.bl=ci,P.bm=function(r,t,n,l,f){return Pn(l,f,rn((r-t)/(n-t),0,1))},P.bn=ri,P.bo=function(){return new Float64Array(3)},P.bp=function(r,t,n,l){return r[0]=t[0]+n[0]*l,r[1]=t[1]+n[1]*l,r[2]=t[2]+n[2]*l,r},P.bq=Ni,P.br=function(r,t,n){var l=n[0],f=n[1],_=n[2],v=t[0],w=t[1],k=t[2],A=f*k-_*w,L=_*v-l*k,O=l*w-f*v,V=f*O-_*L,$=_*A-l*O,Z=l*L-f*A,K=2*n[3];return L*=K,O*=K,$*=2,Z*=2,r[0]=v+(A*=K)+(V*=2),r[1]=w+L+$,r[2]=k+O+Z,r},P.bs=function(r,t,n){const l=(f=[r[0],r[1],r[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((L=f[8])*(v=f[4])-(w=f[5])*(A=f[7]))+f[1]*(-L*(_=f[3])+w*(k=f[6]))+f[2]*(A*_-v*k);var f,_,v,w,k,A,L;if(l===0)return null;const O=ut([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),V=ut([],[n[0],n[1],n[2]],[r[0],r[1],r[2]]),$=ut([],[r[0],r[1],r[2]],[t[0],t[1],t[2]]),Z=Pt([],O,-r[3]);return ct(Z,Z,Pt([],V,-t[3])),ct(Z,Z,Pt([],$,-n[3])),Pt(Z,Z,1/l),Z},P.bt=Bd,P.bu=function(){return new Float64Array(4)},P.bv=function(r,t,n,l){var f=[],_=[];return f[0]=t[0]-n[0],f[1]=t[1]-n[1],f[2]=t[2]-n[2],_[0]=f[0]*Math.cos(l)-f[1]*Math.sin(l),_[1]=f[0]*Math.sin(l)+f[1]*Math.cos(l),_[2]=f[2],r[0]=_[0]+n[0],r[1]=_[1]+n[1],r[2]=_[2]+n[2],r},P.bw=function(r,t,n,l){var f=[],_=[];return f[0]=t[0]-n[0],f[1]=t[1]-n[1],f[2]=t[2]-n[2],_[0]=f[0],_[1]=f[1]*Math.cos(l)-f[2]*Math.sin(l),_[2]=f[1]*Math.sin(l)+f[2]*Math.cos(l),r[0]=_[0]+n[0],r[1]=_[1]+n[1],r[2]=_[2]+n[2],r},P.bx=function(r,t,n,l){var f=[],_=[];return f[0]=t[0]-n[0],f[1]=t[1]-n[1],f[2]=t[2]-n[2],_[0]=f[2]*Math.sin(l)+f[0]*Math.cos(l),_[1]=f[1],_[2]=f[2]*Math.cos(l)-f[0]*Math.sin(l),r[0]=_[0]+n[0],r[1]=_[1]+n[1],r[2]=_[2]+n[2],r},P.by=function(r,t,n){var l=Math.sin(n),f=Math.cos(n),_=t[0],v=t[1],w=t[2],k=t[3],A=t[8],L=t[9],O=t[10],V=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=_*f-A*l,r[1]=v*f-L*l,r[2]=w*f-O*l,r[3]=k*f-V*l,r[8]=_*l+A*f,r[9]=v*l+L*f,r[10]=w*l+O*f,r[11]=k*l+V*f,r},P.bz=function(r,t){const n=ri(r,360),l=ri(t,360),f=l-n,_=l>n?f-360:f+360;return Math.abs(f)<Math.abs(_)?f:_},P.c=Ee,P.c0=class extends g{},P.c1=md,P.c2=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},P.c3=Lm,P.c4=function(r,t,n){var l=t[0],f=t[1],_=t[2],v=n[3]*l+n[7]*f+n[11]*_+n[15];return r[0]=(n[0]*l+n[4]*f+n[8]*_+n[12])/(v=v||1),r[1]=(n[1]*l+n[5]*f+n[9]*_+n[13])/v,r[2]=(n[2]*l+n[6]*f+n[10]*_+n[14])/v,r},P.c5=class extends wc{},P.c6=class extends F{},P.c7=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},P.c8=function(r,t){var n=r[0],l=r[1],f=r[2],_=r[3],v=r[4],w=r[5],k=r[6],A=r[7],L=r[8],O=r[9],V=r[10],$=r[11],Z=r[12],K=r[13],se=r[14],he=r[15],Ie=t[0],ye=t[1],G=t[2],ne=t[3],ve=t[4],Oe=t[5],nt=t[6],Ve=t[7],$e=t[8],gt=t[9],at=t[10],yt=t[11],Je=t[12],Nt=t[13],ei=t[14],Kt=t[15];return Math.abs(n-Ie)<=qe*Math.max(1,Math.abs(n),Math.abs(Ie))&&Math.abs(l-ye)<=qe*Math.max(1,Math.abs(l),Math.abs(ye))&&Math.abs(f-G)<=qe*Math.max(1,Math.abs(f),Math.abs(G))&&Math.abs(_-ne)<=qe*Math.max(1,Math.abs(_),Math.abs(ne))&&Math.abs(v-ve)<=qe*Math.max(1,Math.abs(v),Math.abs(ve))&&Math.abs(w-Oe)<=qe*Math.max(1,Math.abs(w),Math.abs(Oe))&&Math.abs(k-nt)<=qe*Math.max(1,Math.abs(k),Math.abs(nt))&&Math.abs(A-Ve)<=qe*Math.max(1,Math.abs(A),Math.abs(Ve))&&Math.abs(L-$e)<=qe*Math.max(1,Math.abs(L),Math.abs($e))&&Math.abs(O-gt)<=qe*Math.max(1,Math.abs(O),Math.abs(gt))&&Math.abs(V-at)<=qe*Math.max(1,Math.abs(V),Math.abs(at))&&Math.abs($-yt)<=qe*Math.max(1,Math.abs($),Math.abs(yt))&&Math.abs(Z-Je)<=qe*Math.max(1,Math.abs(Z),Math.abs(Je))&&Math.abs(K-Nt)<=qe*Math.max(1,Math.abs(K),Math.abs(Nt))&&Math.abs(se-ei)<=qe*Math.max(1,Math.abs(se),Math.abs(ei))&&Math.abs(he-Kt)<=qe*Math.max(1,Math.abs(he),Math.abs(Kt))},P.c9=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},P.cA=function(r){delete W.REGISTERED_PROTOCOLS[r]},P.cB=function(r,t){const n={};for(let f=0;f<r.length;f++){const _=t&&t[r[f].id]||fu(r[f]);t&&(t[r[f].id]=_);let v=n[_];v||(v=n[_]=[]),v.push(r[f])}const l=[];for(const f in n)l.push(n[f]);return l},P.cC=Lt,P.cD=zg,P.cE=Og,P.cF=dg,P.cG=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Jt/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,l=t._unevaluatedLayout._values,f={layoutIconSize:l["icon-size"].possiblyEvaluate(new nn(r.bucket.zoom+1),r.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new nn(r.bucket.zoom+1),r.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new nn(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:L}=r.bucket.textSizeData;f.compositeTextSizes=[l["text-size"].possiblyEvaluate(new nn(A),r.canonical),l["text-size"].possiblyEvaluate(new nn(L),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:L}=r.bucket.iconSizeData;f.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new nn(A),r.canonical),l["icon-size"].possiblyEvaluate(new nn(L),r.canonical)]}const _=n.get("text-line-height")*Wn,v=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",w=n.get("text-keep-upright"),k=n.get("text-size");for(const A of r.bucket.features){const L=n.get("text-font").evaluate(A,{},r.canonical).join(","),O=k.evaluate(A,{},r.canonical),V=f.layoutTextSize.evaluate(A,{},r.canonical),$=f.layoutIconSize.evaluate(A,{},r.canonical),Z={horizontal:{},vertical:void 0},K=A.text;let se,he=[0,0];if(K){const G=K.toString(),ne=n.get("text-letter-spacing").evaluate(A,{},r.canonical)*Wn,ve=Dh(G)?ne:0,Oe=n.get("text-anchor").evaluate(A,{},r.canonical),nt=Xg(t,A,r.canonical);if(!nt){const at=n.get("text-radial-offset").evaluate(A,{},r.canonical);he=at?Hg(Oe,[at*Wn,Ud]):n.get("text-offset").evaluate(A,{},r.canonical).map(yt=>yt*Wn)}let Ve=v?"center":n.get("text-justify").evaluate(A,{},r.canonical);const $e=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(A,{},r.canonical)*Wn:1/0,gt=()=>{r.bucket.allowVerticalPlacement&&gc(G)&&(Z.vertical=Wh(K,r.glyphMap,r.glyphPositions,r.imagePositions,L,$e,_,Oe,"left",ve,he,P.an.vertical,!0,V,O))};if(!v&&nt){const at=new Set;if(Ve==="auto")for(let Je=0;Je<nt.values.length;Je+=2)at.add(Gd(nt.values[Je]));else at.add(Ve);let yt=!1;for(const Je of at)if(!Z.horizontal[Je])if(yt)Z.horizontal[Je]=Z.horizontal[0];else{const Nt=Wh(K,r.glyphMap,r.glyphPositions,r.imagePositions,L,$e,_,"center",Je,ve,he,P.an.horizontal,!1,V,O);Nt&&(Z.horizontal[Je]=Nt,yt=Nt.positionedLines.length===1)}gt()}else{Ve==="auto"&&(Ve=Gd(Oe));const at=Wh(K,r.glyphMap,r.glyphPositions,r.imagePositions,L,$e,_,Oe,Ve,ve,he,P.an.horizontal,!1,V,O);at&&(Z.horizontal[Ve]=at),gt(),gc(G)&&v&&w&&(Z.vertical=Wh(K,r.glyphMap,r.glyphPositions,r.imagePositions,L,$e,_,Oe,Ve,ve,he,P.an.vertical,!1,V,O))}}let Ie=!1;if(A.icon&&A.icon.name){const G=r.imageMap[A.icon.name];G&&(se=jx(r.imagePositions[A.icon.name],n.get("icon-offset").evaluate(A,{},r.canonical),n.get("icon-anchor").evaluate(A,{},r.canonical)),Ie=!!G.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=Ie:r.bucket.sdfIcons!==Ie&&rt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(G.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ye=Yg(Z.horizontal)||Z.vertical;r.bucket.iconsInText=!!ye&&ye.iconsInText,(ye||se)&&nb(r.bucket,A,Z,se,r.imageMap,f,V,$,he,Ie,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},P.cH=Ed,P.cI=bd,P.cJ=kd,P.cK=Oc,P.cL=Md,P.cM=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},P.cN=function(r,t,n,l,f){return o(this,void 0,void 0,function*(){if(We())try{return yield At(r,t,n,l,f)}catch{}return function(_,v,w,k,A){const L=_.width,O=_.height;mt&&Qt||(mt=new OffscreenCanvas(L,O),Qt=mt.getContext("2d",{willReadFrequently:!0})),mt.width=L,mt.height=O,Qt.drawImage(_,0,0,L,O);const V=Qt.getImageData(v,w,k,A);return Qt.clearRect(0,0,L,O),V.data}(r,t,n,l,f)})},P.cO=Nm,P.cP=J,P.cQ=ie,P.cR=Qm,P.cS=hg,P.cT=lu,P.cU=_a,P.ca=r=>r.type==="symbol",P.cb=r=>r.type==="circle",P.cc=r=>r.type==="heatmap",P.cd=r=>r.type==="line",P.ce=r=>r.type==="fill",P.cf=r=>r.type==="fill-extrusion",P.cg=r=>r.type==="hillshade",P.ch=r=>r.type==="color-relief",P.ci=r=>r.type==="raster",P.cj=r=>r.type==="background",P.ck=r=>r.type==="custom",P.cl=kr,P.cm=function(r,t,n){const l=Ei(t.x-n.x,t.y-n.y),f=Ei(r.x-n.x,r.y-n.y);var _,v;return Et(Math.atan2(l[0]*f[1]-l[1]*f[0],(_=l)[0]*(v=f)[0]+_[1]*v[1]))},P.cn=Ne,P.co=function(r,t){return si[t]&&(r instanceof MouseEvent||r instanceof WheelEvent)},P.cp=function(r,t){return sn[t]&&"touches"in r},P.cq=function(r){return sn[r]||si[r]},P.cr=function(r,t,n){var l=t[0],f=t[1];return r[0]=n[0]*l+n[4]*f+n[12],r[1]=n[1]*l+n[5]*f+n[13],r},P.cs=function(r,t){const{x:n,y:l}=Uc.fromLngLat(t);return!(r<0||r>25||l<0||l>=1||n<0||n>=1)},P.ct=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},P.cu=class extends va{},P.cv=sb,P.cx=function(r){return r.message===Zt},P.cy=pe,P.cz=function(r,t){W.REGISTERED_PROTOCOLS[r]=t},P.d=Le,P.e=jt,P.f=r=>o(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),P.g=ee,P.h=r=>new Promise((t,n)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=$t})},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(r)],{type:"image/png"});l.src=r.byteLength?URL.createObjectURL(f):$t}),P.i=Re,P.j=(r,t)=>Pe(jt(r,{type:"json"}),t),P.k=Ae,P.l=Ue,P.m=Pe,P.n=(r,t)=>Pe(jt(r,{type:"arrayBuffer"}),t),P.o=function(r){return new Md(r).readFields(Px,[])},P.p=fg,P.q=Mc,P.r=br,P.s=fi,P.t=xc,P.u=Si,P.v=be,P.w=rt,P.x=nd,P.y=ml,P.z=wo}),E("worker",["./shared"],function(P){class o{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,ee){for(const pe of W){this._layerConfigs[pe.id]=pe;const Se=this._layers[pe.id]=P.bI(pe);Se._featureFilter=P.a9(Se.filter),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(const pe of ee)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const Q=P.cB(Object.values(this._layerConfigs),this.keyCache);for(const pe of Q){const Se=pe.map(Ae=>this._layers[Ae.id]),Pe=Se[0];if(Pe.visibility==="none")continue;const Le=Pe.source||"";let ke=this.familiesBySource[Le];ke||(ke=this.familiesBySource[Le]={});const Ge=Pe.sourceLayer||"_geojsonTileLayer";let Ue=ke[Ge];Ue||(Ue=ke[Ge]=[]),Ue.push(Se)}}}class J{constructor(W){const ee={},Q=[];for(const Le in W){const ke=W[Le],Ge=ee[Le]={};for(const Ue in ke){const Ae=ke[+Ue];if(!Ae||Ae.bitmap.width===0||Ae.bitmap.height===0)continue;const et={x:0,y:0,w:Ae.bitmap.width+2,h:Ae.bitmap.height+2};Q.push(et),Ge[Ue]={rect:et,metrics:Ae.metrics}}}const{w:pe,h:Se}=P.p(Q),Pe=new P.q({width:pe||1,height:Se||1});for(const Le in W){const ke=W[Le];for(const Ge in ke){const Ue=ke[+Ge];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ae=ee[Le][Ge].rect;P.q.copy(Ue.bitmap,Pe,{x:0,y:0},{x:Ae.x+1,y:Ae.y+1},Ue.bitmap)}}this.image=Pe,this.positions=ee}}P.cC("GlyphAtlas",J);class re{constructor(W){this.tileID=new P.Z(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[],this.globalState=W.globalState}parse(W,ee,Q,pe,Se){return P._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new P.a7;const Pe=new P.cD(Object.keys(W.layers).sort()),Le=new P.cE(this.tileID,this.promoteId);Le.bucketLayerIDs=[];const ke={},Ge={featureIndex:Le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Q,subdivisionGranularity:Se},Ue=ee.familiesBySource[this.source];for(const Yt in Ue){const xi=W.layers[Yt];if(!xi)continue;xi.version===1&&P.w(`Vector tile source "${this.source}" layer "${Yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dn=Pe.encode(Yt),xt=[];for(let Mn=0;Mn<xi.length;Mn++){const Ki=xi.feature(Mn),wn=Le.getId(Ki,Yt);xt.push({feature:Ki,id:wn,index:Mn,sourceLayerIndex:dn})}for(const Mn of Ue[Yt]){const Ki=Mn[0];Ki.source!==this.source&&P.w(`layer.source = ${Ki.source} does not equal this.source = ${this.source}`),Ki.minzoom&&this.zoom<Math.floor(Ki.minzoom)||Ki.maxzoom&&this.zoom>=Ki.maxzoom||Ki.visibility!=="none"&&(H(Mn,this.zoom,Q),(ke[Ki.id]=Ki.createBucket({index:Le.bucketLayerIDs.length,layers:Mn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dn,sourceID:this.source,globalState:this.globalState})).populate(xt,Ge,this.tileID.canonical),Le.bucketLayerIDs.push(Mn.map(wn=>wn.id)))}}const Ae=P.bM(Ge.glyphDependencies,Yt=>Object.keys(Yt).map(Number));this.inFlightDependencies.forEach(Yt=>Yt?.abort()),this.inFlightDependencies=[];let et=Promise.resolve({});if(Object.keys(Ae).length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),et=pe.sendAsync({type:"GG",data:{stacks:Ae,source:this.source,tileID:this.tileID,type:"glyphs"}},Yt)}const be=Object.keys(Ge.iconDependencies);let Tt=Promise.resolve({});if(be.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),Tt=pe.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},Yt)}const He=Object.keys(Ge.patternDependencies);let Mt=Promise.resolve({});if(He.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),Mt=pe.sendAsync({type:"GI",data:{icons:He,source:this.source,tileID:this.tileID,type:"patterns"}},Yt)}const[Ht,ii,Bi]=yield Promise.all([et,Tt,Mt]),Li=new J(Ht),Pi=new P.cF(ii,Bi);for(const Yt in ke){const xi=ke[Yt];xi instanceof P.a8?(H(xi.layers,this.zoom,Q),P.cG({bucket:xi,glyphMap:Ht,glyphPositions:Li.positions,imageMap:ii,imagePositions:Pi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ge.subdivisionGranularity})):xi.hasPattern&&(xi instanceof P.cH||xi instanceof P.cI||xi instanceof P.cJ)&&(H(xi.layers,this.zoom,Q),xi.addFeatures(Ge,this.tileID.canonical,Pi.patternPositions))}return this.status="done",{buckets:Object.values(ke).filter(Yt=>!Yt.isEmpty()),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Li.image,imageAtlas:Pi,glyphMap:this.returnDependencies?Ht:null,iconMap:this.returnDependencies?ii:null,glyphPositions:this.returnDependencies?Li.positions:null}})}}function H(Ee,W,ee){const Q=new P.F(W);for(const pe of Ee)pe.recalculate(Q,ee)}class ie{constructor(W,ee,Q){this.actor=W,this.layerIndex=ee,this.availableImages=Q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,ee){return P._(this,void 0,void 0,function*(){const Q=yield P.n(W.request,ee);try{return{vectorTile:new P.cK.VectorTile(new P.cL(Q.data)),rawData:Q.data,cacheControl:Q.cacheControl,expires:Q.expires}}catch(pe){const Se=new Uint8Array(Q.data);let Pe=`Unable to parse the tile at ${W.request.url}, `;throw Pe+=Se[0]===31&&Se[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${pe.message}`,new Error(Pe)}})}loadTile(W){return P._(this,void 0,void 0,function*(){const ee=W.uid,Q=!!(W&&W.request&&W.request.collectResourceTiming)&&new P.cM(W.request),pe=new re(W);this.loading[ee]=pe;const Se=new AbortController;pe.abort=Se;try{const Pe=yield this.loadVectorTile(W,Se);if(delete this.loading[ee],!Pe)return null;const Le=Pe.rawData,ke={};Pe.expires&&(ke.expires=Pe.expires),Pe.cacheControl&&(ke.cacheControl=Pe.cacheControl);const Ge={};if(Q){const Ae=Q.finish();Ae&&(Ge.resourceTiming=JSON.parse(JSON.stringify(Ae)))}pe.vectorTile=Pe.vectorTile;const Ue=pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[ee]=pe,this.fetching[ee]={rawTileData:Le,cacheControl:ke,resourceTiming:Ge};try{const Ae=yield Ue;return P.e({rawTileData:Le.slice(0)},Ae,ke,Ge)}finally{delete this.fetching[ee]}}catch(Pe){throw delete this.loading[ee],pe.status="done",this.loaded[ee]=pe,Pe}})}reloadTile(W){return P._(this,void 0,void 0,function*(){const ee=W.uid;if(!this.loaded||!this.loaded[ee])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Q=this.loaded[ee];if(Q.showCollisionBoxes=W.showCollisionBoxes,Q.globalState=W.globalState,Q.status==="parsing"){const pe=yield Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let Se;if(this.fetching[ee]){const{rawTileData:Pe,cacheControl:Le,resourceTiming:ke}=this.fetching[ee];delete this.fetching[ee],Se=P.e({rawTileData:Pe.slice(0)},pe,Le,ke)}else Se=pe;return Se}if(Q.status==="done"&&Q.vectorTile)return Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)})}abortTile(W){return P._(this,void 0,void 0,function*(){const ee=this.loading,Q=W.uid;ee&&ee[Q]&&ee[Q].abort&&(ee[Q].abort.abort(),delete ee[Q])})}removeTile(W){return P._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class ce{constructor(){this.loaded={}}loadTile(W){return P._(this,void 0,void 0,function*(){const{uid:ee,encoding:Q,rawImageData:pe,redFactor:Se,greenFactor:Pe,blueFactor:Le,baseShift:ke}=W,Ge=pe.width+2,Ue=pe.height+2,Ae=P.b(pe)?new P.R({width:Ge,height:Ue},yield P.cN(pe,-1,-1,Ge,Ue)):pe,et=new P.cO(ee,Ae,Q,Se,Pe,Le,ke);return this.loaded=this.loaded||{},this.loaded[ee]=et,et})}removeTile(W){const ee=this.loaded,Q=W.uid;ee&&ee[Q]&&delete ee[Q]}}var Y,le,Xe=function(){if(le)return Y;function Ee(ee,Q){if(ee.length!==0){W(ee[0],Q);for(var pe=1;pe<ee.length;pe++)W(ee[pe],!Q)}}function W(ee,Q){for(var pe=0,Se=0,Pe=0,Le=ee.length,ke=Le-1;Pe<Le;ke=Pe++){var Ge=(ee[Pe][0]-ee[ke][0])*(ee[ke][1]+ee[Pe][1]),Ue=pe+Ge;Se+=Math.abs(pe)>=Math.abs(Ge)?pe-Ue+Ge:Ge-Ue+pe,pe=Ue}pe+Se>=0!=!!Q&&ee.reverse()}return le=1,Y=function ee(Q,pe){var Se,Pe=Q&&Q.type;if(Pe==="FeatureCollection")for(Se=0;Se<Q.features.length;Se++)ee(Q.features[Se],pe);else if(Pe==="GeometryCollection")for(Se=0;Se<Q.geometries.length;Se++)ee(Q.geometries[Se],pe);else if(Pe==="Feature")ee(Q.geometry,pe);else if(Pe==="Polygon")Ee(Q.coordinates,pe);else if(Pe==="MultiPolygon")for(Se=0;Se<Q.coordinates.length;Se++)Ee(Q.coordinates[Se],pe);return Q}}(),ft=P.cP(Xe);const it=P.cK.VectorTileFeature.prototype.toGeoJSON;class Qe{constructor(W){this._feature=W,this.extent=P.$,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const ee of this._feature.geometry)W.push([new P.P(ee[0],ee[1])]);return W}{const W=[];for(const ee of this._feature.geometry){const Q=[];for(const pe of ee)Q.push(new P.P(pe[0],pe[1]));W.push(Q)}return W}}toGeoJSON(W,ee,Q){return it.call(this,W,ee,Q)}}class tt{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=P.$,this.length=W.length,this._features=W}feature(W){return new Qe(this._features[W])}}var We,qe,Ke,pt={exports:{}},dt=function(){if(Ke)return pt.exports;Ke=1;var Ee=P.cS(),W=function(){if(qe)return We;qe=1;var Ue=P.cQ(),Ae=P.cR().VectorTileFeature;function et(Tt,He){this.options=He||{},this.features=Tt,this.length=Tt.length}function be(Tt,He){this.id=typeof Tt.id=="number"?Tt.id:void 0,this.type=Tt.type,this.rawGeometry=Tt.type===1?[Tt.geometry]:Tt.geometry,this.properties=Tt.tags,this.extent=He||4096}return We=et,et.prototype.feature=function(Tt){return new be(this.features[Tt],this.options.extent)},be.prototype.loadGeometry=function(){var Tt=this.rawGeometry;this.geometry=[];for(var He=0;He<Tt.length;He++){for(var Mt=Tt[He],Ht=[],ii=0;ii<Mt.length;ii++)Ht.push(new Ue(Mt[ii][0],Mt[ii][1]));this.geometry.push(Ht)}return this.geometry},be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Tt=this.geometry,He=1/0,Mt=-1/0,Ht=1/0,ii=-1/0,Bi=0;Bi<Tt.length;Bi++)for(var Li=Tt[Bi],Pi=0;Pi<Li.length;Pi++){var Yt=Li[Pi];He=Math.min(He,Yt.x),Mt=Math.max(Mt,Yt.x),Ht=Math.min(Ht,Yt.y),ii=Math.max(ii,Yt.y)}return[He,Ht,Mt,ii]},be.prototype.toGeoJSON=Ae.prototype.toGeoJSON,We}();function ee(Ue){var Ae=new Ee;return function(et,be){for(var Tt in et.layers)be.writeMessage(3,Q,et.layers[Tt])}(Ue,Ae),Ae.finish()}function Q(Ue,Ae){var et;Ae.writeVarintField(15,Ue.version||1),Ae.writeStringField(1,Ue.name||""),Ae.writeVarintField(5,Ue.extent||4096);var be={keys:[],values:[],keycache:{},valuecache:{}};for(et=0;et<Ue.length;et++)be.feature=Ue.feature(et),Ae.writeMessage(2,pe,be);var Tt=be.keys;for(et=0;et<Tt.length;et++)Ae.writeStringField(3,Tt[et]);var He=be.values;for(et=0;et<He.length;et++)Ae.writeMessage(4,Ge,He[et])}function pe(Ue,Ae){var et=Ue.feature;et.id!==void 0&&Ae.writeVarintField(1,et.id),Ae.writeMessage(2,Se,Ue),Ae.writeVarintField(3,et.type),Ae.writeMessage(4,ke,et)}function Se(Ue,Ae){var et=Ue.feature,be=Ue.keys,Tt=Ue.values,He=Ue.keycache,Mt=Ue.valuecache;for(var Ht in et.properties){var ii=et.properties[Ht],Bi=He[Ht];if(ii!==null){Bi===void 0&&(be.push(Ht),He[Ht]=Bi=be.length-1),Ae.writeVarint(Bi);var Li=typeof ii;Li!=="string"&&Li!=="boolean"&&Li!=="number"&&(ii=JSON.stringify(ii));var Pi=Li+":"+ii,Yt=Mt[Pi];Yt===void 0&&(Tt.push(ii),Mt[Pi]=Yt=Tt.length-1),Ae.writeVarint(Yt)}}}function Pe(Ue,Ae){return(Ae<<3)+(7&Ue)}function Le(Ue){return Ue<<1^Ue>>31}function ke(Ue,Ae){for(var et=Ue.loadGeometry(),be=Ue.type,Tt=0,He=0,Mt=et.length,Ht=0;Ht<Mt;Ht++){var ii=et[Ht],Bi=1;be===1&&(Bi=ii.length),Ae.writeVarint(Pe(1,Bi));for(var Li=be===3?ii.length-1:ii.length,Pi=0;Pi<Li;Pi++){Pi===1&&be!==1&&Ae.writeVarint(Pe(2,Li-1));var Yt=ii[Pi].x-Tt,xi=ii[Pi].y-He;Ae.writeVarint(Le(Yt)),Ae.writeVarint(Le(xi)),Tt+=Yt,He+=xi}be===3&&Ae.writeVarint(Pe(7,1))}}function Ge(Ue,Ae){var et=typeof Ue;et==="string"?Ae.writeStringField(1,Ue):et==="boolean"?Ae.writeBooleanField(7,Ue):et==="number"&&(Ue%1!=0?Ae.writeDoubleField(3,Ue):Ue<0?Ae.writeSVarintField(6,Ue):Ae.writeVarintField(5,Ue))}return pt.exports=ee,pt.exports.fromVectorTileJs=ee,pt.exports.fromGeojsonVt=function(Ue,Ae){Ae=Ae||{};var et={};for(var be in Ue)et[be]=new W(Ue[be].features,Ae),et[be].name=be,et[be].version=Ae.version,et[be].extent=Ae.extent;return ee({layers:et})},pt.exports.GeoJSONWrapper=W,pt.exports}(),Ye=P.cP(dt);const Ct={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},Dt=Math.fround||(ct=new Float32Array(1),Ee=>(ct[0]=+Ee,ct[0]));var ct;class Pt{constructor(W){this.options=Object.assign(Object.create(Ct),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:ee,minZoom:Q,maxZoom:pe}=this.options;ee&&console.time("total time");const Se=`prepare ${W.length} points`;ee&&console.time(Se),this.points=W;const Pe=[];for(let ke=0;ke<W.length;ke++){const Ge=W[ke];if(!Ge.geometry)continue;const[Ue,Ae]=Ge.geometry.coordinates,et=Dt(qt(Ue)),be=Dt(Ut(Ae));Pe.push(et,be,1/0,ke,-1,1),this.options.reduce&&Pe.push(0)}let Le=this.trees[pe+1]=this._createTree(Pe);ee&&console.timeEnd(Se);for(let ke=pe;ke>=Q;ke--){const Ge=+Date.now();Le=this.trees[ke]=this._createTree(this._cluster(Le,ke)),ee&&console.log("z%d: %d clusters in %dms",ke,Le.numItems,+Date.now()-Ge)}return ee&&console.timeEnd("total time"),this}getClusters(W,ee){let Q=((W[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,W[1]));let Se=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)Q=-180,Se=180;else if(Q>Se){const Ae=this.getClusters([Q,pe,180,Pe],ee),et=this.getClusters([-180,pe,Se,Pe],ee);return Ae.concat(et)}const Le=this.trees[this._limitZoom(ee)],ke=Le.range(qt(Q),Ut(Pe),qt(Se),Ut(pe)),Ge=Le.data,Ue=[];for(const Ae of ke){const et=this.stride*Ae;Ue.push(Ge[et+5]>1?ut(Ge,et,this.clusterProps):this.points[Ge[et+3]])}return Ue}getChildren(W){const ee=this._getOriginId(W),Q=this._getOriginZoom(W),pe="No cluster with the specified id.",Se=this.trees[Q];if(!Se)throw new Error(pe);const Pe=Se.data;if(ee*this.stride>=Pe.length)throw new Error(pe);const Le=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),ke=Se.within(Pe[ee*this.stride],Pe[ee*this.stride+1],Le),Ge=[];for(const Ue of ke){const Ae=Ue*this.stride;Pe[Ae+4]===W&&Ge.push(Pe[Ae+5]>1?ut(Pe,Ae,this.clusterProps):this.points[Pe[Ae+3]])}if(Ge.length===0)throw new Error(pe);return Ge}getLeaves(W,ee,Q){const pe=[];return this._appendLeaves(pe,W,ee=ee||10,Q=Q||0,0),pe}getTile(W,ee,Q){const pe=this.trees[this._limitZoom(W)],Se=Math.pow(2,W),{extent:Pe,radius:Le}=this.options,ke=Le/Pe,Ge=(Q-ke)/Se,Ue=(Q+1+ke)/Se,Ae={features:[]};return this._addTileFeatures(pe.range((ee-ke)/Se,Ge,(ee+1+ke)/Se,Ue),pe.data,ee,Q,Se,Ae),ee===0&&this._addTileFeatures(pe.range(1-ke/Se,Ge,1,Ue),pe.data,Se,Q,Se,Ae),ee===Se-1&&this._addTileFeatures(pe.range(0,Ge,ke/Se,Ue),pe.data,-1,Q,Se,Ae),Ae.features.length?Ae:null}getClusterExpansionZoom(W){let ee=this._getOriginZoom(W)-1;for(;ee<=this.options.maxZoom;){const Q=this.getChildren(W);if(ee++,Q.length!==1)break;W=Q[0].properties.cluster_id}return ee}_appendLeaves(W,ee,Q,pe,Se){const Pe=this.getChildren(ee);for(const Le of Pe){const ke=Le.properties;if(ke&&ke.cluster?Se+ke.point_count<=pe?Se+=ke.point_count:Se=this._appendLeaves(W,ke.cluster_id,Q,pe,Se):Se<pe?Se++:W.push(Le),W.length===Q)break}return Se}_createTree(W){const ee=new P.aH(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<W.length;Q+=this.stride)ee.add(W[Q],W[Q+1]);return ee.finish(),ee.data=W,ee}_addTileFeatures(W,ee,Q,pe,Se,Pe){for(const Le of W){const ke=Le*this.stride,Ge=ee[ke+5]>1;let Ue,Ae,et;if(Ge)Ue=Bt(ee,ke,this.clusterProps),Ae=ee[ke],et=ee[ke+1];else{const He=this.points[ee[ke+3]];Ue=He.properties;const[Mt,Ht]=He.geometry.coordinates;Ae=qt(Mt),et=Ut(Ht)}const be={type:1,geometry:[[Math.round(this.options.extent*(Ae*Se-Q)),Math.round(this.options.extent*(et*Se-pe))]],tags:Ue};let Tt;Tt=Ge||this.options.generateId?ee[ke+3]:this.points[ee[ke+3]].id,Tt!==void 0&&(be.id=Tt),Pe.features.push(be)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,ee){const{radius:Q,extent:pe,reduce:Se,minPoints:Pe}=this.options,Le=Q/(pe*Math.pow(2,ee)),ke=W.data,Ge=[],Ue=this.stride;for(let Ae=0;Ae<ke.length;Ae+=Ue){if(ke[Ae+2]<=ee)continue;ke[Ae+2]=ee;const et=ke[Ae],be=ke[Ae+1],Tt=W.within(ke[Ae],ke[Ae+1],Le),He=ke[Ae+5];let Mt=He;for(const Ht of Tt){const ii=Ht*Ue;ke[ii+2]>ee&&(Mt+=ke[ii+5])}if(Mt>He&&Mt>=Pe){let Ht,ii=et*He,Bi=be*He,Li=-1;const Pi=(Ae/Ue<<5)+(ee+1)+this.points.length;for(const Yt of Tt){const xi=Yt*Ue;if(ke[xi+2]<=ee)continue;ke[xi+2]=ee;const dn=ke[xi+5];ii+=ke[xi]*dn,Bi+=ke[xi+1]*dn,ke[xi+4]=Pi,Se&&(Ht||(Ht=this._map(ke,Ae,!0),Li=this.clusterProps.length,this.clusterProps.push(Ht)),Se(Ht,this._map(ke,xi)))}ke[Ae+4]=Pi,Ge.push(ii/Mt,Bi/Mt,1/0,Pi,-1,Mt),Se&&Ge.push(Li)}else{for(let Ht=0;Ht<Ue;Ht++)Ge.push(ke[Ae+Ht]);if(Mt>1)for(const Ht of Tt){const ii=Ht*Ue;if(!(ke[ii+2]<=ee)){ke[ii+2]=ee;for(let Bi=0;Bi<Ue;Bi++)Ge.push(ke[ii+Bi])}}}}return Ge}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,ee,Q){if(W[ee+5]>1){const Pe=this.clusterProps[W[ee+6]];return Q?Object.assign({},Pe):Pe}const pe=this.points[W[ee+3]].properties,Se=this.options.map(pe);return Q&&Se===pe?Object.assign({},Se):Se}}function ut(Ee,W,ee){return{type:"Feature",id:Ee[W+3],properties:Bt(Ee,W,ee),geometry:{type:"Point",coordinates:[(Q=Ee[W],360*(Q-.5)),ui(Ee[W+1])]}};var Q}function Bt(Ee,W,ee){const Q=Ee[W+5],pe=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,Se=Ee[W+6],Pe=Se===-1?{}:Object.assign({},ee[Se]);return Object.assign(Pe,{cluster:!0,cluster_id:Ee[W+3],point_count:Q,point_count_abbreviated:pe})}function qt(Ee){return Ee/360+.5}function Ut(Ee){const W=Math.sin(Ee*Math.PI/180),ee=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return ee<0?0:ee>1?1:ee}function ui(Ee){const W=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Ni(Ee,W,ee,Q){let pe=Q;const Se=W+(ee-W>>1);let Pe,Le=ee-W;const ke=Ee[W],Ge=Ee[W+1],Ue=Ee[ee],Ae=Ee[ee+1];for(let et=W+3;et<ee;et+=3){const be=Ot(Ee[et],Ee[et+1],ke,Ge,Ue,Ae);if(be>pe)Pe=et,pe=be;else if(be===pe){const Tt=Math.abs(et-Se);Tt<Le&&(Pe=et,Le=Tt)}}pe>Q&&(Pe-W>3&&Ni(Ee,W,Pe,Q),Ee[Pe+2]=pe,ee-Pe>3&&Ni(Ee,Pe,ee,Q))}function Ot(Ee,W,ee,Q,pe,Se){let Pe=pe-ee,Le=Se-Q;if(Pe!==0||Le!==0){const ke=((Ee-ee)*Pe+(W-Q)*Le)/(Pe*Pe+Le*Le);ke>1?(ee=pe,Q=Se):ke>0&&(ee+=Pe*ke,Q+=Le*ke)}return Pe=Ee-ee,Le=W-Q,Pe*Pe+Le*Le}function Ei(Ee,W,ee,Q){const pe={id:Ee??null,type:W,geometry:ee,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")Jt(pe,ee);else if(W==="Polygon")Jt(pe,ee[0]);else if(W==="MultiLineString")for(const Se of ee)Jt(pe,Se);else if(W==="MultiPolygon")for(const Se of ee)Jt(pe,Se[0]);return pe}function Jt(Ee,W){for(let ee=0;ee<W.length;ee+=3)Ee.minX=Math.min(Ee.minX,W[ee]),Ee.minY=Math.min(Ee.minY,W[ee+1]),Ee.maxX=Math.max(Ee.maxX,W[ee]),Ee.maxY=Math.max(Ee.maxY,W[ee+1])}function Ui(Ee,W,ee,Q){if(!W.geometry)return;const pe=W.geometry.coordinates;if(pe&&pe.length===0)return;const Se=W.geometry.type,Pe=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let Le=[],ke=W.id;if(ee.promoteId?ke=W.properties[ee.promoteId]:ee.generateId&&(ke=Q||0),Se==="Point")ri(pe,Le);else if(Se==="MultiPoint")for(const Ge of pe)ri(Ge,Le);else if(Se==="LineString")Pn(pe,Le,Pe,!1);else if(Se==="MultiLineString"){if(ee.lineMetrics){for(const Ge of pe)Le=[],Pn(Ge,Le,Pe,!1),Ee.push(Ei(ke,"LineString",Le,W.properties));return}yr(pe,Le,Pe,!1)}else if(Se==="Polygon")yr(pe,Le,Pe,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(const Ge of W.geometry.geometries)Ui(Ee,{id:ke,geometry:Ge,properties:W.properties},ee,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ge of pe){const Ue=[];yr(Ge,Ue,Pe,!0),Le.push(Ue)}}Ee.push(Ei(ke,Se,Le,W.properties))}function ri(Ee,W){W.push(kr(Ee[0]),Ne(Ee[1]),0)}function Pn(Ee,W,ee,Q){let pe,Se,Pe=0;for(let ke=0;ke<Ee.length;ke++){const Ge=kr(Ee[ke][0]),Ue=Ne(Ee[ke][1]);W.push(Ge,Ue,0),ke>0&&(Pe+=Q?(pe*Ue-Ge*Se)/2:Math.sqrt(Math.pow(Ge-pe,2)+Math.pow(Ue-Se,2))),pe=Ge,Se=Ue}const Le=W.length-3;W[2]=1,Ni(W,0,Le,ee),W[Le+2]=1,W.size=Math.abs(Pe),W.start=0,W.end=W.size}function yr(Ee,W,ee,Q){for(let pe=0;pe<Ee.length;pe++){const Se=[];Pn(Ee[pe],Se,ee,Q),W.push(Se)}}function kr(Ee){return Ee/360+.5}function Ne(Ee){const W=Math.sin(Ee*Math.PI/180),ee=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return ee<0?0:ee>1?1:ee}function rn(Ee,W,ee,Q,pe,Se,Pe,Le){if(Q/=W,Se>=(ee/=W)&&Pe<Q)return Ee;if(Pe<ee||Se>=Q)return null;const ke=[];for(const Ge of Ee){const Ue=Ge.geometry;let Ae=Ge.type;const et=pe===0?Ge.minX:Ge.minY,be=pe===0?Ge.maxX:Ge.maxY;if(et>=ee&&be<Q){ke.push(Ge);continue}if(be<ee||et>=Q)continue;let Tt=[];if(Ae==="Point"||Ae==="MultiPoint")Ci(Ue,Tt,ee,Q,pe);else if(Ae==="LineString")jt(Ue,Tt,ee,Q,pe,!1,Le.lineMetrics);else if(Ae==="MultiLineString")Te(Ue,Tt,ee,Q,pe,!1);else if(Ae==="Polygon")Te(Ue,Tt,ee,Q,pe,!0);else if(Ae==="MultiPolygon")for(const He of Ue){const Mt=[];Te(He,Mt,ee,Q,pe,!0),Mt.length&&Tt.push(Mt)}if(Tt.length){if(Le.lineMetrics&&Ae==="LineString"){for(const He of Tt)ke.push(Ei(Ge.id,Ae,He,Ge.tags));continue}Ae!=="LineString"&&Ae!=="MultiLineString"||(Tt.length===1?(Ae="LineString",Tt=Tt[0]):Ae="MultiLineString"),Ae!=="Point"&&Ae!=="MultiPoint"||(Ae=Tt.length===3?"Point":"MultiPoint"),ke.push(Ei(Ge.id,Ae,Tt,Ge.tags))}}return ke.length?ke:null}function Ci(Ee,W,ee,Q,pe){for(let Se=0;Se<Ee.length;Se+=3){const Pe=Ee[Se+pe];Pe>=ee&&Pe<=Q&&Ze(W,Ee[Se],Ee[Se+1],Ee[Se+2])}}function jt(Ee,W,ee,Q,pe,Se,Pe){let Le=q(Ee);const ke=pe===0?ot:ht;let Ge,Ue,Ae=Ee.start;for(let Mt=0;Mt<Ee.length-3;Mt+=3){const Ht=Ee[Mt],ii=Ee[Mt+1],Bi=Ee[Mt+2],Li=Ee[Mt+3],Pi=Ee[Mt+4],Yt=pe===0?Ht:ii,xi=pe===0?Li:Pi;let dn=!1;Pe&&(Ge=Math.sqrt(Math.pow(Ht-Li,2)+Math.pow(ii-Pi,2))),Yt<ee?xi>ee&&(Ue=ke(Le,Ht,ii,Li,Pi,ee),Pe&&(Le.start=Ae+Ge*Ue)):Yt>Q?xi<Q&&(Ue=ke(Le,Ht,ii,Li,Pi,Q),Pe&&(Le.start=Ae+Ge*Ue)):Ze(Le,Ht,ii,Bi),xi<ee&&Yt>=ee&&(Ue=ke(Le,Ht,ii,Li,Pi,ee),dn=!0),xi>Q&&Yt<=Q&&(Ue=ke(Le,Ht,ii,Li,Pi,Q),dn=!0),!Se&&dn&&(Pe&&(Le.end=Ae+Ge*Ue),W.push(Le),Le=q(Ee)),Pe&&(Ae+=Ge)}let et=Ee.length-3;const be=Ee[et],Tt=Ee[et+1],He=pe===0?be:Tt;He>=ee&&He<=Q&&Ze(Le,be,Tt,Ee[et+2]),et=Le.length-3,Se&&et>=3&&(Le[et]!==Le[0]||Le[et+1]!==Le[1])&&Ze(Le,Le[0],Le[1],Le[2]),Le.length&&W.push(Le)}function q(Ee){const W=[];return W.size=Ee.size,W.start=Ee.start,W.end=Ee.end,W}function Te(Ee,W,ee,Q,pe,Se){for(const Pe of Ee)jt(Pe,W,ee,Q,pe,Se,!1)}function Ze(Ee,W,ee,Q){Ee.push(W,ee,Q)}function ot(Ee,W,ee,Q,pe,Se){const Pe=(Se-W)/(Q-W);return Ze(Ee,Se,ee+(pe-ee)*Pe,1),Pe}function ht(Ee,W,ee,Q,pe,Se){const Pe=(Se-ee)/(pe-ee);return Ze(Ee,W+(Q-W)*Pe,Se,1),Pe}function rt(Ee,W){const ee=[];for(let Q=0;Q<Ee.length;Q++){const pe=Ee[Q],Se=pe.type;let Pe;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")Pe=kt(pe.geometry,W);else if(Se==="MultiLineString"||Se==="Polygon"){Pe=[];for(const Le of pe.geometry)Pe.push(kt(Le,W))}else if(Se==="MultiPolygon"){Pe=[];for(const Le of pe.geometry){const ke=[];for(const Ge of Le)ke.push(kt(Ge,W));Pe.push(ke)}}ee.push(Ei(pe.id,Se,Pe,pe.tags))}return ee}function kt(Ee,W){const ee=[];ee.size=Ee.size,Ee.start!==void 0&&(ee.start=Ee.start,ee.end=Ee.end);for(let Q=0;Q<Ee.length;Q+=3)ee.push(Ee[Q]+W,Ee[Q+1],Ee[Q+2]);return ee}function Re(Ee,W){if(Ee.transformed)return Ee;const ee=1<<Ee.z,Q=Ee.x,pe=Ee.y;for(const Se of Ee.features){const Pe=Se.geometry,Le=Se.type;if(Se.geometry=[],Le===1)for(let ke=0;ke<Pe.length;ke+=2)Se.geometry.push(It(Pe[ke],Pe[ke+1],W,ee,Q,pe));else for(let ke=0;ke<Pe.length;ke++){const Ge=[];for(let Ue=0;Ue<Pe[ke].length;Ue+=2)Ge.push(It(Pe[ke][Ue],Pe[ke][Ue+1],W,ee,Q,pe));Se.geometry.push(Ge)}}return Ee.transformed=!0,Ee}function It(Ee,W,ee,Q,pe,Se){return[Math.round(ee*(Ee*Q-pe)),Math.round(ee*(W*Q-Se))]}function _t(Ee,W,ee,Q,pe){const Se=W===pe.maxZoom?0:pe.tolerance/((1<<W)*pe.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:Ee.length,source:null,x:ee,y:Q,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Le of Ee)$t(Pe,Le,Se,pe);return Pe}function $t(Ee,W,ee,Q){const pe=W.geometry,Se=W.type,Pe=[];if(Ee.minX=Math.min(Ee.minX,W.minX),Ee.minY=Math.min(Ee.minY,W.minY),Ee.maxX=Math.max(Ee.maxX,W.maxX),Ee.maxY=Math.max(Ee.maxY,W.maxY),Se==="Point"||Se==="MultiPoint")for(let Le=0;Le<pe.length;Le+=3)Pe.push(pe[Le],pe[Le+1]),Ee.numPoints++,Ee.numSimplified++;else if(Se==="LineString")At(Pe,pe,Ee,ee,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(let Le=0;Le<pe.length;Le++)At(Pe,pe[Le],Ee,ee,Se==="Polygon",Le===0);else if(Se==="MultiPolygon")for(let Le=0;Le<pe.length;Le++){const ke=pe[Le];for(let Ge=0;Ge<ke.length;Ge++)At(Pe,ke[Ge],Ee,ee,!0,Ge===0)}if(Pe.length){let Le=W.tags||null;if(Se==="LineString"&&Q.lineMetrics){Le={};for(const Ge in W.tags)Le[Ge]=W.tags[Ge];Le.mapbox_clip_start=pe.start/pe.size,Le.mapbox_clip_end=pe.end/pe.size}const ke={geometry:Pe,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:Le};W.id!==null&&(ke.id=W.id),Ee.features.push(ke)}}function At(Ee,W,ee,Q,pe,Se){const Pe=Q*Q;if(Q>0&&W.size<(pe?Pe:Q))return void(ee.numPoints+=W.length/3);const Le=[];for(let ke=0;ke<W.length;ke+=3)(Q===0||W[ke+2]>Pe)&&(ee.numSimplified++,Le.push(W[ke],W[ke+1])),ee.numPoints++;pe&&function(ke,Ge){let Ue=0;for(let Ae=0,et=ke.length,be=et-2;Ae<et;be=Ae,Ae+=2)Ue+=(ke[Ae]-ke[be])*(ke[Ae+1]+ke[be+1]);if(Ue>0===Ge)for(let Ae=0,et=ke.length;Ae<et/2;Ae+=2){const be=ke[Ae],Tt=ke[Ae+1];ke[Ae]=ke[et-2-Ae],ke[Ae+1]=ke[et-1-Ae],ke[et-2-Ae]=be,ke[et-1-Ae]=Tt}}(Le,Se),Ee.push(Le)}const mt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Qt{constructor(W,ee){const Q=(ee=this.options=function(Se,Pe){for(const Le in Pe)Se[Le]=Pe[Le];return Se}(Object.create(mt),ee)).debug;if(Q&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let pe=function(Se,Pe){const Le=[];if(Se.type==="FeatureCollection")for(let ke=0;ke<Se.features.length;ke++)Ui(Le,Se.features[ke],Pe,ke);else Ui(Le,Se.type==="Feature"?Se:{geometry:Se},Pe);return Le}(W,ee);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pe=function(Se,Pe){const Le=Pe.buffer/Pe.extent;let ke=Se;const Ge=rn(Se,1,-1-Le,Le,0,-1,2,Pe),Ue=rn(Se,1,1-Le,2+Le,0,-1,2,Pe);return(Ge||Ue)&&(ke=rn(Se,1,-Le,1+Le,0,-1,2,Pe)||[],Ge&&(ke=rt(Ge,1).concat(ke)),Ue&&(ke=ke.concat(rt(Ue,-1)))),ke}(pe,ee),pe.length&&this.splitTile(pe,0,0,0),Q&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,ee,Q,pe,Se,Pe,Le){const ke=[W,ee,Q,pe],Ge=this.options,Ue=Ge.debug;for(;ke.length;){pe=ke.pop(),Q=ke.pop(),ee=ke.pop(),W=ke.pop();const Ae=1<<ee,et=fi(ee,Q,pe);let be=this.tiles[et];if(!be&&(Ue>1&&console.time("creation"),be=this.tiles[et]=_t(W,ee,Q,pe,Ge),this.tileCoords.push({z:ee,x:Q,y:pe}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,Q,pe,be.numFeatures,be.numPoints,be.numSimplified),console.timeEnd("creation"));const dn=`z${ee}`;this.stats[dn]=(this.stats[dn]||0)+1,this.total++}if(be.source=W,Se==null){if(ee===Ge.indexMaxZoom||be.numPoints<=Ge.indexMaxPoints)continue}else{if(ee===Ge.maxZoom||ee===Se)continue;if(Se!=null){const dn=Se-ee;if(Q!==Pe>>dn||pe!==Le>>dn)continue}}if(be.source=null,W.length===0)continue;Ue>1&&console.time("clipping");const Tt=.5*Ge.buffer/Ge.extent,He=.5-Tt,Mt=.5+Tt,Ht=1+Tt;let ii=null,Bi=null,Li=null,Pi=null,Yt=rn(W,Ae,Q-Tt,Q+Mt,0,be.minX,be.maxX,Ge),xi=rn(W,Ae,Q+He,Q+Ht,0,be.minX,be.maxX,Ge);W=null,Yt&&(ii=rn(Yt,Ae,pe-Tt,pe+Mt,1,be.minY,be.maxY,Ge),Bi=rn(Yt,Ae,pe+He,pe+Ht,1,be.minY,be.maxY,Ge),Yt=null),xi&&(Li=rn(xi,Ae,pe-Tt,pe+Mt,1,be.minY,be.maxY,Ge),Pi=rn(xi,Ae,pe+He,pe+Ht,1,be.minY,be.maxY,Ge),xi=null),Ue>1&&console.timeEnd("clipping"),ke.push(ii||[],ee+1,2*Q,2*pe),ke.push(Bi||[],ee+1,2*Q,2*pe+1),ke.push(Li||[],ee+1,2*Q+1,2*pe),ke.push(Pi||[],ee+1,2*Q+1,2*pe+1)}}getTile(W,ee,Q){W=+W,ee=+ee,Q=+Q;const pe=this.options,{extent:Se,debug:Pe}=pe;if(W<0||W>24)return null;const Le=1<<W,ke=fi(W,ee=ee+Le&Le-1,Q);if(this.tiles[ke])return Re(this.tiles[ke],Se);Pe>1&&console.log("drilling down to z%d-%d-%d",W,ee,Q);let Ge,Ue=W,Ae=ee,et=Q;for(;!Ge&&Ue>0;)Ue--,Ae>>=1,et>>=1,Ge=this.tiles[fi(Ue,Ae,et)];return Ge&&Ge.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",Ue,Ae,et),console.time("drilling down")),this.splitTile(Ge.source,Ue,Ae,et,W,ee,Q),Pe>1&&console.timeEnd("drilling down"),this.tiles[ke]?Re(this.tiles[ke],Se):null):null}}function fi(Ee,W,ee){return 32*((1<<Ee)*ee+W)+Ee}function gi(Ee,W){return W?Ee.properties[W]:Ee.id}function Et(Ee,W){if(Ee==null)return!0;if(Ee.type==="Feature")return gi(Ee,W)!=null;if(Ee.type==="FeatureCollection"){const ee=new Set;for(const Q of Ee.features){const pe=gi(Q,W);if(pe==null||ee.has(pe))return!1;ee.add(pe)}return!0}return!1}function sn(Ee,W){const ee=new Map;if(Ee!=null)if(Ee.type==="Feature")ee.set(gi(Ee,W),Ee);else for(const Q of Ee.features)ee.set(gi(Q,W),Q);return ee}class si extends ie{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,ee){return P._(this,void 0,void 0,function*(){const Q=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const pe=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!pe)return null;const Se=new tt(pe.features);let Pe=Ye(Se);return Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),{vectorTile:Se,rawData:Pe.buffer}})}loadData(W){return P._(this,void 0,void 0,function*(){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.abort();const Q=!!(W&&W.request&&W.request.collectResourceTiming)&&new P.cM(W.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest),this._geoJSONIndex=W.cluster?new Pt(function({superclusterOptions:Pe,clusterProperties:Le}){if(!Le||!Pe)return Pe;const ke={},Ge={},Ue={accumulated:null,zoom:0},Ae={properties:null},et=Object.keys(Le);for(const be of et){const[Tt,He]=Le[be],Mt=P.cT(He),Ht=P.cT(typeof Tt=="string"?[Tt,["accumulated"],["get",be]]:Tt);ke[be]=Mt.value,Ge[be]=Ht.value}return Pe.map=be=>{Ae.properties=be;const Tt={};for(const He of et)Tt[He]=ke[He].evaluate(Ue,Ae);return Tt},Pe.reduce=(be,Tt)=>{Ae.properties=Tt;for(const He of et)Ue.accumulated=be[He],be[He]=Ge[He].evaluate(Ue,Ae)},Pe}(W)).load((yield this._pendingData).features):(pe=yield this._pendingData,new Qt(pe,W.geojsonVtOptions)),this.loaded={};const Se={};if(Q){const Pe=Q.finish();Pe&&(Se.resourceTiming={},Se.resourceTiming[W.source]=JSON.parse(JSON.stringify(Pe)))}return Se}catch(Se){if(delete this._pendingRequest,P.cx(Se))return{abandoned:!0};throw Se}var pe})}getData(){return P._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(W){const ee=this.loaded;return ee&&ee[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,ee){return P._(this,void 0,void 0,function*(){let Q=yield this.loadGeoJSON(W,ee);if(delete this._pendingRequest,typeof Q!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(ft(Q,!0),W.filter){const pe=P.cT(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));Q={type:"FeatureCollection",features:Q.features.filter(Pe=>pe.value.evaluate({zoom:0},Pe))}}return Q})}loadGeoJSON(W,ee){return P._(this,void 0,void 0,function*(){const{promoteId:Q}=W;if(W.request){const pe=yield P.j(W.request,ee);return this._dataUpdateable=Et(pe.data,Q)?sn(pe.data,Q):void 0,pe.data}if(typeof W.data=="string")try{const pe=JSON.parse(W.data);return this._dataUpdateable=Et(pe,Q)?sn(pe,Q):void 0,pe}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(pe,Se,Pe){var Le,ke,Ge,Ue;if(Se.removeAll&&pe.clear(),Se.remove)for(const Ae of Se.remove)pe.delete(Ae);if(Se.add)for(const Ae of Se.add){const et=gi(Ae,Pe);et!=null&&pe.set(et,Ae)}if(Se.update)for(const Ae of Se.update){let et=pe.get(Ae.id);if(et==null)continue;const be=!Ae.removeAllProperties&&(((Le=Ae.removeProperties)===null||Le===void 0?void 0:Le.length)>0||((ke=Ae.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((Ae.newGeometry||Ae.removeAllProperties||be)&&(et=Object.assign({},et),pe.set(Ae.id,et),be&&(et.properties=Object.assign({},et.properties))),Ae.newGeometry&&(et.geometry=Ae.newGeometry),Ae.removeAllProperties)et.properties={};else if(((Ge=Ae.removeProperties)===null||Ge===void 0?void 0:Ge.length)>0)for(const Tt of Ae.removeProperties)Object.prototype.hasOwnProperty.call(et.properties,Tt)&&delete et.properties[Tt];if(((Ue=Ae.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:Tt,value:He}of Ae.addOrUpdateProperties)et.properties[Tt]=He}}(this._dataUpdateable,W.dataDiff,Q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return P._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class Zt{constructor(W){this.self=W,this.actor=new P.J(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ee,Q)=>{if(this.externalWorkerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.externalWorkerSourceTypes[ee]=Q},this.self.addProtocol=P.cz,this.self.removeProtocol=P.cA,this.self.registerRTLTextPlugin=ee=>{P.cU.setMethods(ee)},this.actor.registerMessageHandler("LDT",(ee,Q)=>this._getDEMWorkerSource(ee,Q.source).loadTile(Q)),this.actor.registerMessageHandler("RDT",(ee,Q)=>P._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ee,Q.source).removeTile(Q)})),this.actor.registerMessageHandler("GCEZ",(ee,Q)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,Q.type,Q.source).getClusterExpansionZoom(Q)})),this.actor.registerMessageHandler("GCC",(ee,Q)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,Q.type,Q.source).getClusterChildren(Q)})),this.actor.registerMessageHandler("GCL",(ee,Q)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,Q.type,Q.source).getClusterLeaves(Q)})),this.actor.registerMessageHandler("LD",(ee,Q)=>this._getWorkerSource(ee,Q.type,Q.source).loadData(Q)),this.actor.registerMessageHandler("GD",(ee,Q)=>this._getWorkerSource(ee,Q.type,Q.source).getData()),this.actor.registerMessageHandler("LT",(ee,Q)=>this._getWorkerSource(ee,Q.type,Q.source).loadTile(Q)),this.actor.registerMessageHandler("RT",(ee,Q)=>this._getWorkerSource(ee,Q.type,Q.source).reloadTile(Q)),this.actor.registerMessageHandler("AT",(ee,Q)=>this._getWorkerSource(ee,Q.type,Q.source).abortTile(Q)),this.actor.registerMessageHandler("RMT",(ee,Q)=>this._getWorkerSource(ee,Q.type,Q.source).removeTile(Q)),this.actor.registerMessageHandler("RS",(ee,Q)=>P._(this,void 0,void 0,function*(){if(!this.workerSources[ee]||!this.workerSources[ee][Q.type]||!this.workerSources[ee][Q.type][Q.source])return;const pe=this.workerSources[ee][Q.type][Q.source];delete this.workerSources[ee][Q.type][Q.source],pe.removeSource!==void 0&&pe.removeSource(Q)})),this.actor.registerMessageHandler("RM",ee=>P._(this,void 0,void 0,function*(){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee]})),this.actor.registerMessageHandler("SR",(ee,Q)=>P._(this,void 0,void 0,function*(){this.referrer=Q})),this.actor.registerMessageHandler("SRPS",(ee,Q)=>this._syncRTLPluginState(ee,Q)),this.actor.registerMessageHandler("IS",(ee,Q)=>P._(this,void 0,void 0,function*(){this.self.importScripts(Q)})),this.actor.registerMessageHandler("SI",(ee,Q)=>this._setImages(ee,Q)),this.actor.registerMessageHandler("UL",(ee,Q)=>P._(this,void 0,void 0,function*(){this._getLayerIndex(ee).update(Q.layers,Q.removedIds)})),this.actor.registerMessageHandler("SL",(ee,Q)=>P._(this,void 0,void 0,function*(){this._getLayerIndex(ee).replace(Q)}))}_setImages(W,ee){return P._(this,void 0,void 0,function*(){this.availableImages[W]=ee;for(const Q in this.workerSources[W]){const pe=this.workerSources[W][Q];for(const Se in pe)pe[Se].availableImages=ee}})}_syncRTLPluginState(W,ee){return P._(this,void 0,void 0,function*(){return yield P.cU.syncState(ee,this.self.importScripts)})}_getAvailableImages(W){let ee=this.availableImages[W];return ee||(ee=[]),ee}_getLayerIndex(W){let ee=this.layerIndexes[W];return ee||(ee=this.layerIndexes[W]=new o),ee}_getWorkerSource(W,ee,Q){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][ee]||(this.workerSources[W][ee]={}),!this.workerSources[W][ee][Q]){const pe={sendAsync:(Se,Pe)=>(Se.targetMapId=W,this.actor.sendAsync(Se,Pe))};switch(ee){case"vector":this.workerSources[W][ee][Q]=new ie(pe,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][ee][Q]=new si(pe,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][ee][Q]=new this.externalWorkerSourceTypes[ee](pe,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][ee][Q]}_getDEMWorkerSource(W,ee){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][ee]||(this.demWorkerSources[W][ee]=new ce),this.demWorkerSources[W][ee]}}return P.i(self)&&(self.worker=new Zt(self)),Zt}),E("index",["exports","./shared"],function(P,o){var J="5.6.1";function re(){var m=new o.A(4);return o.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let H,ie;const ce={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,e,i){const u=requestAnimationFrame(g=>{h(),e(g)}),{unsubscribe:h}=o.s(m.signal,"abort",()=>{h(),cancelAnimationFrame(u),i(o.c())},!1)},frameAsync(m){return new Promise((e,i)=>{this.frame(m,e,i)})},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,i.drawImage(m,0,0,m.width,m.height),i},resolveURL:m=>(H||(H=document.createElement("a")),H.href=m,H.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ie==null&&(ie=matchMedia("(prefers-reduced-motion: reduce)")),ie.matches)}};class Y{static testProp(e){if(!Y.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in Y.docStyle)return e[i];return e[0]}static create(e,i,u){const h=window.document.createElement(e);return i!==void 0&&(h.className=i),u&&u.appendChild(h),h}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){Y.docStyle&&Y.selectProp&&(Y.userSelect=Y.docStyle[Y.selectProp],Y.docStyle[Y.selectProp]="none")}static enableDrag(){Y.docStyle&&Y.selectProp&&(Y.docStyle[Y.selectProp]=Y.userSelect)}static setTransform(e,i){e.style[Y.transformProp]=i}static addEventListener(e,i,u,h={}){e.addEventListener(i,u,"passive"in h?h:h.capture)}static removeEventListener(e,i,u,h={}){e.removeEventListener(i,u,"passive"in h?h:h.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Y.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,u){const h=i.boundingClientRect;return new o.P((u.clientX-h.left)/i.x-e.clientLeft,(u.clientY-h.top)/i.y-e.clientTop)}static mousePos(e,i){const u=Y.getScale(e);return Y.getPoint(e,u,i)}static touchPos(e,i){const u=[],h=Y.getScale(e);for(let g=0;g<i.length;g++)u.push(Y.getPoint(e,h,i[g]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=i.querySelectorAll("script");for(const h of u)h.remove();return Y.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const u=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const u of i)Y.removeAttributes(u),Y.clean(u)}static removeAttributes(e){for(const{name:i,value:u}of e.attributes)Y.isPossiblyDangerous(i,u)&&e.removeAttribute(i)}}Y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Y.selectProp=Y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Y.transformProp=Y.testProp(["transform","WebkitTransform"]);const le={supported:!1,testSupport:function(m){!it&&ft&&(Qe?tt(m):Xe=m)}};let Xe,ft,it=!1,Qe=!1;function tt(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,ft),m.isContextLost())return;le.supported=!0}catch{}m.deleteTexture(e),it=!0}var We;typeof document<"u"&&(ft=document.createElement("img"),ft.onload=()=>{Xe&&tt(Xe),Xe=null,Qe=!0},ft.onerror=()=>{it=!0,Xe=null},ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,i,u,h;m.resetRequestQueue=()=>{e=[],i=0,u=0,h={}},m.addThrottleControl=C=>{const R=u++;return h[R]=C,R},m.removeThrottleControl=C=>{delete h[C],x()},m.getImage=(C,R,D=!0)=>new Promise((B,F)=>{le.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),o.e(C,{type:"image"}),e.push({abortController:R,requestParameters:C,supportImageRefresh:D,state:"queued",onError:U=>{F(U)},onSuccess:U=>{B(U)}}),x()});const g=C=>o._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:R,supportImageRefresh:D,onError:B,onSuccess:F,abortController:U}=C,X=D===!1&&!o.i(self)&&!o.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((ue,de)=>ue&&de==="accept",!0));i++;const oe=X?S(R,U):o.m(R,U);try{const ue=yield oe;delete C.abortController,C.state="completed",ue.data instanceof HTMLImageElement||o.b(ue.data)?F(ue):ue.data&&F({data:yield(ae=ue.data,typeof createImageBitmap=="function"?o.f(ae):o.h(ae)),cacheControl:ue.cacheControl,expires:ue.expires})}catch(ue){delete C.abortController,B(ue)}finally{i--,x()}var ae}),x=()=>{const C=(()=>{for(const R of Object.keys(h))if(h[R]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=i;R<C&&e.length>0;R++){const D=e.shift();D.abortController.signal.aborted?R--:g(D)}},S=(C,R)=>new Promise((D,B)=>{const F=new Image,U=C.url,X=C.credentials;X&&X==="include"?F.crossOrigin="use-credentials":(X&&X==="same-origin"||!o.d(U))&&(F.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{F.src="",B(o.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,D({data:F})},F.onerror=()=>{F.onerror=F.onload=null,R.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=U})}(We||(We={})),We.resetRequestQueue();class qe{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ke(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const i=[];for(const{id:u,url:h}of m){const g=`${u}${h}`;i.indexOf(g)===-1&&(i.push(g),e.push({id:u,url:h}))}}return e}function pt(m,e,i){try{const u=new URL(m);return u.pathname+=`${e}${i}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function dt(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ye extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:u}of this.requestors)u(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const u=i.spriteData;i.data=new o.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let u=!0;const h=i.data||i.spriteData;return this._validateStretch(i.stretchX,h&&h.width)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(i.stretchY,h&&h.height)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(i.content,i)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,i){if(!e)return!0;let u=0;for(const h of e){if(h[0]<u||h[1]<h[0]||i<h[1])return!1;u=h[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const u=i.spriteData,h=u&&u.width||i.data.width,g=u&&u.height||i.data.height;return!(e[0]<0||h<e[0]||e[1]<0||g<e[1]||e[2]<0||h<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,u=!0){const h=this.getImage(e);if(u&&(h.data.width!==i.data.width||h.data.height!==i.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=h.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,u)=>{let h=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(h=!1);this.isLoaded()||h?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const u of e){let h=this.getImage(u);h||(this.fire(new o.l("styleimagemissing",{id:u})),h=this.getImage(u)),h?i[u]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:o.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],u=this.getImage(e);if(!u)return null;if(i&&i.position.version===u.version)return i.position;if(i)i.position.version=u.version;else{const h={w:u.data.width+2,h:u.data.height+2,x:0,y:0},g=new o.I(h,u);this.patterns[e]={bin:h,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:i,h:u}=o.p(e),h=this.atlasImage;h.resize({width:i||1,height:u||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],S=x.x+1,C=x.y+1,R=this.getImage(g).data,D=R.width,B=R.height;o.R.copy(R,h,{x:0,y:0},{x:S,y:C},{width:D,height:B}),o.R.copy(R,h,{x:0,y:B-1},{x:S,y:C-1},{width:D,height:1}),o.R.copy(R,h,{x:0,y:0},{x:S,y:C+B},{width:D,height:1}),o.R.copy(R,h,{x:D-1,y:0},{x:S-1,y:C},{width:1,height:B}),o.R.copy(R,h,{x:0,y:0},{x:S+D,y:C},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const u=this.getImage(i);u||o.w(`Image with ID: "${i}" was not found`),dt(u)&&this.updateImage(i,u)}}}const Ct=1e20;function Dt(m,e,i,u,h,g,x,S,C){for(let R=e;R<e+u;R++)ct(m,i*g+R,g,h,x,S,C);for(let R=i;R<i+h;R++)ct(m,R*g+e,1,u,x,S,C)}function ct(m,e,i,u,h,g,x){g[0]=0,x[0]=-Ct,x[1]=Ct,h[0]=m[e];for(let S=1,C=0,R=0;S<u;S++){h[S]=m[e+S*i];const D=S*S;do{const B=g[C];R=(h[S]-h[B]+D-B*B)/(S-B)/2}while(R<=x[C]&&--C>-1);C++,g[C]=S,x[C]=R,x[C+1]=Ct}for(let S=0,C=0;S<u;S++){for(;x[C+1]<S;)C++;const R=g[C],D=S-R;m[e+S*i]=h[R]+D*D}}class Pt{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,function*(){const i=[];for(const g in e)for(const x of e[g])i.push(this._getAndCacheGlyphsPromise(g,x));const u=yield Promise.all(i),h={};for(const{stack:g,id:x,glyph:S}of u)h[g]||(h[g]={}),h[g][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return h})}_getAndCacheGlyphsPromise(e,i){return o._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let h=u.glyphs[i];if(h!==void 0)return{stack:e,id:i,glyph:h};if(h=this._tinySDF(u,e,i),h)return u.glyphs[i]=h,{stack:e,id:i,glyph:h};const g=Math.floor(i/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[g])return{stack:e,id:i,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[g]){const S=Pt.loadGlyphRange(e,g,this.url,this.requestManager);u.requests[g]=S}const x=yield u.requests[g];for(const S in x)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=x[+S]);return u.ranges[g]=!0,{stack:e,id:i,glyph:x[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||o.u["CJK Unified Ideographs"](e)||o.u["Hangul Syllables"](e)||o.u.Hiragana(e)||o.u.Katakana(e)||o.u["CJK Symbols and Punctuation"](e)||o.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,u){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let g=e.tinySDF;if(!g){let S="400";/bold/i.test(i)?S="900":/medium/i.test(i)?S="500":/light/i.test(i)&&(S="200"),g=e.tinySDF=new Pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:S})}const x=g.draw(String.fromCharCode(u));return{id:u,bitmap:new o.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Pt.loadGlyphRange=function(m,e,i,u){return o._(this,void 0,void 0,function*(){const h=256*e,g=h+255,x=u.transformRequest(i.replace("{fontstack}",m).replace("{range}",`${h}-${g}`),"Glyphs"),S=yield o.n(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${h}-${g}`);const C={};for(const R of o.o(S.data))C[R.id]=R;return C})},Pt.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:i=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=i;const S=this.size=m+4*e,C=this._createCanvas(S),R=this.ctx=C.getContext("2d",{willReadFrequently:!0});R.font=`${x} ${g} ${m}px ${h}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(m),x=Math.ceil(i),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),C=Math.min(this.size-this.buffer,x+Math.ceil(u)),R=S+2*this.buffer,D=C+2*this.buffer,B=Math.max(R*D,0),F=new Uint8ClampedArray(B),U={data:F,width:R,height:D,glyphWidth:S,glyphHeight:C,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(S===0||C===0)return U;const{ctx:X,buffer:oe,gridInner:ae,gridOuter:ue}=this;X.clearRect(oe,oe,S,C),X.fillText(m,oe,oe+x);const de=X.getImageData(oe,oe,S,C);ue.fill(Ct,0,B),ae.fill(0,0,B);for(let _e=0;_e<C;_e++)for(let me=0;me<S;me++){const xe=de.data[4*(_e*S+me)+3]/255;if(xe===0)continue;const we=(_e+oe)*R+me+oe;if(xe===1)ue[we]=0,ae[we]=Ct;else{const ge=.5-xe;ue[we]=ge>0?ge*ge:0,ae[we]=ge<0?ge*ge:0}}Dt(ue,0,0,R,D,R,this.f,this.v,this.z),Dt(ae,oe,oe,S,C,R,this.f,this.v,this.z);for(let _e=0;_e<B;_e++){const me=Math.sqrt(ue[_e])-Math.sqrt(ae[_e]);F[_e]=Math.round(255-255*(me/this.radius+this.cutoff))}return U}};class ut{constructor(){this.specification=o.v.light.position}possiblyEvaluate(e,i){return o.B(e.expression.evaluate(i))}interpolate(e,i,u){return{x:o.C.number(e.x,i.x,u),y:o.C.number(e.y,i.y,u),z:o.C.number(e.z,i.z,u)}}}let Bt;class qt extends o.E{constructor(e){super(),Bt=Bt||new o.r({anchor:new o.D(o.v.light.anchor),position:new ut,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(Bt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(o.x,e,i))for(const u in e){const h=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),h):this._transitionable.setValue(u,h)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,u){return(!u||u.validate!==!1)&&o.y(this,e.call(o.z,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Ut=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class ui extends o.E{constructor(e){super(),this._transitionable=new o.t(Ut),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(e,i={}){if(!this._validate(o.G,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const h=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),h):this._transitionable.setValue(u,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,u={}){return u?.validate!==!1&&o.y(this,e.call(o.z,o.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ni{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const u=e.join(",")+String(i);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,i)),this.dashEntry[u]}getDashRanges(e,i,u){const h=[];let g=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,S=!0;h.push({left:g,right:x,isDash:S,zeroLength:e[0]===0});let C=e[0];for(let R=1;R<e.length;R++){S=!S;const D=e[R];g=C*u,C+=D,x=C*u,h.push({left:g,right:x,isDash:S,zeroLength:D===0})}return h}addRoundDash(e,i,u){const h=i/2;for(let g=-u;g<=u;g++){const x=this.width*(this.nextRow+u+g);let S=0,C=e[S];for(let R=0;R<this.width;R++){R/C.right>1&&(C=e[++S]);const D=Math.abs(R-C.left),B=Math.abs(R-C.right),F=Math.min(D,B);let U;const X=g/u*(h+1);if(C.isDash){const oe=h-Math.abs(X);U=Math.sqrt(F*F+oe*oe)}else U=h-Math.sqrt(F*F+X*X);this.data[x+R]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const C=e[S],R=e[S+1];C.zeroLength?e.splice(S,1):R&&R.isDash===C.isDash&&(R.left=C.left,e.splice(S,1))}const i=e[0],u=e[e.length-1];i.isDash===u.isDash&&(i.left=u.left-this.width,u.right=i.right+this.width);const h=this.width*this.nextRow;let g=0,x=e[g];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++g]);const C=Math.abs(S-x.left),R=Math.abs(S-x.right),D=Math.min(C,R);this.data[h+S]=Math.max(0,Math.min(255,(x.isDash?D:-D)+128))}}addDash(e,i){const u=i?7:0,h=2*u+1;if(this.nextRow+h>this.height)return o.w("LineAtlas out of space"),null;let g=0;for(let S=0;S<e.length;S++)g+=e[S];if(g!==0){const S=this.width/g,C=this.getDashRanges(e,this.width,S);i?this.addRoundDash(C,S,u):this.addRegularDash(C)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:g};return this.nextRow+=h,this.dirty=!0,x}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const Ot="maplibre_preloaded_worker_pool";class Ei{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ei.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ot]}numActive(){return Object.keys(this.active).length}}const Jt=Math.floor(ce.hardwareConcurrency/2);let Ui,ri;function Pn(){return Ui||(Ui=new Ei),Ui}Ei.workerCount=o.H(globalThis)?Math.max(Math.min(Jt,3),1):1;class yr{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const u=this.workerPool.acquire(i);for(let h=0;h<u.length;h++){const g=new o.J(u[h],i);g.name=`Worker ${h}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const u=[];for(const h of this.actors)u.push(h.sendAsync({type:e,data:i}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const u of this.actors)u.registerMessageHandler(e,i)}}function kr(){return ri||(ri=new yr(Pn(),o.K),ri.registerMessageHandler("GR",(m,e,i)=>o.m(e,i))),ri}function Ne(m,e){const i=o.L();return o.M(i,i,[1,1,0]),o.N(i,i,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?o.O(i,i,m.calculatePosMatrix(e.toUnwrapped())):i}function rn(m,e,i,u,h,g,x){var S;const C=function(F,U,X){if(F)for(const oe of F){const ae=U[oe];if(ae&&ae.source===X&&ae.type==="fill-extrusion")return!0}else for(const oe in U){const ae=U[oe];if(ae.source===X&&ae.type==="fill-extrusion")return!0}return!1}((S=h?.layers)!==null&&S!==void 0?S:null,e,m.id),R=g.maxPitchScaleFactor(),D=m.tilesIn(u,R,C);D.sort(Ci);const B=[];for(const F of D)B.push({wrappedTileID:F.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(e,i,m._state,F.queryGeometry,F.cameraQueryGeometry,F.scale,h,g,R,Ne(m.transform,F.tileID),x?(U,X)=>x(F.tileID,U,X):void 0)});return function(F,U){for(const X in F)for(const oe of F[X])jt(oe,U);return F}(function(F){const U={},X={};for(const oe of F){const ae=oe.queryResults,ue=oe.wrappedTileID,de=X[ue]=X[ue]||{};for(const _e in ae){const me=ae[_e],xe=de[_e]=de[_e]||{},we=U[_e]=U[_e]||[];for(const ge of me)xe[ge.featureIndex]||(xe[ge.featureIndex]=!0,we.push(ge))}}return U}(B),m)}function Ci(m,e){const i=m.tileID,u=e.tileID;return i.overscaledZ-u.overscaledZ||i.canonical.y-u.canonical.y||i.wrap-u.wrap||i.canonical.x-u.canonical.x}function jt(m,e){const i=m.feature,u=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=u}function q(m,e,i){return o._(this,void 0,void 0,function*(){let u=m;if(m.url?u=(yield o.j(e.transformRequest(m.url,"Source"),i)).data:yield ce.frameAsync(i),!u)return null;const h=o.Q(o.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(h.vectorLayerIds=u.vector_layers.map(g=>g.id)),h})}class Te{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}extend(e){const i=this._sw,u=this._ne;let h,g;if(e instanceof o.S)h=e,g=e;else{if(!(e instanceof Te))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Te.convert(e)):this.extend(o.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.S.convert(e)):this;if(h=e._sw,g=e._ne,!h||!g)return this}return i||u?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new o.S(h.lng,h.lat),this._ne=new o.S(g.lng,g.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:u}=o.S.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(e){return e instanceof Te?e:e&&new Te(e)}static fromLngLat(e,i=0){const u=360*i/40075017,h=u/Math.cos(Math.PI/180*e.lat);return new Te(new o.S(e.lng-h,e.lat-u),new o.S(e.lng+h,e.lat+u))}adjustAntiMeridian(){const e=new o.S(this._sw.lng,this._sw.lat),i=new o.S(this._ne.lng,this._ne.lat);return new Te(e,e.lng>i.lng?new o.S(i.lng+360,i.lat):i)}}class Ze{constructor(e,i,u){this.bounds=Te.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),u=Math.floor(o.V(this.bounds.getWest())*i),h=Math.floor(o.U(this.bounds.getNorth())*i),g=Math.ceil(o.V(this.bounds.getEast())*i),x=Math.ceil(o.U(this.bounds.getSouth())*i);return e.x>=u&&e.x<g&&e.y>=h&&e.y<x}}class ot extends o.E{constructor(e,i,u,h){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(i,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield q(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new Ze(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};u.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((g,x)=>{e.reloadPromise={resolve:g,reject:x}})}else e.actor=this.dispatcher.getActor(),h="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:h,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ht extends o.E{constructor(e,i,u,h){super(),this.id=e,this.dispatcher=u,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},i),o.e(this,o.Q(i,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield q(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(o.e(this,i),i.bounds&&(this.tileBounds=new Ze(i.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new o.k(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield We.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const h=this.map.painter.context,g=h.gl,x=u.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new o.T(h,x,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class rt extends ht{constructor(e,i,u,h){super(e,i,u,h),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return o._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const h=yield We.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){const g=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const x=o.b(g)&&o.W()?g:yield this.readImageNow(g),S={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const C=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=C,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}readImageNow(e){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.X()){const i=e.width+2,u=e.height+2;try{return new o.R({width:i,height:u},yield o.Y(e,-1,-1,i,u))}catch{}}return ce.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,u=Math.pow(2,i.z),h=(i.x-1+u)%u,g=i.x===0?e.wrap-1:e.wrap,x=(i.x+1+u)%u,S=i.x+1===u?e.wrap+1:e.wrap,C={};return C[new o.Z(e.overscaledZ,g,i.z,h,i.y).key]={backfilled:!1},C[new o.Z(e.overscaledZ,S,i.z,x,i.y).key]={backfilled:!1},i.y>0&&(C[new o.Z(e.overscaledZ,g,i.z,h,i.y-1).key]={backfilled:!1},C[new o.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},C[new o.Z(e.overscaledZ,S,i.z,x,i.y-1).key]={backfilled:!1}),i.y+1<u&&(C[new o.Z(e.overscaledZ,g,i.z,h,i.y+1).key]={backfilled:!1},C[new o.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},C[new o.Z(e.overscaledZ,S,i.z,x,i.y+1).key]={backfilled:!1}),C}unloadTile(e){return o._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class kt extends o.E{constructor(e,i,u,h){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(h),this._data=i.data,this._options=o.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(i.clusterMaxZoom),minPoints:Math.max(2,i.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(o.$/this.tileSize)}_getClusterMaxZoom(e){const i=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${i}"`),i}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return o._(this,void 0,void 0,function*(){const e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(i=>i.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,function*(){const e=new Te,i=yield this.getData();let u;switch(i.type){case"FeatureCollection":u=i.features.map(h=>this.getCoordinatesFromGeometry(h.geometry)).flat(1/0);break;case"Feature":u=this.getCoordinatesFromGeometry(i.geometry);break;default:u=this.getCoordinatesFromGeometry(i)}if(u.length==0)return e;for(let h=0;h<u.length-1;h+=2)e.extend([u[h],u[h+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:u}})}_updateWorkerData(e){return o._(this,void 0,void 0,function*(){const i=o.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(ce.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.l("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));let h=null;u.resourceTiming&&u.resourceTiming[this.id]&&(h=u.resourceTiming[this.id].slice(0));const g={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&o.e(g,{resourceTiming:h}),this.fire(new o.l("data",Object.assign(Object.assign({},g),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},g),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return o._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const h=yield this.actor.sendAsync({type:i,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(h,this.map.painter,i==="RT")})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Re extends o.E{constructor(e,i,u,h){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=i}load(e){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield We.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new o.k(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(o.a0.fromLngLat);var u;return this.tileID=function(h){const g=o.a1.fromPoints(h),x=g.width(),S=g.height(),C=Math.max(x,S),R=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),D=Math.pow(2,R);return new o.a3(R,Math.floor((g.minX+g.maxX)/2*D),Math.floor((g.minY+g.maxY)/2*D))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(h=>this.tileID.getTilePoint(h)._round()),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new o.T(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let u=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:i,minY:u,maxX:h,maxY:g}=o.a1.fromPoints(e),x={};for(let S=0;S<=o.a2;S++){const C=Math.pow(2,S),R=Math.floor(i*C),D=Math.floor(u*C),B=Math.floor(h*C),F=Math.floor(g*C);x[S]={minTileX:R,minTileY:D,maxTileX:B,maxTileY:F}}return x}}class It extends Re{constructor(e,i,u,h){super(e,i,u,h),this.roundZoom=!0,this.type="video",this.options=i}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield o.a4(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new o.k(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new o.k(new o.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let u=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class _t extends Re{constructor(e,i,u,h){super(e,i,u,h),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new o.k(new o.a5(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a5(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new o.k(new o.a5(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a5(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a5(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,u=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(i,this.canvas,u.RGBA,{premultiply:!0});let h=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,h=!0)}h&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const $t={},At=m=>{switch(m){case"geojson":return kt;case"image":return Re;case"raster":return ht;case"raster-dem":return rt;case"vector":return ot;case"video":return It;case"canvas":return _t}return $t[m]},mt="RTLPluginLoaded";class Qt extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=kr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,function*(i,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ce.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(mt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let fi=null;function gi(){return fi||(fi=new Qt),fi}class Et{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=o.a6(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,g){const x={};if(!g)return x;for(const S of h){const C=S.layerIds.map(R=>g.getLayer(R)).filter(Boolean);if(C.length!==0){S.layers=C,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(R=>C.filter(D=>D.id===R)[0]));for(const R of C)x[R.id]=S}}return x}(e.buckets,i?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof o.a8){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof o.a8&&g.hasRTLText){this.hasRTLText=!0,gi().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o.a7}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const h=this.buckets[u];h.uploadPending()&&h.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,u,h,g,x,S,C,R,D,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:D,transform:C,params:S,queryPadding:this.queryPadding*R,getElevation:B},e,i,u):{}}querySourceFeatures(e,i){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const h=u.loadVTLayers(),g=i&&i.sourceLayer?i.sourceLayer:"",x=h._geojsonTileLayer||h[g];if(!x)return;const S=o.a9(i&&i.filter),{z:C,x:R,y:D}=this.tileID.canonical,B={z:C,x:R,y:D};for(let F=0;F<x.length;F++){const U=x.feature(F);if(S.needGeometry){const ae=o.aa(U,!0);if(!S.filter(new o.F(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!S.filter(new o.F(this.tileID.overscaledZ),U))continue;const X=u.getId(U,g),oe=new o.ab(U,C,R,D,X);oe.tile=B,e.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const u=o.ac(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let h=!1;if(this.expirationTime>u)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const g=this.expirationTime-i;g?this.expirationTime=u+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!i.style.hasLayer(h))continue;const g=this.buckets[h],x=g.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],C=e[x];if(!S||!C||Object.keys(C).length===0)continue;g.update(C,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=i&&i.style&&i.style.getLayer(h);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ce.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ce.now()+e}setDependencies(e,i){const u={};for(const h of i)u[h]=!0;this.dependencies[e]=u}hasDependency(e,i){for(const u of e){const h=this.dependencies[u];if(h){for(const g of i)if(h[g])return!0}}return!1}}class sn{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,u){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const g={value:i,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},u)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const u=e.wrapped().key,h=i===void 0?0:this.data[u].indexOf(i),g=this.data[u][h];return this.data[u].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const u in this.data)for(const h of this.data[u])e(h.value)||i.push(h);for(const u of i)this.remove(u.value.tileID,u)}}class si{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,u){const h=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},o.e(this.stateChanges[e][h],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==h&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const g in this.state[e][h])u[g]||(this.deletedStates[e][h][g]=null)}else for(const g in u)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][g]===null&&delete this.deletedStates[e][h][g]}removeFeatureState(e,i,u){if(this.deletedStates[e]===null)return;const h=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&i!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][u]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(u in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][u]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,i){const u=String(i),h=o.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][i];if(g===null)return{};for(const x in g)delete h[x]}return h}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const u={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const x in this.stateChanges[h])this.state[h][x]||(this.state[h][x]={}),o.e(this.state[h][x],this.stateChanges[h][x]),g[x]=this.state[h][x];u[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(this.deletedStates[h]===null)for(const x in this.state[h])g[x]={},this.state[h][x]={};else for(const x in this.deletedStates[h]){if(this.deletedStates[h][x]===null)this.state[h][x]={};else for(const S of Object.keys(this.deletedStates[h][x]))delete this.state[h][x][S];g[x]=this.state[h][x]}u[h]=u[h]||{},o.e(u[h],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const h in e)e[h].setFeatureState(u,i)}}const Zt=89.25;function Ee(m,e){const i=o.ag(e.lat,-o.ah,o.ah);return new o.P(o.V(e.lng)*m,o.U(i)*m)}function W(m,e){return new o.a0(e.x/m,e.y/m).toLngLat()}function ee(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(o.ad(90-m.pitch)),Math.tan(o.ad(Zt-m.pitch)))}function Q(m,e){const i=m.canonical,u=e/o.ae(i.z),h=i.x+Math.pow(2,i.z)*m.wrap,g=o.af(new Float64Array(16));return o.M(g,g,[h*u,i.y*u,0]),o.N(g,g,[u/o.$,u/o.$,1]),g}function pe(m,e,i,u,h){const g=o.a0.fromLngLat(m,e),x=h*o.ai(1,m.lat),S=x*Math.cos(o.ad(i)),C=Math.sqrt(x*x-S*S),R=C*Math.sin(o.ad(-u)),D=C*Math.cos(o.ad(-u));return new o.a0(g.x+R,g.y+D,g.z+S)}function Se(m,e,i){const u=e.intersectsFrustum(m);if(!i||u===0)return u;const h=e.intersectsPlane(i);return h===0?0:u===2&&h===2?2:1}function Pe(m,e,i){let u=0;const h=(i-e)/10;for(let g=0;g<10;g++)u+=h*Math.pow(Math.cos(e+(g+.5)/10*(i-e)),m);return u}function Le(m,e){return function(i,u,h,g,x){const S=2*((m-1)/o.aj(Math.cos(o.ad(Zt-x))/Math.cos(o.ad(Zt)))-1),C=Math.acos(h/g),R=2*Pe(S-1,0,o.ad(x/2)),D=Math.min(o.ad(Zt),C+o.ad(x/2)),B=Pe(S-1,Math.min(D,C-o.ad(x/2)),D),F=Math.atan(u/h),U=Math.hypot(u,h);let X=i;return X+=o.aj(g/U/Math.max(.5,Math.cos(o.ad(x/2)))),X+=S*o.aj(Math.cos(F))/2,X-=o.aj(Math.max(1,B/R/e))/2,X}}const ke=Le(9.314,3);function Ge(m,e){const i=(e.roundZoom?Math.round:Math.floor)(m.zoom+o.aj(m.tileSize/e.tileSize));return Math.max(0,i)}function Ue(m,e){const i=m.getCameraFrustum(),u=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=o.a0.fromLngLat(m.center,m.elevation);h.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const x=m.getCoveringTilesDetailsProvider(),S=x.allowVariableZoom(m,e),C=Ge(m,e),R=e.minzoom||0,D=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,B=Math.min(Math.max(0,C),D),F=Math.pow(2,B),U=[F*h.x,F*h.y,0],X=[F*g.x,F*g.y,0],oe=Math.hypot(g.x-h.x,g.y-h.y),ae=Math.abs(g.z-h.z),ue=Math.hypot(oe,ae),de=xe=>({zoom:0,x:0,y:0,wrap:xe,fullyVisible:!1}),_e=[],me=[];if(m.renderWorldCopies&&x.allowWorldCopies())for(let xe=1;xe<=3;xe++)_e.push(de(-xe)),_e.push(de(xe));for(_e.push(de(0));_e.length>0;){const xe=_e.pop(),we=xe.x,ge=xe.y;let Ce=xe.fullyVisible;const Be={x:we,y:ge,z:xe.zoom},De=x.getTileBoundingVolume(Be,xe.wrap,m.elevation,e);if(!Ce){const wt=Se(i,De,u);if(wt===0)continue;Ce=wt===2}const ze=x.distanceToTile2d(h.x,h.y,Be,De);let je=C;S&&(je=(e.calculateTileZoom||ke)(m.zoom+o.aj(m.tileSize/e.tileSize),ze,ae,ue,m.fov)),je=(e.roundZoom?Math.round:Math.floor)(je),je=Math.max(0,je);const St=Math.min(je,D);if(xe.wrap=x.getWrap(g,Be,xe.wrap),xe.zoom>=St){if(xe.zoom<R)continue;const wt=B-xe.zoom,st=U[0]-.5-(we<<wt),zt=U[1]-.5-(ge<<wt),_i=e.reparseOverscaled?Math.max(xe.zoom,je):xe.zoom;me.push({tileID:new o.Z(xe.zoom===D?_i:xe.zoom,xe.wrap,xe.zoom,we,ge),distanceSq:o.ak([X[0]-.5-we,X[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(st*st+zt*zt)})}else for(let wt=0;wt<4;wt++)_e.push({zoom:xe.zoom+1,x:(we<<1)+wt%2,y:(ge<<1)+(wt>>1),wrap:xe.wrap,fullyVisible:Ce})}return me.sort((xe,we)=>xe.distanceSq-we.distanceSq).map(xe=>xe.tileID)}const Ae=o.a1.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class et extends o.E{constructor(e,i,u){super(),this.id=e,this.dispatcher=u,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,g,x,S)=>{const C=new(At(g.type))(h,g,x,S);if(C.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${C.id}`);return C})(e,i,u,this),this._tiles={},this._cache=new sn(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new si,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,u){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,u)}catch(h){e.state="errored",h.status!==404?this._source.fire(new o.k(h,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const u=this._tiles[i];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(be).map(e=>e.key)}getRenderableIds(e){const i=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&i.push(this._tiles[u]);return e?i.sort((u,h)=>{const g=u.tileID,x=h.tileID,S=new o.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),C=new o.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-x.overscaledZ||C.y-S.y||C.x-S.x}).map(u=>u.tileID.key):i.map(u=>u.tileID).sort(be).map(u=>u.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)e?this._reloadTile(i,"expired"):this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return o._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=i),yield this._loadTile(u,e,i))})}_tileLoaded(e,i,u){e.timeAdded=ce.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const g=i[h];if(e.neighboringTiles&&e.neighboringTiles[g]){const x=this.getTileByID(g);u(e,x),u(x,e)}}function u(h,g){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-h.tileID.canonical.x;const S=g.tileID.canonical.y-h.tileID.canonical.y,C=Math.pow(2,h.tileID.canonical.z),R=g.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+C)===1?x+=C:Math.abs(x-C)===1&&(x-=C)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,x,S),h.neighboringTiles&&h.neighboringTiles[R]&&(h.neighboringTiles[R].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,u,h){for(const g in this._tiles){let x=this._tiles[g];if(h[g]||!x.hasData()||x.tileID.overscaledZ<=i||x.tileID.overscaledZ>u)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>i+1;){const R=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[R.key],x&&x.hasData()&&(S=R)}let C=S;for(;C.overscaledZ>i;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]||e[C.canonical.key]){h[S.key]=S;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=i?u:null}for(let u=e.overscaledZ-1;u>=i;u--){const h=e.scaledTo(u),g=this._getLoadedTile(h);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,h=Math.floor(i*u*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(g)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const u={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+i),u[g.tileID.key]=g}this._tiles=u;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(e,i,u,h,g,x){const S={},C={},R=Object.keys(e),D=ce.now();for(const B of R){const F=e[B],U=this._tiles[B];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=D)continue;const X=this.findLoadedParent(F,i),oe=this.findLoadedSibling(F),ae=X||oe||null;ae&&(this._addTile(ae.tileID),S[ae.tileID.key]=ae.tileID),C[B]=F}this._retainLoadedChildren(C,h,u,e);for(const B in S)e[B]||(this._coveredTiles[B]=!0,e[B]=S[B]);if(x){const B={},F={};for(const U of g)this._tiles[U.key].hasData()?B[U.key]=U:F[U.key]=U;for(const U in F){const X=F[U].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(B[X[0].key]=e[X[0].key]=X[0],B[X[1].key]=e[X[1].key]=X[1],B[X[2].key]=e[X[2].key]=X[2],B[X[3].key]=e[X[3].key]=X[3],delete F[U])}for(const U in F){const X=F[U],oe=this.findLoadedParent(X,this._source.minzoom),ae=this.findLoadedSibling(X),ue=oe||ae||null;if(ue){B[ue.tileID.key]=e[ue.tileID.key]=ue.tileID;for(const de in B)B[de].isChildOf(ue.tileID)&&delete B[de]}}for(const U in this._tiles)B[U]||(this._coveredTiles[U]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new o.Z(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(u=Ue(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter(D=>this._source.hasTile(D)))):u=[];const h=Ge(e,this._source),g=Math.max(h-et.maxOverzooming,this._source.minzoom),x=Math.max(h+et.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const B of u)if(B.canonical.z>this._source.minzoom){const F=B.scaledTo(B.canonical.z-1);D[F.key]=F;const U=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));D[U.key]=U}u=u.concat(Object.values(D))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(u,h);Tt(this._source.type)&&this._updateCoveredAndRetainedTiles(C,g,x,h,u,i);for(const D in C)this._tiles[D].clearFadeHold();const R=o.al(this._tiles,C);for(const D of R){const B=this._tiles[D];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var u;const h={},g={},x=Math.max(i-et.maxOverzooming,this._source.minzoom),S=Math.max(i+et.maxUnderzooming,this._source.minzoom),C={};for(const R of e){const D=this._addTile(R);h[R.key]=R,D.hasData()||i<this._source.maxzoom&&(C[R.key]=R)}this._retainLoadedChildren(C,i,S,h);for(const R of e){let D=this._tiles[R.key];if(D.hasData())continue;if(i+1>this._source.maxzoom){const F=R.children(this._source.maxzoom)[0],U=this.getTile(F);if(U&&U.hasData()){h[F.key]=F;continue}}else{const F=R.children(this._source.maxzoom);if(h[F[0].key]&&h[F[1].key]&&h[F[2].key]&&h[F[3].key])continue}let B=D.wasRequested();for(let F=R.overscaledZ-1;F>=x;--F){const U=R.scaledTo(F);if(g[U.key])break;if(g[U.key]=!0,D=this.getTile(U),!D&&B&&(D=this._addTile(U)),D){const X=D.hasData();if((X||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||B)&&(h[U.key]=U),B=D.wasRequested(),X)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let u,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){u=this._loadedParentTiles[h.key];break}i.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;h=g}for(const g of i)this._loadedParentTiles[g]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,u=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=u}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const u=i;return i||(i=new Et(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,u||this._source.fire(new o.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=i.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}refreshTiles(e){for(const i in this._tiles)(this._isIdRenderable(i)||this._tiles[i].state=="errored")&&e.some(u=>u.equals(this._tiles[i].tileID.canonical))&&this._reloadTile(i,"expired")}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,u){const h=[],g=this.transform;if(!g)return h;const x=g.getCoveringTilesDetailsProvider().allowWorldCopies(),S=u?g.getCameraQueryGeometry(e):e,C=U=>g.screenPointToMercatorCoordinate(U,this.terrain),R=this.transformBbox(e,C,!x),D=this.transformBbox(S,C,!x),B=this.getIds(),F=o.a1.fromPoints(D);for(let U=0;U<B.length;U++){const X=this._tiles[B[U]];if(X.holdingForFade())continue;const oe=x?[X.tileID]:[X.tileID.unwrapTo(-1),X.tileID.unwrapTo(0)],ae=Math.pow(2,g.zoom-X.tileID.overscaledZ),ue=i*X.queryPadding*o.$/X.tileSize/ae;for(const de of oe){const _e=F.map(me=>de.getTilePoint(new o.a0(me.x,me.y)));if(_e.expandBy(ue),_e.intersects(Ae)){const me=R.map(we=>de.getTilePoint(we)),xe=D.map(we=>de.getTilePoint(we));h.push({tile:X,tileID:x?de:de.unwrapTo(0),queryGeometry:me,cameraQueryGeometry:xe,scale:ae})}}}return h}transformBbox(e,i,u){let h=e.map(i);if(u){const g=o.a1.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const x=g.map(i);o.a1.fromPoints(h).covers(x)||(h=h.map(S=>S.x>.5?new o.a0(S.x-1,S.y,S.z):S))}return h}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(Tt(this._source.type)){const e=ce.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,u){this._state.updateState(e=e||"_geojsonTileLayer",i,u)}removeFeatureState(e,i,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,u)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,u){const h=this._tiles[e];h&&h.setDependencies(i,u)}reloadTilesForDependencies(e,i){for(const u in this._tiles)this._tiles[u].hasDependency(e,i)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,i))}}function be(m,e){const i=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-i||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function Tt(m){return m==="raster"||m==="image"||m==="video"}et.maxOverzooming=10,et.maxUnderzooming=3;class He{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.ag(e,0,1);let i=1,u=this._distances[i];const h=e*this.paddedLength+this.padding;for(;u<h&&i<this._distances.length;)u=this._distances[++i];const g=i-1,x=this._distances[g],S=u-x,C=S>0?(h-x)/S:0;return this.points[g].mult(1-C).add(this.points[i].mult(C))}}function Mt(m,e){let i=!0;return m==="always"||m!=="never"&&e!=="never"||(i=!1),i}class Ht{constructor(e,i,u){const h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(i/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,u,h,g){this._forEachCell(i,u,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(g)}insertCircle(e,i,u,h){this._forEachCell(i-h,u-h,i+h,u+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(u),this.circles.push(h)}_insertBoxCell(e,i,u,h,g,x){this.boxCells[g].push(x)}_insertCircleCell(e,i,u,h,g,x){this.circleCells[g].push(x)}_query(e,i,u,h,g,x,S){if(u<0||e>this.width||h<0||i>this.height)return[];const C=[];if(e<=0&&i<=0&&this.width<=u&&this.height<=h){if(g)return[{key:null,x1:e,y1:i,x2:u,y2:h}];for(let R=0;R<this.boxKeys.length;R++)C.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const D=this.circles[3*R],B=this.circles[3*R+1],F=this.circles[3*R+2];C.push({key:this.circleKeys[R],x1:D-F,y1:B-F,x2:D+F,y2:B+F})}}else this._forEachCell(e,i,u,h,this._queryCell,C,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},S);return C}query(e,i,u,h){return this._query(e,i,u,h,!1,null)}hitTest(e,i,u,h,g,x){return this._query(e,i,u,h,!0,g,x).length>0}hitTestCircle(e,i,u,h,g){const x=e-u,S=e+u,C=i-u,R=i+u;if(S<0||x>this.width||R<0||C>this.height)return!1;const D=[];return this._forEachCell(x,C,S,R,this._queryCellCircle,D,{hitTest:!0,overlapMode:h,circle:{x:e,y:i,radius:u},seenUids:{box:{},circle:{}}},g),D.length>0}_queryCell(e,i,u,h,g,x,S,C){const{seenUids:R,hitTest:D,overlapMode:B}=S,F=this.boxCells[g];if(F!==null){const X=this.bboxes;for(const oe of F)if(!R.box[oe]){R.box[oe]=!0;const ae=4*oe,ue=this.boxKeys[oe];if(e<=X[ae+2]&&i<=X[ae+3]&&u>=X[ae+0]&&h>=X[ae+1]&&(!C||C(ue))&&(!D||!Mt(B,ue.overlapMode))&&(x.push({key:ue,x1:X[ae],y1:X[ae+1],x2:X[ae+2],y2:X[ae+3]}),D))return!0}}const U=this.circleCells[g];if(U!==null){const X=this.circles;for(const oe of U)if(!R.circle[oe]){R.circle[oe]=!0;const ae=3*oe,ue=this.circleKeys[oe];if(this._circleAndRectCollide(X[ae],X[ae+1],X[ae+2],e,i,u,h)&&(!C||C(ue))&&(!D||!Mt(B,ue.overlapMode))){const de=X[ae],_e=X[ae+1],me=X[ae+2];if(x.push({key:ue,x1:de-me,y1:_e-me,x2:de+me,y2:_e+me}),D)return!0}}}return!1}_queryCellCircle(e,i,u,h,g,x,S,C){const{circle:R,seenUids:D,overlapMode:B}=S,F=this.boxCells[g];if(F!==null){const X=this.bboxes;for(const oe of F)if(!D.box[oe]){D.box[oe]=!0;const ae=4*oe,ue=this.boxKeys[oe];if(this._circleAndRectCollide(R.x,R.y,R.radius,X[ae+0],X[ae+1],X[ae+2],X[ae+3])&&(!C||C(ue))&&!Mt(B,ue.overlapMode))return x.push(!0),!0}}const U=this.circleCells[g];if(U!==null){const X=this.circles;for(const oe of U)if(!D.circle[oe]){D.circle[oe]=!0;const ae=3*oe,ue=this.circleKeys[oe];if(this._circlesCollide(X[ae],X[ae+1],X[ae+2],R.x,R.y,R.radius)&&(!C||C(ue))&&!Mt(B,ue.overlapMode))return x.push(!0),!0}}}_forEachCell(e,i,u,h,g,x,S,C){const R=this._convertToXCellCoord(e),D=this._convertToYCellCoord(i),B=this._convertToXCellCoord(u),F=this._convertToYCellCoord(h);for(let U=R;U<=B;U++)for(let X=D;X<=F;X++)if(g.call(this,e,i,u,h,this.xCellCount*X+U,x,S,C))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,u,h,g,x){const S=h-e,C=g-i,R=u+x;return R*R>S*S+C*C}_circleAndRectCollide(e,i,u,h,g,x,S){const C=(x-h)/2,R=Math.abs(e-(h+C));if(R>C+u)return!1;const D=(S-g)/2,B=Math.abs(i-(g+D));if(B>D+u)return!1;if(R<=C||B<=D)return!0;const F=R-C,U=B-D;return F*F+U*U<=u*u}}function ii(m,e,i){const u=o.L();if(!m){const{vecSouth:B,vecEast:F}=Li(e),U=re();U[0]=F[0],U[1]=F[1],U[2]=B[0],U[3]=B[1],h=U,(D=(x=(g=U)[0])*(R=g[3])-(C=g[2])*(S=g[1]))&&(h[0]=R*(D=1/D),h[1]=-S*D,h[2]=-C*D,h[3]=x*D),u[0]=U[0],u[1]=U[1],u[4]=U[2],u[5]=U[3]}var h,g,x,S,C,R,D;return o.N(u,u,[1/i,1/i,1]),u}function Bi(m,e,i,u){if(m){const h=o.L();if(!e){const{vecSouth:g,vecEast:x}=Li(i);h[0]=x[0],h[1]=x[1],h[4]=g[0],h[5]=g[1]}return o.N(h,h,[u,u,1]),h}return i.pixelsToClipSpaceMatrix}function Li(m){const e=Math.cos(m.rollInRadians),i=Math.sin(m.rollInRadians),u=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),x=o.aq();x[0]=-h*u*i-g*e,x[1]=-g*u*i+h*e;const S=o.ar(x);S<1e-9?o.as(x):o.at(x,x,1/S);const C=o.aq();C[0]=h*u*e-g*i,C[1]=g*u*e+h*i;const R=o.ar(C);return R<1e-9?o.as(C):o.at(C,C,1/R),{vecEast:C,vecSouth:x}}function Pi(m,e,i,u){let h;u?(h=[m,e,u(m,e),1],o.av(h,h,i)):(h=[m,e,0,1],Vs(h,h,i));const g=h[3];return{point:new o.P(h[0]/g,h[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Yt(m,e){return .5+m/e*.5}function xi(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function dn(m,e,i,u,h,g,x,S,C,R,D,B,F){const U=i?m.textSizeData:m.iconSizeData,X=o.am(U,e.transform.zoom),oe=[256/e.width*2+1,256/e.height*2+1],ae=i?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ae.clear();const ue=m.lineVertexArray,de=i?m.text.placedSymbolArray:m.icon.placedSymbolArray,_e=e.transform.width/e.transform.height;let me=!1;for(let xe=0;xe<de.length;xe++){const we=de.get(xe);if(we.hidden||we.writingMode===o.an.vertical&&!me){ss(we.numGlyphs,ae);continue}me=!1;const ge=new o.P(we.anchorX,we.anchorY),Ce={getElevation:F,pitchedLabelPlaneMatrix:u,lineVertexArray:ue,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ge,unwrappedTileID:C,width:R,height:D,translation:B},Be=li(we.anchorX,we.anchorY,Ce);if(!xi(Be.point,oe)){ss(we.numGlyphs,ae);continue}const De=Yt(e.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),ze=o.ao(U,X,we),je=g?ze*e.transform.getPitchedTextCorrection(we.anchorX,we.anchorY,C)/De:ze*De,St=Ki({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:h,symbol:we,fontSize:je,flip:!1,keepUpright:x,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:_e,rotateToLine:S});me=St.useVertical,(St.notEnoughRoom||me||St.needsFlipping&&Ki({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:h,symbol:we,fontSize:je,flip:!0,keepUpright:x,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:_e,rotateToLine:S}).notEnoughRoom)&&ss(we.numGlyphs,ae)}i?m.text.dynamicLayoutVertexBuffer.updateData(ae):m.icon.dynamicLayoutVertexBuffer.updateData(ae)}function xt(m,e,i,u,h,g,x,S){const C=g.glyphStartIndex+g.numGlyphs,R=g.lineStartIndex,D=g.lineStartIndex+g.lineLength,B=e.getoffsetX(g.glyphStartIndex),F=e.getoffsetX(C-1),U=cr(m*B,i,u,h,g.segment,R,D,S,x);if(!U)return null;const X=cr(m*F,i,u,h,g.segment,R,D,S,x);return X?S.projectionCache.anyProjectionOccluded?null:{first:U,last:X}:null}function Mn(m,e,i,u){return m===o.an.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*u?{useVertical:!0}:(m===o.an.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function Ki(m){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:u,fontSize:h,flip:g,keepUpright:x,glyphOffsetArray:S,dynamicLayoutVertexArray:C,aspectRatio:R,rotateToLine:D}=m,B=h/24,F=u.lineOffsetX*B,U=u.lineOffsetY*B;let X;if(u.numGlyphs>1){const oe=u.glyphStartIndex+u.numGlyphs,ae=u.lineStartIndex,ue=u.lineStartIndex+u.lineLength,de=xt(B,S,F,U,g,u,D,e);if(!de)return{notEnoughRoom:!0};const _e=oi(de.first.point.x,de.first.point.y,e,i),me=oi(de.last.point.x,de.last.point.y,e,i);if(x&&!g){const xe=Mn(u.writingMode,_e,me,R);if(xe)return xe}X=[de.first];for(let xe=u.glyphStartIndex+1;xe<oe-1;xe++){const we=cr(B*S.getoffsetX(xe),F,U,g,u.segment,ae,ue,e,D);if(!we)return{notEnoughRoom:!0};X.push(we)}X.push(de.last)}else{if(x&&!g){const ae=bt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,ue=u.lineStartIndex+u.segment+1,de=new o.P(e.lineVertexArray.getx(ue),e.lineVertexArray.gety(ue)),_e=bt(de.x,de.y,e),me=_e.signedDistanceFromCamera>0?_e.point:wn(e.tileAnchorPoint,de,ae,1,e),xe=oi(ae.x,ae.y,e,i),we=oi(me.x,me.y,e,i),ge=Mn(u.writingMode,xe,we,R);if(ge)return ge}const oe=cr(B*S.getoffsetX(u.glyphStartIndex),F,U,g,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,D);if(!oe||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[oe]}for(const oe of X)o.au(C,oe.point,oe.angle);return{}}function wn(m,e,i,u,h){const g=m.add(m.sub(e)._unit()),x=bt(g.x,g.y,h).point,S=i.sub(x);return i.add(S._mult(u/S.mag()))}function rs(m,e,i){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const h=new o.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=bt(h.x,h.y,e);if(g.signedDistanceFromCamera>0)return u.projections[m]=g.point,u.anyProjectionOccluded=u.anyProjectionOccluded||g.isOccluded,g.point;const x=m-i.direction;return wn(i.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),h,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function bt(m,e,i){const u=m+i.translation[0],h=e+i.translation[1];let g;return i.pitchWithMap?(g=Pi(u,h,i.pitchedLabelPlaneMatrix,i.getElevation),g.isOccluded=!1):(g=i.transform.projectTileCoordinates(u,h,i.unwrappedTileID,i.getElevation),g.point.x=(.5*g.point.x+.5)*i.width,g.point.y=(.5*-g.point.y+.5)*i.height),g}function oi(m,e,i,u){if(i.pitchWithMap){const h=[m,e,0,1];return o.av(h,h,u),i.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],i.unwrappedTileID,i.getElevation).point}return{x:m/i.width*2-1,y:1-e/i.height*2}}function li(m,e,i){return i.transform.projectTileCoordinates(m,e,i.unwrappedTileID,i.getElevation)}function er(m,e,i){return m._unit()._perp()._mult(e*i)}function js(m,e,i,u,h,g,x,S,C){if(S.projectionCache.offsets[m])return S.projectionCache.offsets[m];const R=i.add(e);if(m+C.direction<u||m+C.direction>=h)return S.projectionCache.offsets[m]=R,R;const D=rs(m+C.direction,S,C),B=er(D.sub(i),x,C.direction),F=i.add(B),U=D.add(B);return S.projectionCache.offsets[m]=o.aw(g,R,F,U)||R,S.projectionCache.offsets[m]}function cr(m,e,i,u,h,g,x,S,C){const R=u?m-e:m+e;let D=R>0?1:-1,B=0;u&&(D*=-1,B=Math.PI),D<0&&(B+=Math.PI);let F,U=D>0?g+h:g+h+1;S.projectionCache.cachedAnchorPoint?F=S.projectionCache.cachedAnchorPoint:(F=bt(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=F);let X,oe,ae=F,ue=F,de=0,_e=0;const me=Math.abs(R),xe=[];let we;for(;de+_e<=me;){if(U+=D,U<g||U>=x)return null;de+=_e,ue=ae,oe=X;const Be={absOffsetX:me,direction:D,distanceFromAnchor:de,previousVertex:ue};if(ae=rs(U,S,Be),i===0)xe.push(ue),we=ae.sub(ue);else{let De;const ze=ae.sub(ue);De=ze.mag()===0?er(rs(U+D,S,Be).sub(ae),i,D):er(ze,i,D),oe||(oe=ue.add(De)),X=js(U,De,ae,g,x,oe,i,S,Be),xe.push(oe),we=X.sub(oe)}_e=we.mag()}const ge=we._mult((me-de)/_e)._add(oe||ue),Ce=B+Math.atan2(ae.y-ue.y,ae.x-ue.x);return xe.push(ge),{point:ge,angle:C?Ce:0,path:xe}}const Wt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ss(m,e){for(let i=0;i<m;i++){const u=e.length;e.resize(u+4),e.float32.set(Wt,3*u)}}function Vs(m,e,i){const u=e[0],h=e[1];return m[0]=i[0]*u+i[4]*h+i[12],m[1]=i[1]*u+i[5]*h+i[13],m[3]=i[3]*u+i[7]*h+i[15],m}const Ji=100;class as{constructor(e,i=new Ht(e.width+200,e.height+200,25),u=new Ht(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ji,this.screenBottomBoundary=e.height+Ji,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,u,h,g,x,S,C,R,D,B,F){const U=this.projectAndGetPerspectiveRatio(e.anchorPointX+C[0],e.anchorPointY+C[1],g,D,F),X=u*U.perspectiveRatio;let oe;if(x||S)oe=this._projectCollisionBox(e,X,h,g,x,S,C,U,D,B,F);else{const we=U.x+(B?B.x*X:0),ge=U.y+(B?B.y*X:0);oe={allPointsOccluded:!1,box:[we+e.x1*X,ge+e.y1*X,we+e.x2*X,ge+e.y2*X]}}const[ae,ue,de,_e]=oe.box,me=x?oe.allPointsOccluded:U.isOccluded;let xe=me;return xe||(xe=U.perspectiveRatio<this.perspectiveRatioCutoff),xe||(xe=!this.isInsideGrid(ae,ue,de,_e)),xe||i!=="always"&&this.grid.hitTest(ae,ue,de,_e,i,R)?{box:[ae,ue,de,_e],placeable:!1,offscreen:!1,occluded:me}:{box:[ae,ue,de,_e],placeable:!0,offscreen:this.isOffscreen(ae,ue,de,_e),occluded:me}}placeCollisionCircles(e,i,u,h,g,x,S,C,R,D,B,F,U,X){const oe=[],ae=new o.P(i.anchorX,i.anchorY),ue=this.getPerspectiveRatio(ae.x,ae.y,x,X),de=(R?g*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,x)/ue:g*ue)/o.aA,_e={getElevation:X,pitchedLabelPlaneMatrix:S,lineVertexArray:u,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ae,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:U},me=xt(de,h,i.lineOffsetX*de,i.lineOffsetY*de,!1,i,!1,_e);let xe=!1,we=!1,ge=!0;if(me){const Ce=.5*B*ue+F,Be=new o.P(-100,-100),De=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new He,je=me.first,St=me.last;let wt=[];for(let _i=je.path.length-1;_i>=1;_i--)wt.push(je.path[_i]);for(let _i=1;_i<St.path.length;_i++)wt.push(St.path[_i]);const st=2.5*Ce;if(R){const _i=this.projectPathToScreenSpace(wt,_e);wt=_i.some(Oi=>Oi.signedDistanceFromCamera<=0)?[]:_i.map(Oi=>Oi.point)}let zt=[];if(wt.length>0){const _i=wt[0].clone(),Oi=wt[0].clone();for(let on=1;on<wt.length;on++)_i.x=Math.min(_i.x,wt[on].x),_i.y=Math.min(_i.y,wt[on].y),Oi.x=Math.max(Oi.x,wt[on].x),Oi.y=Math.max(Oi.y,wt[on].y);zt=_i.x>=Be.x&&Oi.x<=De.x&&_i.y>=Be.y&&Oi.y<=De.y?[wt]:Oi.x<Be.x||_i.x>De.x||Oi.y<Be.y||_i.y>De.y?[]:o.ax([wt],Be.x,Be.y,De.x,De.y)}for(const _i of zt){ze.reset(_i,.25*Ce);let Oi=0;Oi=ze.length<=.5*Ce?1:Math.ceil(ze.paddedLength/st)+1;for(let on=0;on<Oi;on++){const Gi=on/Math.max(Oi-1,1),ln=ze.lerp(Gi),Zi=ln.x+Ji,qi=ln.y+Ji;oe.push(Zi,qi,Ce,0);const Hi=Zi-Ce,rr=qi-Ce,Mi=Zi+Ce,Xn=qi+Ce;if(ge=ge&&this.isOffscreen(Hi,rr,Mi,Xn),we=we||this.isInsideGrid(Hi,rr,Mi,Xn),e!=="always"&&this.grid.hitTestCircle(Zi,qi,Ce,e,D)&&(xe=!0,!C))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!C&&xe||!we||ue<this.perspectiveRatioCutoff?[]:oe,offscreen:ge,collisionDetected:xe}}projectPathToScreenSpace(e,i){const u=function(h,g){const x=o.L();return o.ap(x,g.pitchedLabelPlaneMatrix),h.map(S=>{const C=Pi(S.x,S.y,x,g.getElevation),R=g.transform.projectTileCoordinates(C.point.x,C.point.y,g.unwrappedTileID,g.getElevation);return R.point.x=(.5*R.point.x+.5)*g.width,R.point.y=(.5*-R.point.y+.5)*g.height,R})}(e,i);return function(h){let g=0,x=0,S=0,C=0;for(let R=0;R<h.length;R++)h[R].isOccluded?(S=R+1,C=0):(C++,C>x&&(x=C,g=S));return h.slice(g,g+x)}(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[],u=new o.a1;for(const B of e){const F=new o.P(B.x+Ji,B.y+Ji);u.extend(F),i.push(F)}const{minX:h,minY:g,maxX:x,maxY:S}=u,C=this.grid.query(h,g,x,S).concat(this.ignoredGrid.query(h,g,x,S)),R={},D={};for(const B of C){const F=B.key;if(R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]={}),R[F.bucketInstanceId][F.featureIndex])continue;const U=[new o.P(B.x1,B.y1),new o.P(B.x2,B.y1),new o.P(B.x2,B.y2),new o.P(B.x1,B.y2)];o.ay(i,U)&&(R[F.bucketInstanceId][F.featureIndex]=!0,D[F.bucketInstanceId]===void 0&&(D[F.bucketInstanceId]=[]),D[F.bucketInstanceId].push(F.featureIndex))}return D}insertCollisionBox(e,i,u,h,g,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:x,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,u,h,g,x){const S=u?this.ignoredGrid:this.grid,C={bucketInstanceId:h,featureIndex:g,collisionGroupID:x,overlapMode:i};for(let R=0;R<e.length;R+=4)S.insertCircle(C,e[R],e[R+1],e[R+2])}projectAndGetPerspectiveRatio(e,i,u,h,g){if(g){let x;h?(x=[e,i,h(e,i),1],o.av(x,x,g)):(x=[e,i,0,1],Vs(x,x,g));const S=x[3];return{x:(x[0]/S+1)/2*this.transform.width+Ji,y:(-x[1]/S+1)/2*this.transform.height+Ji,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const x=this.transform.projectTileCoordinates(e,i,u,h);return{x:(x.point.x+1)/2*this.transform.width+Ji,y:(1-x.point.y)/2*this.transform.height+Ji,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,u,h){const g=this.transform.projectTileCoordinates(e,i,u,h);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,i,u,h){return u<Ji||e>=this.screenRightBoundary||h<Ji||i>this.screenBottomBoundary}isInsideGrid(e,i,u,h){return u>=0&&e<this.gridRightBoundary&&h>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=o.af([]);return o.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,u,h,g,x,S,C,R,D,B){let F=1,U=0,X=0,oe=1;const ae=e.anchorPointX+S[0],ue=e.anchorPointY+S[1];if(x&&!g){const wt=this.projectAndGetPerspectiveRatio(ae+1,ue,h,R,B),st=wt.x-C.x,zt=Math.atan((wt.y-C.y)/st)+(st<0?Math.PI:0),_i=Math.sin(zt),Oi=Math.cos(zt);F=Oi,U=_i,X=-_i,oe=Oi}else if(!x&&g){const wt=Li(this.transform);F=wt.vecEast[0],U=wt.vecEast[1],X=wt.vecSouth[0],oe=wt.vecSouth[1]}let de=C.x,_e=C.y,me=i;g&&(de=ae,_e=ue,me=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),me*=this.transform.getPitchedTextCorrection(ae,ue,h),D||(me*=o.ag(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(de+=F*D.x*me+X*D.y*me,_e+=U*D.x*me+oe*D.y*me);const xe=e.x1*me,we=e.x2*me,ge=(xe+we)/2,Ce=e.y1*me,Be=e.y2*me,De=(Ce+Be)/2,ze=[{offsetX:xe,offsetY:Ce},{offsetX:ge,offsetY:Ce},{offsetX:we,offsetY:Ce},{offsetX:we,offsetY:De},{offsetX:we,offsetY:Be},{offsetX:ge,offsetY:Be},{offsetX:xe,offsetY:Be},{offsetX:xe,offsetY:De}];let je=[];for(const{offsetX:wt,offsetY:st}of ze)je.push(new o.P(de+F*wt+X*st,_e+U*wt+oe*st));let St=!1;if(g){const wt=je.map(st=>this.projectAndGetPerspectiveRatio(st.x,st.y,h,R,B));St=wt.some(st=>!st.isOccluded),je=wt.map(st=>new o.P(st.x,st.y))}else St=!0;return{box:o.az(je),allPointsOccluded:!St}}}class Us{constructor(e,i,u,h){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):h&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Or{constructor(e,i,u,h,g){this.text=new Us(e?e.text:null,i,u,g),this.icon=new Us(e?e.icon:null,i,h,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class la{constructor(e,i,u){this.text=e,this.icon=i,this.skipFade=u}}class vr{constructor(e,i,u,h,g){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=u,this.bucketIndex=h,this.tileID=g}}class Ai{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:u=>u.collisionGroupID===i}}return this.collisionGroups[e]}}function Gs(m,e,i,u,h){const{horizontalAlign:g,verticalAlign:x}=o.aG(m);return new o.P(-(g-.5)*e+u[0]*h,-(x-.5)*i+u[1]*h)}class qs{constructor(e,i,u,h,g){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new as(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ai(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(u,h)=>i.getElevation(e,u,h):null}getBucketParts(e,i,u,h){const g=u.getBucket(i),x=u.latestFeatureIndex;if(!g||!x||i.id!==g.layerIds[0])return;const S=u.collisionBoxArray,C=g.layers[0].layout,R=g.layers[0].paint,D=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),B=u.tileSize/o.$,F=u.tileID.toUnwrapped(),U=C.get("text-rotation-alignment")==="map",X=o.aB(u,1,this.transform.zoom),oe=o.aC(this.collisionIndex.transform,u,R.get("text-translate"),R.get("text-translate-anchor")),ae=o.aC(this.collisionIndex.transform,u,R.get("icon-translate"),R.get("icon-translate-anchor")),ue=ii(U,this.transform,X);this.retainedQueryData[g.bucketInstanceId]=new vr(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,u.tileID);const de={bucket:g,layout:C,translationText:oe,translationIcon:ae,unwrappedTileID:F,pitchedLabelPlaneMatrix:ue,scale:D,textPixelRatio:B,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.am(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(const _e of g.sortKeyRanges){const{sortKey:me,symbolInstanceStart:xe,symbolInstanceEnd:we}=_e;e.push({sortKey:me,symbolInstanceStart:xe,symbolInstanceEnd:we,parameters:de})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:de})}attemptAnchorPlacement(e,i,u,h,g,x,S,C,R,D,B,F,U,X,oe,ae,ue,de,_e,me){const xe=o.aD[e.textAnchor],we=[e.textOffset0,e.textOffset1],ge=Gs(xe,u,h,we,g),Ce=this.collisionIndex.placeCollisionBox(i,F,C,R,D,S,x,ae,B.predicate,_e,ge,me);if((!de||this.collisionIndex.placeCollisionBox(de,F,C,R,D,S,x,ue,B.predicate,_e,ge,me).placeable)&&Ce.placeable){let Be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(Be=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:we,width:u,height:h,anchor:xe,textBoxScale:g,prevAnchor:Be},this.markUsedJustification(X,xe,U,oe),X.allowVerticalPlacement&&(this.markUsedOrientation(X,oe,U),this.placedOrientations[U.crossTileID]=oe),{shift:ge,placedGlyphBoxes:Ce}}}placeLayerBucketPart(e,i,u){const{bucket:h,layout:g,translationText:x,translationIcon:S,unwrappedTileID:C,pitchedLabelPlaneMatrix:R,textPixelRatio:D,holdingForFade:B,collisionBoxArray:F,partiallyEvaluatedTextSize:U,collisionGroup:X}=e.parameters,oe=g.get("text-optional"),ae=g.get("icon-optional"),ue=o.aE(g,"text-overlap","text-allow-overlap"),de=ue==="always",_e=o.aE(g,"icon-overlap","icon-allow-overlap"),me=_e==="always",xe=g.get("text-rotation-alignment")==="map",we=g.get("text-pitch-alignment")==="map",ge=g.get("icon-text-fit")!=="none",Ce=g.get("symbol-z-order")==="viewport-y",Be=de&&(me||!h.hasIconData()||ae),De=me&&(de||!h.hasTextData()||oe);!h.collisionArrays&&F&&h.deserializeCollisionBoxes(F);const ze=this.retainedQueryData[h.bucketInstanceId].tileID,je=this._getTerrainElevationFunc(ze),St=this.transform.getFastPathSimpleProjectionMatrix(ze),wt=(st,zt,_i)=>{var Oi,on;if(i[st.crossTileID])return;if(B)return void(this.placements[st.crossTileID]=new la(!1,!1,!1));let Gi=!1,ln=!1,Zi=!0,qi=null,Hi={box:null,placeable:!1,offscreen:null,occluded:!1},rr={placeable:!1},Mi=null,Xn=null,sr=null,xa=0,ba=0,wa=0;zt.textFeatureIndex?xa=zt.textFeatureIndex:st.useRuntimeCollisionCircles&&(xa=st.featureIndex),zt.verticalTextFeatureIndex&&(ba=zt.verticalTextFeatureIndex);const zs=zt.textBox;if(zs){const Lr=Sn=>{let Qi=o.an.horizontal;if(h.allowVerticalPlacement&&!Sn&&this.prevPlacement){const wr=this.prevPlacement.placedOrientations[st.crossTileID];wr&&(this.placedOrientations[st.crossTileID]=wr,Qi=wr,this.markUsedOrientation(h,Qi,st))}return Qi},ps=(Sn,Qi)=>{if(h.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&zt.verticalTextBox){for(const wr of h.writingModes)if(wr===o.an.vertical?(Hi=Qi(),rr=Hi):Hi=Sn(),Hi&&Hi.placeable)break}else Hi=Sn()},Ta=st.textAnchorOffsetStartIndex,Wa=st.textAnchorOffsetEndIndex;if(Wa===Ta){const Sn=(Qi,wr)=>{const On=this.collisionIndex.placeCollisionBox(Qi,ue,D,ze,C,we,xe,x,X.predicate,je,void 0,St);return On&&On.placeable&&(this.markUsedOrientation(h,wr,st),this.placedOrientations[st.crossTileID]=wr),On};ps(()=>Sn(zs,o.an.horizontal),()=>{const Qi=zt.verticalTextBox;return h.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&Qi?Sn(Qi,o.an.vertical):{box:null,offscreen:null}}),Lr(Hi&&Hi.placeable)}else{let Sn=o.aD[(on=(Oi=this.prevPlacement)===null||Oi===void 0?void 0:Oi.variableOffsets[st.crossTileID])===null||on===void 0?void 0:on.anchor];const Qi=(On,Vh,ud)=>{const Ic=On.x2-On.x1,Sl=On.y2-On.y1,ko=st.textBoxScale,ea=ge&&_e==="never"?Vh:null;let ar=null,ta=ue==="never"?1:2,kc="never";Sn&&ta++;for(let Sa=0;Sa<ta;Sa++){for(let Ec=Ta;Ec<Wa;Ec++){const Cc=h.textAnchorOffsets.get(Ec);if(Sn&&Cc.textAnchor!==Sn)continue;const Il=this.attemptAnchorPlacement(Cc,On,Ic,Sl,ko,xe,we,D,ze,C,X,kc,st,h,ud,x,S,ea,je);if(Il&&(ar=Il.placedGlyphBoxes,ar&&ar.placeable))return Gi=!0,qi=Il.shift,ar}Sn?Sn=null:kc=ue}return u&&!ar&&(ar={box:this.collisionIndex.placeCollisionBox(zs,"always",D,ze,C,we,xe,x,X.predicate,je,void 0,St).box,offscreen:!1,placeable:!1,occluded:!1}),ar};ps(()=>Qi(zs,zt.iconBox,o.an.horizontal),()=>{const On=zt.verticalTextBox;return h.allowVerticalPlacement&&(!Hi||!Hi.placeable)&&st.numVerticalGlyphVertices>0&&On?Qi(On,zt.verticalIconBox,o.an.vertical):{box:null,occluded:!0,offscreen:null}}),Hi&&(Gi=Hi.placeable,Zi=Hi.offscreen);const wr=Lr(Hi&&Hi.placeable);if(!Gi&&this.prevPlacement){const On=this.prevPlacement.variableOffsets[st.crossTileID];On&&(this.variableOffsets[st.crossTileID]=On,this.markUsedJustification(h,On.anchor,st,wr))}}}if(Mi=Hi,Gi=Mi&&Mi.placeable,Zi=Mi&&Mi.offscreen,st.useRuntimeCollisionCircles){const Lr=h.text.placedSymbolArray.get(st.centerJustifiedTextSymbolIndex),ps=o.ao(h.textSizeData,U,Lr),Ta=g.get("text-padding");Xn=this.collisionIndex.placeCollisionCircles(ue,Lr,h.lineVertexArray,h.glyphOffsetArray,ps,C,R,u,we,X.predicate,st.collisionCircleDiameter,Ta,x,je),Xn.circles.length&&Xn.collisionDetected&&!u&&o.w("Collisions detected, but collision boxes are not shown"),Gi=de||Xn.circles.length>0&&!Xn.collisionDetected,Zi=Zi&&Xn.offscreen}if(zt.iconFeatureIndex&&(wa=zt.iconFeatureIndex),zt.iconBox){const Lr=ps=>this.collisionIndex.placeCollisionBox(ps,_e,D,ze,C,we,xe,S,X.predicate,je,ge&&qi?qi:void 0,St);rr&&rr.placeable&&zt.verticalIconBox?(sr=Lr(zt.verticalIconBox),ln=sr.placeable):(sr=Lr(zt.iconBox),ln=sr.placeable),Zi=Zi&&sr.offscreen}const wl=oe||st.numHorizontalGlyphVertices===0&&st.numVerticalGlyphVertices===0,Tl=ae||st.numIconVertices===0;wl||Tl?Tl?wl||(ln=ln&&Gi):Gi=ln&&Gi:ln=Gi=ln&&Gi;const Io=ln&&sr.placeable;if(Gi&&Mi.placeable&&this.collisionIndex.insertCollisionBox(Mi.box,ue,g.get("text-ignore-placement"),h.bucketInstanceId,rr&&rr.placeable&&ba?ba:xa,X.ID),Io&&this.collisionIndex.insertCollisionBox(sr.box,_e,g.get("icon-ignore-placement"),h.bucketInstanceId,wa,X.ID),Xn&&Gi&&this.collisionIndex.insertCollisionCircles(Xn.circles,ue,g.get("text-ignore-placement"),h.bucketInstanceId,xa,X.ID),u&&this.storeCollisionData(h.bucketInstanceId,_i,zt,Mi,sr,Xn),st.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[st.crossTileID]=new la((Gi||Be)&&!Mi?.occluded,(ln||De)&&!sr?.occluded,Zi||h.justReloaded),i[st.crossTileID]=!0};if(Ce){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const st=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let zt=st.length-1;zt>=0;--zt){const _i=st[zt];wt(h.symbolInstances.get(_i),h.collisionArrays[_i],_i)}}else for(let st=e.symbolInstanceStart;st<e.symbolInstanceEnd;st++)wt(h.symbolInstances.get(st),h.collisionArrays[st],st);h.justReloaded=!1}storeCollisionData(e,i,u,h,g,x){if(u.textBox||u.iconBox){let S,C;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(i)?C=S.get(i):(C={text:null,icon:null},S.set(i,C)),u.textBox&&(C.text=h.box),u.iconBox&&(C.icon=g.box)}if(x){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=[]);for(let C=0;C<x.circles.length;C+=4)S.push(x.circles[C+0]-Ji),S.push(x.circles[C+1]-Ji),S.push(x.circles[C+2]),S.push(x.collisionDetected?1:0)}}markUsedJustification(e,i,u,h){let g;g=h===o.an.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[o.aF(i)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=g>=0&&S!==g?0:u.crossTileID)}markUsedOrientation(e,i,u){const h=i===o.an.horizontal||i===o.an.horizontalOnly?i:0,g=i===o.an.vertical?i:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of x)e.text.placedSymbolArray.get(S).placedOrientation=h;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let u=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const h=i?i.symbolFadeChange(e):1,g=i?i.opacities:{},x=i?i.variableOffsets:{},S=i?i.placedOrientations:{};for(const C in this.placements){const R=this.placements[C],D=g[C];D?(this.opacities[C]=new Or(D,h,R.text,R.icon),u=u||R.text!==D.text.placed||R.icon!==D.icon.placed):(this.opacities[C]=new Or(null,h,R.text,R.icon,R.skipFade),u=u||R.text||R.icon)}for(const C in g){const R=g[C];if(!this.opacities[C]){const D=new Or(R,h,!1,!1);D.isHidden()||(this.opacities[C]=D,u=u||R.text.placed||R.icon.placed)}}for(const C in x)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=x[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const u={};for(const h of i){const g=h.getBucket(e);g&&h.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,h.tileID,u,h.collisionBoxArray)}}updateBucketOpacities(e,i,u,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],x=g.layout,S=new Or(null,0,!1,!1,!0),C=x.get("text-allow-overlap"),R=x.get("icon-allow-overlap"),D=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=x.get("text-rotation-alignment")==="map",F=x.get("text-pitch-alignment")==="map",U=x.get("icon-text-fit")!=="none",X=new Or(null,0,C&&(R||!e.hasIconData()||x.get("icon-optional")),R&&(C||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const oe=(ue,de,_e)=>{for(let me=0;me<de/4;me++)ue.opacityVertexArray.emplaceBack(_e);ue.hasVisibleVertices=ue.hasVisibleVertices||_e!==Er},ae=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ue=0;ue<e.symbolInstances.length;ue++){const de=e.symbolInstances.get(ue),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:me,crossTileID:xe}=de;let we=this.opacities[xe];u[xe]?we=S:we||(we=X,this.opacities[xe]=we),u[xe]=!0;const ge=de.numIconVertices>0,Ce=this.placedOrientations[de.crossTileID],Be=Ce===o.an.vertical,De=Ce===o.an.horizontal||Ce===o.an.horizontalOnly;if(_e>0||me>0){const je=Kr(we.text);oe(e.text,_e,Be?Er:je),oe(e.text,me,De?Er:je);const St=we.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(zt=>{zt>=0&&(e.text.placedSymbolArray.get(zt).hidden=St||Be?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=St||De?1:0);const wt=this.variableOffsets[de.crossTileID];wt&&this.markUsedJustification(e,wt.anchor,de,Ce);const st=this.placedOrientations[de.crossTileID];st&&(this.markUsedJustification(e,"left",de,st),this.markUsedOrientation(e,st,de))}if(ge){const je=Kr(we.icon),St=!(U&&de.verticalPlacedIconSymbolIndex&&Be);de.placedIconSymbolIndex>=0&&(oe(e.icon,de.numIconVertices,St?je:Er),e.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=we.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(oe(e.icon,de.numVerticalIconVertices,St?Er:je),e.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}const ze=ae&&ae.has(ue)?ae.get(ue):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const je=e.collisionArrays[ue];if(je){let St=new o.P(0,0);if(je.textBox||je.verticalTextBox){let wt=!0;if(D){const st=this.variableOffsets[xe];st?(St=Gs(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale),B&&St._rotate(F?-this.transform.bearingInRadians:this.transform.bearingInRadians)):wt=!1}if(je.textBox||je.verticalTextBox){let st;je.textBox&&(st=Be),je.verticalTextBox&&(st=De),os(e.textCollisionBox.collisionVertexArray,we.text.placed,!wt||st,ze.text,St.x,St.y)}}if(je.iconBox||je.verticalIconBox){const wt=!!(!De&&je.verticalIconBox);let st;je.iconBox&&(st=wt),je.verticalIconBox&&(st=!wt),os(e.iconCollisionBox.collisionVertexArray,we.icon.placed,st,ze.icon,U?St.x:0,U?St.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const u=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function os(m,e,i,u,h,g){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-Ji,S=u[1]-Ji,C=u[2]-Ji,R=u[3]-Ji;m.emplaceBack(e?1:0,i?1:0,h||0,g||0,x,S),m.emplaceBack(e?1:0,i?1:0,h||0,g||0,C,S),m.emplaceBack(e?1:0,i?1:0,h||0,g||0,C,R),m.emplaceBack(e?1:0,i?1:0,h||0,g||0,x,R)}const ls=Math.pow(2,25),ws=Math.pow(2,24),$l=Math.pow(2,17),Zl=Math.pow(2,16),$o=Math.pow(2,9),$s=Math.pow(2,8),La=Math.pow(2,1);function Kr(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,i=Math.floor(127*m.opacity);return i*ls+e*ws+i*$l+e*Zl+i*$o+e*$s+i*La+e}const Er=0;class Hl{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,u,h,g){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(x,h,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<x.length;)if(i.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,g())return!0;return!1}}class Zs{constructor(e,i,u,h,g,x,S,C){this.placement=new qs(e,i,x,S,C),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,i,u){const h=ce.now(),g=()=>!this._forceFullPlacement&&ce.now()-h>2;for(;this._currentPlacementIndex>=0;){const x=i[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Hl(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ua=512/o.$/2;class Zo{constructor(e,i,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const h=new Map;for(let g=0;g<i.length;g++){const x=i.get(g),S=x.key,C=h.get(S);C?C.push(x):h.set(S,[x])}for(const[g,x]of h){const S={positions:x.map(C=>({x:Math.floor(C.anchorX*ua),y:Math.floor(C.anchorY*ua)})),crossTileIDs:x.map(C=>C.crossTileID)};if(S.positions.length>128){const C=new o.aH(S.positions.length,16,Uint16Array);for(const{x:R,y:D}of S.positions)C.add(R,D);C.finish(),delete S.positions,S.index=C}this._symbolsByKey[g]=S}}getScaledCoordinates(e,i){const{x:u,y:h,z:g}=this.tileID.canonical,{x,y:S,z:C}=i.canonical,R=ua/Math.pow(2,C-g),D=(S*o.$+e.anchorY)*R,B=h*o.$*ua;return{x:Math.floor((x*o.$+e.anchorX)*R-u*o.$*ua),y:Math.floor(D-B)}}findMatches(e,i,u){const h=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let g=0;g<e.length;g++){const x=e.get(g);if(x.crossTileID)continue;const S=this._symbolsByKey[x.key];if(!S)continue;const C=this.getScaledCoordinates(x,i);if(S.index){const R=S.index.range(C.x-h,C.y-h,C.x+h,C.y+h).sort();for(const D of R){const B=S.crossTileIDs[D];if(!u[B]){u[B]=!0,x.crossTileID=B;break}}}else if(S.positions)for(let R=0;R<S.positions.length;R++){const D=S.positions[R],B=S.crossTileIDs[R];if(Math.abs(D.x-C.x)<=h&&Math.abs(D.y-C.y)<=h&&!u[B]){u[B]=!0,x.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ho{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const u in this.indexes){const h=this.indexes[u],g={};for(const x in h){const S=h[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+i),g[S.tileID.key]=S}this.indexes[u]=g}this.lng=e}addBucket(e,i,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<i.symbolInstances.length;g++)i.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const h=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>e.overscaledZ)for(const S in x){const C=x[S];C.tileID.isChildOf(e)&&C.findMatches(i.symbolInstances,e,h)}else{const S=x[e.scaledTo(Number(g)).key];S&&S.findMatches(i.symbolInstances,e,h)}}for(let g=0;g<i.symbolInstances.length;g++){const x=i.symbolInstances.get(g);x.crossTileID||(x.crossTileID=u.generate(),h[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Zo(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const u of i.getCrossTileIDsLists())for(const h of u)delete this.usedCrossTileIDs[e][h]}removeStaleBuckets(e){let i=!1;for(const u in this.indexes){const h=this.indexes[u];for(const g in h)e[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,h[g]),delete h[g],i=!0)}return i}}class Da{constructor(){this.layerIndexes={},this.crossTileIDs=new Ho,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,u){let h=this.layerIndexes[e.id];h===void 0&&(h=this.layerIndexes[e.id]=new Xl);let g=!1;const x={};h.handleWrapJump(u);for(const S of i){const C=S.getBucket(e);C&&e.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(S.tileID,C,this.crossTileIDs)&&(g=!0),x[C.bucketInstanceId]=!0)}return h.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(e){const i={};e.forEach(u=>{i[u]=!0});for(const u in this.layerIndexes)i[u]||delete this.layerIndexes[u]}}var Ts="void main() {fragColor=vec4(1.0);}";const Fr={prelude:yi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:yi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:yi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:yi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:yi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:yi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:yi(Ts,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:yi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:yi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:yi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:yi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:yi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:yi(Ts,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:yi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:yi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:yi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:yi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:yi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:yi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:yi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:yi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:yi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:yi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:yi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:yi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:yi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:yi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:yi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:yi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:yi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:yi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:yi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:yi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:yi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function yi(m,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(h):h,S={};return{fragmentSource:m=m.replace(i,(C,R,D,B,F)=>(S[F]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${D} ${B} ${F};
#else
uniform ${D} ${B} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${D} ${B} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(i,(C,R,D,B,F)=>{const U=B==="float"?"vec2":"vec4",X=F.match(/color/)?"color":U;return S[F]?R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${D} ${U} a_${F};
out ${D} ${B} ${F};
#else
uniform ${D} ${B} u_${F};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${D} ${B} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${X}(a_${F}, u_${F}_t);
#else
    ${D} ${B} ${F} = u_${F};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${D} ${U} a_${F};
#else
uniform ${D} ${B} u_${F};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${D} ${B} ${F} = a_${F};
#else
    ${D} ${B} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${D} ${B} ${F} = unpack_mix_${X}(a_${F}, u_${F}_t);
#else
    ${D} ${B} ${F} = u_${F};
#endif
`}),staticAttributes:u,staticUniforms:x}}class Jr{constructor(e,i,u){this.vertexBuffer=e,this.indexBuffer=i,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var us=o.aI([{name:"a_pos",type:"Int16",components:2}]);const cs="#define PROJECTION_MERCATOR",$i="mercator";class hs{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return $i}get shaderDefine(){return cs}get shaderPreludeCode(){return Fr.projectionMercator}get vertexShaderPreludeCode(){return Fr.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,u,h,g){if(this._cachedMesh)return this._cachedMesh;const x=new o.aK;x.emplaceBack(0,0),x.emplaceBack(o.$,0),x.emplaceBack(0,o.$),x.emplaceBack(o.$,o.$);const S=e.createVertexBuffer(x,us.members),C=o.aL.simpleSegment(0,0,4,2),R=new o.aM;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const D=e.createIndexBuffer(R);return this._cachedMesh=new Jr(S,D,C),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Cr{constructor(e=0,i=0,u=0,h=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(u)||u<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=u,this.right=h}interpolate(e,i,u){return i.top!=null&&e.top!=null&&(this.top=o.C.number(e.top,i.top,u)),i.bottom!=null&&e.bottom!=null&&(this.bottom=o.C.number(e.bottom,i.bottom,u)),i.left!=null&&e.left!=null&&(this.left=o.C.number(e.left,i.left,u)),i.right!=null&&e.right!=null&&(this.right=o.C.number(e.right,i.right,u)),this}getCenter(e,i){const u=o.ag((this.left+e-this.right)/2,0,e),h=o.ag((this.top+i-this.bottom)/2,0,i);return new o.P(u,h)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Cr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Br(m,e){if(!m.renderWorldCopies||m.lngRange)return;const i=e.lng-m.center.lng;e.lng+=i>180?-360:i<-180?360:0}function ai(m){return Math.max(0,Math.floor(m))}class Un{constructor(e,i,u,h,g,x){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=h??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ai(this._zoom),this._scale=o.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Cr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,u){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ai(this._zoom),this._scale=o.ae(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Cr(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=o.aN(e,-180,180)*Math.PI/180;var u,h,g,x,S,C,R,D,B;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=re(),u=this._rotationMatrix,g=-this._bearingInRadians,x=(h=this._rotationMatrix)[0],S=h[1],C=h[2],R=h[3],D=Math.sin(g),B=Math.cos(g),u[0]=x*B+C*D,u[1]=S*B+R*D,u[2]=x*-D+C*B,u[3]=S*-D+R*B)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=o.ag(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aO(this._fovInRadians)}setFov(e){e=o.ag(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.ad(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=o.ae(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,u){this._unmodified=!1,this._edgeInsets.interpolate(e,i,u),this._constrain(),this._calcMatrices()}resize(e,i,u=!0){this._width=e,this._height=i,u&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Te([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-o.ah,o.ah])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{const{minX:u,minY:h,maxX:g,maxY:x}=o.a1.fromPoints(i).extend(e);return[new o.P(u,h),new o.P(g,h),new o.P(g,x),new o.P(u,x),new o.P(u,h)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:u}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.af(new Float64Array(16));o.N(e,e,[this._width/2,-this._height/2,1]),o.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.af(new Float64Array(16)),o.N(e,e,[1,-1,1]),o.M(e,e,[-1,-1,0]),o.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,u,h){const g=u!==void 0?u:this.bearing,x=h=h!==void 0?h:this.pitch,S=o.a0.fromLngLat(e,i),C=-Math.cos(o.ad(x)),R=Math.sin(o.ad(x)),D=R*Math.sin(o.ad(g)),B=-R*Math.cos(o.ad(g));let F=this.elevation;const U=i-F;let X;C*U>=0||Math.abs(C)<.1?(X=1e4,F=i+X*C):X=-U/C;let oe,ae,ue=o.aP(1,S.y),de=0;do{if(de+=1,de>10)break;ae=X/ue,oe=new o.a0(S.x+D*ae,S.y+B*ae),ue=1/oe.meterInMercatorCoordinateUnits()}while(Math.abs(X-ae*ue)>1e-12);return{center:oe.toLngLat(),elevation:F,zoom:o.aj(this.height/2/Math.tan(this.fovInRadians/2)/ae/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=o.ai(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/i,h=o.a0.fromLngLat(this.center,this.elevation),g=pe(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;const x=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),o.aP(g.z,h.y),this.bearing,this.pitch);this._elevation=x.elevation,this._center=x.center,this.setZoom(x.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=o.ai(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/o.$,1/i/o.$]}}class Hs{constructor(e,i){this.min=e,this.max=i,this.center=o.aQ([],o.aR([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],u=o.aS(this.min),h=o.aS(this.max);for(let g=0;g<i.length;g++)u[g]=i[g]?this.min[g]:this.center[g],h[g]=i[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Hs(u,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let u=0;u<e.planes.length;u++){const h=this.intersectsPlane(e.planes[u]);if(h===0)return 0;h===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],u=e[3];for(let h=0;h<3;h++)e[h]>0?(i+=e[h]*this.min[h],u+=e[h]*this.max[h]):(u+=e[h]*this.min[h],i+=e[h]*this.max[h]);return i>=0?2:u<0?0:1}}class Xo{distanceToTile2d(e,i,u,h){const g=h.distanceX([e,i]),x=h.distanceY([e,i]);return Math.hypot(g,x)}getWrap(e,i,u){return u}getTileBoundingVolume(e,i,u,h){var g,x;let S=u,C=u;if(h?.terrain){const D=new o.Z(e.z,i,e.z,e.x,e.y),B=h.terrain.getMinMaxElevation(D);S=(g=B.minElevation)!==null&&g!==void 0?g:u,C=(x=B.maxElevation)!==null&&x!==void 0?x:u}const R=1<<e.z;return new Hs([i+e.x/R,e.y/R,S],[i+(e.x+1)/R,(e.y+1)/R,C])}allowVariableZoom(e,i){const u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,h=o.ag(78.5-u/2,0,60);return!!i.terrain||e.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class Gn{constructor(e,i,u){this.points=e,this.planes=i,this.aabb=u}static fromInvProjectionMatrix(e,i=1,u=0,h,g){const x=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,u),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(F=>function(U,X,oe,ae){const ue=o.av([],U,X),de=1/ue[3]/oe*ae;return o.aX(ue,ue,[de,de,1/ue[3],de])}(F,e,i,S));h&&function(F,U,X,oe){const ae=oe?4:0,ue=oe?0:4;let de=0;const _e=[],me=[];for(let ge=0;ge<4;ge++){const Ce=o.aT([],F[ge+ue],F[ge+ae]),Be=o.aY(Ce);o.aQ(Ce,Ce,1/Be),_e.push(Be),me.push(Ce)}for(let ge=0;ge<4;ge++){const Ce=o.aZ(F[ge+ae],me[ge],X);de=Ce!==null&&Ce>=0?Math.max(de,Ce):Math.max(de,_e[ge])}const xe=function(ge,Ce){const Be=o.aT([],ge[Ce[0]],ge[Ce[1]]),De=o.aT([],ge[Ce[2]],ge[Ce[1]]),ze=[0,0,0,0];return o.aU(ze,o.aV([],Be,De)),ze[3]=-o.aW(ze,ge[Ce[0]]),ze}(F,U),we=function(ge,Ce){const Be=o.a_(ge),De=o.a$([],ge,1/Be),ze=o.aT([],Ce,o.aQ([],De,o.aW(Ce,De))),je=o.a_(ze);if(je>0){const St=Math.sqrt(1-De[3]*De[3]),wt=o.aQ([],De,-De[3]),st=o.aR([],wt,o.aQ([],ze,St/je));return o.b0(Ce,st)}return null}(X,xe);if(we!==null){const ge=we/o.aW(me[0],xe);de=Math.min(de,ge)}for(let ge=0;ge<4;ge++){const Ce=Math.min(de,_e[ge]);F[ge+ue]=[F[ge+ae][0]+me[ge][0]*Ce,F[ge+ae][1]+me[ge][1]*Ce,F[ge+ae][2]+me[ge][2]*Ce,1]}}(C,x[0],h,g);const R=x.map(F=>{const U=o.aT([],C[F[0]],C[F[1]]),X=o.aT([],C[F[2]],C[F[1]]),oe=o.aU([],o.aV([],U,X)),ae=-o.aW(oe,C[F[1]]);return oe.concat(ae)}),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],B=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const F of C)for(let U=0;U<3;U++)D[U]=Math.min(D[U],F[U]),B[U]=Math.max(B[U],F[U]);return new Gn(C,R,new Hs(D,B))}}class pn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,u=!0){this._helper.resize(e,i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,u,h,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(x,S)=>this.getConstrained(x,S)},e,i,u,h,g),this._coveringTilesDetailsProvider=new Xo}clone(){const e=new pn;return e.apply(this),e}apply(e,i,u){this._helper.apply(e,i,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new o.b1(0,e)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new o.P(0,0)),h=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),S=Math.floor(Math.min(u.x,h.x,g.x,x.x)),C=Math.floor(Math.max(u.x,h.x,g.x,x.x)),R=1;for(let D=S-R;D<=C+R;D++)D!==0&&i.push(new o.b1(D,e))}return i}getCameraFrustum(){return Gn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,i){const u=o.ai(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(i,u),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),x=o.a0.fromLngLat(e),S=new o.a0(x.x-(h.x-g.x),x.y-(h.y-g.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(o.a0.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a0.fromLngLat(e))}screenPointToLocation(e,i){var u;return(u=this.screenPointToMercatorCoordinate(e,i))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const u=i.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const u=i||0,h=[e.x,e.y,0,1],g=[e.x,e.y,1,1];o.av(h,h,this._pixelMatrixInverse),o.av(g,g,this._pixelMatrixInverse);const x=h[3],S=g[3],C=h[1]/x,R=g[1]/S,D=h[2]/x,B=g[2]/S,F=D===B?0:(u-D)/(B-D);return new o.a0(o.C.number(h[0]/x,g[0]/S,F)/this.worldSize,o.C.number(C,R,F)/this.worldSize,u)}coordinatePoint(e,i=0,u=this._pixelMatrix){const h=[e.x*this.worldSize,e.y*this.worldSize,i,1];return o.av(h,h,u),new o.P(h[0]/h[3],h[1]/h[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ee(this));return new Te().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-ee(this)}calculatePosMatrix(e,i=!1,u){var h;const g=(h=e.key)!==null&&h!==void 0?h:o.b2(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),x=i?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(g)){const R=x.get(g);return u?R.f32:R.f64}const S=Q(e,this.worldSize);o.O(S,i?this._alignedProjMatrix:this._viewProjMatrix,S);const C={f64:S,f32:new Float32Array(S)};return x.set(g,C),u?C.f32:C.f64}calculateFogMatrix(e){const i=e.key,u=this._fogMatrixCacheF32;if(u.has(i))return u.get(i);const h=Q(e,this.worldSize);return o.O(h,this._fogMatrix,h),u.set(i,new Float32Array(h)),u.get(i)}getConstrained(e,i){i=o.ag(+i,this.minZoom,this.maxZoom);const u={center:new o.S(e.lng,e.lat),zoom:i};let h=this._helper._lngRange;if(!this._helper._renderWorldCopies&&h===null){const _e=179.9999999999;h=[-_e,_e]}const g=this.tileSize*o.ae(u.zoom);let x=0,S=g,C=0,R=g,D=0,B=0;const{x:F,y:U}=this.size;if(this._helper._latRange){const _e=this._helper._latRange;x=o.U(_e[1])*g,S=o.U(_e[0])*g,S-x<U&&(D=U/(S-x))}h&&(C=o.aN(o.V(h[0])*g,0,g),R=o.aN(o.V(h[1])*g,0,g),R<C&&(R+=g),R-C<F&&(B=F/(R-C)));const{x:X,y:oe}=Ee(g,e);let ae,ue;const de=Math.max(B||0,D||0);if(de){const _e=new o.P(B?(R+C)/2:X,D?(S+x)/2:oe);return u.center=W(g,_e).wrap(),u.zoom+=o.aj(de),u}if(this._helper._latRange){const _e=U/2;oe-_e<x&&(ue=x+_e),oe+_e>S&&(ue=S-_e)}if(h){const _e=(C+R)/2;let me=X;this._helper._renderWorldCopies&&(me=o.aN(X,_e-g/2,_e+g/2));const xe=F/2;me-xe<C&&(ae=C+xe),me+xe>R&&(ae=R-xe)}if(ae!==void 0||ue!==void 0){const _e=new o.P(ae??X,ue??oe);u.center=W(g,_e).wrap()}return u}calculateCenterFromCameraLngLatAlt(e,i,u,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,h)}_calculateNearFarZIfNeeded(e,i,u){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-h*this._helper._pixelPerMeter/Math.cos(i),x=h<0?g:e,S=Math.PI/2+this.pitchInRadians,C=o.ad(this.fov)*(Math.abs(Math.cos(o.ad(this.roll)))*this.height+Math.abs(Math.sin(o.ad(this.roll)))*this.width)/this.height*(.5+u.y/this.height),R=Math.sin(C)*x/Math.sin(o.ag(Math.PI-S-C,.01,Math.PI-.01)),D=ee(this),B=Math.atan(D/this._helper.cameraToCenterDistance),F=o.ad(.75),U=B>F?2*B*(.5+u.y/(2*D)):F,X=Math.sin(U)*x/Math.sin(o.ag(Math.PI-S-U,.01,Math.PI-.01)),oe=Math.min(R,X);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*oe+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=Ee(this.worldSize,this.center),u=i.x,h=i.y;this._helper._pixelPerMeter=o.ai(1,this.center.lat)*this.worldSize;const g=o.ad(Math.min(this.pitch,Zt)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let S;this._calculateNearFarZIfNeeded(x,g,e),S=new Float64Array(16),o.b3(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.ap(this._invProjMatrix,S),S[8]=2*-e.x/this._helper._width,S[9]=2*e.y/this._helper._height,this._projectionMatrix=o.b4(S),o.N(S,S,[1,-1,1]),o.M(S,S,[0,0,-this._helper.cameraToCenterDistance]),o.b5(S,S,-this.rollInRadians),o.b6(S,S,this.pitchInRadians),o.b5(S,S,-this.bearingInRadians),o.M(S,S,[-u,-h,0]),this._mercatorMatrix=o.N([],S,[this.worldSize,this.worldSize,this.worldSize]),o.N(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),o.M(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=o.ap([],S);const C=[0,0,-1,1];o.av(C,C,this._invViewProjMatrix),this._cameraPosition=[C[0]/C[3],C[1]/C[3],C[2]/C[3]],this._fogMatrix=new Float64Array(16),o.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-u,-h,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const R=this._helper._width%2/2,D=this._helper._height%2/2,B=Math.cos(this.bearingInRadians),F=Math.sin(-this.bearingInRadians),U=u-Math.round(u)+B*R+F*D,X=h-Math.round(h)+B*D+F*R,oe=new Float64Array(S);if(o.M(oe,oe,[U>.5?U-1:U,X>.5?X-1:X,0]),this._alignedProjMatrix=oe,S=o.ap(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new o.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.av(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=o.ai(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const u=o.a0.fromLngLat(e),h=[u.x*this.worldSize,u.y*this.worldSize,i,1];return o.av(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(e){const{overscaledTileID:i,aligned:u,applyTerrainMatrix:h}=e,g=this._helper.getMercatorTileCoordinates(i),x=i?this.calculatePosMatrix(i,u,!0):null;let S;return S=i&&i.terrainRttPosMatrix32f&&h?i.terrainRttPosMatrix32f:x||o.b7(),{mainMatrix:S,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,u){return 1}transformLightDirection(e){return o.aS(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,u,h){const g=this.calculatePosMatrix(u);let x;h?(x=[e,i,h(e,i),1],o.av(x,x,g)):(x=[e,i,0,1],Vs(x,x,g));const S=x[3];return{point:new o.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const u=o.a0.fromLngLat(e,i),h=u.meterInMercatorCoordinateUnits(),g=o.b8();return o.M(g,g,[u.x,u.y,u.z]),o.b5(g,g,Math.PI),o.b6(g,g,Math.PI/2),o.N(g,g,[-h,h,h]),g}getProjectionDataForCustomLayer(e=!0){const i=new o.Z(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),h=Q(i,this.worldSize);o.O(h,this._viewProjMatrix,h),u.tileMercatorCoords=[0,0,1,1];const g=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],x=o.b9();return o.N(x,h,g),u.fallbackMatrix=x,u.mainMatrix=x,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function In(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function An(m){if(m.useSlerp)if(m.k<1){const e=o.ba(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),i=o.ba(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),u=new Float64Array(4);o.bb(u,e,i,m.k);const h=o.bc(u);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(o.C.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(o.C.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(o.C.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Wi(m,e,i,u,h){const g=h.padding,x=Ee(h.worldSize,i.getNorthWest()),S=Ee(h.worldSize,i.getNorthEast()),C=Ee(h.worldSize,i.getSouthEast()),R=Ee(h.worldSize,i.getSouthWest()),D=o.ad(-u),B=x.rotate(D),F=S.rotate(D),U=C.rotate(D),X=R.rotate(D),oe=new o.P(Math.max(B.x,F.x,X.x,U.x),Math.max(B.y,F.y,X.y,U.y)),ae=new o.P(Math.min(B.x,F.x,X.x,U.x),Math.min(B.y,F.y,X.y,U.y)),ue=oe.sub(ae),de=(h.width-(g.left+g.right+e.left+e.right))/ue.x,_e=(h.height-(g.top+g.bottom+e.top+e.bottom))/ue.y;if(_e<0||de<0)return void In();const me=Math.min(o.aj(h.scale*Math.min(de,_e)),m.maxZoom),xe=o.P.convert(m.offset),we=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.ad(u)),ge=xe.add(we).mult(h.scale/o.ae(me));return{center:W(h.worldSize,x.add(C).div(2).sub(ge)),zoom:me,bearing:u}}class Ri{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,u){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,i,u,h,g){return Wi(e,i,u,h,g)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(o.S.convert(i.center))}handleEaseTo(e,i){const u=e.zoom,h=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},x={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},S=i.zoom!==void 0,C=!e.isPaddingEqual(i.padding);let R=!1;const D=S?+i.zoom:e.zoom;let B=e.centerPoint.add(i.offsetAsPoint);const F=e.screenPointToLocation(B),{center:U,zoom:X}=e.getConstrained(o.S.convert(i.center||F),D??u);Br(e,U);const oe=Ee(e.worldSize,F),ae=Ee(e.worldSize,U).sub(oe),ue=o.ae(X-u);return R=X!==u,{easeFunc:de=>{if(R&&e.setZoom(o.C.number(u,X,de)),o.bd(g,x)||An({startEulerAngles:g,endEulerAngles:x,tr:e,k:de,useSlerp:g.roll!=x.roll}),C&&(e.interpolatePadding(h,i.padding,de),B=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const _e=o.ae(e.zoom-u),me=X>u?Math.min(2,ue):Math.max(.5,ue),xe=Math.pow(me,1-de),we=W(e.worldSize,oe.add(ae.mult(de*xe)).mult(_e));e.setLocationAtPoint(e.renderWorldCopies?we.wrap():we,B)}},isZooming:R,elevationCenter:U}}handleFlyTo(e,i){const u=i.zoom!==void 0,h=e.zoom,g=e.getConstrained(o.S.convert(i.center||i.locationAtOffset),u?+i.zoom:h),x=g.center,S=g.zoom;Br(e,x);const C=Ee(e.worldSize,i.locationAtOffset),R=Ee(e.worldSize,x).sub(C),D=R.mag(),B=o.ae(S-h);let F;if(i.minZoom!==void 0){const U=Math.min(+i.minZoom,h,S),X=e.getConstrained(x,U).zoom;F=o.ae(X-h)}return{easeFunc:(U,X,oe,ae)=>{e.setZoom(U===1?S:h+o.aj(X));const ue=U===1?x:W(e.worldSize,C.add(R.mult(oe)).mult(X));e.setLocationAtPoint(e.renderWorldCopies?ue.wrap():ue,ae)},scaleOfZoom:B,targetCenter:x,scaleOfMinZoom:F,pixelPathLength:D}}}class di{constructor(e,i,u){this.blendFunction=e,this.blendColor=i,this.mask=u}}di.Replace=[1,0],di.disabled=new di(di.Replace,o.be.transparent,[!1,!1,!1,!1]),di.unblended=new di(di.Replace,o.be.transparent,[!0,!0,!0,!0]),di.alphaBlended=new di([1,771],o.be.transparent,[!0,!0,!0,!0]);const qn=2305;class ci{constructor(e,i,u){this.enable=e,this.mode=i,this.frontFace=u}}ci.disabled=new ci(!1,1029,qn),ci.backCCW=new ci(!0,1029,qn),ci.frontCCW=new ci(!0,1028,qn);class hi{constructor(e,i,u){this.func=e,this.mask=i,this.range=u}}hi.ReadOnly=!1,hi.ReadWrite=!0,hi.disabled=new hi(519,hi.ReadOnly,[0,1]);const Ss=7680;class Vt{constructor(e,i,u,h,g,x){this.test=e,this.ref=i,this.mask=u,this.fail=h,this.depthFail=g,this.pass=x}}Vt.disabled=new Vt({func:519,mask:0},0,0,Ss,Ss,Ss);const Is=new WeakMap;function zn(m){var e;if(Is.has(m))return Is.get(m);{const i=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Is.set(m,i),i}}class Xs{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,u=i.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const h=new o.aK;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const g=new o.aM;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Jr(i.createVertexBuffer(h,us.members),i.createIndexBuffer(g),o.aL.simpleSegment(0,0,h.length,g.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(u.TEXTURE1);const x=u.createTexture();u.bindTexture(u.TEXTURE_2D,x),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),zn(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const u=this._cachedRenderContext.context,h=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:o.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,h.TRIANGLES,hi.disabled,Vt.disabled,di.unblended,ci.disabled,((g,x)=>({u_input:g,u_output_expected:x}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&zn(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const g=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&zn(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Xs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const tr=o.$/128;function Wo(m,e){const i=m.granularity!==void 0?Math.max(m.granularity,1):1,u=i+(m.generateBorders?2:0),h=i+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=u+1,x=h+1,S=m.generateBorders?-1:0,C=m.generateBorders||m.extendToNorthPole?-1:0,R=i+(m.generateBorders?1:0),D=i+(m.generateBorders||m.extendToSouthPole?1:0),B=g*x,F=u*h*6,U=g*x>65536;if(U&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const X=U||e==="32bit",oe=new Int16Array(2*B);let ae=0;for(let _e=C;_e<=D;_e++)for(let me=S;me<=R;me++){let xe=me/i*o.$;me===-1&&(xe=-tr),me===i+1&&(xe=o.$+tr);let we=_e/i*o.$;_e===-1&&(we=m.extendToNorthPole?o.bg:-tr),_e===i+1&&(we=m.extendToSouthPole?o.bh:o.$+tr),oe[ae++]=xe,oe[ae++]=we}const ue=X?new Uint32Array(F):new Uint16Array(F);let de=0;for(let _e=0;_e<h;_e++)for(let me=0;me<u;me++){const xe=me+1+_e*g,we=me+(_e+1)*g,ge=me+1+(_e+1)*g;ue[de++]=me+_e*g,ue[de++]=we,ue[de++]=xe,ue[de++]=xe,ue[de++]=we,ue[de++]=ge}return{vertices:oe.buffer.slice(0),indices:ue.buffer.slice(0),uses32bitIndices:X}}const jr=new o.aJ({fill:new o.bi(128,2),line:new o.bi(512,0),tile:new o.bi(128,32),stencil:new o.bi(128,1),circle:3});class Qr{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Fr.projectionGlobe}get vertexShaderPreludeCode(){return Fr.projectionMercator.vertexSource}get subdivisionGranularity(){return jr}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Xs(e));const i=o.U(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(i,u),g=ce.now();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=g);const x=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bk(x))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,u,h,g){const x=(g==="stencil"?jr.stencil:jr.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:x,generateBorders:u,extendToNorthPole:i.y===0&&h,extendToSouthPole:i.y===(1<<i.z)-1&&h})}_getMesh(e,i){const u=this._getMeshKey(i);if(u in this._tileMeshCache)return this._tileMeshCache[u];const h=function(g,x){const S=Wo(x,"16bit"),C=o.aK.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),R=o.aM.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new Jr(g.createVertexBuffer(C,us.members),g.createIndexBuffer(R),o.aL.simpleSegment(0,0,C.length,R.length))}(e,i);return this._tileMeshCache[u]=h,h}recalculate(e){}hasTransition(){const e=ce.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const za=new o.r({type:new o.D(o.v.projection.type)});class Na extends o.E{constructor(e){super(),this._transitionable=new o.t(za),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new hs,this._verticalPerspectiveProjection=new Qr}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bl){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,u,h,g){return this.currentProjection.getMeshFromTileID(e,i,u,h,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function $n(m){const e=Vr(m.worldSize,m.center.lat);return 2*Math.PI*e}function Zn(m,e,i,u,h){const g=1/(1<<h),x=e/o.$*g+u*g,S=o.bn((m/o.$*g+i*g)*Math.PI*2+Math.PI,2*Math.PI),C=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,R=Math.cos(C),D=new Float64Array(3);return D[0]=Math.sin(S)*R,D[1]=Math.sin(C),D[2]=Math.cos(S)*R,D}function Rn(m){return function(e,i){const u=Math.cos(i),h=new Float64Array(3);return h[0]=Math.sin(e)*u,h[1]=Math.sin(i),h[2]=Math.cos(e)*u,h}(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Vr(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function ca(m){const e=Math.asin(m[1])/Math.PI*180,i=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(i>1e-6){const u=m[0]/i,h=Math.acos(m[2]/i),g=(u>0?h:-h)/Math.PI*180;return new o.S(o.aN(g,-180,180),e)}return new o.S(0,e)}function Ur(m){return Math.cos(m*Math.PI/180)}function Tn(m,e){const i=Ur(m),u=Ur(e);return o.aj(u/i)}function hr(m,e){const i=m.rotate(e.bearingInRadians),u=e.zoom+Tn(e.center.lat,0),h=o.bj(1/Ur(e.center.lat),1/Ur(Math.min(Math.abs(e.center.lat),60)),o.bm(u,7,3,0,1)),g=360/$n({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.S(e.center.lng-i.x*g*h,o.ag(e.center.lat+i.y*g,-o.ah,o.ah))}function Ws(m){const e=.5*m,i=Math.sin(e),u=Math.cos(e);return Math.log(i+u)-Math.log(u-i)}function ha(m,e,i,u){const h=m.lat+i*u;if(Math.abs(i)>1){const g=(Math.sign(m.lat+i)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,x=Math.abs(m.lat+i)*Math.PI/180,S=Ws(g+u*(x-g)),C=Ws(g),R=Ws(x);return new o.S(m.lng+e*((S-C)/(R-C)),h)}return new o.S(m.lng+e*u,h)}class Qu{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,i,u,h){const g=`${e.z}_${e.x}_${e.y}_${h?.terrain?"t":""}`,x=this._cache.get(g);if(x)return x;const S=this._cachePrevious.get(g);if(S)return this._cache.set(g,S),S;const C=this._boundingVolumeFactory(e,i,u,h);return this._cache.set(g,C),this._hadAnyChanges=!0,C}}class ks{constructor(e,i,u,h){this.min=u,this.max=h,this.points=e,this.planes=i}static fromAabb(e,i){const u=[];for(let h=0;h<8;h++)u.push([1&~h?e[0]:i[0],(h>>1&1)==1?i[1]:e[1],(h>>2&1)==1?i[2]:e[2]]);return new ks(u,[[-1,0,0,i[0]],[1,0,0,-e[0]],[0,-1,0,i[1]],[0,1,0,-e[1]],[0,0,-1,i[2]],[0,0,1,-e[2]]],e,i)}static fromCenterSizeAngles(e,i,u){const h=o.bq([],u[0],u[1],u[2]),g=o.br([],[i[0],0,0],h),x=o.br([],[0,i[1],0],h),S=o.br([],[0,0,i[2]],h),C=[...e],R=[...e];for(let B=0;B<8;B++)for(let F=0;F<3;F++){const U=e[F]+g[F]*(1&~B?-1:1)+x[F]*((B>>1&1)==1?1:-1)+S[F]*((B>>2&1)==1?1:-1);C[F]=Math.min(C[F],U),R[F]=Math.max(R[F],U)}const D=[];for(let B=0;B<8;B++){const F=[...e];o.aR(F,F,o.aQ([],g,1&~B?-1:1)),o.aR(F,F,o.aQ([],x,(B>>1&1)==1?1:-1)),o.aR(F,F,o.aQ([],S,(B>>2&1)==1?1:-1)),D.push(F)}return new ks(D,[[...g,-o.aW(g,D[0])],[...x,-o.aW(x,D[0])],[...S,-o.aW(S,D[0])],[-g[0],-g[1],-g[2],-o.aW(g,D[7])],[-x[0],-x[1],-x[2],-o.aW(x,D[7])],[-S[0],-S[1],-S[2],-o.aW(S,D[7])]],C,R)}intersectsFrustum(e){let i=!0;const u=this.points.length,h=this.planes.length,g=e.planes.length,x=e.points.length;for(let S=0;S<g;S++){const C=e.planes[S];let R=0;for(let D=0;D<u;D++){const B=this.points[D];C[0]*B[0]+C[1]*B[1]+C[2]*B[2]+C[3]>=0&&R++}if(R===0)return 0;R<u&&(i=!1)}if(i)return 2;for(let S=0;S<h;S++){const C=this.planes[S];let R=0;for(let D=0;D<x;D++){const B=e.points[D];C[0]*B[0]+C[1]*B[1]+C[2]*B[2]+C[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(e){const i=this.points.length;let u=0;for(let h=0;h<i;h++){const g=this.points[h];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&u++}return u===i?2:u===0?0:1}}function Oa(m,e,i){const u=m-e;return u<0?-u:Math.max(0,u-i)}function Yo(m,e,i,u,h){const g=m-i;let x;return x=g<0?Math.min(-g,1+g-h):g>1?Math.min(Math.max(g-h,0),1-g):0,Math.max(x,Oa(e,u,h))}class ec{constructor(){this._boundingVolumeCache=new Qu(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,i,u,h){const g=1<<u.z,x=1/g,S=u.x/g,C=u.y/g;let R=2;return R=Math.min(R,Yo(e,i,S,C,x)),R=Math.min(R,Yo(e,i,S+.5,-C-x,x)),R=Math.min(R,Yo(e,i,S+.5,2-C-x,x)),R}getWrap(e,i,u){const h=1<<i.z,g=1/h,x=i.x/h,S=Oa(e.x,x,g),C=Oa(e.x,x-1,g),R=Oa(e.x,x+1,g),D=Math.min(S,C,R);return D===R?1:D===C?-1:0}allowVariableZoom(e,i){return Ge(e,i)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,i,u,h){return this._boundingVolumeCache.getTileBoundingVolume(e,i,u,h)}_computeTileBoundingVolume(e,i,u,h){var g,x;let S=u,C=u;if(h?.terrain){const R=new o.Z(e.z,i,e.z,e.x,e.y),D=h.terrain.getMinMaxElevation(R);S=(g=D.minElevation)!==null&&g!==void 0?g:u,C=(x=D.maxElevation)!==null&&x!==void 0?x:u}if(S/=o.bt,C/=o.bt,S+=1,C+=1,e.z<=0)return ks.fromAabb([-C,-C,-C],[C,C,C]);if(e.z===1)return ks.fromAabb([e.x===0?-C:0,e.y===0?0:-C,-C],[e.x===0?0:C,e.y===0?C:0,C]);{const R=[Zn(0,0,e.x,e.y,e.z),Zn(o.$,0,e.x,e.y,e.z),Zn(o.$,o.$,e.x,e.y,e.z),Zn(0,o.$,e.x,e.y,e.z)],D=[];for(const ze of R)D.push(o.aQ([],ze,C));if(C!==S)for(const ze of R)D.push(o.aQ([],ze,S));e.y===0&&D.push([0,1,0]),e.y===(1<<e.z)-1&&D.push([0,-1,0]);const B=[1,1,1],F=[-1,-1,-1];for(const ze of D)for(let je=0;je<3;je++)B[je]=Math.min(B[je],ze[je]),F[je]=Math.max(F[je],ze[je]);const U=Zn(o.$/2,o.$/2,e.x,e.y,e.z),X=o.aV([],[0,1,0],U);o.aU(X,X);const oe=o.aV([],U,X);o.aU(oe,oe);const ae=o.aV([],R[2],R[1]);o.aU(ae,ae);const ue=o.aV([],R[0],R[3]);o.aU(ue,ue),D.push(o.aQ([],U,C)),e.y>=(1<<e.z)/2&&D.push(o.aQ([],Zn(o.$/2,0,e.x,e.y,e.z),C)),e.y<(1<<e.z)/2&&D.push(o.aQ([],Zn(o.$/2,o.$,e.x,e.y,e.z),C));const de=ir(U,D),_e=ir(oe,D),me=[-U[0],-U[1],-U[2],de.max],xe=[U[0],U[1],U[2],-de.min],we=[-oe[0],-oe[1],-oe[2],_e.max],ge=[oe[0],oe[1],oe[2],-_e.min],Ce=[...ae,0],Be=[...ue,0],De=[];return e.y===0?De.push(o.bs(Be,Ce,me),o.bs(Be,Ce,xe)):De.push(o.bs(we,Ce,me),o.bs(we,Ce,xe),o.bs(we,Be,me),o.bs(we,Be,xe)),e.y===(1<<e.z)-1?De.push(o.bs(Be,Ce,me),o.bs(Be,Ce,xe)):De.push(o.bs(ge,Ce,me),o.bs(ge,Ce,xe),o.bs(ge,Be,me),o.bs(ge,Be,xe)),new ks(De,[me,xe,we,ge,Ce,Be],B,F)}}}function ir(m,e){let i=1/0,u=-1/0;for(const h of e){const g=o.aW(m,h);i=Math.min(i,g),u=Math.max(u,g)}return{min:i,max:u}}class Pr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=o.bu(),this._projectionMatrix=o.b8(),this._globeViewProjMatrix32f=o.b7(),this._globeViewProjMatrixNoCorrection=o.b8(),this._globeViewProjMatrixNoCorrectionInverted=o.b8(),this._globeProjMatrixInverted=o.b8(),this._cameraPosition=o.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new ec}clone(){const e=new Pr;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=o.bo();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:u}=e,h=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,u=this.cameraToCenterDistance/e,h=Math.sin(i)*u,g=Math.cos(i)*u+1,x=1/Math.sqrt(h*h+g*g)*1;let S=-h,C=g;const R=Math.sqrt(S*S+C*C);S/=R,C/=R;const D=[0,S,C];o.bv(D,D,[0,0,0],-this.bearingInRadians),o.bw(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),o.bx(D,D,[0,0,0],this.center.lng*Math.PI/180);const B=1/o.aY(D);return o.aQ(D,D,B),[...D,-x*B]}isLocationOccluded(e){return!this.isSurfacePointVisible(Rn(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,h=Math.cos(u),g=[Math.sin(i)*h,Math.sin(u),Math.cos(i)*h],x=[g[2],0,-g[0]],S=[0,0,0];o.aV(S,x,g),o.aU(x,x),o.aU(S,S);const C=[0,0,0];return o.aU(C,[x[0]*e[0]+S[0]*e[1]+g[0]*e[2],x[1]*e[0]+S[1]*e[1]+g[1]*e[2],x[2]*e[0]+S[2]*e[1]+g[2]*e[2]]),C}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,u){const h=function(S,C,R){const D=1/(1<<R.z);return new o.a0(S/o.$*D+R.x*D,C/o.$*D+R.y*D)}(e,i,u.canonical),g=(x=h.y,[o.bn(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,i,u,h){const g=u.canonical,x=Zn(e,i,g.x,g.y,g.z),S=1+(h?h(e,i):0)/o.bt,C=[x[0]*S,x[1]*S,x[2]*S,1];o.av(C,C,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,D=R[0]*x[0]+R[1]*x[1]+R[2]*x[2]+R[3]<0;return{point:new o.P(C[0]/C[3],C[1]/C[3]),signedDistanceFromCamera:C[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Vr(this.worldSize,this.center.lat),i=o.b9(),u=o.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.b3(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;i[8]=2*-h.x/this._helper._width,i[9]=2*h.y/this._helper._height,this._projectionMatrix=o.b4(i),this._globeProjMatrixInverted=o.b9(),o.ap(this._globeProjMatrixInverted,i),o.M(i,i,[0,0,-this.cameraToCenterDistance]),o.b5(i,i,this.rollInRadians),o.b6(i,i,-this.pitchInRadians),o.b5(i,i,this.bearingInRadians),o.M(i,i,[0,0,-e]);const g=o.bo();g[0]=e,g[1]=e,g[2]=e,o.b6(u,i,this.center.lat*Math.PI/180),o.by(u,u,-this.center.lng*Math.PI/180),o.N(u,u,g),this._globeViewProjMatrixNoCorrection=u,o.b6(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.by(i,i,-this.center.lng*Math.PI/180),o.N(i,i,g),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),o.ap(this._globeViewProjMatrixNoCorrectionInverted,u);const x=o.bo();this._cameraPosition=o.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bv(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),o.bw(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),o.bv(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),o.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bw(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),o.bx(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const S=o.b4(this._globeViewProjMatrixNoCorrectionInverted);o.N(S,S,[1,1,-1]),this._cachedFrustum=Gn.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");const i=o.b9();return o.af(i),i}getVisibleUnwrappedCoordinates(e){return[new o.b1(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=Rn(e);o.aQ(u,u,1+i/o.bt);const h=o.bu();return o.av(h,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,u=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,i),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,i)],h=[];for(const B of u)h.push(this.unprojectScreenPoint(B));let g=0,x=0,S=0,C=0;const R=this.center;for(const B of h){const F=o.bz(R.lng,B.lng),U=o.bz(R.lat,B.lat);F<x&&(x=F),F>g&&(g=F),U<C&&(C=U),U>S&&(S=U)}const D=[R.lng+x,R.lat+C,R.lng+g,R.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new Te(D)}getConstrained(e,i){const u=o.ag(e.lat,-o.ah,o.ah),h=o.ag(+i,this.minZoom+Tn(0,u),this.maxZoom);return{center:new o.S(e.lng,u),zoom:h}}calculateCenterFromCameraLngLatAlt(e,i,u,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,h)}setLocationAtPoint(e,i){const u=Rn(this.unprojectScreenPoint(i)),h=Rn(e),g=o.bo();o.bA(g);const x=o.bo();o.bx(x,u,g,-this.center.lng*Math.PI/180),o.bw(x,x,g,this.center.lat*Math.PI/180);const S=h[0]*h[0]+h[2]*h[2],C=x[0]*x[0];if(S<C)return;const R=Math.sqrt(S-C),D=-R,B=o.bB(h[0],h[2],x[0],R),F=o.bB(h[0],h[2],x[0],D),U=o.bo();o.bx(U,h,g,-B);const X=o.bB(U[1],U[2],x[1],x[2]),oe=o.bo();o.bx(oe,h,g,-F);const ae=o.bB(oe[1],oe[2],x[1],x[2]),ue=.5*Math.PI,de=X>=-ue&&X<=ue,_e=ae>=-ue&&ae<=ue;let me,xe;if(de&&_e){const Be=this.center.lng*Math.PI/180,De=this.center.lat*Math.PI/180;o.bC(B,Be)+o.bC(X,De)<o.bC(F,Be)+o.bC(ae,De)?(me=B,xe=X):(me=F,xe=ae)}else if(de)me=B,xe=X;else{if(!_e)return;me=F,xe=ae}const we=me/Math.PI*180,ge=xe/Math.PI*180,Ce=this.center.lat;this.setCenter(new o.S(we,o.ag(ge,-90,90))),this.setZoom(this.zoom+Tn(Ce,this.center.lat))}locationToScreenPoint(e,i){const u=Rn(e);if(i){const h=i.getElevationForLngLatZoom(e,this._helper._tileZoom);o.aQ(u,u,1+h/o.bt)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){const i=o.bu();return o.av(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new o.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const u=i.pointCoordinate(e);if(u)return u}return o.a0.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var u;return(u=this.screenPointToMercatorCoordinate(e,i))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,i){const u=this._cameraPosition,h=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,h)}getRayDirectionFromPixel(e){const i=o.bu();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,o.av(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const u=o.bo();u[0]=i[0]-this._cameraPosition[0],u[1]=i[1]-this._cameraPosition[1],u[2]=i[2]-this._cameraPosition[2];const h=o.bo();return o.aU(h,u),h}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=o.bu();return o.av(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const u=o.aW(e,i),h=o.bo(),g=o.bo();o.aQ(g,i,u),o.aT(h,e,g);const x=1-o.aW(h,h);if(x<0)return null;const S=o.aW(e,e)-1,C=-u+(u<0?1:-1)*Math.sqrt(x),R=S/C,D=C;return{tMin:Math.min(R,D),tMax:Math.max(R,D)}}unprojectScreenPoint(e){const i=this._cameraPosition,u=this.getRayDirectionFromPixel(e),h=this.rayPlanetIntersection(i,u);if(h){const D=o.bo();o.aR(D,i,[u[0]*h.tMin,u[1]*h.tMin,u[2]*h.tMin]);const B=o.bo();return o.aU(B,D),ca(B)}const g=this._cachedClippingPlane,x=g[0]*u[0]+g[1]*u[1]+g[2]*u[2],S=-o.b0(g,i)/x,C=o.bo();if(S>0)o.aR(C,i,[u[0]*S,u[1]*S,u[2]*S]);else{const D=o.bo();o.aR(D,i,[2*u[0],2*u[1],2*u[2]]);const B=o.b0(this._cachedClippingPlane,D);o.aT(C,D,[this._cachedClippingPlane[0]*B,this._cachedClippingPlane[1]*B,this._cachedClippingPlane[2]*B])}const R=function(D){const B=o.bo();return B[0]=D[0]*-D[3],B[1]=D[1]*-D[3],B[2]=D[2]*-D[3],{center:B,radius:Math.sqrt(1-D[3]*D[3])}}(g);return ca(function(D,B,F){const U=o.bo();o.aT(U,F,D);const X=o.bo();return o.bp(X,D,U,B/o.a_(U)),X}(R.center,R.radius,C))}getMatrixForModel(e,i){const u=o.S.convert(e),h=1/o.bt,g=o.b8();return o.by(g,g,u.lng/180*Math.PI),o.b6(g,g,-u.lat/180*Math.PI),o.M(g,g,[0,0,1+i/o.bt]),o.b6(g,g,.5*Math.PI),o.N(g,g,[h,h,h]),g}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Yi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,u=!0){this._helper.resize(e,i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new pn,this._verticalPerspectiveTransform=new Pr}clone(){const e=new Yi;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:i.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,u){const h=this._mercatorTransform.getPitchedTextCorrection(e,i,u),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,u);return o.bj(h,g,this._globeness)}projectTileCoordinates(e,i,u,h){return this.currentTransform.projectTileCoordinates(e,i,u,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,u,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,h)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=i.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class fr{get useGlobeControls(){return!0}handlePanInertia(e,i){const u=hr(e,i);return Math.abs(u.lng-i.center.lng)>180&&(u.lng=i.center.lng+179.5*Math.sign(u.lng-i.center.lng)),{easingCenter:u,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const u=e.around,h=i.screenPointToLocation(u);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const g=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const x=i.zoom-g;if(x===0)return;const S=o.bz(i.center.lng,h.lng),C=S/(Math.abs(S/180)+1),R=o.bz(i.center.lat,h.lat),D=i.getRayDirectionFromPixel(u),B=i.cameraPosition,F=-1*o.aW(B,D),U=o.bo();o.aR(U,B,[D[0]*F,D[1]*F,D[2]*F]);const X=o.aY(U)-1,oe=Math.exp(.5*-Math.max(X-.3,0)),ae=Vr(i.worldSize,i.center.lat)/Math.min(i.width,i.height),ue=o.bm(ae,.9,.5,1,.25),de=(1-o.ae(-x))*Math.min(oe,ue),_e=i.center.lat,me=i.zoom,xe=new o.S(i.center.lng+C*de,o.ag(i.center.lat+R*de,-o.ah,o.ah));i.setLocationAtPoint(h,u);const we=i.center,ge=o.bm(Math.abs(S),45,85,0,1),Ce=o.bm(ae,.75,.35,0,1),Be=Math.pow(Math.max(ge,Ce),.25),De=o.bz(we.lng,xe.lng),ze=o.bz(we.lat,xe.lat);i.setCenter(new o.S(we.lng+De*Be,we.lat+ze*Be).wrap()),i.setZoom(me+Tn(_e,i.center.lat))}handleMapControlsPan(e,i,u){if(!e.panDelta)return;const h=i.center.lat,g=i.zoom;i.setCenter(hr(e.panDelta,i).wrap()),i.setZoom(g+Tn(h,i.center.lat))}cameraForBoxAndBearing(e,i,u,h,g){const x=Wi(e,i,u,h,g),S=i.left/g.width*2-1,C=(g.width-i.right)/g.width*2-1,R=i.top/g.height*-2+1,D=(g.height-i.bottom)/g.height*-2+1,B=o.bz(u.getWest(),u.getEast())<0,F=B?u.getEast():u.getWest(),U=B?u.getWest():u.getEast(),X=Math.max(u.getNorth(),u.getSouth()),oe=Math.min(u.getNorth(),u.getSouth()),ae=F+.5*o.bz(F,U),ue=X+.5*o.bz(X,oe),de=g.clone();de.setCenter(x.center),de.setBearing(x.bearing),de.setPitch(0),de.setRoll(0),de.setZoom(x.zoom);const _e=de.modelViewProjectionMatrix,me=[Rn(u.getNorthWest()),Rn(u.getNorthEast()),Rn(u.getSouthWest()),Rn(u.getSouthEast()),Rn(new o.S(U,ue)),Rn(new o.S(F,ue)),Rn(new o.S(ae,X)),Rn(new o.S(ae,oe))],xe=Rn(x.center);let we=Number.POSITIVE_INFINITY;for(const ge of me)S<0&&(we=fr.getLesserNonNegativeNonNull(we,fr.solveVectorScale(ge,xe,_e,"x",S))),C>0&&(we=fr.getLesserNonNegativeNonNull(we,fr.solveVectorScale(ge,xe,_e,"x",C))),R>0&&(we=fr.getLesserNonNegativeNonNull(we,fr.solveVectorScale(ge,xe,_e,"y",R))),D<0&&(we=fr.getLesserNonNegativeNonNull(we,fr.solveVectorScale(ge,xe,_e,"y",D)));if(Number.isFinite(we)&&we!==0)return x.zoom=de.zoom+o.aj(we),x;In()}handleJumpToCenterZoom(e,i){const u=e.center.lat,h=e.getConstrained(i.center?o.S.convert(i.center):e.center,e.zoom).center;e.setCenter(h.wrap());const g=i.zoom!==void 0?+i.zoom:e.zoom+Tn(u,h.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,i){const u=e.zoom,h=e.center,g=e.padding,x={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},C=i.zoom!==void 0,R=!e.isPaddingEqual(i.padding);let D=!1;const B=i.center?o.S.convert(i.center):h,F=e.getConstrained(B,u).center;Br(e,F);const U=e.clone();U.setCenter(F),U.setZoom(C?+i.zoom:u+Tn(h.lat,B.lat)),U.setBearing(i.bearing);const X=new o.P(o.ag(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),o.ag(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));U.setLocationAtPoint(F,X);const oe=(i.offset&&i.offsetAsPoint.mag())>0?U.center:F,ae=C?+i.zoom:u+Tn(h.lat,oe.lat),ue=u+Tn(h.lat,0),de=ae+Tn(oe.lat,0),_e=o.bz(h.lng,oe.lng),me=o.bz(h.lat,oe.lat),xe=o.ae(de-ue);return D=ae!==u,{easeFunc:we=>{if(o.bd(x,S)||An({startEulerAngles:x,endEulerAngles:S,tr:e,k:we,useSlerp:x.roll!=S.roll}),R&&e.interpolatePadding(g,i.padding,we),i.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const ge=de>ue?Math.min(2,xe):Math.max(.5,xe),Ce=Math.pow(ge,1-we),Be=ha(h,_e,me,we*Ce);e.setCenter(Be.wrap())}if(D){const ge=o.C.number(ue,de,we)+Tn(0,e.center.lat);e.setZoom(ge)}},isZooming:D,elevationCenter:oe}}handleFlyTo(e,i){const u=i.zoom!==void 0,h=e.center,g=e.zoom,x=e.padding,S=!e.isPaddingEqual(i.padding),C=e.getConstrained(o.S.convert(i.center||i.locationAtOffset),g).center,R=u?+i.zoom:e.zoom+Tn(e.center.lat,C.lat),D=e.clone();D.setCenter(C),D.setZoom(R),D.setBearing(i.bearing);const B=new o.P(o.ag(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),o.ag(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));D.setLocationAtPoint(C,B);const F=D.center;Br(e,F);const U=function(me,xe,we){const ge=Rn(xe),Ce=Rn(we),Be=o.aW(ge,Ce),De=Math.acos(Be),ze=$n(me);return De/(2*Math.PI)*ze}(e,h,F),X=g+Tn(h.lat,0),oe=R+Tn(F.lat,0),ae=o.ae(oe-X);let ue;if(typeof i.minZoom=="number"){const me=+i.minZoom+Tn(F.lat,0),xe=Math.min(me,X,oe)+Tn(0,F.lat),we=e.getConstrained(F,xe).zoom+Tn(F.lat,0);ue=o.ae(we-X)}const de=o.bz(h.lng,F.lng),_e=o.bz(h.lat,F.lat);return{easeFunc:(me,xe,we,ge)=>{const Ce=ha(h,de,_e,we);S&&e.interpolatePadding(x,i.padding,me);const Be=me===1?F:Ce;e.setCenter(Be.wrap());const De=X+o.aj(xe);e.setZoom(me===1?R:De+Tn(0,Be.lat))},scaleOfZoom:ae,targetCenter:F,scaleOfMinZoom:ue,pixelPathLength:U}}static solveVectorScale(e,i,u,h,g){const x=h==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],S=[u[3],u[7],u[11],u[15]],C=e[0]*x[0]+e[1]*x[1]+e[2]*x[2],R=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],D=i[0]*x[0]+i[1]*x[1]+i[2]*x[2],B=i[0]*S[0]+i[1]*S[1]+i[2]*S[2];return D+g*R===C+g*B||S[3]*(C-D)+x[3]*(B-R)+C*B==D*R?null:(D+x[3]-g*B-g*S[3])/(D-C-g*B+g*R)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class ao{constructor(e){this._globe=e,this._mercatorCameraHelper=new Ri,this._verticalPerspectiveCameraHelper=new fr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,u){this.currentHelper.handleMapControlsPan(e,i,u)}cameraForBoxAndBearing(e,i,u,h,g){return this.currentHelper.cameraForBoxAndBearing(e,i,u,h,g)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const Fa=(m,e)=>o.y(m,e&&e.filter(i=>i.identifier!=="source.canvas")),Es=o.bD();class oo extends o.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const h=this.sourceCaches[u].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new yr(Pn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,h)=>this.getGlyphs(u,h)),this.dispatcher.registerMessageHandler("GI",(u,h)=>this.getImages(u,h)),this.imageManager=new Ye,this.imageManager.setEventedParent(this),this.glyphManager=new Pt(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new Ni(256,512),this.crossTileSymbolIndex=new Da,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bF()),gi().on(mt,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const h=this.sourceCaches[u.sourceId];if(!h)return;const g=h.getSource();if(g&&g.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===g.id&&this._validateLayer(S)}})}setGlobalStateProperty(e,i){var u,h,g;this._checkLoaded();const x=i===null?(g=(h=(u=this.stylesheet.state)===null||u===void 0?void 0:u[e])===null||h===void 0?void 0:h.default)!==null&&g!==void 0?g:null:i;if(o.bG(x,this._globalState[e]))return this;this._globalState[e]=x;const S=this._findGlobalStateAffectedSources([e]);for(const C in this.sourceCaches)S.has(C)&&(this._reloadSource(C),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const i=[];for(const h in e)!o.bG(this._globalState[h],e[h].default)&&(i.push(h),this._globalState[h]=e[h].default);const u=this._findGlobalStateAffectedSources(i);for(const h in this.sourceCaches)u.has(h)&&(this._reloadSource(h),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const i=new Set;for(const u in this._layers){const h=this._layers[u],g=h.getLayoutAffectingGlobalStateRefs();for(const x of e)g.has(x)&&i.add(h.source)}return i}loadURL(e,i={},u){this.fire(new o.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const h=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;o.j(h,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,i,u)}).catch(x=>{this._loadStyleRequest=null,x&&!g.signal.aborted&&this.fire(new o.k(x))})}loadJSON(e,i={},u){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ce.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,u)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Es,{validate:!1})}_load(e,i,u){var h,g,x;const S=i.transformStyle?i.transformStyle(u,e):e;if(!i.validate||!Fa(this,o.z(S))){this._loaded=!0,this.stylesheet=S;for(const C in S.sources)this.addSource(C,S.sources[C],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new qt(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new ui(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.setGlobalState((x=this.stylesheet.state)!==null&&x!==void 0?x:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){const e=o.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const u=o.bI(i);u.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=u}}_loadSprite(e,i=!1,u=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(g,x,S,C){return o._(this,void 0,void 0,function*(){const R=Ke(g),D=S>1?"@2x":"",B={},F={};for(const{id:U,url:X}of R){const oe=x.transformRequest(pt(X,D,".json"),"SpriteJSON");B[U]=o.j(oe,C);const ae=x.transformRequest(pt(X,D,".png"),"SpriteImage");F[U]=We.getImage(ae,C)}return yield Promise.all([...Object.values(B),...Object.values(F)]),function(U,X){return o._(this,void 0,void 0,function*(){const oe={};for(const ae in U){oe[ae]={};const ue=ce.getImageCanvasContext((yield X[ae]).data),de=(yield U[ae]).data;for(const _e in de){const{width:me,height:xe,x:we,y:ge,sdf:Ce,pixelRatio:Be,stretchX:De,stretchY:ze,content:je,textFitWidth:St,textFitHeight:wt}=de[_e];oe[ae][_e]={data:null,pixelRatio:Be,sdf:Ce,stretchX:De,stretchY:ze,content:je,textFitWidth:St,textFitHeight:wt,spriteData:{width:me,height:xe,x:we,y:ge,context:ue}}}}return oe})}(B,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(g=>{if(this._spriteRequest=null,g)for(const x in g){this._spritesImagesIds[x]=[];const S=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(C=>!(C in g)):[];for(const C of S)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in g[x]){const R=x==="default"?C:`${x}:${C}`;this._spritesImagesIds[x].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,g[x][C],!1):this.imageManager.addImage(R,g[x][C]),i&&(this._changedImages[R]=!0)}}}).catch(g=>{this._spriteRequest=null,h=g,this.fire(new o.k(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),u&&u(h)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const u=e.sourceLayer;if(!u)return;const h=i.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.k(new Error(`Source layer "${u}" does not exist on source "${h.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?o.bJ(u):u);const h=[];for(const g of e)if(u[g]){const x=i?o.bJ(u[g]):u[g];h.push(x)}return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const u of i){const h=this._layers[u];h.type!=="custom"&&(e[u]=h.serialize())}return e}hasTransitions(){var e,i,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const h=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(h.length||g.length)&&this._updateWorkerLayers(h,g);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const h in this.sourceCaches){const g=this.sourceCaches[h];u[h]=g.used,g.used=!1}for(const h of this._order){const g=this._layers[h];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const h in u){const g=this.sourceCaches[h];!!u[h]!=!!g.used&&g.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var u;this._checkLoaded();const h=this.serialize();if(e=i.transformStyle?i.transformStyle(h,e):e,((u=i.validate)===null||u===void 0||u)&&Fa(this,o.z(e)))return!1;(e=o.bJ(e)).layers=o.bH(e.layers);const g=o.bK(h,e),x=this._getOperationsToPerform(g);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const S of x.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],u=[];for(const h of e)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":i.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":i.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setSky":i.push(()=>this.setSky.apply(this,h.args));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":i.push(()=>this.setGlobalState.apply(this,h.args));break;case"setTransition":i.push(()=>{});break;default:u.push(h.command)}return{operations:i,unimplemented:u}}addImage(e,i){if(this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(o.z.source,`sources.${e}`,i,null,u))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const h=this.sourceCaches[e]=new et(e,i,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:e})),h.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new o.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,u={}){this._checkLoaded();const h=e.id;if(this.getLayer(h))return void this.fire(new o.k(new Error(`Layer "${h}" already exists on this map.`)));let g;if(e.type==="custom"){if(Fa(this,o.bL(e)))return;g=o.bI(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(h,e.source),e=o.bJ(e),e=o.e(e,{source:h})),this._validate(o.z.layer,`layers.${h}`,e,{arrayIndex:-1},u))return;g=o.bI(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:h}})}const x=i?this._order.indexOf(i):this._order.length;if(i&&x===-1)this.fire(new o.k(new Error(`Cannot add layer "${h}" before non-existing layer "${i}".`)));else{if(this._order.splice(x,0,h),this._layerOrderChanged=!0,this._layers[h]=g,this._removedLayers[h]&&g.source&&g.type!=="custom"){const S=this._removedLayers[h];delete this._removedLayers[h],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const u=this._order.indexOf(e);this._order.splice(u,1);const h=i?this._order.indexOf(i):this._order.length;i&&h===-1?this.fire(new o.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(h,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,u){this._checkLoaded();const h=this.getLayer(e);h?h.minzoom===i&&h.maxzoom===u||(i!=null&&(h.minzoom=i),u!=null&&(h.maxzoom=u),this._updateLayer(h)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,u={}){this._checkLoaded();const h=this.getLayer(e);if(h){if(!o.bG(h.filter,i))return i==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(o.z.filter,`layers.${h.id}.filter`,i,null,u)||(h.setFilter(o.bJ(i)),this._updateLayer(h)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bJ(this.getLayer(e).filter)}setLayoutProperty(e,i,u,h={}){this._checkLoaded();const g=this.getLayer(e);g?o.bG(g.getLayoutProperty(i),u)||(g.setLayoutProperty(i,u,h),this._updateLayer(g)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const u=this.getLayer(e);if(u)return u.getLayoutProperty(i);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,u,h={}){this._checkLoaded();const g=this.getLayer(e);g?o.bG(g.getPaintProperty(i),u)||(g.setPaintProperty(i,u,h)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const u=e.source,h=e.sourceLayer,g=this.sourceCaches[u];if(g===void 0)return void this.fire(new o.k(new Error(`The source '${u}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&h?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||h?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(h,e.id,i)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const u=e.source,h=this.sourceCaches[u];if(h===void 0)return void this.fire(new o.k(new Error(`The source '${u}' does not exist in the map's style.`)));const g=h.getSource().type,x=g==="vector"?e.sourceLayer:void 0;g!=="vector"||x?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(x,e.id,i):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,u=e.sourceLayer,h=this.sourceCaches[i];if(h!==void 0)return h.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(u,e.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=o.bM(this.sourceCaches,g=>g.serialize()),i=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,h=this.stylesheet;return o.bN({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:e,layers:i,terrain:u},g=>g!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=x=>this._layers[x].type==="fill-extrusion",u={},h=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(i(S)){u[S]=x;for(const C of e){const R=C[S];if(R)for(const D of R)h.push(D)}}}h.sort((x,S)=>S.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(i(S))for(let C=h.length-1;C>=0;C--){const R=h[C].feature;if(u[R.layer.id]<x)break;g.push(R),h.pop()}else for(const C of e){const R=C[S];if(R)for(const D of R)g.push(D.feature)}}return g}queryRenderedFeatures(e,i,u){i&&i.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",i.filter,null,i);const h={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of i.layers){const D=this._layers[R];if(!D)return this.fire(new o.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];h[D.source]=!0}}const g=[];i.availableImages=this._availableImages;const x=this._serializedAllLayers(),S=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,C=Object.assign(Object.assign({},i),{layers:S});for(const R in this.sourceCaches)i.layers&&!h[R]||g.push(rn(this.sourceCaches[R],this._layers,x,e,C,u,this.map.terrain?(D,B,F)=>this.map.terrain.getElevation(D,B,F):void 0));return this.placement&&g.push(function(R,D,B,F,U,X,oe){const ae={},ue=X.queryRenderedSymbols(F),de=[];for(const _e of Object.keys(ue).map(Number))de.push(oe[_e]);de.sort(Ci);for(const _e of de){const me=_e.featureIndex.lookupSymbolFeatures(ue[_e.bucketInstanceId],D,_e.bucketIndex,_e.sourceLayerIndex,U.filter,U.layers,U.availableImages,R);for(const xe in me){const we=ae[xe]=ae[xe]||[],ge=me[xe];ge.sort((Ce,Be)=>{const De=_e.featureSortOrder;if(De){const ze=De.indexOf(Ce.featureIndex);return De.indexOf(Be.featureIndex)-ze}return Be.featureIndex-Ce.featureIndex});for(const Ce of ge)we.push(Ce)}}return function(_e,me,xe){for(const we in _e)for(const ge of _e[we])jt(ge,xe[me[we].source]);return _e}(ae,R,B)}(this._layers,x,this.sourceCaches,e,C,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,i){i&&i.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",i.filter,null,i);const u=this.sourceCaches[e];return u?function(h,g){const x=h.getRenderableIds().map(R=>h.getTileByID(R)),S=[],C={};for(let R=0;R<x.length;R++){const D=x[R],B=D.tileID.canonical.key;C[B]||(C[B]=!0,D.querySourceFeatures(S,g))}return S}(u,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const u=this.light.getLight();let h=!1;for(const x in e)if(!o.bG(e[x],u[x])){h=!0;break}if(!h)return;const g={now:ce.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const u=this.getSky();let h=!1;if(!e&&!u)return;if(e&&!u)h=!0;else if(!e&&u)h=!0;else for(const x in e)if(!o.bG(e[x],u[x])){h=!0;break}if(!h)return;const g={now:ce.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(g)}_setProjectionInternal(e){const i=function(u){if(Array.isArray(u)){const h=new Na({type:u});return{projection:h,transform:new Yi,cameraHelper:new ao(h)}}switch(u){case"mercator":return{projection:new hs,transform:new pn,cameraHelper:new Ri};case"globe":{const h=new Na({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:h,transform:new Yi,cameraHelper:new ao(h)}}case"vertical-perspective":return{projection:new Qr,transform:new Pr,cameraHelper:new fr};default:return o.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new hs,transform:new pn,cameraHelper:new Ri}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const u in this.sourceCaches)this.sourceCaches[u].reload()}_validate(e,i,u,h,g={}){return(!g||g.validate!==!1)&&Fa(this,e.call(o.z,o.e({key:i,style:this.serialize(),value:u,styleSpec:o.v},h)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),gi().off(mt,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const u=this.sourceCaches[i];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,u,h,g=!1){let x=!1,S=!1;const C={};for(const R of this._order){const D=this._layers[R];if(D.type!=="symbol")continue;if(!C[D.source]){const F=this.sourceCaches[D.source];C[D.source]=F.getRenderableIds(!0).map(U=>F.getTileByID(U)).sort((U,X)=>X.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(X.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(D,C[D.source],e.center.lng);x=x||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ce.now(),e.zoom))&&(this.pauseablePlacement=new Zs(e,this.map.terrain,this._order,g,i,u,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ce.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const R of this._order){const D=this._layers[R];D.type==="symbol"&&this.placement.updateLayerOpacities(D,C[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ce.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return o._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[i.source];return h&&h.setDependencies(i.tileID.key,i.type,i.icons),u})}getGlyphs(e,i){return o._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(i.stacks),h=this.sourceCaches[i.source];return h&&h.setDependencies(i.tileID.key,i.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(o.z.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,u={},h){this._checkLoaded();const g=[{id:e,url:i}],x=[...Ke(this.stylesheet.sprite),...g];this._validate(o.z.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(g,!0,h))}removeSprite(e){this._checkLoaded();const i=Ke(this.stylesheet.sprite);if(i.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;i.splice(i.findIndex(u=>u.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ke(this.stylesheet.sprite)}setSprite(e,i={},u){this._checkLoaded(),e&&this._validate(o.z.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var Ko=o.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Wl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,u,h,g,x,S,C,R){this.context=e;let D=this.boundPaintVertexBuffers.length!==h.length;for(let B=0;!D&&B<h.length;B++)this.boundPaintVertexBuffers[B]!==h[B]&&(D=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==u||D||this.boundIndexBuffer!==g||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==R?this.freshBind(i,u,h,g,x,S,C,R):(e.bindVertexArray.set(this.vao),S&&S.bind(),g&&g.dynamicDraw&&g.bind(),C&&C.bind(),R&&R.bind())}freshBind(e,i,u,h,g,x,S,C){const R=e.numAttributes,D=this.context,B=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=C,i.enableAttributes(B,e);for(const F of u)F.enableAttributes(B,e);x&&x.enableAttributes(B,e),S&&S.enableAttributes(B,e),C&&C.enableAttributes(B,e),i.bind(),i.setVertexAttribPointers(B,e,g);for(const F of u)F.bind(),F.setVertexAttribPointers(B,e,g);x&&(x.bind(),x.setVertexAttribPointers(B,e,g)),h&&h.bind(),S&&(S.bind(),S.setVertexAttribPointers(B,e,g)),C&&(C.bind(),C.setVertexAttribPointers(B,e,g)),D.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Gr=(m,e,i,u,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):o.be.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:i?i.calculateFogBlendOpacity(u):0,u_horizon_color:i?i.properties.get("horizon-color"):o.be.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Yl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Hn(m){const e=[];for(let i=0;i<m.length;i++){if(m[i]===null)continue;const u=m[i].split(" ");e.push(u.pop())}return e}class Cs{constructor(e,i,u,h,g,x,S,C,R=[]){const D=e.gl;this.program=D.createProgram();const B=Hn(i.staticAttributes),F=u?u.getBinderAttributes():[],U=B.concat(F),X=Fr.prelude.staticUniforms?Hn(Fr.prelude.staticUniforms):[],oe=S.staticUniforms?Hn(S.staticUniforms):[],ae=i.staticUniforms?Hn(i.staticUniforms):[],ue=u?u.getBinderUniforms():[],de=X.concat(oe).concat(ae).concat(ue),_e=[];for(const De of de)_e.indexOf(De)<0&&_e.push(De);const me=u?u.defines():[];zn(D)&&me.unshift("#version 300 es"),g&&me.push("#define OVERDRAW_INSPECTOR;"),x&&me.push("#define TERRAIN3D;"),C&&me.push(C),R&&me.push(...R);let xe=me.concat(Fr.prelude.fragmentSource,S.fragmentSource,i.fragmentSource).join(`
`),we=me.concat(Fr.prelude.vertexSource,S.vertexSource,i.vertexSource).join(`
`);zn(D)||(xe=function(De){return De.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(xe),we=function(De){return De.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(we));const ge=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(ge,xe),D.compileShader(ge),!D.getShaderParameter(ge,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(ge)}`);D.attachShader(this.program,ge);const Ce=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ce,we),D.compileShader(Ce),!D.getShaderParameter(Ce,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ce)}`);D.attachShader(this.program,Ce),this.attributes={};const Be={};this.numAttributes=U.length;for(let De=0;De<this.numAttributes;De++)U[De]&&(D.bindAttribLocation(this.program,De,U[De]),this.attributes[U[De]]=De);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ce),D.deleteShader(ge);for(let De=0;De<_e.length;De++){const ze=_e[De];if(ze&&!Be[ze]){const je=D.getUniformLocation(this.program,ze);je&&(Be[ze]=je)}}this.fixedUniforms=h(e,Be),this.terrainUniforms=((De,ze)=>({u_depth:new o.bO(De,ze.u_depth),u_terrain:new o.bO(De,ze.u_terrain),u_terrain_dim:new o.bf(De,ze.u_terrain_dim),u_terrain_matrix:new o.bQ(De,ze.u_terrain_matrix),u_terrain_unpack:new o.bR(De,ze.u_terrain_unpack),u_terrain_exaggeration:new o.bf(De,ze.u_terrain_exaggeration)}))(e,Be),this.projectionUniforms=((De,ze)=>({u_projection_matrix:new o.bQ(De,ze.u_projection_matrix),u_projection_tile_mercator_coords:new o.bR(De,ze.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bR(De,ze.u_projection_clipping_plane),u_projection_transition:new o.bf(De,ze.u_projection_transition),u_projection_fallback_matrix:new o.bQ(De,ze.u_projection_fallback_matrix)}))(e,Be),this.binderUniforms=u?u.getUniforms(e,Be):[]}draw(e,i,u,h,g,x,S,C,R,D,B,F,U,X,oe,ae,ue,de,_e){const me=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(h),e.setColorMode(g),e.setCullFace(x),C){e.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,C.depthTexture),e.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,C.texture);for(const we in this.terrainUniforms)this.terrainUniforms[we].set(C[we])}if(R)for(const we in R)this.projectionUniforms[Yl[we]].set(R[we]);if(S)for(const we in this.fixedUniforms)this.fixedUniforms[we].set(S[we]);ae&&ae.setUniforms(e,this.binderUniforms,X,{zoom:oe});let xe=0;switch(i){case me.LINES:xe=2;break;case me.TRIANGLES:xe=3;break;case me.LINE_STRIP:xe=1}for(const we of U.get()){const ge=we.vaos||(we.vaos={});(ge[D]||(ge[D]=new Wl)).bind(e,this,B,ae?ae.getPaintVertexBuffers():[],F,we.vertexOffset,ue,de,_e),me.drawElements(i,we.primitiveLength*xe,me.UNSIGNED_SHORT,we.primitiveOffset*xe*2)}}}function lo(m,e,i){const u=1/o.aB(i,1,e.transform.tileZoom),h=Math.pow(2,i.tileID.overscaledZ),g=i.tileSize*Math.pow(2,e.transform.tileZoom)/h,x=g*(i.tileID.canonical.x+i.tileID.wrap*h),S=g*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const fa=(m,e,i,u)=>{const h=m.style.light,g=h.properties.get("position"),x=[g.x,g.y,g.z],S=o.bU();h.properties.get("anchor")==="viewport"&&o.bV(S,m.transform.bearingInRadians),o.bW(x,x,S);const C=m.transform.transformLightDirection(x),R=h.properties.get("color");return{u_lightpos:x,u_lightpos_globe:C,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:u}},uo=(m,e,i,u,h,g,x)=>o.e(fa(m,e,i,u),lo(g,m,x),{u_height_factor:-Math.pow(2,h.overscaledZ)/x.tileSize/8}),Ba=(m,e,i,u)=>o.e(lo(e,m,i),{u_fill_translate:u}),Mr=(m,e)=>({u_world:m,u_fill_translate:e}),tc=(m,e,i,u,h)=>o.e(Ba(m,e,i,h),{u_world:u}),Jo=(m,e,i,u,h)=>{const g=m.transform;let x,S,C=0;if(i.paint.get("circle-pitch-alignment")==="map"){const R=o.aB(e,1,g.zoom);x=!0,S=[R,R],C=R/(o.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*h}else x=!1,S=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:C,u_translate:u}},ja=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Va=m=>({u_viewport_size:[m.width,m.height]}),Kl=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),Ua=(m,e,i,u)=>{const h=o.aB(m,1,e)/(o.$*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:o.aB(m,1,e),u_intensity:i,u_globe_extrude_scale:h}},Jl=(m,e,i,u)=>{const h=o.L();o.bX(h,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:h,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:i,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},da=(m,e,i)=>{const u=i.paint.get("hillshade-accent-color");let h;switch(i.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const g=i.getIlluminationProperties();for(let x=0;x<g.directionRadians.length;x++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[x]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:eu(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:u,u_method:h,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Ql=(m,e)=>{const i=e.stride,u=o.L();return o.bX(u,0,o.$,-o.$,0,0,1),o.M(u,u,[0,-o.$,0]),{u_matrix:u,u_image:1,u_dimension:[i,i],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function eu(m,e){const i=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new o.a0(0,u/i).toLngLat().lat,new o.a0(0,(u+1)/i).toLngLat().lat]}const tu=(m,e,i=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:i,u_opacity:m.paint.get("color-relief-opacity")}),co=(m,e,i,u)=>{const h=m.transform;return{u_translation:tl(m,e,i),u_ratio:u/o.aB(e,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Qo=(m,e,i,u,h)=>o.e(co(m,e,i,u),{u_image:0,u_image_height:h}),iu=(m,e,i,u,h)=>{const g=m.transform,x=el(e,g);return{u_translation:tl(m,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:u/o.aB(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},nu=(m,e,i,u,h,g)=>{const x=m.lineAtlas,S=el(e,m.transform),C=i.layout.get("line-cap")==="round",R=x.getDash(h.from,C),D=x.getDash(h.to,C),B=R.width*g.fromScale,F=D.width*g.toScale;return o.e(co(m,e,i,u),{u_patternscale_a:[S/B,-R.height/2],u_patternscale_b:[S/F,-D.height/2],u_sdfgamma:x.width/(256*Math.min(B,F)*m.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:D.y,u_mix:g.t})};function el(m,e){return 1/o.aB(m,1,e.tileZoom)}function tl(m,e,i){return o.aC(m.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Ys=(m,e,i,u,h)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=u.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:il(u.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var g,x};function il(m){m*=Math.PI/180;const e=Math.sin(m),i=Math.cos(m);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const ho=(m,e,i,u,h,g,x,S,C,R,D,B,F)=>{const U=x.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:U.width/U.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+D,u_pitch_with_map:+u,u_is_along_line:h,u_is_variable_anchor:g,u_texsize:B,u_texture:0,u_translation:R,u_pitched_scale:F}},Ks=(m,e,i,u,h,g,x,S,C,R,D,B,F,U)=>{const X=x.transform;return o.e(ho(m,e,i,u,h,g,x,S,C,R,D,B,U),{u_gamma_scale:u?Math.cos(X.pitch*Math.PI/180)*X.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},ic=(m,e,i,u,h,g,x,S,C,R,D,B,F)=>o.e(Ks(m,e,i,u,h,g,x,S,C,R,!0,D,0,F),{u_texsize_icon:B,u_texture_icon:1}),Ga=(m,e)=>({u_opacity:m,u_color:e}),nl=(m,e,i,u,h)=>o.e(function(g,x,S,C){const R=S.imageManager.getPattern(g.from.toString()),D=S.imageManager.getPattern(g.to.toString()),{width:B,height:F}=S.imageManager.getPixelSize(),U=Math.pow(2,C.tileID.overscaledZ),X=C.tileSize*Math.pow(2,S.transform.tileZoom)/U,oe=X*(C.tileID.canonical.x+C.tileID.wrap*U),ae=X*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[B,F],u_mix:x.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/o.aB(C,1,S.transform.tileZoom),u_pixel_coord_upper:[oe>>16,ae>>16],u_pixel_coord_lower:[65535&oe,65535&ae]}}(i,h,e,u),{u_opacity:m}),ru=(m,e)=>{},rl={fillExtrusion:(m,e)=>({u_lightpos:new o.bS(m,e.u_lightpos),u_lightpos_globe:new o.bS(m,e.u_lightpos_globe),u_lightintensity:new o.bf(m,e.u_lightintensity),u_lightcolor:new o.bS(m,e.u_lightcolor),u_vertical_gradient:new o.bf(m,e.u_vertical_gradient),u_opacity:new o.bf(m,e.u_opacity),u_fill_translate:new o.bT(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new o.bS(m,e.u_lightpos),u_lightpos_globe:new o.bS(m,e.u_lightpos_globe),u_lightintensity:new o.bf(m,e.u_lightintensity),u_lightcolor:new o.bS(m,e.u_lightcolor),u_vertical_gradient:new o.bf(m,e.u_vertical_gradient),u_height_factor:new o.bf(m,e.u_height_factor),u_opacity:new o.bf(m,e.u_opacity),u_fill_translate:new o.bT(m,e.u_fill_translate),u_image:new o.bO(m,e.u_image),u_texsize:new o.bT(m,e.u_texsize),u_pixel_coord_upper:new o.bT(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(m,e.u_pixel_coord_lower),u_scale:new o.bS(m,e.u_scale),u_fade:new o.bf(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new o.bT(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new o.bO(m,e.u_image),u_texsize:new o.bT(m,e.u_texsize),u_pixel_coord_upper:new o.bT(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(m,e.u_pixel_coord_lower),u_scale:new o.bS(m,e.u_scale),u_fade:new o.bf(m,e.u_fade),u_fill_translate:new o.bT(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new o.bT(m,e.u_world),u_fill_translate:new o.bT(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new o.bT(m,e.u_world),u_image:new o.bO(m,e.u_image),u_texsize:new o.bT(m,e.u_texsize),u_pixel_coord_upper:new o.bT(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(m,e.u_pixel_coord_lower),u_scale:new o.bS(m,e.u_scale),u_fade:new o.bf(m,e.u_fade),u_fill_translate:new o.bT(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new o.bf(m,e.u_camera_to_center_distance),u_scale_with_map:new o.bO(m,e.u_scale_with_map),u_pitch_with_map:new o.bO(m,e.u_pitch_with_map),u_extrude_scale:new o.bT(m,e.u_extrude_scale),u_device_pixel_ratio:new o.bf(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.bf(m,e.u_globe_extrude_scale),u_translate:new o.bT(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new o.bT(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new o.bT(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new o.bP(m,e.u_color),u_overlay:new o.bO(m,e.u_overlay),u_overlay_scale:new o.bf(m,e.u_overlay_scale)}),depth:ru,clippingMask:ru,heatmap:(m,e)=>({u_extrude_scale:new o.bf(m,e.u_extrude_scale),u_intensity:new o.bf(m,e.u_intensity),u_globe_extrude_scale:new o.bf(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new o.bQ(m,e.u_matrix),u_world:new o.bT(m,e.u_world),u_image:new o.bO(m,e.u_image),u_color_ramp:new o.bO(m,e.u_color_ramp),u_opacity:new o.bf(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new o.bO(m,e.u_image),u_latrange:new o.bT(m,e.u_latrange),u_exaggeration:new o.bf(m,e.u_exaggeration),u_altitudes:new o.bZ(m,e.u_altitudes),u_azimuths:new o.bZ(m,e.u_azimuths),u_accent:new o.bP(m,e.u_accent),u_method:new o.bO(m,e.u_method),u_shadows:new o.bY(m,e.u_shadows),u_highlights:new o.bY(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new o.bQ(m,e.u_matrix),u_image:new o.bO(m,e.u_image),u_dimension:new o.bT(m,e.u_dimension),u_zoom:new o.bf(m,e.u_zoom),u_unpack:new o.bR(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new o.bO(m,e.u_image),u_unpack:new o.bR(m,e.u_unpack),u_dimension:new o.bT(m,e.u_dimension),u_elevation_stops:new o.bO(m,e.u_elevation_stops),u_color_stops:new o.bO(m,e.u_color_stops),u_color_ramp_size:new o.bO(m,e.u_color_ramp_size),u_opacity:new o.bf(m,e.u_opacity)}),line:(m,e)=>({u_translation:new o.bT(m,e.u_translation),u_ratio:new o.bf(m,e.u_ratio),u_device_pixel_ratio:new o.bf(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.bT(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new o.bT(m,e.u_translation),u_ratio:new o.bf(m,e.u_ratio),u_device_pixel_ratio:new o.bf(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.bT(m,e.u_units_to_pixels),u_image:new o.bO(m,e.u_image),u_image_height:new o.bf(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new o.bT(m,e.u_translation),u_texsize:new o.bT(m,e.u_texsize),u_ratio:new o.bf(m,e.u_ratio),u_device_pixel_ratio:new o.bf(m,e.u_device_pixel_ratio),u_image:new o.bO(m,e.u_image),u_units_to_pixels:new o.bT(m,e.u_units_to_pixels),u_scale:new o.bS(m,e.u_scale),u_fade:new o.bf(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new o.bT(m,e.u_translation),u_ratio:new o.bf(m,e.u_ratio),u_device_pixel_ratio:new o.bf(m,e.u_device_pixel_ratio),u_units_to_pixels:new o.bT(m,e.u_units_to_pixels),u_patternscale_a:new o.bT(m,e.u_patternscale_a),u_patternscale_b:new o.bT(m,e.u_patternscale_b),u_sdfgamma:new o.bf(m,e.u_sdfgamma),u_image:new o.bO(m,e.u_image),u_tex_y_a:new o.bf(m,e.u_tex_y_a),u_tex_y_b:new o.bf(m,e.u_tex_y_b),u_mix:new o.bf(m,e.u_mix)}),raster:(m,e)=>({u_tl_parent:new o.bT(m,e.u_tl_parent),u_scale_parent:new o.bf(m,e.u_scale_parent),u_buffer_scale:new o.bf(m,e.u_buffer_scale),u_fade_t:new o.bf(m,e.u_fade_t),u_opacity:new o.bf(m,e.u_opacity),u_image0:new o.bO(m,e.u_image0),u_image1:new o.bO(m,e.u_image1),u_brightness_low:new o.bf(m,e.u_brightness_low),u_brightness_high:new o.bf(m,e.u_brightness_high),u_saturation_factor:new o.bf(m,e.u_saturation_factor),u_contrast_factor:new o.bf(m,e.u_contrast_factor),u_spin_weights:new o.bS(m,e.u_spin_weights),u_coords_top:new o.bR(m,e.u_coords_top),u_coords_bottom:new o.bR(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new o.bO(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(m,e.u_is_size_feature_constant),u_size_t:new o.bf(m,e.u_size_t),u_size:new o.bf(m,e.u_size),u_camera_to_center_distance:new o.bf(m,e.u_camera_to_center_distance),u_pitch:new o.bf(m,e.u_pitch),u_rotate_symbol:new o.bO(m,e.u_rotate_symbol),u_aspect_ratio:new o.bf(m,e.u_aspect_ratio),u_fade_change:new o.bf(m,e.u_fade_change),u_label_plane_matrix:new o.bQ(m,e.u_label_plane_matrix),u_coord_matrix:new o.bQ(m,e.u_coord_matrix),u_is_text:new o.bO(m,e.u_is_text),u_pitch_with_map:new o.bO(m,e.u_pitch_with_map),u_is_along_line:new o.bO(m,e.u_is_along_line),u_is_variable_anchor:new o.bO(m,e.u_is_variable_anchor),u_texsize:new o.bT(m,e.u_texsize),u_texture:new o.bO(m,e.u_texture),u_translation:new o.bT(m,e.u_translation),u_pitched_scale:new o.bf(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new o.bO(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(m,e.u_is_size_feature_constant),u_size_t:new o.bf(m,e.u_size_t),u_size:new o.bf(m,e.u_size),u_camera_to_center_distance:new o.bf(m,e.u_camera_to_center_distance),u_pitch:new o.bf(m,e.u_pitch),u_rotate_symbol:new o.bO(m,e.u_rotate_symbol),u_aspect_ratio:new o.bf(m,e.u_aspect_ratio),u_fade_change:new o.bf(m,e.u_fade_change),u_label_plane_matrix:new o.bQ(m,e.u_label_plane_matrix),u_coord_matrix:new o.bQ(m,e.u_coord_matrix),u_is_text:new o.bO(m,e.u_is_text),u_pitch_with_map:new o.bO(m,e.u_pitch_with_map),u_is_along_line:new o.bO(m,e.u_is_along_line),u_is_variable_anchor:new o.bO(m,e.u_is_variable_anchor),u_texsize:new o.bT(m,e.u_texsize),u_texture:new o.bO(m,e.u_texture),u_gamma_scale:new o.bf(m,e.u_gamma_scale),u_device_pixel_ratio:new o.bf(m,e.u_device_pixel_ratio),u_is_halo:new o.bO(m,e.u_is_halo),u_translation:new o.bT(m,e.u_translation),u_pitched_scale:new o.bf(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new o.bO(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(m,e.u_is_size_feature_constant),u_size_t:new o.bf(m,e.u_size_t),u_size:new o.bf(m,e.u_size),u_camera_to_center_distance:new o.bf(m,e.u_camera_to_center_distance),u_pitch:new o.bf(m,e.u_pitch),u_rotate_symbol:new o.bO(m,e.u_rotate_symbol),u_aspect_ratio:new o.bf(m,e.u_aspect_ratio),u_fade_change:new o.bf(m,e.u_fade_change),u_label_plane_matrix:new o.bQ(m,e.u_label_plane_matrix),u_coord_matrix:new o.bQ(m,e.u_coord_matrix),u_is_text:new o.bO(m,e.u_is_text),u_pitch_with_map:new o.bO(m,e.u_pitch_with_map),u_is_along_line:new o.bO(m,e.u_is_along_line),u_is_variable_anchor:new o.bO(m,e.u_is_variable_anchor),u_texsize:new o.bT(m,e.u_texsize),u_texsize_icon:new o.bT(m,e.u_texsize_icon),u_texture:new o.bO(m,e.u_texture),u_texture_icon:new o.bO(m,e.u_texture_icon),u_gamma_scale:new o.bf(m,e.u_gamma_scale),u_device_pixel_ratio:new o.bf(m,e.u_device_pixel_ratio),u_is_halo:new o.bO(m,e.u_is_halo),u_translation:new o.bT(m,e.u_translation),u_pitched_scale:new o.bf(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new o.bf(m,e.u_opacity),u_color:new o.bP(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new o.bf(m,e.u_opacity),u_image:new o.bO(m,e.u_image),u_pattern_tl_a:new o.bT(m,e.u_pattern_tl_a),u_pattern_br_a:new o.bT(m,e.u_pattern_br_a),u_pattern_tl_b:new o.bT(m,e.u_pattern_tl_b),u_pattern_br_b:new o.bT(m,e.u_pattern_br_b),u_texsize:new o.bT(m,e.u_texsize),u_mix:new o.bf(m,e.u_mix),u_pattern_size_a:new o.bT(m,e.u_pattern_size_a),u_pattern_size_b:new o.bT(m,e.u_pattern_size_b),u_scale_a:new o.bf(m,e.u_scale_a),u_scale_b:new o.bf(m,e.u_scale_b),u_pixel_coord_upper:new o.bT(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bf(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new o.bO(m,e.u_texture),u_ele_delta:new o.bf(m,e.u_ele_delta),u_fog_matrix:new o.bQ(m,e.u_fog_matrix),u_fog_color:new o.bP(m,e.u_fog_color),u_fog_ground_blend:new o.bf(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bf(m,e.u_fog_ground_blend_opacity),u_horizon_color:new o.bP(m,e.u_horizon_color),u_horizon_fog_blend:new o.bf(m,e.u_horizon_fog_blend),u_is_globe_mode:new o.bf(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new o.bf(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new o.bO(m,e.u_texture),u_terrain_coords_id:new o.bf(m,e.u_terrain_coords_id),u_ele_delta:new o.bf(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new o.bf(m,e.u_input),u_output_expected:new o.bf(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new o.bS(m,e.u_sun_pos),u_atmosphere_blend:new o.bf(m,e.u_atmosphere_blend),u_globe_position:new o.bS(m,e.u_globe_position),u_globe_radius:new o.bf(m,e.u_globe_radius),u_inv_proj_matrix:new o.bQ(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new o.bP(m,e.u_sky_color),u_horizon_color:new o.bP(m,e.u_horizon_color),u_horizon:new o.bT(m,e.u_horizon),u_horizon_normal:new o.bT(m,e.u_horizon_normal),u_sky_horizon_blend:new o.bf(m,e.u_sky_horizon_blend),u_sky_blend:new o.bf(m,e.u_sky_blend)})};class sl{constructor(e,i,u){this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const su={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class al{constructor(e,i,u,h){this.length=i.length,this.attributes=u,this.itemSize=i.bytesPerElement,this.dynamicDraw=h,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let u=0;u<this.attributes.length;u++){const h=i.attributes[this.attributes[u].name];h!==void 0&&e.enableVertexAttribArray(h)}}setVertexAttribPointers(e,i,u){for(let h=0;h<this.attributes.length;h++){const g=this.attributes[h],x=i.attributes[g.name];x!==void 0&&e.vertexAttribPointer(x,g.components,e[su[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class wi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fo extends wi{getDefault(){return o.be.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class es extends wi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class dr extends wi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Ar extends wi{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class p extends wi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class s extends wi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class a extends wi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class d extends wi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class b extends wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class M extends wi{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class N extends wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class j extends wi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class te extends wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class fe extends wi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Me extends wi{getDefault(){return o.be.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Fe extends wi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class lt extends wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class Rt extends wi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Xt extends wi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ti extends wi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class vi extends wi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class bi extends wi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class zi extends wi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ji extends wi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Nn extends wi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Ps extends wi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Js extends wi{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ms extends wi{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const u=this.gl;zn(u)?u.bindVertexArray(e):(i=u.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class qa extends wi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class $a extends wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class pa extends wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Qs extends wi{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class ol extends Qs{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class As extends Qs{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Rs extends Qs{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const nc="Framebuffer is not complete";class rc{constructor(e,i,u,h,g){this.context=e,this.width=i,this.height=u;const x=e.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new ol(e,S),h)this.depthAttachment=g?new Rs(e,S):new As(e,S);else if(g)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(nc)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class Ti{constructor(e){var i,u;if(this.gl=e,this.clearColor=new fo(this),this.clearDepth=new es(this),this.clearStencil=new dr(this),this.colorMask=new Ar(this),this.depthMask=new p(this),this.stencilMask=new s(this),this.stencilFunc=new a(this),this.stencilOp=new d(this),this.stencilTest=new b(this),this.depthRange=new M(this),this.depthTest=new N(this),this.depthFunc=new j(this),this.blend=new te(this),this.blendFunc=new fe(this),this.blendColor=new Me(this),this.blendEquation=new Fe(this),this.cullFace=new lt(this),this.cullFaceSide=new Rt(this),this.frontFace=new Xt(this),this.program=new ti(this),this.activeTexture=new vi(this),this.viewport=new bi(this),this.bindFramebuffer=new zi(this),this.bindRenderbuffer=new ji(this),this.bindTexture=new Nn(this),this.bindVertexBuffer=new Ps(this),this.bindElementBuffer=new Js(this),this.bindVertexArray=new Ms(this),this.pixelStoreUnpack=new qa(this),this.pixelStoreUnpackPremultiplyAlpha=new $a(this),this.pixelStoreUnpackFlipY=new pa(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),zn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const h=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:h?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:h?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const h=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new sl(this,e,i)}createVertexBuffer(e,i,u){return new al(this,e,i,u)}createRenderbuffer(e,i,u){const h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,e,i,u),this.bindRenderbuffer.set(null),g}createFramebuffer(e,i,u,h){return new rc(this,e,i,u,h)}clear({color:e,depth:i,stencil:u}){const h=this.gl;let g=0;e&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),u!==void 0&&(g|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),h.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bG(e.blendFunction,di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return zn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return zn(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Za;function xh(m,e,i,u,h){const g=m.context,x=m.transform,S=g.gl,C=m.useProgram("collisionBox"),R=[];let D=0,B=0;for(let ue=0;ue<u.length;ue++){const de=u[ue],_e=e.getTile(de).getBucket(i);if(!_e)continue;const me=h?_e.textCollisionBox:_e.iconCollisionBox,xe=_e.collisionCircleArray;xe.length>0&&(R.push({circleArray:xe,circleOffset:B,coord:de}),D+=xe.length/4,B=D),me&&C.draw(g,S.LINES,hi.disabled,Vt.disabled,m.colorModeForRenderPass(),ci.disabled,ja(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(de),x.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,null,m.transform.zoom,null,null,me.collisionVertexBuffer)}if(!h||!R.length)return;const F=m.useProgram("collisionCircle"),U=new o.b_;U.resize(4*D),U._trim();let X=0;for(const ue of R)for(let de=0;de<ue.circleArray.length/4;de++){const _e=4*de,me=ue.circleArray[_e+0],xe=ue.circleArray[_e+1],we=ue.circleArray[_e+2],ge=ue.circleArray[_e+3];U.emplace(X++,me,xe,we,ge,0),U.emplace(X++,me,xe,we,ge,1),U.emplace(X++,me,xe,we,ge,2),U.emplace(X++,me,xe,we,ge,3)}(!Za||Za.length<2*D)&&(Za=function(ue){const de=2*ue,_e=new o.c0;_e.resize(de),_e._trim();for(let me=0;me<de;me++){const xe=6*me;_e.uint16[xe+0]=4*me+0,_e.uint16[xe+1]=4*me+1,_e.uint16[xe+2]=4*me+2,_e.uint16[xe+3]=4*me+2,_e.uint16[xe+4]=4*me+3,_e.uint16[xe+5]=4*me+0}return _e}(D));const oe=g.createIndexBuffer(Za,!0),ae=g.createVertexBuffer(U,o.b$.members,!0);for(const ue of R){const de=Va(m.transform);F.draw(g,S.TRIANGLES,hi.disabled,Vt.disabled,m.colorModeForRenderPass(),ci.disabled,de,m.style.map.terrain&&m.style.map.terrain.getTerrainData(ue.coord),null,i.id,ae,oe,o.aL.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,m.transform.zoom,null,null,null)}ae.destroy(),oe.destroy()}const bh=o.af(new Float32Array(16));function ll(m,e,i,u,h,g){const{horizontalAlign:x,verticalAlign:S}=o.aG(m);return new o.P((-(x-.5)*e/h+u[0])*g,(-(S-.5)*i/h+u[1])*g)}function ed(m,e,i,u,h,g){const x=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(g);i||(S=S.rotate(-h));const C=x.add(S);return Pi(C.x,C.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const S=bt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),C=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return m.add(u.rotate(C))}return m.add(u)}function td(m,e,i,u,h,g,x,S,C,R,D,B){const F=m.text.placedSymbolArray,U=m.text.dynamicLayoutVertexArray,X=m.icon.dynamicLayoutVertexArray,oe={};U.clear();for(let ae=0;ae<F.length;ae++){const ue=F.get(ae),de=ue.hidden||!ue.crossTileID||m.allowVerticalPlacement&&!ue.placedOrientation?null:u[ue.crossTileID];if(de){const _e=new o.P(ue.anchorX,ue.anchorY),me={getElevation:B,width:h.width,height:h.height,pitchedLabelPlaneMatrix:g,pitchWithMap:i,transform:h,tileAnchorPoint:_e,translation:R,unwrappedTileID:D},xe=i?li(_e.x,_e.y,me):bt(_e.x,_e.y,me),we=Yt(h.cameraToCenterDistance,xe.signedDistanceFromCamera);let ge=o.ao(m.textSizeData,S,ue)*we/o.aA;i&&(ge*=m.tilePixelRatio/x);const{width:Ce,height:Be,anchor:De,textOffset:ze,textBoxScale:je}=de,St=ll(De,Ce,Be,ze,je,ge),wt=h.getPitchedTextCorrection(_e.x+R[0],_e.y+R[1],D),st=ed(xe.point,me,e,St,-h.bearingInRadians,wt),zt=m.allowVerticalPlacement&&ue.placedOrientation===o.an.vertical?Math.PI/2:0;for(let _i=0;_i<ue.numGlyphs;_i++)o.au(U,st,zt);C&&ue.associatedIconIndex>=0&&(oe[ue.associatedIconIndex]={shiftedAnchor:st,angle:zt})}else ss(ue.numGlyphs,U)}if(C){X.clear();const ae=m.icon.placedSymbolArray;for(let ue=0;ue<ae.length;ue++){const de=ae.get(ue);if(de.hidden)ss(de.numGlyphs,X);else{const _e=oe[ue];if(_e)for(let me=0;me<de.numGlyphs;me++)o.au(X,_e.shiftedAnchor,_e.angle);else ss(de.numGlyphs,X)}}m.icon.dynamicLayoutVertexBuffer.updateData(X)}m.text.dynamicLayoutVertexBuffer.updateData(U)}function wh(m,e,i){return i.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Th(m,e,i,u,h,g,x,S,C,R,D,B,F){const U=m.context,X=U.gl,oe=m.transform,ae=S==="map",ue=C==="map",de=S!=="viewport"&&i.layout.get("symbol-placement")!=="point",_e=ae&&!ue&&!de,me=!i.layout.get("symbol-sort-key").isConstant();let xe=!1;const we=m.getDepthModeForSublayer(0,hi.ReadOnly),ge=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ce=[],Be=oe.getCircleRadiusCorrection();for(const De of u){const ze=e.getTile(De),je=ze.getBucket(i);if(!je)continue;const St=h?je.text:je.icon;if(!St||!St.segments.get().length||!St.hasVisibleVertices)continue;const wt=St.programConfigurations.get(i.id),st=h||je.sdfIcons,zt=h?je.textSizeData:je.iconSizeData,_i=ue||oe.pitch!==0,Oi=m.useProgram(wh(st,h,je),wt),on=o.am(zt,oe.zoom),Gi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(De);let ln,Zi,qi,Hi,rr=[0,0],Mi=null;if(h)Zi=ze.glyphAtlasTexture,qi=X.LINEAR,ln=ze.glyphAtlasTexture.size,je.iconsInText&&(rr=ze.imageAtlasTexture.size,Mi=ze.imageAtlasTexture,Hi=_i||m.options.rotating||m.options.zooming||zt.kind==="composite"||zt.kind==="camera"?X.LINEAR:X.NEAREST);else{const Sn=i.layout.get("icon-size").constantOr(0)!==1||je.iconsNeedLinear;Zi=ze.imageAtlasTexture,qi=st||m.options.rotating||m.options.zooming||Sn||_i?X.LINEAR:X.NEAREST,ln=ze.imageAtlasTexture.size}const Xn=o.aB(ze,1,m.transform.zoom),sr=ii(ae,m.transform,Xn),xa=o.L();o.ap(xa,sr);const ba=Bi(ue,ae,m.transform,Xn),wa=o.aC(oe,ze,g,x),zs=oe.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),wl=ge&&je.hasTextData(),Tl=i.layout.get("icon-text-fit")!=="none"&&wl&&je.hasIconData();if(de){const Sn=m.style.map.terrain?(wr,On)=>m.style.map.terrain.getElevation(De,wr,On):null,Qi=i.layout.get("text-rotation-alignment")==="map";dn(je,m,h,sr,xa,ue,R,Qi,De.toUnwrapped(),oe.width,oe.height,wa,Sn)}const Io=h&&ge||Tl,Lr=de||Io?bh:ue?sr:m.transform.clipSpaceToPixelsMatrix,ps=st&&i.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ta;Ta=st?je.iconsInText?ic(zt.kind,on,_e,ue,de,Io,m,Lr,ba,wa,ln,rr,Be):Ks(zt.kind,on,_e,ue,de,Io,m,Lr,ba,wa,h,ln,0,Be):ho(zt.kind,on,_e,ue,de,Io,m,Lr,ba,wa,h,ln,Be);const Wa={program:Oi,buffers:St,uniformValues:Ta,projectionData:zs,atlasTexture:Zi,atlasTextureIcon:Mi,atlasInterpolation:qi,atlasInterpolationIcon:Hi,isSDF:st,hasHalo:ps};if(me&&je.canOverlap){xe=!0;const Sn=St.segments.get();for(const Qi of Sn)Ce.push({segments:new o.aL([Qi]),sortKey:Qi.sortKey,state:Wa,terrainData:Gi})}else Ce.push({segments:St.segments,sortKey:0,state:Wa,terrainData:Gi})}xe&&Ce.sort((De,ze)=>De.sortKey-ze.sortKey);for(const De of Ce){const ze=De.state;if(U.activeTexture.set(X.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,X.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(U.activeTexture.set(X.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),ze.isSDF){const je=ze.uniformValues;ze.hasHalo&&(je.u_is_halo=1,au(ze.buffers,De.segments,i,m,ze.program,we,D,B,je,ze.projectionData,De.terrainData)),je.u_is_halo=0}au(ze.buffers,De.segments,i,m,ze.program,we,D,B,ze.uniformValues,ze.projectionData,De.terrainData)}}function au(m,e,i,u,h,g,x,S,C,R,D){const B=u.context;h.draw(B,B.gl.TRIANGLES,g,x,S,ci.backCCW,C,D,R,i.id,m.layoutVertexBuffer,m.indexBuffer,e,i.paint,u.transform.zoom,m.programConfigurations.get(i.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function ou(m,e,i,u,h){const g=m.context,x=g.gl,S=Vt.disabled,C=new di([x.ONE,x.ONE],o.be.transparent,[!0,!0,!0,!0]),R=e.getBucket(i);if(!R)return;const D=u.key;let B=i.heatmapFbos.get(D);B||(B=ul(g,e.tileSize,e.tileSize),i.heatmapFbos.set(D,B)),g.bindFramebuffer.set(B.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:o.be.transparent});const F=R.programConfigurations.get(i.id),U=m.useProgram("heatmap",F,!h),X=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),oe=m.style.map.terrain.getTerrainData(u);U.draw(g,x.TRIANGLES,hi.disabled,S,C,ci.disabled,Ua(e,m.transform.zoom,i.paint.get("heatmap-intensity"),1),oe,X,i.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,i.paint,m.transform.zoom,F)}function lu(m,e,i,u,h){const g=m.context,x=g.gl,S=m.transform;g.setColorMode(m.colorModeForRenderPass());const C=uu(g,e),R=i.key,D=e.heatmapFbos.get(R);if(!D)return;g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,D.colorAttachment.get()),g.activeTexture.set(x.TEXTURE1),C.bind(x.LINEAR,x.CLAMP_TO_EDGE);const B=S.getProjectionData({overscaledTileID:i,applyTerrainMatrix:h,applyGlobeMatrix:!u});m.useProgram("heatmapTexture").draw(g,x.TRIANGLES,hi.disabled,Vt.disabled,m.colorModeForRenderPass(),ci.disabled,Jl(m,e,0,1),null,B,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,S.zoom),D.destroy(),e.heatmapFbos.delete(R)}function ul(m,e,i){var u,h;const g=m.gl,x=g.createTexture();g.bindTexture(g.TEXTURE_2D,x),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const S=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:g.UNSIGNED_BYTE,C=(h=m.RGBA16F)!==null&&h!==void 0?h:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,C,e,i,0,g.RGBA,S,null);const R=m.createFramebuffer(e,i,!1,!1);return R.colorAttachment.set(x),R}function uu(m,e){return e.colorRampTexture||(e.colorRampTexture=new o.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function sc(m,e,i,u,h){if(!i||!u||!u.imageAtlas)return;const g=u.imageAtlas.patternPositions;let x=g[i.to.toString()],S=g[i.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){const C=h.getPaintProperty(e);x=g[C],S=g[C]}x&&S&&m.setConstantPatternPositions(x,S)}function cl(m,e,i,u,h,g,x,S){const C=m.context.gl,R="fill-pattern",D=i.paint.get(R),B=D&&D.constantOr(1),F=i.getCrossfadeParameters();let U,X,oe,ae,ue;const de=m.transform,_e=i.paint.get("fill-translate"),me=i.paint.get("fill-translate-anchor");x?(X=B&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=C.LINES):(X=B?"fillPattern":"fill",U=C.TRIANGLES);const xe=D.constantOr(null);for(const we of u){const ge=e.getTile(we);if(B&&!ge.patternsLoaded())continue;const Ce=ge.getBucket(i);if(!Ce)continue;const Be=Ce.programConfigurations.get(i.id),De=m.useProgram(X,Be),ze=m.style.map.terrain&&m.style.map.terrain.getTerrainData(we);B&&(m.context.activeTexture.set(C.TEXTURE0),ge.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Be.updatePaintBuffers(F)),sc(Be,R,xe,ge,i);const je=de.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),St=o.aC(de,ge,_e,me);if(x){ae=Ce.indexBuffer2,ue=Ce.segments2;const st=[C.drawingBufferWidth,C.drawingBufferHeight];oe=X==="fillOutlinePattern"&&B?tc(m,F,ge,st,St):Mr(st,St)}else ae=Ce.indexBuffer,ue=Ce.segments,oe=B?Ba(m,F,ge,St):{u_fill_translate:St};const wt=m.stencilModeForClipping(we);De.draw(m.context,U,h,wt,g,ci.backCCW,oe,ze,je,i.id,Ce.layoutVertexBuffer,ae,ue,i.paint,m.transform.zoom,Be)}}function po(m,e,i,u,h,g,x,S){const C=m.context,R=C.gl,D="fill-extrusion-pattern",B=i.paint.get(D),F=B.constantOr(1),U=i.getCrossfadeParameters(),X=i.paint.get("fill-extrusion-opacity"),oe=B.constantOr(null),ae=m.transform;for(const ue of u){const de=e.getTile(ue),_e=de.getBucket(i);if(!_e)continue;const me=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ue),xe=_e.programConfigurations.get(i.id),we=m.useProgram(F?"fillExtrusionPattern":"fillExtrusion",xe);F&&(m.context.activeTexture.set(R.TEXTURE0),de.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),xe.updatePaintBuffers(U));const ge=ae.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!S,applyTerrainMatrix:!0});sc(xe,D,oe,de,i);const Ce=o.aC(ae,de,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Be=i.paint.get("fill-extrusion-vertical-gradient"),De=F?uo(m,Be,X,Ce,ue,U,de):fa(m,Be,X,Ce);we.draw(C,C.gl.TRIANGLES,h,g,x,ci.backCCW,De,me,ge,i.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,i.paint,m.transform.zoom,xe,m.style.map.terrain&&_e.centroidVertexBuffer)}}function mo(m,e,i,u,h,g,x,S,C){var R;const D=m.style.projection,B=m.context,F=m.transform,U=B.gl,X=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],oe=m.useProgram("hillshade",null,!1,X),ae=!m.options.moving;for(const ue of u){const de=e.getTile(ue),_e=de.fbo;if(!_e)continue;const me=D.getMeshFromTileID(B,ue.canonical,S,!0,"raster"),xe=(R=m.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ue);B.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,_e.colorAttachment.get());const we=F.getProjectionData({overscaledTileID:ue,aligned:ae,applyGlobeMatrix:!C,applyTerrainMatrix:!0});oe.draw(B,U.TRIANGLES,g,h[ue.overscaledZ],x,ci.backCCW,da(m,de,i),xe,we,i.id,me.vertexBuffer,me.indexBuffer,me.segments)}}function hl(m,e,i,u,h,g,x,S,C){var R;const D=m.style.projection,B=m.context,F=m.transform,U=B.gl,X=m.useProgram("colorRelief"),oe=!m.options.moving;let ae=!0,ue=0;for(const de of u){const _e=e.getTile(de),me=_e.dem;if(ae){const De=U.getParameter(U.MAX_TEXTURE_SIZE),{elevationTexture:ze,colorTexture:je}=i.getColorRampTextures(B,De,me.getUnpackVector());B.activeTexture.set(U.TEXTURE1),ze.bind(U.NEAREST,U.CLAMP_TO_EDGE),B.activeTexture.set(U.TEXTURE4),je.bind(U.LINEAR,U.CLAMP_TO_EDGE),ae=!1,ue=ze.size[0]}if(!me||!me.data)continue;const xe=me.stride,we=me.getPixels();if(B.activeTexture.set(U.TEXTURE0),B.pixelStoreUnpackPremultiplyAlpha.set(!1),_e.demTexture=_e.demTexture||m.getTileTexture(xe),_e.demTexture){const De=_e.demTexture;De.update(we,{premultiply:!1}),De.bind(U.LINEAR,U.CLAMP_TO_EDGE)}else _e.demTexture=new o.T(B,we,U.RGBA,{premultiply:!1}),_e.demTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ge=D.getMeshFromTileID(B,de.canonical,S,!0,"raster"),Ce=(R=m.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(de),Be=F.getProjectionData({overscaledTileID:de,aligned:oe,applyGlobeMatrix:!C,applyTerrainMatrix:!0});X.draw(B,U.TRIANGLES,g,h[de.overscaledZ],x,ci.backCCW,tu(i,_e.dem,ue),Ce,Be,i.id,ge.vertexBuffer,ge.indexBuffer,ge.segments)}}const ac=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function ma(m,e,i,u,h,g,x,S,C=!1,R=!1){const D=u[u.length-1].overscaledZ,B=m.context,F=B.gl,U=m.useProgram("raster"),X=m.transform,oe=m.style.projection,ae=m.colorModeForRenderPass(),ue=!m.options.moving;for(const de of u){const _e=m.getDepthModeForSublayer(de.overscaledZ-D,i.paint.get("raster-opacity")===1?hi.ReadWrite:hi.ReadOnly,F.LESS),me=e.getTile(de);me.registerFadeDuration(i.paint.get("raster-fade-duration"));const xe=e.findLoadedParent(de,0),we=e.findLoadedSibling(de),ge=id(me,xe||we||null,e,i,m.transform,m.style.map.terrain);let Ce,Be;const De=i.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;B.activeTexture.set(F.TEXTURE0),me.texture.bind(De,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(F.TEXTURE1),xe?(xe.texture.bind(De,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Ce=Math.pow(2,xe.tileID.overscaledZ-me.tileID.overscaledZ),Be=[me.tileID.canonical.x*Ce%1,me.tileID.canonical.y*Ce%1]):me.texture.bind(De,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),me.texture.useMipmap&&B.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const ze=m.style.map.terrain&&m.style.map.terrain.getTerrainData(de),je=X.getProjectionData({overscaledTileID:de,aligned:ue,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),St=Ys(Be||[0,0],Ce||1,ge,i,S),wt=oe.getMeshFromTileID(B,de.canonical,g,x,"raster");U.draw(B,F.TRIANGLES,_e,h?h[de.overscaledZ]:Vt.disabled,ae,C?ci.frontCCW:ci.backCCW,St,ze,je,i.id,wt.vertexBuffer,wt.indexBuffer,wt.segments)}}function id(m,e,i,u,h,g){const x=u.paint.get("raster-fade-duration");if(!g&&x>0){const S=ce.now(),C=(S-m.timeAdded)/x,R=e?(S-e.timeAdded)/x:-1,D=i.getSource(),B=Ge(h,{tileSize:D.tileSize,roundZoom:D.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),U=F&&m.refreshedUponExpiration?1:o.ag(F?C:1-R,0,1);return m.refreshedUponExpiration&&C>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const Sh=new o.be(1,0,0,1),cu=new o.be(0,1,0,1),oc=new o.be(0,0,1,1),Ih=new o.be(1,0,1,1),kh=new o.be(0,1,1,1);function fl(m,e,i,u){fu(m,0,e+i/2,m.transform.width,i,u)}function hu(m,e,i,u){fu(m,e-i/2,0,i,m.transform.height,u)}function fu(m,e,i,u,h,g){const x=m.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*m.pixelRatio,i*m.pixelRatio,u*m.pixelRatio,h*m.pixelRatio),x.clear({color:g}),S.disable(S.SCISSOR_TEST)}function Eh(m,e,i){const u=m.context,h=u.gl,g=m.useProgram("debug"),x=hi.disabled,S=Vt.disabled,C=m.colorModeForRenderPass(),R="$debug",D=m.style.map.terrain&&m.style.map.terrain.getTerrainData(i);u.activeTexture.set(h.TEXTURE0);const B=e.getTileByID(i.key).latestRawTileData,F=Math.floor((B&&B.byteLength||0)/1024),U=e.getTile(i).tileSize,X=512/Math.min(U,512)*(i.overscaledZ/m.transform.zoom)*.5;let oe=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(oe+=` => ${i.overscaledZ}`),function(ue,de){ue.initDebugOverlayCanvas();const _e=ue.debugOverlayCanvas,me=ue.context.gl,xe=ue.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,_e.width,_e.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(de,5,5),xe.strokeText(de,5,5),ue.debugOverlayTexture.update(_e),ue.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)}(m,`${oe} ${F}kB`);const ae=m.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(u,h.TRIANGLES,x,S,di.alphaBlended,ci.disabled,Kl(o.be.transparent,X),null,ae,R,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(u,h.LINE_STRIP,x,S,C,ci.disabled,Kl(o.be.red),D,ae,R,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function mn(m,e,i,u){const{isRenderingGlobe:h}=u,g=m.context,x=g.gl,S=m.transform,C=m.colorModeForRenderPass(),R=m.getDepthModeFor3D(),D=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const B of i){const F=e.getTerrainMesh(B.tileID),U=m.renderToTexture.getTexture(B),X=e.getTerrainData(B.tileID);g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,U.texture);const oe=e.getMeshFrameDelta(S.zoom),ae=S.calculateFogMatrix(B.tileID.toUnwrapped()),ue=Gr(oe,ae,m.style.sky,S.pitch,h),de=S.getProjectionData({overscaledTileID:B.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(g,x.TRIANGLES,R,Vt.disabled,C,ci.backCCW,ue,X,de,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}}function ga(m,e){if(!e.mesh){const i=new o.aK;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const u=new o.aM;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new Jr(m.createVertexBuffer(i,us.members),m.createIndexBuffer(u),o.aL.simpleSegment(0,0,i.length,u.length))}return e.mesh}class ts{constructor(e,i){this.context=new Ti(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=et.maxUnderzooming+et.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Da}resize(e,i,u){if(this.width=Math.floor(e*u),this.height=Math.floor(i*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const e=this.context,i=new o.aK;i.emplaceBack(0,0),i.emplaceBack(o.$,0),i.emplaceBack(0,o.$),i.emplaceBack(o.$,o.$),this.tileExtentBuffer=e.createVertexBuffer(i,us.members),this.tileExtentSegments=o.aL.simpleSegment(0,0,4,2);const u=new o.aK;u.emplaceBack(0,0),u.emplaceBack(o.$,0),u.emplaceBack(0,o.$),u.emplaceBack(o.$,o.$),this.debugBuffer=e.createVertexBuffer(u,us.members),this.debugSegments=o.aL.simpleSegment(0,0,4,5);const h=new o.c5;h.emplaceBack(0,0,0,0),h.emplaceBack(o.$,0,o.$,0),h.emplaceBack(0,o.$,0,o.$),h.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=e.createVertexBuffer(h,Ko.members),this.rasterBoundsSegments=o.aL.simpleSegment(0,0,4,2);const g=new o.aK;g.emplaceBack(0,0),g.emplaceBack(o.$,0),g.emplaceBack(0,o.$),g.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,us.members),this.rasterBoundsSegmentsPosOnly=o.aL.simpleSegment(0,0,4,5);const x=new o.aK;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(x,us.members),this.viewportSegments=o.aL.simpleSegment(0,0,4,2);const S=new o.c6;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);const C=new o.aM;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(C);const R=this.context.gl;this.stencilClearMode=new Vt({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new Jr(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=o.L();o.bX(u,0,this.width,this.height,0,0,1),o.N(u,u,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const h={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,hi.disabled,this.stencilClearMode,di.disabled,ci.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const h=this.context;h.setColorMode(di.disabled),h.setDepthMode(hi.disabled);const g={};for(const x of i)g[x.key]=this.nextStencilID++;this._renderTileMasks(g,i,u,!0),this._renderTileMasks(g,i,u,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,i,u,h){const g=this.context,x=g.gl,S=this.style.projection,C=this.transform,R=this.useProgram("clippingMask");for(const D of i){const B=e[D.key],F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),U=S.getMeshFromTileID(this.context,D.canonical,h,!0,"stencil"),X=C.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!u,applyTerrainMatrix:!0});R.draw(g,x.TRIANGLES,hi.disabled,new Vt({func:x.ALWAYS,mask:0},B,255,x.KEEP,x.KEEP,x.REPLACE),di.disabled,u?ci.disabled:ci.backCCW,null,F,X,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,u=this.style.projection,h=this.transform,g=this.useProgram("depth"),x=this.getDepthModeFor3D(),S=Ue(h,{tileSize:h.tileSize});for(const C of S){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),D=u.getMeshFromTileID(this.context,C.canonical,!0,!0,"raster"),B=h.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,i.TRIANGLES,x,Vt.disabled,di.disabled,ci.backCCW,null,R,B,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new Vt({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new Vt({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,u=e.sort((x,S)=>S.overscaledZ-x.overscaledZ),h=u[u.length-1].overscaledZ,g=u[0].overscaledZ-h+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let S=0;S<g;S++)x[S+h]=new Vt({func:i.GEQUAL,mask:255},S+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=g,[x,u]}return[{[h]:Vt.disabled},u]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,u=e.sort((x,S)=>S.overscaledZ-x.overscaledZ),h=u[u.length-1].overscaledZ,g=u[0].overscaledZ-h+1;if(this.clearStencil(),g>1){const x={},S={};for(let C=0;C<g;C++)x[C+h]=new Vt({func:i.GREATER,mask:255},g+1+C,255,i.KEEP,i.KEEP,i.REPLACE),S[C+h]=new Vt({func:i.GREATER,mask:255},1+C,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*g+1,[x,S,u]}return this.nextStencilID=3,[{[h]:new Vt({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[h]:new Vt({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new di([e.CONSTANT_COLOR,e.ONE],new o.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?di.unblended:di.alphaBlended}getDepthModeForSublayer(e,i,u){if(!this.opaquePassEnabledForLayer())return hi.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new hi(u||this.context.gl.LEQUAL,i,[h,h])}getDepthModeFor3D(){return new hi(this.context.gl.LEQUAL,hi.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var u,h;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ce.now()),this.imageManager.beginFrame();const g=this.style._order,x=this.style.sourceCaches,S={},C={},R={},D={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const F in x){const U=x[F];U.used&&U.prepare(this.context),S[F]=U.getVisibleCoordinates(!1),C[F]=S[F].slice().reverse(),R[F]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<g.length;F++)if(this.style._layers[g[F]].is3D()){this.opaquePassCutoff=F;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const F of g){const U=this.style._layers[F];if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const X=C[U.source];(U.type==="custom"||X.length)&&this.renderLayer(this,x[U.source],U,X,D)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:F=>this.useProgram(F)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?o.be.black:o.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(F,U){const X=F.context,oe=X.gl,ae=((we,ge,Ce)=>{const Be=Math.cos(ge.rollInRadians),De=Math.sin(ge.rollInRadians),ze=ee(ge),je=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:we.properties.get("sky-color"),u_horizon_color:we.properties.get("horizon-color"),u_horizon:[(ge.width/2-ze*De)*Ce,(ge.height/2+ze*Be)*Ce],u_horizon_normal:[-De,Be],u_sky_horizon_blend:we.properties.get("sky-horizon-blend")*ge.height/2*Ce,u_sky_blend:je}})(U,F.style.map.transform,F.pixelRatio),ue=new hi(oe.LEQUAL,hi.ReadWrite,[0,1]),de=Vt.disabled,_e=F.colorModeForRenderPass(),me=F.useProgram("sky"),xe=ga(X,U);me.draw(X,oe.TRIANGLES,ue,de,_e,ci.disabled,ae,null,void 0,"sky",xe.vertexBuffer,xe.indexBuffer,xe.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[g[this.currentLayer]],U=x[F.source],X=S[F.source];this._renderTileClippingMasks(F,X,!1),this.renderLayer(this,U,F,X,D)}this.renderPass="translucent";let B=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const F=this.style._layers[g[this.currentLayer]],U=x[F.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(F,D))continue;this.opaquePassEnabledForLayer()||B||(B=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const X=(F.type==="symbol"?R:C)[F.source];this._renderTileClippingMasks(F,S[F.source],!!this.renderToTexture),this.renderLayer(this,U,F,X,D)}if(D.isRenderingGlobe&&function(F,U,X){const oe=F.context,ae=oe.gl,ue=F.useProgram("atmosphere"),de=new hi(ae.LEQUAL,hi.ReadOnly,[0,1]),_e=F.transform,me=function(je,St){const wt=je.properties.get("position"),st=[-wt.x,-wt.y,-wt.z],zt=o.af(new Float64Array(16));return je.properties.get("anchor")==="map"&&(o.b5(zt,zt,St.rollInRadians),o.b6(zt,zt,-St.pitchInRadians),o.b5(zt,zt,St.bearingInRadians),o.b6(zt,zt,St.center.lat*Math.PI/180),o.by(zt,zt,-St.center.lng*Math.PI/180)),o.c4(st,st,zt),st}(X,F.transform),xe=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),we=U.properties.get("atmosphere-blend")*xe.projectionTransition;if(we===0)return;const ge=Vr(_e.worldSize,_e.center.lat),Ce=_e.inverseProjectionMatrix,Be=new Float64Array(4);Be[3]=1,o.av(Be,Be,_e.modelViewProjectionMatrix),Be[0]/=Be[3],Be[1]/=Be[3],Be[2]/=Be[3],Be[3]=1,o.av(Be,Be,Ce),Be[0]/=Be[3],Be[1]/=Be[3],Be[2]/=Be[3],Be[3]=1;const De=((je,St,wt,st,zt)=>({u_sun_pos:je,u_atmosphere_blend:St,u_globe_position:wt,u_globe_radius:st,u_inv_proj_matrix:zt}))(me,we,[Be[0],Be[1],Be[2]],ge,Ce),ze=ga(oe,U);ue.draw(oe,ae.TRIANGLES,de,Vt.disabled,di.alphaBlended,ci.disabled,De,null,null,"atmosphere",ze.vertexBuffer,ze.indexBuffer,ze.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const F=function(U,X){let oe=null;const ae=Object.values(U._layers).flatMap(me=>me.source&&!me.isHidden(X)?[U.sourceCaches[me.source]]:[]),ue=ae.filter(me=>me.getSource().type==="vector"),de=ae.filter(me=>me.getSource().type!=="vector"),_e=me=>{(!oe||oe.getSource().maxzoom<me.getSource().maxzoom)&&(oe=me)};return ue.forEach(me=>_e(me)),oe||de.forEach(me=>_e(me)),oe}(this.style,this.transform.zoom);F&&function(U,X,oe){for(let ae=0;ae<oe.length;ae++)Eh(U,X,oe[ae])}(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const U=F.transform.padding;fl(F,F.transform.height-(U.top||0),3,Sh),fl(F,U.bottom||0,3,cu),hu(F,U.left||0,3,oc),hu(F,F.transform.width-(U.right||0),3,Ih);const X=F.transform.centerPoint;(function(oe,ae,ue,de){fu(oe,ae-1,ue-10,2,20,de),fu(oe,ae-10,ue-1,20,2,de)})(F,X.x,F.transform.height-X.y,kh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=e?!o.c7(i,u):!o.c8(i,u)),h||(h=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(o.c9(i,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(g,x){const S=g.context,C=S.gl,R=g.transform,D=di.unblended,B=new hi(C.LEQUAL,hi.ReadWrite,[0,1]),F=x.sourceCache.getRenderableTiles(),U=g.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),S.clear({color:o.be.transparent,depth:1});for(const X of F){const oe=x.getTerrainMesh(X.tileID),ae=x.getTerrainData(X.tileID),ue=R.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),de={u_ele_delta:x.getMeshFrameDelta(R.zoom)};U.draw(S,C.TRIANGLES,B,Vt.disabled,D,ci.backCCW,de,ae,ue,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain),function(g,x){const S=g.context,C=S.gl,R=g.transform,D=di.unblended,B=new hi(C.LEQUAL,hi.ReadWrite,[0,1]),F=x.getCoordsTexture(),U=x.sourceCache.getRenderableTiles(),X=g.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),S.clear({color:o.be.transparent,depth:1}),x.coordsIndex=[];for(const oe of U){const ae=x.getTerrainMesh(oe.tileID),ue=x.getTerrainData(oe.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,F.texture);const de={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(R.zoom)},_e=R.getProjectionData({overscaledTileID:oe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});X.draw(S,C.TRIANGLES,B,Vt.disabled,D,ci.backCCW,de,ue,_e,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments),x.coordsIndex.push(oe.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain))}renderLayer(e,i,u,h,g){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(h||[]).length)&&(this.id=u.id,o.ca(u)?function(x,S,C,R,D,B){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:F}=B,U=Vt.disabled,X=x.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(oe,ae,ue,de,_e,me,xe,we,ge){const Ce=ae.transform,Be=ae.style.map.terrain,De=_e==="map",ze=me==="map";for(const je of oe){const St=de.getTile(je),wt=St.getBucket(ue);if(!wt||!wt.text||!wt.text.segments.get().length)continue;const st=o.am(wt.textSizeData,Ce.zoom),zt=o.aB(St,1,ae.transform.zoom),_i=ii(De,ae.transform,zt),Oi=ue.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(st){const on=Math.pow(2,Ce.zoom-St.tileID.overscaledZ),Gi=Be?(ln,Zi)=>Be.getElevation(je,ln,Zi):null;td(wt,De,ze,ge,Ce,_i,on,st,Oi,o.aC(Ce,St,xe,we),je.toUnwrapped(),Gi)}}}(R,x,C,S,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),D),C.paint.get("icon-opacity").constantOr(1)!==0&&Th(x,S,C,R,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),U,X,F),C.paint.get("text-opacity").constantOr(1)!==0&&Th(x,S,C,R,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),U,X,F),S.map.showCollisionBoxes&&(xh(x,S,C,R,!0),xh(x,S,C,R,!1))}(e,i,u,h,this.style.placement.variableOffsets,g):o.cb(u)?function(x,S,C,R,D){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:B}=D,F=C.paint.get("circle-opacity"),U=C.paint.get("circle-stroke-width"),X=C.paint.get("circle-stroke-opacity"),oe=!C.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(U.constantOr(1)===0||X.constantOr(1)===0))return;const ae=x.context,ue=ae.gl,de=x.transform,_e=x.getDepthModeForSublayer(0,hi.ReadOnly),me=Vt.disabled,xe=x.colorModeForRenderPass(),we=[],ge=de.getCircleRadiusCorrection();for(let Ce=0;Ce<R.length;Ce++){const Be=R[Ce],De=S.getTile(Be),ze=De.getBucket(C);if(!ze)continue;const je=C.paint.get("circle-translate"),St=C.paint.get("circle-translate-anchor"),wt=o.aC(de,De,je,St),st=ze.programConfigurations.get(C.id),zt=x.useProgram("circle",st),_i=ze.layoutVertexBuffer,Oi=ze.indexBuffer,on=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Be),Gi={programConfiguration:st,program:zt,layoutVertexBuffer:_i,indexBuffer:Oi,uniformValues:Jo(x,De,C,wt,ge),terrainData:on,projectionData:de.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!B,applyTerrainMatrix:!0})};if(oe){const ln=ze.segments.get();for(const Zi of ln)we.push({segments:new o.aL([Zi]),sortKey:Zi.sortKey,state:Gi})}else we.push({segments:ze.segments,sortKey:0,state:Gi})}oe&&we.sort((Ce,Be)=>Ce.sortKey-Be.sortKey);for(const Ce of we){const{programConfiguration:Be,program:De,layoutVertexBuffer:ze,indexBuffer:je,uniformValues:St,terrainData:wt,projectionData:st}=Ce.state;De.draw(ae,ue.TRIANGLES,_e,me,xe,ci.backCCW,St,wt,st,C.id,ze,je,Ce.segments,C.paint,x.transform.zoom,Be)}}(e,i,u,h,g):o.cc(u)?function(x,S,C,R,D){if(C.paint.get("heatmap-opacity")===0)return;const B=x.context,{isRenderingToTexture:F,isRenderingGlobe:U}=D;if(x.style.map.terrain){for(const X of R){const oe=S.getTile(X);S.hasRenderableParent(X)||(x.renderPass==="offscreen"?ou(x,oe,C,X,U):x.renderPass==="translucent"&&lu(x,C,X,F,U))}B.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?function(X,oe,ae,ue){const de=X.context,_e=de.gl,me=X.transform,xe=Vt.disabled,we=new di([_e.ONE,_e.ONE],o.be.transparent,[!0,!0,!0,!0]);(function(ge,Ce,Be){const De=ge.gl;ge.activeTexture.set(De.TEXTURE1),ge.viewport.set([0,0,Ce.width/4,Ce.height/4]);let ze=Be.heatmapFbos.get(o.c1);ze?(De.bindTexture(De.TEXTURE_2D,ze.colorAttachment.get()),ge.bindFramebuffer.set(ze.framebuffer)):(ze=ul(ge,Ce.width/4,Ce.height/4),Be.heatmapFbos.set(o.c1,ze))})(de,X,ae),de.clear({color:o.be.transparent});for(let ge=0;ge<ue.length;ge++){const Ce=ue[ge];if(oe.hasRenderableParent(Ce))continue;const Be=oe.getTile(Ce),De=Be.getBucket(ae);if(!De)continue;const ze=De.programConfigurations.get(ae.id),je=X.useProgram("heatmap",ze),St=me.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),wt=me.getCircleRadiusCorrection();je.draw(de,_e.TRIANGLES,hi.disabled,xe,we,ci.backCCW,Ua(Be,me.zoom,ae.paint.get("heatmap-intensity"),wt),null,St,ae.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,ae.paint,me.zoom,ze)}de.viewport.set([0,0,X.width,X.height])}(x,S,C,R):x.renderPass==="translucent"&&function(X,oe){const ae=X.context,ue=ae.gl;ae.setColorMode(X.colorModeForRenderPass());const de=oe.heatmapFbos.get(o.c1);de&&(ae.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,de.colorAttachment.get()),ae.activeTexture.set(ue.TEXTURE1),uu(ae,oe).bind(ue.LINEAR,ue.CLAMP_TO_EDGE),X.useProgram("heatmapTexture").draw(ae,ue.TRIANGLES,hi.disabled,Vt.disabled,X.colorModeForRenderPass(),ci.disabled,Jl(X,oe,0,1),null,null,oe.id,X.viewportBuffer,X.quadTriangleIndexBuffer,X.viewportSegments,oe.paint,X.transform.zoom))}(x,C)}(e,i,u,h,g):o.cd(u)?function(x,S,C,R,D){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:B}=D,F=C.paint.get("line-opacity"),U=C.paint.get("line-width");if(F.constantOr(1)===0||U.constantOr(1)===0)return;const X=x.getDepthModeForSublayer(0,hi.ReadOnly),oe=x.colorModeForRenderPass(),ae=C.paint.get("line-dasharray"),ue=C.paint.get("line-pattern"),de=ue.constantOr(1),_e=C.paint.get("line-gradient"),me=C.getCrossfadeParameters(),xe=de?"linePattern":ae?"lineSDF":_e?"lineGradient":"line",we=x.context,ge=we.gl,Ce=x.transform;let Be=!0;for(const De of R){const ze=S.getTile(De);if(de&&!ze.patternsLoaded())continue;const je=ze.getBucket(C);if(!je)continue;const St=je.programConfigurations.get(C.id),wt=x.context.program.get(),st=x.useProgram(xe,St),zt=Be||st.program!==wt,_i=x.style.map.terrain&&x.style.map.terrain.getTerrainData(De),Oi=ue.constantOr(null);if(Oi&&ze.imageAtlas){const qi=ze.imageAtlas,Hi=qi.patternPositions[Oi.to.toString()],rr=qi.patternPositions[Oi.from.toString()];Hi&&rr&&St.setConstantPatternPositions(Hi,rr)}const on=Ce.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Gi=Ce.getPixelScale(),ln=de?iu(x,ze,C,Gi,me):ae?nu(x,ze,C,Gi,ae,me):_e?Qo(x,ze,C,Gi,je.lineClipsArray.length):co(x,ze,C,Gi);if(de)we.activeTexture.set(ge.TEXTURE0),ze.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),St.updatePaintBuffers(me);else if(ae&&(zt||x.lineAtlas.dirty))we.activeTexture.set(ge.TEXTURE0),x.lineAtlas.bind(we);else if(_e){const qi=je.gradients[C.id];let Hi=qi.texture;if(C.gradientVersion!==qi.version){let rr=256;if(C.stepInterpolant){const Mi=S.getSource().maxzoom,Xn=De.canonical.z===Mi?Math.ceil(1<<x.transform.maxZoom-De.canonical.z):1;rr=o.ag(o.c2(je.maxLineLength/o.$*1024*Xn),256,we.maxTextureSize)}qi.gradient=o.c3({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:rr,image:qi.gradient||void 0,clips:je.lineClipsArray}),qi.texture?qi.texture.update(qi.gradient):qi.texture=new o.T(we,qi.gradient,ge.RGBA),qi.version=C.gradientVersion,Hi=qi.texture}we.activeTexture.set(ge.TEXTURE0),Hi.bind(C.stepInterpolant?ge.NEAREST:ge.LINEAR,ge.CLAMP_TO_EDGE)}const Zi=x.stencilModeForClipping(De);st.draw(we,ge.TRIANGLES,X,Zi,oe,ci.disabled,ln,_i,on,C.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,C.paint,x.transform.zoom,St,je.layoutVertexBuffer2),Be=!1}}(e,i,u,h,g):o.ce(u)?function(x,S,C,R,D){const B=C.paint.get("fill-color"),F=C.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const{isRenderingToTexture:U}=D,X=x.colorModeForRenderPass(),oe=C.paint.get("fill-pattern"),ae=x.opaquePassEnabledForLayer()&&!oe.constantOr(1)&&B.constantOr(o.be.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===ae){const ue=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?hi.ReadWrite:hi.ReadOnly);cl(x,S,C,R,ue,X,!1,U)}if(x.renderPass==="translucent"&&C.paint.get("fill-antialias")){const ue=x.getDepthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,hi.ReadOnly);cl(x,S,C,R,ue,X,!0,U)}}(e,i,u,h,g):o.cf(u)?function(x,S,C,R,D){const B=C.paint.get("fill-extrusion-opacity");if(B===0)return;const{isRenderingToTexture:F}=D;if(x.renderPass==="translucent"){const U=new hi(x.context.gl.LEQUAL,hi.ReadWrite,x.depthRangeFor3D);if(B!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))po(x,S,C,R,U,Vt.disabled,di.disabled,F),po(x,S,C,R,U,x.stencilModeFor3D(),x.colorModeForRenderPass(),F);else{const X=x.colorModeForRenderPass();po(x,S,C,R,U,Vt.disabled,X,F)}}}(e,i,u,h,g):o.cg(u)?function(x,S,C,R,D){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const{isRenderingToTexture:B}=D,F=x.context,U=x.style.projection.useSubdivision,X=x.getDepthModeForSublayer(0,hi.ReadOnly),oe=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(ae,ue,de,_e,me,xe,we){const ge=ae.context,Ce=ge.gl;for(const Be of de){const De=ue.getTile(Be),ze=De.dem;if(!ze||!ze.data||!De.needsHillshadePrepare)continue;const je=ze.dim,St=ze.stride,wt=ze.getPixels();if(ge.activeTexture.set(Ce.TEXTURE1),ge.pixelStoreUnpackPremultiplyAlpha.set(!1),De.demTexture=De.demTexture||ae.getTileTexture(St),De.demTexture){const zt=De.demTexture;zt.update(wt,{premultiply:!1}),zt.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE)}else De.demTexture=new o.T(ge,wt,Ce.RGBA,{premultiply:!1}),De.demTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);ge.activeTexture.set(Ce.TEXTURE0);let st=De.fbo;if(!st){const zt=new o.T(ge,{width:je,height:je,data:null},Ce.RGBA);zt.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),st=De.fbo=ge.createFramebuffer(je,je,!0,!1),st.colorAttachment.set(zt.texture)}ge.bindFramebuffer.set(st.framebuffer),ge.viewport.set([0,0,je,je]),ae.useProgram("hillshadePrepare").draw(ge,Ce.TRIANGLES,me,xe,we,ci.disabled,Ql(De.tileID,ze),null,null,_e.id,ae.rasterBoundsBuffer,ae.quadTriangleIndexBuffer,ae.rasterBoundsSegments),De.needsHillshadePrepare=!1}})(x,S,R,C,X,Vt.disabled,oe),F.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if(U){const[ae,ue,de]=x.stencilConfigForOverlapTwoPass(R);mo(x,S,C,de,ae,X,oe,!1,B),mo(x,S,C,de,ue,X,oe,!0,B)}else{const[ae,ue]=x.getStencilConfigForOverlapAndUpdateStencilID(R);mo(x,S,C,ue,ae,X,oe,!1,B)}}(e,i,u,h,g):o.ch(u)?function(x,S,C,R,D){if(x.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:B}=D,F=x.style.projection.useSubdivision,U=x.getDepthModeForSublayer(0,hi.ReadOnly),X=x.colorModeForRenderPass();if(F){const[oe,ae,ue]=x.stencilConfigForOverlapTwoPass(R);hl(x,S,C,ue,oe,U,X,!1,B),hl(x,S,C,ue,ae,U,X,!0,B)}else{const[oe,ae]=x.getStencilConfigForOverlapAndUpdateStencilID(R);hl(x,S,C,ae,oe,U,X,!1,B)}}(e,i,u,h,g):o.ci(u)?function(x,S,C,R,D){if(x.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:B}=D,F=S.getSource(),U=x.style.projection.useSubdivision;if(F instanceof Re)ma(x,S,C,R,null,!1,!1,F.tileCoords,F.flippedWindingOrder,B);else if(U){const[X,oe,ae]=x.stencilConfigForOverlapTwoPass(R);ma(x,S,C,ae,X,!1,!0,ac,!1,B),ma(x,S,C,ae,oe,!0,!0,ac,!1,B)}else{const[X,oe]=x.getStencilConfigForOverlapAndUpdateStencilID(R);ma(x,S,C,oe,X,!1,!0,ac,!1,B)}}(e,i,u,h,g):o.cj(u)?function(x,S,C,R,D){const B=C.paint.get("background-color"),F=C.paint.get("background-opacity");if(F===0)return;const{isRenderingToTexture:U}=D,X=x.context,oe=X.gl,ae=x.style.projection,ue=x.transform,de=ue.tileSize,_e=C.paint.get("background-pattern");if(x.isPatternMissing(_e))return;const me=!_e&&B.a===1&&F===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==me)return;const xe=Vt.disabled,we=x.getDepthModeForSublayer(0,me==="opaque"?hi.ReadWrite:hi.ReadOnly),ge=x.colorModeForRenderPass(),Ce=x.useProgram(_e?"backgroundPattern":"background"),Be=R||Ue(ue,{tileSize:de,terrain:x.style.map.terrain});_e&&(X.activeTexture.set(oe.TEXTURE0),x.imageManager.bind(x.context));const De=C.getCrossfadeParameters();for(const ze of Be){const je=ue.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),St=_e?nl(F,x,_e,{tileID:ze,tileSize:de},De):Ga(F,B),wt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ze),st=ae.getMeshFromTileID(X,ze.canonical,!1,!0,"raster");Ce.draw(X,oe.TRIANGLES,we,xe,ge,ci.backCCW,St,wt,je,C.id,st.vertexBuffer,st.indexBuffer,st.segments)}}(e,0,u,h,g):o.ck(u)&&function(x,S,C,R){const{isRenderingGlobe:D}=R,B=x.context,F=C.implementation,U=x.style.projection,X=x.transform,oe=X.getProjectionDataForCustomLayer(D),ae={farZ:X.farZ,nearZ:X.nearZ,fov:X.fov*Math.PI/180,modelViewProjectionMatrix:X.modelViewProjectionMatrix,projectionMatrix:X.projectionMatrix,shaderData:{variantName:U.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${U.shaderPreludeCode.vertexSource}`,define:U.shaderDefine},defaultProjectionData:oe},ue=F.renderingMode?F.renderingMode:"2d";if(x.renderPass==="offscreen"){const de=F.prerender;de&&(x.setCustomLayerDefaults(),B.setColorMode(x.colorModeForRenderPass()),de.call(F,B.gl,ae),B.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),B.setColorMode(x.colorModeForRenderPass()),B.setStencilMode(Vt.disabled);const de=ue==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,hi.ReadOnly);B.setDepthMode(de),F.render(B.gl,ae),B.setDirty(),x.setBaseState(),B.bindFramebuffer.set(null)}}(e,0,u,g))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!i||!u}useProgram(e,i,u=!1,h=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,x=this.style.projection,S=u?Fr.projectionMercator:x.shaderPreludeCode,C=u?cs:x.shaderDefine,R=e+(i?i.cacheKey:"")+`/${u?$i:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[R]||(this.cache[R]=new Cs(this.context,Fr[e],i,rl[e],this._showOverdrawInspector,g,S,C,h)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function du(m,e){let i,u=!1,h=null,g=null;const x=()=>{h=null,u&&(m.apply(g,i),h=setTimeout(x,e),u=!1)};return(...S)=>(u=!0,g=this,i=S,h||x(),h)}class dl{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let u;return i.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(u=h)}),(u&&u[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const u=i.join("/");let h=u;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${u}`);let g=window.location.hash.replace(h,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let x=window.location.href.replace(/(#.+)?$/,g);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=du(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,h=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),x=Math.round(i.lng*g)/g,S=Math.round(i.lat*g)/g,C=this._map.getBearing(),R=this._map.getPitch();let D="";if(D+=e?`/${x}/${S}/${u}`:`${u}/${S}/${x}`,(C||R)&&(D+="/"+Math.round(10*C)/10),R&&(D+=`/${Math.round(R)}`),this._hashName){const B=this._hashName;let F=!1;const U=window.location.hash.slice(1).split("&").map(X=>{const oe=X.split("=")[0];return oe===B?(F=!0,`${oe}=${D}`):X}).filter(X=>X);return F||U.push(`${B}=${D}`),`#${U.join("&")}`}return`#${D}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.S(+e[2],+e[1])}catch{return!1}const i=+e[0],u=+(e[3]||0),h=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&u>=-180&&u<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const go={linearity:.3,easing:o.cl(0,0,.3,1)},_o=o.e({deceleration:2500,maxSpeed:1400},go),lc=o.e({deceleration:20,maxSpeed:1400},go),pl=o.e({deceleration:1e3,maxSpeed:360},go),uc=o.e({deceleration:1e3,maxSpeed:90},go),Ch=o.e({deceleration:1e3,maxSpeed:360},go);class Ph{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ce.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=ce.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)i.zoom+=g.zoomDelta||0,i.bearing+=g.bearingDelta||0,i.pitch+=g.pitchDelta||0,i.roll+=g.rollDelta||0,g.panDelta&&i.pan._add(g.panDelta),g.around&&(i.around=g.around),g.pinchAround&&(i.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(i.pan.mag()){const g=vo(i.pan.mag(),u,o.e({},_o,e||{})),x=i.pan.mult(g.amount/i.pan.mag()),S=this._map.cameraHelper.handlePanInertia(x,this._map.transform);h.center=S.easingCenter,h.offset=S.easingOffset,yo(h,g)}if(i.zoom){const g=vo(i.zoom,u,lc);h.zoom=this._map.transform.zoom+g.amount,yo(h,g)}if(i.bearing){const g=vo(i.bearing,u,pl);h.bearing=this._map.transform.bearing+o.ag(g.amount,-179,179),yo(h,g)}if(i.pitch){const g=vo(i.pitch,u,uc);h.pitch=this._map.transform.pitch+g.amount,yo(h,g)}if(i.roll){const g=vo(i.roll,u,Ch);h.roll=this._map.transform.roll+o.ag(g.amount,-179,179),yo(h,g)}if(h.zoom||h.bearing){const g=i.pinchAround===void 0?i.around:i.pinchAround;h.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),o.e(h,{noMoveStart:!0})}}function yo(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function vo(m,e,i){const{maxSpeed:u,linearity:h,deceleration:g}=i,x=o.ag(m*h/(e/1e3),-u,u),S=Math.abs(x)/(g*h);return{easing:i.easing,duration:1e3*S,amount:x*(S/2)}}class Rr extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u,h={}){u=u instanceof MouseEvent?u:new MouseEvent(e,u);const g=Y.mousePos(i.getCanvas(),u),x=i.unproject(g);super(e,o.e({point:g,lngLat:x,originalEvent:u},h)),this._defaultPrevented=!1,this.target=i}}class fs extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u){const h=e==="touchend"?u.changedTouches:u.touches,g=Y.touchPos(i.getCanvasContainer(),h),x=g.map(C=>i.unproject(C)),S=g.reduce((C,R,D,B)=>C.add(R.div(B.length)),new o.P(0,0));super(e,{points:g,point:S,lngLats:x,lngLat:i.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class cc extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class Mh{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new cc(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new Rr(e.type,this._map,e))}mouseup(e){this._map.fire(new Rr(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new Rr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Rr(e.type,this._map,e))}mouseover(e){this._map.fire(new Rr(e.type,this._map,e))}mouseout(e){this._map.fire(new Rr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new fs(e.type,this._map,e))}touchmove(e){this._map.fire(new fs(e.type,this._map,e))}touchend(e){this._map.fire(new fs(e.type,this._map,e))}touchcancel(e){this._map.fire(new fs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ah{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Rr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Rr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class hc{constructor(e,i){this._map=e,this._tr=new xo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const u=i;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=u,this._box||(this._box=Y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(h.x,u.x),x=Math.max(h.x,u.x),S=Math.min(h.y,u.y),C=Math.max(h.y,u.y);Y.setTransform(this._box,`translate(${g}px,${S}px)`),this._box.style.width=x-g+"px",this._box.style.height=C-S+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const u=this._startPos,h=i;if(this.reset(),Y.suppressClick(),u.x!==h.x||u.y!==h.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(u,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new o.l(e,{originalEvent:i}))}}function pu(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const i={};for(let u=0;u<m.length;u++)i[m[u].identifier]=e[u];return i}class Rh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(h){const g=new o.P(0,0);for(const x of h)g._add(x);return g.div(h.length)}(i),this.touches=pu(u,i)))}touchmove(e,i,u){if(this.aborted||!this.centroid)return;const h=pu(u,i);for(const g in this.touches){const x=h[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,i,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class mu{constructor(e){this.singleTap=new Rh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,u){this.singleTap.touchstart(e,i,u)}touchmove(e,i,u){this.singleTap.touchmove(e,i,u)}touchend(e,i,u){const h=this.singleTap.touchend(e,i,u);if(h){const g=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(h)<30;if(g&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class gu{constructor(e){this._tr=new xo(e),this._zoomIn=new mu({numTouches:1,numTaps:2}),this._zoomOut=new mu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,u){this._zoomIn.touchstart(e,i,u),this._zoomOut.touchstart(e,i,u)}touchmove(e,i,u){this._zoomIn.touchmove(e,i,u),this._zoomOut.touchmove(e,i,u)}touchend(e,i,u){const h=this._zoomIn.touchend(e,i,u),g=this._zoomOut.touchend(e,i,u),x=this._tr;return h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(h)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const h=Array.isArray(i)?i[0]:i;return!this._moved&&h.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(u,h))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Y.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const is=0,ds=2,Lh={[is]:1,[ds]:2};class xr{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=Y.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,u){const h=Lh[u];return i.buttons===void 0||(i.buttons&h)!==h}(e,this._eventButton)}isValidEndEvent(e){return Y.mouseButton(e)===this._eventButton}}class wo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class nd{constructor(e=new xr({checkCorrectEvent:()=>!0}),i=new wo){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,u){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const _u=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class rd{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,u){return this._calculateTransform(e,i,u)}touchmove(e,i,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,i,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,u){this._calculateTransform(e,i,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,u){u.length>0&&(this._active=!0);const h=pu(u,i),g=new o.P(0,0),x=new o.P(0,0);let S=0;for(const R in h){const D=h[R],B=this._touches[R];B&&(g._add(D),x._add(D.sub(B)),S++,h[R]=D)}if(this._touches=h,this._shouldBePrevented(S)||!x.mag())return;const C=x.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,u){if(!this._firstTwoTouches)return;e.preventDefault();const[h,g]=this._firstTwoTouches,x=ml(u,i,h),S=ml(u,i,g);if(!x||!S)return;const C=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],C,e)}touchend(e,i,u){if(!this._firstTwoTouches)return;const[h,g]=this._firstTwoTouches,x=ml(u,i,h),S=ml(u,i,g);x&&S||(this._active&&Y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ml(m,e,i){for(let u=0;u<m.length;u++)if(m[u].identifier===i)return e[u]}function To(m,e){return Math.log(m/e)/Math.LN2}class Ls extends fc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(To(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:To(this._distance,u),pinchAround:i}}}function Lt(m,e){return 180*m.angleWith(e)/Math.PI}class dc extends fc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,u){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lt(this._vector,h),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,u=Lt(e,this._startVector);return Math.abs(u)<i}}function gl(m){return Math.abs(m.y)>Math.abs(m.x)}class pc extends fc{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,u){super.touchstart(e,i,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,gl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,g,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(h.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,u){if(this._valid!==void 0)return this._valid;const h=e.mag()>=2,g=i.mag()>=2;if(!h&&!g)return;if(!h||!g)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=e.y>0==i.y>0;return gl(e)&&gl(i)&&x}}const _l={panStep:100,bearingStep:15,pitchStep:10};class So{constructor(e){this._tr=new xo(e);const i=_l;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,u=0,h=0,g=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?h=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?h=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,h=0),{cameraAnimation:S=>{const C=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:mc,zoom:i?Math.round(C.zoom)+i*(e.shiftKey?2:1):C.zoom,bearing:C.bearing+u*this._bearingStep,pitch:C.pitch+h*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:C.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function mc(m){return m*(2-m)}const Si=4.000244140625,gc=1/450;class Dh{constructor(e,i){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new xo(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=gc}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=ce.now(),h=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,i!==0&&i%Si==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(h*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=Y.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(o.S.convert(u.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Si?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&C!==0&&(C=1/C);const R=typeof this._targetZoom!="number"?e.scale:o.ae(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),o.aj(R*C)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,h=this._easing;let g,x=!1;if(this._type==="wheel"&&u&&h){const S=ce.now()-this._lastWheelEventTime,C=Math.min((S+5)/200,1),R=h(C);g=o.C.number(u,i,R),C<1?this._frameId||(this._frameId=!0):x=!0}else g=i,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=o.cn;if(this._prevEase){const u=this._prevEase,h=(ce.now()-u.start)/u.duration,g=u.easing(h+.01)-u.easing(h),x=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-x*x);i=o.cl(x,S,.25,1)}return this._prevEase={start:ce.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class yu{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sd{constructor(e){this._tr=new xo(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(){this._tap=new mu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,u){if(!this._swipePoint)if(this._tapTime){const h=i[0],g=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(h)<30;g&&x?u.length>0&&(this._swipePoint=h,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,i,u)}touchmove(e,i,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const h=i[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,i,u)}touchend(e,i,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const h=this._tap.touchend(e,i,u);h&&(this._tapTime=e.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _c{constructor(e,i,u){this._el=e,this._mousePan=i,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vu{constructor(e,i,u,h){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=u,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class yc{constructor(e,i,u,h){this._el=e,this._touchZoom=i,this._touchRotate=u,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class zh{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Y.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=i,this._container.appendChild(h);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=u,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Y.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const yl=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class od extends o.l{}function vc(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class _a{constructor(e,i){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,g)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=h.type==="renderFrame"?void 0:h,S={needsRenderFrame:!1},C={},R={};for(const{handlerName:F,handler:U,allowed:X}of this._handlers){if(!U.isEnabled())continue;let oe;if(this._blockedByActive(R,X,F))U.reset();else if(U[g||h.type]){if(o.co(h,g||h.type)){const ae=Y.mousePos(this._map.getCanvas(),h);oe=U[g||h.type](h,ae)}else if(o.cp(h,g||h.type)){const ae=this._getMapTouches(h.touches),ue=Y.touchPos(this._map.getCanvas(),ae);oe=U[g||h.type](h,ue,ae)}else o.cq(g||h.type)||(oe=U[g||h.type](h));this.mergeHandlerResult(S,C,oe,F,x),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()}(oe||U.isActive())&&(R[F]=U)}const D={};for(const F in this._previousActiveHandlers)R[F]||(D[F]=x);this._previousActiveHandlers=R,(Object.keys(D).length||vc(S))&&(this._changes.push([S,C,D]),this._triggerRenderFrame()),(Object.keys(R).length||vc(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=S;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ph(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,g,x]of this._listeners)Y.addEventListener(h,g,h===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,i,u]of this._listeners)Y.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const i=this._map,u=i.getCanvasContainer();this._add("mapEvent",new Mh(i,e));const h=i.boxZoom=new hc(i,e);this._add("boxZoom",h),e.interactive&&e.boxZoom&&h.enable();const g=i.cooperativeGestures=new zh(i,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const x=new gu(i),S=new sd(i);i.doubleClickZoom=new yu(S,x),this._add("tapZoom",x),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const C=new ad;this._add("tapDragZoom",C);const R=i.touchPitch=new pc(i);this._add("touchPitch",R),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const D=()=>i.project(i.getCenter()),B=function({enable:me,clickTolerance:xe,aroundCenter:we=!0,minPixelCenterThreshold:ge=100,rotateDegreesPerPixelMoved:Ce=.8},Be){const De=new xr({checkCorrectEvent:ze=>Y.mouseButton(ze)===0&&ze.ctrlKey||Y.mouseButton(ze)===2&&!ze.ctrlKey});return new bo({clickTolerance:xe,move:(ze,je)=>{const St=Be();if(we&&Math.abs(St.y-ze.y)>ge)return{bearingDelta:o.cm(new o.P(ze.x,je.y),je,St)};let wt=(je.x-ze.x)*Ce;return we&&je.y<St.y&&(wt=-wt),{bearingDelta:wt}},moveStateManager:De,enable:me,assignEvents:_u})}(e,D),F=function({enable:me,clickTolerance:xe,pitchDegreesPerPixelMoved:we=-.5}){const ge=new xr({checkCorrectEvent:Ce=>Y.mouseButton(Ce)===0&&Ce.ctrlKey||Y.mouseButton(Ce)===2});return new bo({clickTolerance:xe,move:(Ce,Be)=>({pitchDelta:(Be.y-Ce.y)*we}),moveStateManager:ge,enable:me,assignEvents:_u})}(e),U=function({enable:me,clickTolerance:xe,rollDegreesPerPixelMoved:we=.3},ge){const Ce=new xr({checkCorrectEvent:Be=>Y.mouseButton(Be)===2&&Be.ctrlKey});return new bo({clickTolerance:xe,move:(Be,De)=>{const ze=ge();let je=(De.x-Be.x)*we;return De.y<ze.y&&(je=-je),{rollDelta:je}},moveStateManager:Ce,enable:me,assignEvents:_u})}(e,D);i.dragRotate=new vu(e,B,F,U),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",F,["mouseRotate","mouseRoll"]),this._add("mouseRoll",U,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const X=function({enable:me,clickTolerance:xe}){const we=new xr({checkCorrectEvent:ge=>Y.mouseButton(ge)===0&&!ge.ctrlKey});return new bo({clickTolerance:xe,move:(ge,Ce)=>({around:Ce,panDelta:Ce.sub(ge)}),activateOnStart:!0,moveStateManager:we,enable:me,assignEvents:_u})}(e),oe=new rd(e,i);i.dragPan=new _c(u,X,oe),this._add("mousePan",X),this._add("touchPan",oe,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const ae=new dc,ue=new Ls;i.touchZoomRotate=new yc(u,ue,ae,C),this._add("touchRotate",ae,["touchPan","touchZoom"]),this._add("touchZoom",ue,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const de=i.scrollZoom=new Dh(i,()=>this._triggerRenderFrame());this._add("scrollZoom",de,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const _e=i.keyboard=new So(i);this._add("keyboard",_e),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new Ah(i))}_add(e,i,u){this._handlers.push({handlerName:e,handler:i,allowed:u}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yl(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,u){for(const h in e)if(h!==u&&(!i||i.indexOf(h)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const u of e)this._el.contains(u.target)&&i.push(u);return i}mergeHandlerResult(e,i,u,h,g){if(!u)return;o.e(e,u);const x={handlerName:h,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(i.zoom=x),u.panDelta!==void 0&&(i.drag=x),u.rollDelta!==void 0&&(i.roll=x),u.pitchDelta!==void 0&&(i.pitch=x),u.bearingDelta!==void 0&&(i.rotate=x)}_applyChanges(){const e={},i={},u={};for(const[h,g,x]of this._changes)h.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(h.panDelta)),h.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(e.rollDelta=(e.rollDelta||0)+h.rollDelta),h.around!==void 0&&(e.around=h.around),h.pinchAround!==void 0&&(e.pinchAround=h.pinchAround),h.noInertia&&(e.noInertia=h.noInertia),o.e(i,g),o.e(u,x);this._updateMapTransform(e,i,u),this._changes=[]}_updateMapTransform(e,i,u){const h=this._map,g=h._getTransformForUpdate(),x=h.terrain;if(!(vc(e)||x&&this._terrainMovement))return this._fireEvents(i,u,!0);h._stop(!0);let{panDelta:S,zoomDelta:C,bearingDelta:R,pitchDelta:D,rollDelta:B,around:F,pinchAround:U}=e;U!==void 0&&(F=U),F=F||h.transform.centerPoint,x&&!g.isPointOnMapSurface(F)&&(F=g.centerPoint);const X={panDelta:S,zoomDelta:C,rollDelta:B,pitchDelta:D,bearingDelta:R,around:F};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(F)&&(F=g.centerPoint);const oe=F.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(S?F.sub(S):F);x?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(X,g),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(X,g,oe):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(X,g,oe))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(X,g),this._map.cameraHelper.handleMapControlsPan(X,g,oe)),h._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,u,!0)}_fireEvents(e,i,u){const h=yl(this._eventsInProgress),g=yl(e),x={};for(const B in e){const{originalEvent:F}=e[B];this._eventsInProgress[B]||(x[`${B}start`]=F),this._eventsInProgress[B]=e[B]}!h&&g&&this._fireEvent("movestart",g.originalEvent);for(const B in x)this._fireEvent(B,x[B]);g&&this._fireEvent("move",g.originalEvent);for(const B in e){const{originalEvent:F}=e[B];this._fireEvent(B,F)}const S={};let C;for(const B in this._eventsInProgress){const{handlerName:F,originalEvent:U}=this._eventsInProgress[B];this._handlersById[F].isActive()||(delete this._eventsInProgress[B],C=i[F]||U,S[`${B}end`]=C)}for(const B in S)this._fireEvent(B,S[B]);const R=yl(this._eventsInProgress),D=(h||g)&&!R;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const B=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&B.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(B)}if(u&&D){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;!B||!B.essential&&ce.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:C})),F(this._map.getBearing())&&this._map.resetNorth()):(F(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new o.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new od("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class nn extends o.E{constructor(e,i,u){super(),this._renderFrameCallback=()=>{const h=Math.min((ce.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,u){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},i),u)}panTo(e,i,u){return this.easeTo(o.e({center:e},i),u)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,u){return this.easeTo(o.e({zoom:e},i),u)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.l("movestart",i)).fire(new o.l("move",i)).fire(new o.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,u){return this.easeTo(o.e({bearing:e},i),u)}resetNorth(e,i){return this.rotateTo(0,o.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=Te.convert(e).adjustAntiMeridian();const u=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,i)}_cameraForBoxAndBearing(e,i,u,h){const g={top:0,bottom:0,right:0,left:0};if(typeof(h=o.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const R=h.padding;h.padding={top:R,bottom:R,right:R,left:R}}const x=o.e(g,h.padding);h.padding=x;const S=this.transform,C=new Te(e,i);return this.cameraHelper.cameraForBoxAndBearing(h,x,C,u,S)}fitBounds(e,i,u){return this._fitInternal(this.cameraForBounds(e,i),i,u)}fitScreenCoordinates(e,i,u,h,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(i)),u,h),h,g)}_fitInternal(e,i,u){return e?(delete(i=o.e(e,i)).padding,i.linear?this.easeTo(i,u):this.flyTo(i,u)):this}jumpTo(e,i){this.stop();const u=this._getTransformForUpdate();let h=!1,g=!1,x=!1;const S=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);const C=u.zoom!==S;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(h=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(g=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(x=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new o.l("movestart",i)).fire(new o.l("move",i)),C&&this.fire(new o.l("zoomstart",i)).fire(new o.l("zoom",i)).fire(new o.l("zoomend",i)),h&&this.fire(new o.l("rotatestart",i)).fire(new o.l("rotate",i)).fire(new o.l("rotateend",i)),g&&this.fire(new o.l("pitchstart",i)).fire(new o.l("pitch",i)).fire(new o.l("pitchend",i)),x&&this.fire(new o.l("rollstart",i)).fire(new o.l("roll",i)).fire(new o.l("rollend",i)),this.fire(new o.l("moveend",i))}calculateCameraOptionsFromTo(e,i,u,h=0){const g=o.a0.fromLngLat(e,i),x=o.a0.fromLngLat(u,h),S=x.x-g.x,C=x.y-g.y,R=x.z-g.z,D=Math.hypot(S,C,R);if(D===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(S,C),F=o.aj(this.transform.cameraToCenterDistance/D/this.transform.tileSize),U=180*Math.atan2(S,-C)/Math.PI;let X=180*Math.acos(B/D)/Math.PI;return X=R<0?90-X:90+X,{center:x.toLngLat(),elevation:h,zoom:F,pitch:X,bearing:U}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,u,h,g){const x=this.transform.calculateCenterFromCameraLngLatAlt(e,i,u,h);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:u,pitch:h,roll:g}}easeTo(e,i){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.cn},e)).animate===!1||!e.essential&&ce.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),h=this.getBearing(),g=u.pitch,x=u.roll,S="bearing"in e?this._normalizeBearing(e.bearing,h):h,C="pitch"in e?+e.pitch:g,R="roll"in e?this._normalizeBearing(e.roll,x):x,D="padding"in e?e.padding:u.padding,B=o.P.convert(e.offset);let F,U;e.around&&(F=o.S.convert(e.around),U=u.locationToScreenPoint(F));const X={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},oe=this.cameraHelper.handleEaseTo(u,{bearing:S,pitch:C,roll:R,padding:D,around:F,aroundPoint:U,offsetAsPoint:B,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||h!==S,this._pitching=this._pitching||C!==g,this._rolling=this._rolling||R!==x,this._padding=!u.isPaddingEqual(D),this._zooming=this._zooming||oe.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,X),this.terrain&&this._prepareElevation(oe.elevationCenter),this._ease(ae=>{oe.easeFunc(ae),this.terrain&&!e.freezeElevation&&this._updateElevation(ae),this._applyUpdatedTransform(u),this._fireMoveEvents(i)},ae=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,ae)},e),this}_prepareEase(e,i,u={}){this._moving=!0,i||u.moving||this.fire(new o.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new o.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new o.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new o.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new o.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(i-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),u=e.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(u<h){const g=this.calculateCameraOptionsFromTo(i,h,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&i.push(h=>this.transformCameraUpdate(h)),!i.length)return;const u=e.clone();for(const h of i){const g=u.clone(),{center:x,zoom:S,roll:C,pitch:R,bearing:D,elevation:B}=h(g);x&&g.setCenter(x),B!==void 0&&g.setElevation(B),S!==void 0&&g.setZoom(S),C!==void 0&&g.setRoll(C),R!==void 0&&g.setPitch(R),D!==void 0&&g.setBearing(D),u.apply(g)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new o.l("move",e)),this._zooming&&this.fire(new o.l("zoom",e)),this._rotating&&this.fire(new o.l("rotate",e)),this._pitching&&this.fire(new o.l("pitch",e)),this._rolling&&this.fire(new o.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const u=this._zooming,h=this._rotating,g=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new o.l("zoomend",e)),h&&this.fire(new o.l("rotateend",e)),g&&this.fire(new o.l("pitchend",e)),x&&this.fire(new o.l("rollend",e)),this.fire(new o.l("moveend",e))}flyTo(e,i){if(!e.essential&&ce.prefersReducedMotion){const je=o.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(je,i)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cn},e);const u=this._getTransformForUpdate(),h=u.bearing,g=u.pitch,x=u.roll,S=u.padding,C="bearing"in e?this._normalizeBearing(e.bearing,h):h,R="pitch"in e?+e.pitch:g,D="roll"in e?this._normalizeBearing(e.roll,x):x,B="padding"in e?e.padding:u.padding,F=o.P.convert(e.offset);let U=u.centerPoint.add(F);const X=u.screenPointToLocation(U),oe=this.cameraHelper.handleFlyTo(u,{bearing:C,pitch:R,roll:D,padding:B,locationAtOffset:X,offsetAsPoint:F,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let ae=e.curve;const ue=Math.max(u.width,u.height),de=ue/oe.scaleOfZoom,_e=oe.pixelPathLength;typeof oe.scaleOfMinZoom=="number"&&(ae=Math.sqrt(ue/oe.scaleOfMinZoom/_e*2));const me=ae*ae;function xe(je){const St=(de*de-ue*ue+(je?-1:1)*me*me*_e*_e)/(2*(je?de:ue)*me*_e);return Math.log(Math.sqrt(St*St+1)-St)}function we(je){return(Math.exp(je)-Math.exp(-je))/2}function ge(je){return(Math.exp(je)+Math.exp(-je))/2}const Ce=xe(!1);let Be=function(je){return ge(Ce)/ge(Ce+ae*je)},De=function(je){return ue*((ge(Ce)*(we(St=Ce+ae*je)/ge(St))-we(Ce))/me)/_e;var St},ze=(xe(!0)-Ce)/ae;if(Math.abs(_e)<2e-6||!isFinite(ze)){if(Math.abs(ue-de)<1e-6)return this.easeTo(e,i);const je=de<ue?-1:1;ze=Math.abs(Math.log(de/ue))/ae,De=()=>0,Be=St=>Math.exp(je*ae*St)}return e.duration="duration"in e?+e.duration:1e3*ze/("screenSpeed"in e?+e.screenSpeed/ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=h!==C,this._pitching=R!==g,this._rolling=D!==x,this._padding=!u.isPaddingEqual(B),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(oe.targetCenter),this._ease(je=>{const St=je*ze,wt=1/Be(St),st=De(St);this._rotating&&u.setBearing(o.C.number(h,C,je)),this._pitching&&u.setPitch(o.C.number(g,R,je)),this._rolling&&u.setRoll(o.C.number(x,D,je)),this._padding&&(u.interpolatePadding(S,B,je),U=u.centerPoint.add(F)),oe.easeFunc(je,wt,st,U),this.terrain&&!e.freezeElevation&&this._updateElevation(je),this._applyUpdatedTransform(u),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,i)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,i,u){u.animate===!1||u.duration===0?(e(1),i()):(this._easeStart=ce.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=o.aN(e,-180,180);const u=Math.abs(e-i);return Math.abs(e-360-i)<u&&(e-=360),Math.abs(e+360-i)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(e),this.transform.tileZoom):null}}const vl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xu{constructor(e=vl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const u=this._map._getUIString(`AttributionControl.${i}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const i=this._map.style.sourceCaches;for(const h in i){const g=i[h];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter(h=>String(h).trim()),e.sort((h,g)=>h.length-g.length),e=e.filter((h,g)=>{for(let x=g+1;x<e.length;x++)if(e[x].indexOf(h)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=Y.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class xc{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const u=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Y.create("div","maplibregl-ctrl");const i=Y.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Nh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,u=i?this._queue.concat(i):this._queue;for(const h of u)if(h.id===e)return void(h.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const u of i)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Oh=o.aI([{name:"a_pos3d",type:"Int16",components:3}]);class ld extends o.E{constructor(e){super(),this._lastTilesetChange=ce.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const u={};for(const h of Ue(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))u[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),o.bX(h.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[h.key]=new Et(h,this.tileSize),this._lastTilesetChange=ce.now());for(const h in this._tiles)u[h]||delete this._tiles[h]}freeRtt(e){for(const i in this._tiles){const u=this._tiles[i];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,i){return i?this._getTerrainCoordsForTileRanges(e,i):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const u of this._renderableTilesKeys){const h=this._tiles[u].tileID,g=e.clone(),x=o.b9();if(h.canonical.equals(e.canonical))o.bX(x,0,o.$,o.$,0,0,1);else if(h.canonical.isChildOf(e.canonical)){const S=h.canonical.z-e.canonical.z,C=h.canonical.x-(h.canonical.x>>S<<S),R=h.canonical.y-(h.canonical.y>>S<<S),D=o.$>>S;o.bX(x,0,D,D,0,0,1),o.M(x,x,[-C*D,-R*D,0])}else{if(!e.canonical.isChildOf(h.canonical))continue;{const S=e.canonical.z-h.canonical.z,C=e.canonical.x-(e.canonical.x>>S<<S),R=e.canonical.y-(e.canonical.y>>S<<S),D=o.$>>S;o.bX(x,0,o.$,o.$,0,0,1),o.M(x,x,[C*D,R*D,0]),o.N(x,x,[1/2**S,1/2**S,0])}}g.terrainRttPosMatrix32f=new Float32Array(x),i[u]=g}return i}_getTerrainCoordsForTileRanges(e,i){const u={};for(const h of this._renderableTilesKeys){const g=this._tiles[h].tileID;if(!this._isWithinTileRanges(g,i))continue;const x=e.clone(),S=o.b9();if(g.canonical.z===e.canonical.z){const C=e.canonical.x-g.canonical.x,R=e.canonical.y-g.canonical.y;o.bX(S,0,o.$,o.$,0,0,1),o.M(S,S,[C*o.$,R*o.$,0])}else if(g.canonical.z>e.canonical.z){const C=g.canonical.z-e.canonical.z,R=g.canonical.x-(g.canonical.x>>C<<C),D=g.canonical.y-(g.canonical.y>>C<<C),B=e.canonical.x-(g.canonical.x>>C),F=e.canonical.y-(g.canonical.y>>C),U=o.$>>C;o.bX(S,0,U,U,0,0,1),o.M(S,S,[-R*U+B*o.$,-D*U+F*o.$,0])}else{const C=e.canonical.z-g.canonical.z,R=e.canonical.x-(e.canonical.x>>C<<C),D=e.canonical.y-(e.canonical.y>>C<<C),B=(e.canonical.x>>C)-g.canonical.x,F=(e.canonical.y>>C)-g.canonical.y,U=o.$<<C;o.bX(S,0,U,U,0,0,1),o.M(S,S,[R*o.$+B*U,D*o.$+F*U,0])}x.terrainRttPosMatrix32f=new Float32Array(S),u[h]=x}return u}getSourceTile(e,i){const u=this.sourceCache._source;let h=e.overscaledZ-this.deltaZoom;if(h>u.maxzoom&&(h=u.maxzoom),h<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(h).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&i)for(;h>=u.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(h--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,i){return i[e.canonical.z]&&e.canonical.x>=i[e.canonical.z].minTileX&&e.canonical.x<=i[e.canonical.z].maxTileX&&e.canonical.y>=i[e.canonical.z].minTileY&&e.canonical.y<=i[e.canonical.z].maxTileY}}class Ds{constructor(e,i,u){this._meshCache={},this.painter=e,this.sourceCache=new ld(i),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,u,h=o.$){var g;if(!(i>=0&&i<h&&u>=0&&u<h))return 0;const x=this.getTerrainData(e),S=(g=x.tile)===null||g===void 0?void 0:g.dem;if(!S)return 0;const C=o.cr([],[i/h*o.$,u/h*o.$],x.u_terrain_matrix),R=[C[0]*S.dim,C[1]*S.dim],D=Math.floor(R[0]),B=Math.floor(R[1]),F=R[0]-D,U=R[1]-B;return S.get(D,B)*(1-F)*(1-U)+S.get(D+1,B)*F*(1-U)+S.get(D,B+1)*(1-F)*U+S.get(D+1,B+1)*F*U}getElevationForLngLatZoom(e,i){if(!o.cs(i,e.wrap()))return 0;const{tileID:u,mercatorX:h,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(u,h%o.$,g%o.$,o.$)}getElevation(e,i,u,h=o.$){return this.getDEMElevation(e,i,u,h)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const h=this.painter.context,g=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(h,g,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(h,new o.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.af([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const h=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new o.T(h,i.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),i.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const u=i&&i+i.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const h=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=h?g=e.canonical.z-h:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>g<<g),S=e.canonical.y-(e.canonical.y>>g<<g),C=o.ct(new Float64Array(16),[1/(o.$<<g),1/(o.$<<g),0]);o.M(C,C,[x*o.$,S*o.$,0]),this._demMatrixCache[e.key]={matrix:C,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,u=i.width/devicePixelRatio,h=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(i.context,{width:u,height:h,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(i.context,{width:u,height:h,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(u,h,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,u,h))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)i[x+0]=255&S,i[x+1]=255&g,i[x+2]=S>>8<<4|g>>8,i[x+3]=0;const u=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),h=new o.T(e,u,e.gl.RGBA,{premultiply:!1});return h.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),u=this.painter.context,h=u.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(g,S-x-1,1,1,h.RGBA,h.UNSIGNED_BYTE,i),u.bindFramebuffer.set(null);const C=i[0]+(i[2]>>4<<8),R=i[1]+((15&i[2])<<8),D=this.coordsIndex[255-i[3]],B=D&&this.sourceCache.getTileByID(D);if(!B)return null;const F=this._coordsTextureSize,U=(1<<B.tileID.canonical.z)*F;return new o.a0((B.tileID.canonical.x*F+C)/U+B.tileID.wrap,(B.tileID.canonical.y*F+R)/U,this.getElevation(B.tileID,C,R,F))}depthAtPoint(e){const i=new Uint8Array(4),u=this.painter.context,h=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,i),u.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const u=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,h=u&&e.canonical.y===0,g=u&&e.canonical.y===(1<<e.canonical.z)-1,x=`m_${h?"n":""}_${g?"s":""}`;if(this._meshCache[x])return this._meshCache[x];const S=this.painter.context,C=new o.cu,R=new o.aM,D=this.meshSize,B=o.$/D,F=D*D;for(let ge=0;ge<=D;ge++)for(let Ce=0;Ce<=D;Ce++)C.emplaceBack(Ce*B,ge*B,0);for(let ge=0;ge<F;ge+=D+1)for(let Ce=0;Ce<D;Ce++)R.emplaceBack(Ce+ge,D+Ce+ge+1,D+Ce+ge+2),R.emplaceBack(Ce+ge,D+Ce+ge+2,Ce+ge+1);const U=C.length,X=U+(D+1),oe=(D+1)*D,ae=h?o.bg:0,ue=h?0:1,de=g?o.bh:o.$,_e=g?0:1;for(let ge=0;ge<=D;ge++)C.emplaceBack(ge*B,ae,ue);for(let ge=0;ge<=D;ge++)C.emplaceBack(ge*B,de,_e);for(let ge=0;ge<D;ge++)R.emplaceBack(oe+ge,X+ge,X+ge+1),R.emplaceBack(oe+ge,X+ge+1,oe+ge+1),R.emplaceBack(0+ge,U+ge+1,U+ge),R.emplaceBack(0+ge,0+ge+1,U+ge+1);const me=C.length,xe=me+2*(D+1);for(const ge of[0,1])for(let Ce=0;Ce<=D;Ce++)for(const Be of[0,1])C.emplaceBack(ge*o.$,Ce*B,Be);for(let ge=0;ge<2*D;ge+=2)R.emplaceBack(me+ge,me+ge+1,me+ge+3),R.emplaceBack(me+ge,me+ge+3,me+ge+2),R.emplaceBack(xe+ge,xe+ge+3,xe+ge+1),R.emplaceBack(xe+ge,xe+ge+2,xe+ge+3);const we=new Jr(S.createVertexBuffer(C,Oh.members),S.createIndexBuffer(R),o.aL.simpleSegment(0,0,C.length,R.length));return this._meshCache[x]=we,we}getMeshFrameDelta(e){return 2*Math.PI*o.bt/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var u;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(u=this.getMinMaxElevation(h).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return i&&i.dem&&(u.minElevation=i.dem.min*this.exaggeration,u.maxElevation=i.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,i){const u=o.a0.fromLngLat(e.wrap()),h=(1<<i)*o.$,g=u.x*h,x=u.y*h,S=Math.floor(g/o.$),C=Math.floor(x/o.$);return{tileID:new o.Z(i,0,i,S,C),mercatorX:g,mercatorY:x}}}class bu{constructor(e,i,u){this._context=e,this._size=i,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(u.texture),{id:e,fbo:i,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Ft={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class ni{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new bu(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(i)),this._coordsAscending={};for(const u in e.sourceCaches){this._coordsAscending[u]={};const h=e.sourceCaches[u].getVisibleCoordinates(),g=e.sourceCaches[u].getSource(),x=g instanceof Re?g.terrainTileRanges:null;for(const S of h){const C=this.terrain.sourceCache.getTerrainCoords(S,x);for(const R in C)this._coordsAscending[u][R]||(this._coordsAscending[u][R]=[]),this._coordsAscending[u][R].push(C[R])}}this._coordsAscendingStr={};for(const u of e._order){const h=e._layers[u],g=h.source;if(Ft[h.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const x in this._coordsAscending[g])this._coordsAscendingStr[g][x]=this._coordsAscending[g][x].map(S=>S.key).sort().join()}}for(const u of this._renderableTiles)for(const h in this._coordsAscendingStr){const g=this._coordsAscendingStr[h][u.tileID.key];g&&g!==u.rttCoords[h]&&(u.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),h=e.type,g=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ft[h]&&(this._prevType&&Ft[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(e.id),!x))return!0;if(Ft[this._prevType]||Ft[h]&&x){this._prevType=h;const S=this._stacks.length-1,C=this._stacks[S]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(mn(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[S]){const B=this.pool.getObjectForId(R.rtt[S].id);if(B.stamp===R.rtt[S].stamp){this.pool.useObject(B);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),R.rtt[S]={id:D.id,stamp:D.stamp},g.context.bindFramebuffer.set(D.fbo.framebuffer),g.context.clear({color:o.be.transparent,stencil:0}),g.currentStencilSource=void 0;for(let B=0;B<C.length;B++){const F=g.style._layers[C[B]],U=F.source?this._coordsAscending[F.source][R.tileID.key]:[R.tileID];g.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),g._renderTileClippingMasks(F,U,!0),g.renderLayer(g,g.style.sourceCaches[F.source],F,U,u),F.source&&(R.rttCoords[F.source]=this._coordsAscendingStr[F.source][R.tileID.key])}}return mn(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),Ft[h]}return!1}}const wu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},bc=J,xl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:vl,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},br={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Fh{constructor(e,i,u=!1){this.mousedown=g=>{this.startMove(g,Y.mousePos(this.element,g)),Y.addEventListener(window,"mousemove",this.mousemove),Y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,Y.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHanlder.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),Y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const h=new nd;this._rotatePitchHanlder=new bo({clickTolerance:3,move:(g,x)=>{const S=i.getBoundingClientRect(),C=new o.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:o.cm(new o.P(g.x,x.y),x,C),pitchDelta:u?-.5*(x.y-g.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=e,Y.addEventListener(i,"mousedown",this.mousedown),Y.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),Y.disableDrag()}move(e,i){const u=this.map,{bearingDelta:h,pitchDelta:g}=this._rotatePitchHanlder.dragMove(e,i)||{};h&&u.setBearing(u.getBearing()+h),g&&u.setPitch(u.getPitch()+g)}off(){const e=this.element;Y.removeEventListener(e,"mousedown",this.mousedown),Y.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend),Y.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Y.enableDrag(),Y.removeEventListener(window,"mousemove",this.mousemove),Y.removeEventListener(window,"mouseup",this.mouseup),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend)}}let nr;function Bh(m,e,i,u=!1){if(u||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new o.S(m.lng,m.lat);if(m=new o.S(m.lng,m.lat),e){const g=new o.S(m.lng-360,m.lat),x=new o.S(m.lng+360,m.lat),S=i.locationToScreenPoint(m).distSqr(e);i.locationToScreenPoint(g).distSqr(e)<S?m=g:i.locationToScreenPoint(x).distSqr(e)<S&&(m=x)}for(;Math.abs(m.lng-i.center.lng)>180;){const g=i.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=i.width&&g.y<=i.height)break;m.lng>i.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(m))?m:h}const Ha={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function an(m,e,i){const u=m.classList;for(const h in Ha)u.remove(`maplibregl-${i}-anchor-${h}`);u.add(`maplibregl-${i}-anchor-${e}`)}class gn extends o.E{constructor(e){if(super(),this._onKeyPress=i=>{const u=i.code,h=i.charCode||i.keyCode;u!=="Space"&&u!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=i=>{const u=i.originalEvent.target,h=this._element;this._popup&&(u===h||h.contains(u))&&this.togglePopup()},this._update=i=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(i?.type==="terrain"||i?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Bh(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,`${Ha[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${h}`),ce.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div");const i=Y.createNS("http://www.w3.org/2000/svg","svg"),u=41,h=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${u}px`),i.setAttributeNS(null,"width",`${h}px`),i.setAttributeNS(null,"viewBox",`0 0 ${h} ${u}`);const g=Y.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const x=Y.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const S=Y.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ue of C){const de=Y.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",ue.rx),de.setAttributeNS(null,"ry",ue.ry),S.appendChild(de)}const R=Y.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const D=Y.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(D);const B=Y.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const F=Y.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(F);const U=Y.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const X=Y.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const oe=Y.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#000000"),oe.setAttributeNS(null,"opacity","0.25"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962");const ae=Y.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),X.appendChild(oe),X.appendChild(ae),x.appendChild(S),x.appendChild(R),x.appendChild(B),x.appendChild(U),x.appendChild(X),i.appendChild(x),i.setAttributeNS(null,"height",u*this._scale+"px"),i.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(i),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),an(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const h=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,u;const h=(i=this._map)===null||i===void 0?void 0:i.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!h||g){const U=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==U&&(this._element.style.opacity=U))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const x=this._map,S=x.terrain.depthAtPoint(this._pos),C=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,C)-S<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/x.transform.pixelsPerMeter,D=Math.sin(x.getPitch()*Math.PI/180)*R,B=x.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),F=x.transform.lngLatToCameraDepth(this._lngLat,C+D)-B>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const jh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ya=0,va=!1;const wc={maxWidth:100,unit:"metric"};function Tu(m,e,i){const u=i&&i.maxWidth||100,h=m._container.clientHeight/2,g=m._container.clientWidth/2,x=m.unproject([g-u/2,h]),S=m.unproject([g+u/2,h]),C=Math.round(m.project(S).x-m.project(x).x),R=Math.min(u,C,m._container.clientWidth),D=x.distanceTo(S);if(i&&i.unit==="imperial"){const B=3.2808*D;B>5280?Xa(e,R,B/5280,m._getUIString("ScaleControl.Miles")):Xa(e,R,B,m._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?Xa(e,R,D/1852,m._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Xa(e,R,D/1e3,m._getUIString("ScaleControl.Kilometers")):Xa(e,R,D,m._getUIString("ScaleControl.Meters"))}function Xa(m,e,i,u){const h=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let S=g/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const R=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*R)/R}(S),x*S}(i);m.style.width=e*(h/i)+"px",m.innerHTML=`${h}&nbsp;${u}`}const bl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Tc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Su(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,m),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-m),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(m,0),right:new o.P(-m,0)}}if(m instanceof o.P||Array.isArray(m)){const e=o.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(m.center||[0,0]),top:o.P.convert(m.top||[0,0]),"top-left":o.P.convert(m["top-left"]||[0,0]),"top-right":o.P.convert(m["top-right"]||[0,0]),bottom:o.P.convert(m.bottom||[0,0]),"bottom-left":o.P.convert(m["bottom-left"]||[0,0]),"bottom-right":o.P.convert(m["bottom-right"]||[0,0]),left:o.P.convert(m.left||[0,0]),right:o.P.convert(m.right||[0,0])}}return Su(new o.P(0,0))}const Sc=J;P.AJAXError=o.cy,P.Event=o.l,P.Evented=o.E,P.LngLat=o.S,P.MercatorCoordinate=o.a0,P.Point=o.P,P.addProtocol=o.cz,P.config=o.a,P.removeProtocol=o.cA,P.AttributionControl=xu,P.BoxZoomHandler=hc,P.CanvasSource=_t,P.CooperativeGesturesHandler=zh,P.DoubleClickZoomHandler=yu,P.DragPanHandler=_c,P.DragRotateHandler=vu,P.EdgeInsets=Cr,P.FullscreenControl=class extends o.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=Y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Y.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},P.GeoJSONSource=kt,P.GeolocateControl=class extends o.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new o.S(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,h=this._map.getBearing(),g=o.e({bearing:h},this.options.fitBoundsOptions),x=Te.fromLngLat(i,u);this._map.fitBounds(x,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new o.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&va)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Y.create("button","maplibregl-ctrl-geolocate",this._container),Y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new gn({element:this._dotElement}),this._circleElement=Y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},jh,m)}onAdd(m){return this._map=m,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(e=!1){if(nr!==void 0&&!e)return nr;if(window.navigator.permissions===void 0)return nr=!!window.navigator.geolocation,nr;try{nr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{nr=!!window.navigator.geolocation}return nr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ya=0,va=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),i=m.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),i=m.getNorthEast(),u=e.distanceTo(i),h=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ya--,va=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ya++,ya>1?(m={maximumAge:6e5,timeout:0},va=!0):(m=this.options.positionOptions,va=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},P.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Y.create("button","maplibregl-ctrl-globe",this._container),Y.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},P.Hash=dl,P.ImageSource=Re,P.KeyboardHandler=So,P.LngLatBounds=Te,P.LogoControl=xc,P.Map=class extends nn{constructor(m){var e,i;o.cv.mark(o.cw.create);const u=Object.assign(Object.assign(Object.assign({},xl),m),{canvasContextAttributes:Object.assign(Object.assign({},xl.canvasContextAttributes),m.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new pn,g=new Ri;if(u.minZoom!==void 0&&h.setMinZoom(u.minZoom),u.maxZoom!==void 0&&h.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&h.setMinPitch(u.minPitch),u.maxPitch!==void 0&&h.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&h.setRenderWorldCopies(u.renderWorldCopies),super(h,g,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Nh,this._controls=[],this._mapId=o.a6(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},wu),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=We.addThrottleControl(()=>this.isMoving()),this._requestManager=new qe(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const C=du(R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())},50);this._resizeObserver=new ResizeObserver(R=>{S?C(R):S=!0}),this._resizeObserver.observe(this._container)}this.handlers=new _a(this,u),this._hash=u.hash&&new dl(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,o.e({},u.fitBoundsOptions,{duration:0}))));const x=typeof u.style=="string"||((i=(e=u.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new xu(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new xc,u.logoPosition),this.on("style.load",()=>{if(x||this._resizeTransform(),this.transform.unmodified){const S=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new o.l(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new o.l(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new o.l("sourcedataabort",S))})}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(i,u.firstChild):u.appendChild(i),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,i,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,i,u)}resize(m,e=!0){const[i,u]=this._containerDimensions(),h=this._getClampedPixelRatio(i,u);if(this._resizeCanvas(i,u,h),this.painter.resize(i,u,h),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const S=this._getClampedPixelRatio(i,u);this._resizeCanvas(i,u,S),this.painter.resize(i,u,S)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new o.l("movestart",m)).fire(new o.l("move",m))),this.fire(new o.l("resize",m)),g&&this.fire(new o.l("moveend",m)),this}_resizeTransform(m=!0){var e;const[i,u]=this._containerDimensions();this.transform.resize(i,u,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,u,m)}_getClampedPixelRatio(m,e){const{0:i,1:u}=this._maxCanvasSize,h=this.getPixelRatio(),g=m*h,x=e*h;return Math.min(g>i?i/g:1,x>u?u/x:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Te.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(o.S.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(o.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,i){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:i,delegates:{mousemove:g=>{const x=e.filter(C=>this.getLayer(C)),S=x.length!==0?this.queryRenderedFeatures(g.point,{layers:x}):[];S.length?u||(u=!0,i.call(this,new Rr(m,this,g.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:i,delegates:{mousemove:x=>{const S=e.filter(C=>this.getLayer(C));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?u=!0:u&&(u=!1,i.call(this,new Rr(m,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,i.call(this,new Rr(m,this,x.originalEvent)))}}}}{const u=h=>{const g=e.filter(S=>this.getLayer(S)),x=g.length!==0?this.queryRenderedFeatures(h.point,{layers:g}):[];x.length&&(h.features=x,i.call(this,h),delete h.features)};return{layers:e,listener:i,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,i){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let h=0;h<u.length;h++){const g=u[h];if(g.listener===i&&g.layers.length===e.length&&g.layers.every(x=>e.includes(x))){for(const x in g.delegates)this.off(x,g.delegates[x]);return void u.splice(h,1)}}}on(m,e,i){if(i===void 0)return super.on(m,e);const u=typeof e=="string"?[e]:e,h=this._createDelegatedListener(m,u,i);this._saveDelegatedListener(m,h);for(const g in h.delegates)this.on(g,h.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,u,i)}}}once(m,e,i){if(i===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,h=this._createDelegatedListener(m,u,i);for(const g in h.delegates){const x=h.delegates[g];h.delegates[g]=(...S)=>{this._removeDelegatedListener(m,u,i),x(...S)}}this._saveDelegatedListener(m,h);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(m,e,i){return i===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let i;const u=m instanceof o.P||Array.isArray(m),h=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},h instanceof o.P||typeof h[0]=="number")i=[o.P.convert(h)];else{const g=o.P.convert(h[0]),x=o.P.convert(h[1]);i=[g,new o.P(x.x,g.y),x,new o.P(g.x,x.y),g]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var i,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const h=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new oo(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,h):this.style.loadJSON(m,e,h),this):((u=(i=this.style)===null||i===void 0?void 0:i.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const i=this._requestManager.transformRequest(m,"Style");o.j(i,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new o.k(u))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(i){o.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new o.k(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const u=this.style._layers[i];u.type==="hillshade"&&u.source===m.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===m.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ds(this.painter,e,m),this.painter.renderToTexture=new ni(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var u;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=i.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const i=m[e]._tiles;for(const u in i){const h=i[u];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,i){if(i){const u=this.getSource(i);if(!u)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);u.calculateTileZoom=Le(Math.max(1,m),Math.max(1,e))}else for(const u in this.style.sourceCaches)this.style.sourceCaches[u].getSource().calculateTileZoom=Le(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){const i=this.style.sourceCaches[m];if(!i)throw new Error(`There is no source cache with ID "${m}", cannot refresh tile`);e===void 0?i.reload(!0):i.refreshTiles(e.map(u=>new o.a3(u.z,u.x,u.y)))}addImage(m,e,i={}){const{pixelRatio:u=1,sdf:h=!1,stretchX:g,stretchY:x,content:S,textFitWidth:C,textFitHeight:R}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:B,data:F}=e,U=e;return this.style.addImage(m,{data:new o.R({width:D,height:B},new Uint8Array(F)),pixelRatio:u,stretchX:g,stretchY:x,content:S,textFitWidth:C,textFitHeight:R,sdf:h,version:0,userImage:U}),U.onAdd&&U.onAdd(this,m),this}}{const{width:D,height:B,data:F}=ce.getImageData(e);this.style.addImage(m,{data:new o.R({width:D,height:B},F),pixelRatio:u,stretchX:g,stretchY:x,content:S,textFitWidth:C,textFitHeight:R,sdf:h,version:0})}}updateImage(m,e){const i=this.style.getImage(m);if(!i)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||o.b(e)?ce.getImageData(e):e,{width:h,height:g,data:x}=u;if(h===void 0||g===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==i.data.width||g!==i.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||o.b(e));return i.data.replace(x,S),this.style.updateImage(m,i),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return We.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,i){return this.style.setLayerZoomRange(m,e,i),this._update(!0)}setFilter(m,e,i={}){return this.style.setFilter(m,e,i),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,i,u={}){return this.style.setPaintProperty(m,e,i,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,i,u={}){return this.style.setLayoutProperty(m,e,i,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,i,u=>{u||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,i=>{i||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=Y.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Y.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),u=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],u);const h=this._controlContainer=Y.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=Y.create("div",`maplibregl-ctrl-${x} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,i){this._canvas.width=Math.floor(i*m),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!i){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new ts(i,this.transform),le.testSupport(i)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,i,u,h,g;const x=this._idleTriggered?this._fadeDuration:0,S=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let C=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,F=ce.now();this.style.zoomHistory.update(B,F);const U=new o.F(B,{now:F,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),X=U.crossFadingFactor();X===1&&X===this._crossFadingFactor||(C=!0,this._crossFadingFactor=X),this.style.update(U)}const R=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==S;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cv.mark(o.cw.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||C)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,o.cv.mark(o.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),We.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Y.remove(this._canvasContainer),Y.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cv.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ce.frame(this._frameRequest,m=>{o.cv.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!o.cx(e)&&!function(i){return i.message===nc}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return bc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},P.MapMouseEvent=Rr,P.MapTouchEvent=fs,P.MapWheelEvent=cc,P.Marker=gn,P.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const u=this._map._getUIString(`NavigationControl.${i}`);e.title=u,e.setAttribute("aria-label",u)},this.options=o.e({},br,m),this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),Y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),Y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=Y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const i=Y.create("button",m,this._container);return i.type="button",i.addEventListener("click",e),i}},P.Popup=class extends o.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Bh(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const i=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const h=Su(this.options.offset);if(!u){const x=this._container.offsetWidth,S=this._container.offsetHeight;let C;C=i.y+h.bottom.y<S?["top"]:i.y>this._map.transform.height-S?["bottom"]:[],i.x<x/2?C.push("left"):i.x>this._map.transform.width-x/2&&C.push("right"),u=C.length===0?"bottom":C.join("-")}let g=i.add(h[u]);this.options.subpixelPositioning||(g=g.round()),Y.setTransform(this._container,`${Ha[u]} translate(${g.x}px,${g.y}px)`),an(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(bl),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=o.S.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),i=document.createElement("body");let u;for(i.innerHTML=m;u=i.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=Y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Tc);m&&m.focus()}},P.RasterDEMTileSource=rt,P.RasterTileSource=ht,P.ScaleControl=class{constructor(m){this._onMove=()=>{Tu(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Tu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wc),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},P.ScrollZoomHandler=Dh,P.Style=oo,P.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Y.create("button","maplibregl-ctrl-terrain",this._container),Y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},P.TwoFingersTouchPitchHandler=pc,P.TwoFingersTouchRotateHandler=dc,P.TwoFingersTouchZoomHandler=Ls,P.TwoFingersTouchZoomRotateHandler=yc,P.VectorTileSource=ot,P.VideoSource=It,P.addSourceType=(m,e)=>o._(void 0,void 0,void 0,function*(){if(At(m))throw new Error(`A source type called "${m}" already exists.`);((i,u)=>{$t[i]=u})(m,e)}),P.clearPrewarmedResources=function(){const m=Ui;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Ot),Ui=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},P.createTileMesh=Wo,P.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},P.getRTLTextPluginStatus=function(){return gi().getRTLTextPluginStatus()},P.getVersion=function(){return Sc},P.getWorkerCount=function(){return Ei.workerCount},P.getWorkerUrl=function(){return o.a.WORKER_URL},P.importScriptInWorkers=function(m){return kr().broadcast("IS",m)},P.prewarm=function(){Pn().acquire(Ot)},P.setMaxParallelImageRequests=function(m){o.a.MAX_PARALLEL_IMAGE_REQUESTS=m},P.setRTLTextPlugin=function(m,e){return gi().setRTLTextPlugin(m,e)},P.setWorkerCount=function(m){Ei.workerCount=m},P.setWorkerUrl=function(m){o.a.WORKER_URL=m}});var z=T;return z})}(Sf)),Sf.exports}var sS=rS();const aS=mm(sS),oS=Yu("kawasan",{state:()=>({kawasanData:null}),actions:{startGlitchAnimation(c){if(!this.kawasanData||!this.kawasanData.features)return;let y=0;const T=this.kawasanData.features.map(E=>r0(E)),I=()=>{if(y+=1,c.getZoom()<15){c.getLayer("kawasan-layer")&&c.setPaintProperty("kawasan-layer","fill-translate",[0,0]),c.getLayer("kawasan-layer-glitch")&&c.setPaintProperty("kawasan-layer-glitch","fill-translate",[0,0]),setTimeout(()=>requestAnimationFrame(I),500);return}const z=c.getBounds(),P=[z.getWest(),z.getSouth(),z.getEast(),z.getNorth()];if(T.some(J=>J[2]>=P[0]&&J[0]<=P[2]&&J[3]>=P[1]&&J[1]<=P[3])){const J=Math.floor(Math.sin(y*.6+Math.random())*2),re=J+Math.floor(Math.random()*17-10),H=Math.floor(Math.random()*8-2);c.getLayer("kawasan-layer")&&c.setPaintProperty("kawasan-layer","fill-translate",[J,0]),c.getLayer("kawasan-layer-glitch")&&c.setPaintProperty("kawasan-layer-glitch","fill-translate",[re,H])}setTimeout(()=>requestAnimationFrame(I),2)};I()}}});var pp,my;function b0(){if(my)return pp;my=1;function c(y){var T=typeof y;return y!=null&&(T=="object"||T=="function")}return pp=c,pp}var mp,gy;function lS(){if(gy)return mp;gy=1;var c=typeof hf=="object"&&hf&&hf.Object===Object&&hf;return mp=c,mp}var gp,_y;function w0(){if(_y)return gp;_y=1;var c=lS(),y=typeof self=="object"&&self&&self.Object===Object&&self,T=c||y||Function("return this")();return gp=T,gp}var _p,yy;function uS(){if(yy)return _p;yy=1;var c=w0(),y=function(){return c.Date.now()};return _p=y,_p}var yp,vy;function cS(){if(vy)return yp;vy=1;var c=/\s/;function y(T){for(var I=T.length;I--&&c.test(T.charAt(I)););return I}return yp=y,yp}var vp,xy;function hS(){if(xy)return vp;xy=1;var c=cS(),y=/^\s+/;function T(I){return I&&I.slice(0,c(I)+1).replace(y,"")}return vp=T,vp}var xp,by;function T0(){if(by)return xp;by=1;var c=w0(),y=c.Symbol;return xp=y,xp}var bp,wy;function fS(){if(wy)return bp;wy=1;var c=T0(),y=Object.prototype,T=y.hasOwnProperty,I=y.toString,E=c?c.toStringTag:void 0;function z(P){var o=T.call(P,E),J=P[E];try{P[E]=void 0;var re=!0}catch{}var H=I.call(P);return re&&(o?P[E]=J:delete P[E]),H}return bp=z,bp}var wp,Ty;function dS(){if(Ty)return wp;Ty=1;var c=Object.prototype,y=c.toString;function T(I){return y.call(I)}return wp=T,wp}var Tp,Sy;function pS(){if(Sy)return Tp;Sy=1;var c=T0(),y=fS(),T=dS(),I="[object Null]",E="[object Undefined]",z=c?c.toStringTag:void 0;function P(o){return o==null?o===void 0?E:I:z&&z in Object(o)?y(o):T(o)}return Tp=P,Tp}var Sp,Iy;function mS(){if(Iy)return Sp;Iy=1;function c(y){return y!=null&&typeof y=="object"}return Sp=c,Sp}var Ip,ky;function gS(){if(ky)return Ip;ky=1;var c=pS(),y=mS(),T="[object Symbol]";function I(E){return typeof E=="symbol"||y(E)&&c(E)==T}return Ip=I,Ip}var kp,Ey;function _S(){if(Ey)return kp;Ey=1;var c=hS(),y=b0(),T=gS(),I=NaN,E=/^[-+]0x[0-9a-f]+$/i,z=/^0b[01]+$/i,P=/^0o[0-7]+$/i,o=parseInt;function J(re){if(typeof re=="number")return re;if(T(re))return I;if(y(re)){var H=typeof re.valueOf=="function"?re.valueOf():re;re=y(H)?H+"":H}if(typeof re!="string")return re===0?re:+re;re=c(re);var ie=z.test(re);return ie||P.test(re)?o(re.slice(2),ie?2:8):E.test(re)?I:+re}return kp=J,kp}var Ep,Cy;function yS(){if(Cy)return Ep;Cy=1;var c=b0(),y=uS(),T=_S(),I="Expected a function",E=Math.max,z=Math.min;function P(o,J,re){var H,ie,ce,Y,le,Xe,ft=0,it=!1,Qe=!1,tt=!0;if(typeof o!="function")throw new TypeError(I);J=T(J)||0,c(re)&&(it=!!re.leading,Qe="maxWait"in re,ce=Qe?E(T(re.maxWait)||0,J):ce,tt="trailing"in re?!!re.trailing:tt);function We(Pt){var ut=H,Bt=ie;return H=ie=void 0,ft=Pt,Y=o.apply(Bt,ut),Y}function qe(Pt){return ft=Pt,le=setTimeout(dt,J),it?We(Pt):Y}function Ke(Pt){var ut=Pt-Xe,Bt=Pt-ft,qt=J-ut;return Qe?z(qt,ce-Bt):qt}function pt(Pt){var ut=Pt-Xe,Bt=Pt-ft;return Xe===void 0||ut>=J||ut<0||Qe&&Bt>=ce}function dt(){var Pt=y();if(pt(Pt))return Ye(Pt);le=setTimeout(dt,Ke(Pt))}function Ye(Pt){return le=void 0,tt&&H?We(Pt):(H=ie=void 0,Y)}function Ct(){le!==void 0&&clearTimeout(le),ft=0,H=Xe=ie=le=void 0}function Dt(){return le===void 0?Y:Ye(y())}function ct(){var Pt=y(),ut=pt(Pt);if(H=arguments,ie=this,Xe=Pt,ut){if(le===void 0)return qe(Xe);if(Qe)return clearTimeout(le),le=setTimeout(dt,J),We(Xe)}return le===void 0&&(le=setTimeout(dt,J)),Y}return ct.cancel=Ct,ct.flush=Dt,ct}return Ep=P,Ep}var vS=yS();const xS=mm(vS),_m="./assets/melati-GceLE03l.png",ym="./assets/keris-FzZzBZa9.png",vm="./assets/jenglot-BroRIou4.png",bS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAABLCAYAAAA4TnrqAAABcmlDQ1BEaXNwbGF5UDMuaWNjAAAokXWQv0vDQBzFX1ulpa2I6OiQoYpDhWIHXQT7AwQpUquCVZf0mrRCUsMlRTrrHyC4uCqCm+hYHOrg4CgI6iA6C04KLlLO7zWFFLEX7u7Du3ePywP8WYOZ9sACYNYcXlhMKxvFTSX4jiBCCCCMmMpsK5XP59B3fD/CJ/eHaZnV3/fviJQ1mwG+EHGCWdwhniPO7TmW5APiMVZVy8THxHFODyS+lXrJ5WfJFZc/JPO1Qgbwy3yl0sOlHmZVbhIrxDHTqLPue+SfRLXa+qrMoTmOLHZgw4IBFQ0oyCPZx5/o+JexSy5Gq0V+TrcrqMJBnNQ6JWm066Rr9BloyL7/9mjryRk3PZoGBl+F+JoAgkdA+1CInxMh2qdA4AW4qXn399+A+ZYQ4trTpqjLkQhw1/S0pRZwNQuEm5bK1Y4UoOnXdeDzHBgqAqP3dL7ldtQ9xwX1sUL9Zp6AyzNgkvzD27+ZrGhJ/2k2TAAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAydJREFUeAHtmuF2IyEIhTu77//IPbOHNqSOER2Qi2Rr/jg6KJcPMM05/fjYn01gE1hM4Fjs/+L+PM+zXDiOI5W+NGJqUAwtE7AUsCRQ2YClgEVQJGC7srhkHqMEis2yAPvDgvY4JrBhjRk9LZbfWaMWZKUZWnEprLugsgDbbciZuDFuWDcgscmyNtS24FPwwp9AS2BZQa0GttuQM3Bj3LBuQGKT8DYUW/D4y5q+x/PzOq9mK/7uCq0sEVQF4mtaw6tsVGdVe63TMFim4AbArEFb94W04RDUCEqnJSPbEV5ZQ1DWND/2oc8v5UErqxvIqJpKlfy8uMJgleUOioBZADNohxEGS9QGCribHFGM7gWkDUXhnqAaLYm+7N1hhYDigmgAo1coaK6wQkExMBob0BDA3O4sEVQZVOAzQo9LZQ2Fed5VPeCNCiNzrypzqywxhihQogC/F3hYflr7JwlV1d+kezvdht0WjK6qDjCPVvx/KouKhJIDTNAUrG5V6Sr8LaynYHUjBGa465degnybYb1UFUjgEMxNA9JLn5vmTTMzrMtpNah6fjEOmgA0mGDNZigIV9PNjHYTrIsKQAYv5yeazMNKFMyLFOdE+sJyFvcSvNOCtRV9YVEwbwLMwl0Ny5oVizjkHkscaljIACLPtvxWnIdV/nil53IeGX2Ar3lYASKzuNiwFJnAwMrUio1vZ8t9RUzVsLqOWBiPiqzBTKvEsf4c34aZQAkZsIAyVZbg/1csq9vwrahULTir3RcWiXMWaA5woIPvLs35PrAGwjSCkLYMiEetLxOs0ln5rHUOsxeSZ73YWacJFm+m8SlAEFjavvvzNKwmgJXggL7NsFK2XzNzP4uzms2wfiQkeupU1SwoinL6fx3okOe9VXOL/mtegOUBikLDVpYgvmbqMg/whYVFFAKCkGBTRdFHeq9ddztIbMWWIs/2FJLhCYlDcINFB6qAsQIaR/AYSGnHa+U5j2cEqC+ZDV9TS2ZgVaDWc1CgILCYtDVY3m8ZkaCgsDjYKGhoUCGw0NAiIHEMrhc8HzoardXGYHg/z0f+9vtNYBPYBH4jgX+SGgJrv7R5zQAAAA5lWElmTU0AKgAAAAgAAAAAAAAA0lOTAAAAAElFTkSuQmCC",xm=(c,y)=>{const T=c.__vccOpts||c;for(const[I,E]of y)T[I]=E;return T},wS={setup(){const c=vn(null),y=Jf(),T=gh(),I=Qf(),E=Ju(),z=oS(),P=xS(()=>{o&&(o.addSource("material",{type:"geojson",data:y.emptyData}),o.addSource("kawasan",{type:"geojson",data:y.emptyData}),o.addLayer({id:"material-layer",type:"symbol",source:"material",layout:{"icon-image":["get","icon"],"icon-size":.2}}),o.addLayer({id:"kawasan-layer",type:"fill",source:"kawasan",paint:{"fill-color":"#8b0000","fill-opacity":.3}}),o.addLayer({id:"kawasan-layer-glitch",type:"fill",source:"kawasan",paint:{"fill-color":"#AAFF95","fill-opacity":.05,"fill-translate":[-4,4]}}))},300);let o;return dh(()=>{o=new aS.Map({container:c.value,style:"https://api.maptiler.com/maps/streets-v2-dark/style.json?key=uphnMI3aKq0AUa7AG7GO",center:[101.46191571299335,.43856943227326894],zoom:16,maxZoom:19,minZoom:12}),o.on("load",async()=>{o.getStyle().layers.forEach(re=>{const H=re.id;H&&((re.type==="symbol"||H.includes("label")||H.includes("place")||H.includes("poi"))&&o.setLayoutProperty(H,"visibility","none"),re.type==="line"&&o.setPaintProperty(H,"line-color","#A59F8C"),(H==="Building"||H==="Building 3D")&&o.setLayoutProperty(H,"visibility","none"),H.toLowerCase().includes("background")&&o.setPaintProperty(H,"background-color","#363636"))});const J={melati:_m,keris:ym,jenglot:vm};for(const re in J){const H=J[re];await new Promise((ie,ce)=>{const Y=new Image;Y.crossOrigin="anonymous",Y.onload=()=>{o.addImage(re,Y),ie()},Y.onerror=le=>{ie()},Y.src=H})}await new Promise((re,H)=>{const ie=new Image;ie.crossOrigin="anonymous",ie.onload=()=>{o.addImage("user-location-icon",ie),re()},ie.onerror=ce=>{re()},ie.src=bS}),P(),T.setMapInstance(o),z.kawasanData=y.kawasanData,z.startGlitchAnimation(o)}),o.on("click",J=>{const re=$u([J.lngLat.lng,J.lngLat.lat]),ie=(y.materialData?.features||[]).map(ce=>{if(!ce?.geometry?.coordinates)return null;const Y=$u(ce.geometry.coordinates),le=t0(re,Y,{units:"meters"});return le<=60?{feature:ce,distance:le}:null}).filter(Boolean).sort((ce,Y)=>ce.distance-Y.distance)[0]?.feature;ie&&I.collectMaterial(ie,o)}),o.on("click","kawasan-layer",J=>{const re=J.features?.[0];re&&T.setSelectedKawasan(re)})}),{mapContainer:c,playerStore:E}}},TS={ref:"mapContainer",class:"map-container"},SS={class:"absolute top-4 left-1 transform bg-black/60 border border-red-600 backdrop-blur-sm px-4 py-1 rounded-full text-start text-white text-sm shadow-lg z-10 font-horror"},IS={class:"text-yellow-300 font-bold"};function kS(c,y,T,I,E,z){return mi(),Di("div",TS,[vt("div",SS,[vt("p",null,[y[0]||(y[0]=qu(" Total Distance Walked: ")),y[1]||(y[1]=vt("br",null,null,-1)),vt("span",IS,yn(I.playerStore.formattedDistance),1)])])],512)}const ES=xm(wS,[["render",kS],["__scopeId","data-v-85a5c1be"]]),S0="./assets/Banaspati-DUgZm5_n.jpg",I0="./assets/Genderuwo-JXaqDzcw.jpg",k0="./assets/Kuntilanak-CLhQqkn8.jpg",E0="./assets/Kuyang-0usUToFc.jpg",C0="./assets/Kuyang-0usUToFc.jpg",P0="./assets/Tuyul-CODVJ9mL.jpg";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Py=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),CS=c=>c.replace(/^([A-Z])|[\s-_]+(\w)/g,(y,T,I)=>I?I.toUpperCase():T.toLowerCase()),PS=c=>{const y=CS(c);return y.charAt(0).toUpperCase()+y.slice(1)},MS=(...c)=>c.filter((y,T,I)=>!!y&&y.trim()!==""&&I.indexOf(y)===T).join(" ").trim();/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var _f={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AS=({size:c,strokeWidth:y=2,absoluteStrokeWidth:T,color:I,iconNode:E,name:z,class:P,...o},{slots:J})=>Lf("svg",{..._f,width:c||_f.width,height:c||_f.height,stroke:I||_f.stroke,"stroke-width":T?Number(y)*24/Number(c):y,class:MS("lucide",...z?[`lucide-${Py(PS(z))}-icon`,`lucide-${Py(z)}`]:["lucide-icon"]),...o},[...E.map(re=>Lf(...re)),...J.default?[J.default()]:[]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=(c,y)=>(T,{slots:I})=>Lf(AS,{...T,iconNode:y,name:c},I);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RS=yh("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LS=yh("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DS=yh("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zS=yh("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=yh("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),NS={class:"fixed inset-0 bg-black/90 z-56 flex items-center justify-center p-6 text-white"},OS={class:"relative w-full max-w-2xl bg-zinc-900 border border-red-700 p-6 rounded-xl shadow-lg"},FS={class:"text-2xl font-horror text-red-600 text-center mb-4"},BS={class:"text-sm italic text-center text-red-300 mb-4"},jS={class:"text-base leading-relaxed whitespace-pre-line mb-6"},VS={class:"text-sm text-zinc-300 mb-2"},US={class:"font-semibold text-white"},GS={key:0,class:"mt-4"},qS={class:"flex flex-wrap gap-2"},$S={__name:"HantuInfoModal",props:{ghostName:{type:String,required:!0},ghostAlias:{type:String,required:!1,default:""}},setup(c){const y=c,T=_h(),I=io(()=>T.ghostData[y.ghostName]||{text:"No data available for this ghost.",location:"Unknown",similarEntities:[]});return(E,z)=>(mi(),Di("div",NS,[vt("div",OS,[vt("h2",FS,yn(c.ghostName),1),vt("p",BS,"Identified as: "+yn(c.ghostAlias),1),vt("p",jS,yn(I.value.text),1),vt("p",VS,[z[1]||(z[1]=qu(" Origin: ")),vt("span",US,yn(I.value.location),1)]),I.value.similarEntities?.length?(mi(),Di("div",GS,[z[2]||(z[2]=vt("p",{class:"text-sm text-zinc-300 mb-1"},"Similar Entities:",-1)),vt("ul",qS,[(mi(!0),Di(Wr,null,ph(I.value.similarEntities,P=>(mi(),Di("li",{key:P.name+P.country,class:"bg-red-800/40 border border-red-700 px-3 py-1 rounded text-xs text-white"},yn(P.name)+"  "+yn(P.country),1))),128))])])):jn("",!0),vt("button",{onClick:z[0]||(z[0]=P=>E.$emit("close")),class:"absolute top-2 right-2 text-white text-xl hover:text-red-500"},[tn(xn(vh))])])]))}},ZS={class:"fixed inset-0 bg-black/90 z-55 flex items-center justify-center p-6 text-white"},HS={class:"relative w-full max-w-2xl bg-zinc-900 border border-red-700 p-6 rounded-xl shadow-lg"},XS=["src"],WS=["value"],YS={__name:"HantuShareModal",props:{ghost:Object,annotatedBlob:Blob,shareText:String},setup(c){const y=c,T=vn(null);Ul(()=>y.annotatedBlob,z=>{z&&(T.value&&URL.revokeObjectURL(T.value),T.value=URL.createObjectURL(z))},{immediate:!0}),lm(()=>{T.value&&URL.revokeObjectURL(T.value)});const I=async()=>{try{const z=new File([y.annotatedBlob],`${y.ghost.name}.jpg`,{type:"image/jpeg"});navigator.canShare&&navigator.canShare({files:[z],text:y.shareText})?await navigator.share({title:`I caught ${y.ghost.name}!`,text:y.shareText,files:[z]}):alert("Sharing not supported. Try copying the text instead.")}catch(z){alert("Share failed. Try manually copying the message."),console.error(z)}},E=()=>{navigator.clipboard.writeText(y.shareText).then(()=>{alert("Share message copied to clipboard!")}).catch(()=>{alert("Failed to copy. Please do it manually.")})};return(z,P)=>(mi(),Di("div",ZS,[vt("div",HS,[P[1]||(P[1]=vt("h2",{class:"text-xl font-horror text-red-500 mb-4 text-center"},"Share Your Catch",-1)),T.value?(mi(),Di("img",{key:0,src:T.value,alt:"ghost preview",class:"mx-auto max-h-64 rounded border border-red-800 shadow mb-6"},null,8,XS)):jn("",!0),vt("button",{onClick:I,class:"w-full bg-red-700 hover:bg-red-600 text-white py-2 px-4 rounded mb-6"}," Share Image + Message "),P[2]||(P[2]=vt("label",{for:"share-text",class:"text-sm text-zinc-300 mb-1 block"},"Share Message:",-1)),vt("textarea",{id:"share-text",readonly:"",value:c.shareText,class:"w-full bg-zinc-800 border border-zinc-700 text-white rounded p-2 text-sm mb-3 resize-none",rows:"6"},null,8,WS),vt("button",{onClick:E,class:"w-full bg-zinc-700 hover:bg-zinc-600 text-white py-2 px-4 rounded"}," Copy Message to Clipboard "),vt("button",{onClick:P[0]||(P[0]=o=>z.$emit("close")),class:"absolute top-2 right-2 text-white text-xl hover:text-red-500"},[tn(xn(vh))])])]))}},KS={key:0,class:"fixed inset-0 bg-black/80 z-54 flex items-center justify-center p-4"},JS={key:2,class:"relative w-[90vw] h-[90vh] flex items-center justify-center"},QS={class:"relative inline-block"},eI=["src","alt"],tI={class:"absolute bottom-0 left-0 w-full text-center text-red-700 font-horror bg-transparent py-2"},iI={class:"text-sm sm:text-lg"},nI={class:"text-xs sm:text-sm"},rI={class:"text-xs sm:text-sm"},sI={class:"absolute -top-4 right-3 flex flex-col items-end space-y-6 z-10"},M0={__name:"HantuPreviewModal",props:{ghost:{type:Object,required:!1,default:null}},setup(c){const y=c,T=vn(!1),I=vn(!1),E=vn(null),z=vn(""),P=Object.assign({"/src/assets/hantu/Banaspati.jpg":S0,"/src/assets/hantu/Genderuwo.jpg":I0,"/src/assets/hantu/Kuntilanak.jpg":k0,"/src/assets/hantu/Kuyang.jpg":E0,"/src/assets/hantu/Pocong.jpg":C0,"/src/assets/hantu/Tuyul.jpg":P0}),o=ce=>{const Y=Object.entries(P).find(([le])=>le.includes(`/${ce}.jpg`));return Y?Y[1]:null},J=ce=>new Date(ce).toLocaleString(),re=()=>{T.value=!T.value},H=async()=>{const ce=o(y.ghost.name),le=await(await fetch(ce)).blob(),Xe=await createImageBitmap(le),ft=3,it=document.createElement("canvas");it.width=Xe.width*ft,it.height=Xe.height*ft;const Qe=it.getContext("2d");Qe.drawImage(Xe,0,0,it.width,it.height);const tt=Math.floor(it.height*.024);Qe.font=`${tt}px 'Creepster', cursive`,Qe.textAlign="center",Qe.fillStyle="#b91c1c";const We=[y.ghost.name,y.ghost.alias,J(y.ghost.timestamp)],qe=tt*1.4,Ke=20*ft,pt=it.height-Ke-(We.length-1)*qe;We.forEach((Ct,Dt)=>{const ct=pt+Dt*qe;Qe.fillText(Ct,it.width/2,ct)});const dt=await new Promise(Ct=>it.toBlob(Dt=>Ct(Dt),"image/jpeg",1)),Ye=`I caught *${y.ghost.name}*
Alias: ${y.ghost.alias}
Time: ${J(y.ghost.timestamp)}
Join me in a paranormal investigation at *PENAMPAKAN*
I'm helping a scientist collect photographic evidence of ghost sightings
I just caught one  can you capture your own?
https://baikunip.github.io./`;return{annotatedBlob:dt,shareText:Ye}},ie=async()=>{try{const{annotatedBlob:ce,shareText:Y}=await H();E.value=ce,z.value=Y,I.value=!0}catch(ce){console.error("Failed to prepare share content:",ce)}};return(ce,Y)=>c.ghost?(mi(),Di("div",KS,[T.value?(mi(),Aa($S,{key:0,ghostName:c.ghost.name,ghostAlias:c.ghost.alias,onClose:re},null,8,["ghostName","ghostAlias"])):jn("",!0),I.value?(mi(),Aa(YS,{key:1,ghost:c.ghost,annotatedBlob:E.value,shareText:z.value,onClose:Y[0]||(Y[0]=le=>I.value=!1)},null,8,["ghost","annotatedBlob","shareText"])):jn("",!0),!T.value&&!I.value?(mi(),Di("div",JS,[vt("div",QS,[vt("img",{src:o(c.ghost.name),alt:c.ghost.name,class:"block object-contain max-h-[90vh] max-w-[90vw]"},null,8,eI),vt("div",tI,[vt("div",iI,yn(c.ghost.name),1),vt("div",nI,yn(c.ghost.alias),1),vt("div",rI,yn(J(c.ghost.timestamp)),1)])]),vt("div",sI,[vt("button",{onClick:Y[1]||(Y[1]=le=>ce.$emit("close")),class:"text-white text-3xl hover:text-red-500",title:"Close"},[tn(xn(vh))]),vt("button",{onClick:re,class:"text-white text-xl hover:text-red-500",title:"Info"},[tn(xn(LS))]),vt("button",{onClick:ie,class:"text-white text-xl hover:text-red-500",title:"Share"},[tn(xn(zS))])])])):jn("",!0)])):jn("",!0)}},aI={key:0,class:"absolute inset-0 bg-black/60 z-[53] flex items-center justify-center p-6"},oI={class:"font-horror text-white rounded-xl p-8 max-w-md w-full h-[98vh] relative shadow-lg flex flex-col items-center"},lI={class:"mb-4 space-y-1 text-sm"},uI=["src","alt"],cI={class:"font-semibold"},hI={key:0,class:"mb-4 text-center flex flex-col items-center justify-center gap-2"},fI={key:1,class:"mb-4 text-center"},dI={key:0,class:"text-red-400 font-semibold"},pI={key:1,class:"text-green-400 font-semibold text-lg"},mI={class:"text-red-300"},gI={class:"text-yellow-300 italic"},_I={key:3,class:"absolute inset-0 z-10 flex items-center justify-center p-4"},yI={class:"bg-gray-800 text-white p-6 rounded-xl w-full max-w-sm text-center shadow-xl"},vI={class:"flex justify-center gap-4"},xI={__name:"Penangkapan",props:{visible:Boolean,requirements:{type:Object,required:!0}},emits:["close","consume"],setup(c,{emit:y}){const T=y,I=gh(),E=Qf(),z=_h(),P=Ju(),o=vn(!1),J=vn(!1),re=vn(""),H=vn(""),ie=Object.assign({"/src/assets/materials/jenglot.png":vm,"/src/assets/materials/keris.png":ym,"/src/assets/materials/melati.png":_m}),ce=["Rizky","Ayu","Dewi","Budi","Rina","Satria","Dimas","Indah","Yusuf","Sari"],Y=["Santoso","Wijaya","Pratama","Saputra","Susanti","Nugroho","Putri","Setiawan","Kurniawan"],le=()=>{const qe=ce[Math.floor(Math.random()*ce.length)],Ke=Y[Math.floor(Math.random()*Y.length)],pt=Math.random()<.5?ce[Math.floor(Math.random()*ce.length)]+" ":"";return`${qe} ${pt}${Ke}`},Xe=qe=>{const Ke=Object.entries(ie).find(([pt])=>pt.includes(`/${qe}.png`));return Ke?Ke[1]:null};function ft(qe){J.value=!0,setTimeout(()=>{if(E.consumeMaterials(qe)){const pt=["Pocong","Kuntilanak","Tuyul","Genderuwo","Banaspati"],dt=Math.floor(Math.random()*pt.length);H.value={name:pt[dt],alias:le()},re.value="";const Ye=I.playerPoint?.geometry?.coordinates??[null,null];z.addGhost(H.value,Ye),setTimeout(()=>{T("consume",H.value),T("close"),H.value=""},8e3),J.value=!1,P.countHantuCaught(Ct=>{Ct&&(P.latestUnlocked=Ct)})}else re.value=" Material tidak mencukupi!",H.value="",J.value=!1},3e3)}const it=()=>{o.value=!0},Qe=qe=>{o.value=!1,ft(qe)},tt=()=>{o.value=!1},We=()=>{T("close")};return(qe,Ke)=>c.visible?(mi(),Di("div",aI,[vt("div",oI,[Ke[8]||(Ke[8]=vt("h2",{class:"text-2xl font-bold mb-4"},"Penangkapan Hantu",-1)),Ke[9]||(Ke[9]=vt("p",{class:"mb-2 text-sm text-gray-300"},"Material dibutuhkan:",-1)),vt("ul",lI,[(mi(!0),Di(Wr,null,ph(JSON.parse(c.requirements),(pt,dt)=>(mi(),Di("li",{key:dt,class:"capitalize flex items-center gap-2"},[vt("img",{src:Xe(dt),alt:dt,class:"w-6 h-6 object-contain"},null,8,uI),Ke[2]||(Ke[2]=qu(" : ")),vt("span",cI,yn(pt),1)]))),128))]),J.value?(mi(),Di("div",hI,Ke[3]||(Ke[3]=[vt("svg",{class:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[vt("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),vt("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),vt("p",{class:"text-gray-400 font-semibold text-lg"},"Menangkap hantu...",-1)]))):jn("",!0),!J.value&&(re.value||H.value)?(mi(),Di("div",fI,[re.value?(mi(),Di("p",dI,yn(re.value),1)):(mi(),Di("p",pI,[Ke[4]||(Ke[4]=qu(" Successfully caught ")),vt("span",mI,yn(H.value.name),1),Ke[5]||(Ke[5]=vt("br",null,null,-1)),Ke[6]||(Ke[6]=qu(" Alias: ")),vt("span",gI,yn(H.value.alias),1)]))])):jn("",!0),vt("button",{onClick:it,class:"absolute bottom-10 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full transition"}," Tangkap Hantu "),vt("button",{onClick:We,class:"absolute top-4 p-4 right-3 text-white hover:text-red-400 text-xl"},"  "),H.value?(mi(),Aa(M0,{key:2,ghost:{name:H.value.name,alias:H.value.alias,timestamp:new Date().toISOString()},onClose:Ke[0]||(Ke[0]=pt=>H.value=null)},null,8,["ghost"])):jn("",!0),o.value?(mi(),Di("div",_I,[vt("div",yI,[Ke[7]||(Ke[7]=vt("p",{class:"mb-4"},"Yakin ingin menggunakan material untuk menangkap hantu?",-1)),vt("div",vI,[vt("button",{onClick:Ke[1]||(Ke[1]=pt=>Qe(JSON.parse(c.requirements))),class:"bg-green-600 hover:bg-green-700 px-4 py-2 rounded"}," Ya "),vt("button",{onClick:tt,class:"bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded"}," Batal ")])])])):jn("",!0)])])):jn("",!0)}},bI={key:0,class:"fixed inset-0 z-[51] bg-black bg-opacity-80 flex items-center justify-center p-4"},wI={class:"scrollable-grid h-full overflow-y-auto"},TI={class:"grid grid-cols-3 sm:grid-cols-5 md:grid-cols-6 gap-6"},SI=["src","alt"],II={class:"text-red-600 mt-2 capitalize font-semibold"},kI={class:"text-red-300 text-sm"},EI={__name:"Inventory",props:{visible:Boolean},emits:["close"],setup(c,{emit:y}){const T=y,I=Object.assign({"/src/assets/materials/jenglot.png":vm,"/src/assets/materials/keris.png":ym,"/src/assets/materials/melati.png":_m}),E=Qf(),z=io(()=>{const J={};for(const re of E.collectedMaterials)J[re.type]=(J[re.type]||0)+1;return Object.entries(J).map(([re,H])=>({type:re,count:H}))}),P=J=>{const re=Object.entries(I).find(([H])=>H.includes(`/${J}.png`));return re?re[1]:null},o=()=>{T("close")};return(J,re)=>c.visible?(mi(),Di("div",bI,[vt("div",{class:"bg-transparent font-horror rounded-xl p-6 max-w-5xl w-full h-[98vh] overflow-auto shadow-2xl relative",style:Wu({backgroundImage:`url(${xn(gm)})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[re[0]||(re[0]=vt("h2",{class:"text-red-800 text-center text-2xl mb-4 font-bold"},"Inventory",-1)),vt("button",{onClick:o,class:"absolute top-4 right-4 p-1 text-white hover:text-red-400 text-2xl"},"  "),vt("div",wI,[vt("div",TI,[(mi(!0),Di(Wr,null,ph(z.value,(H,ie)=>(mi(),Di("div",{key:ie,class:"flex flex-col items-center"},[vt("img",{src:P(H.type),alt:H.type,class:"w-20 h-20 object-contain"},null,8,SI),vt("span",II,yn(H.type),1),vt("span",kI,"x"+yn(H.count),1)]))),128))])])],4)])):jn("",!0)}},CI=xm(EI,[["__scopeId","data-v-8bf5bc1d"]]),PI={class:"scrollable-grid h-full overflow-y-auto"},MI={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 gap-2"},AI=["onClick"],RI=["src","alt"],LI={class:"text-red-600 capitalize font-semibold"},DI={class:"text-red-600 capitalize font-semibold"},zI={class:"text-red-300 text-xs"},NI={__name:"HantuJournal",props:{visible:Boolean},emits:["close"],setup(c,{emit:y}){const T=_h(),I=vn(null),E=Object.assign({"/src/assets/hantu/Banaspati.jpg":S0,"/src/assets/hantu/Genderuwo.jpg":I0,"/src/assets/hantu/Kuntilanak.jpg":k0,"/src/assets/hantu/Kuyang.jpg":E0,"/src/assets/hantu/Pocong.jpg":C0,"/src/assets/hantu/Tuyul.jpg":P0}),z=J=>{const re=Object.entries(E).find(([H])=>H.includes(`/${J}.jpg`));return re?re[1]:null},P=J=>new Date(J).toLocaleString(),o=J=>{I.value=J,console.log("selected ghost",I.value)};return(J,re)=>(mi(),Di("div",PI,[re[1]||(re[1]=vt("h2",{class:"text-red-800 text-center text-2xl mb-4 font-bold"},"Hantu Journal",-1)),vt("div",MI,[(mi(!0),Di(Wr,null,ph(xn(T).caughtGhosts,(H,ie)=>(mi(),Di("div",{key:ie,class:"flex flex-col items-center cursor-pointer",onClick:ce=>o(H)},[vt("img",{src:z(H.name),alt:H.name,class:"w-45 h-45 object-contain"},null,8,RI),vt("span",LI,yn(H.name),1),vt("span",DI,yn(H.alias),1),vt("span",zI,yn(P(H.timestamp)),1)],8,AI))),128))]),I.value?(mi(),Aa(M0,{key:0,ghost:I.value,onClose:re[0]||(re[0]=H=>I.value=null)},null,8,["ghost"])):jn("",!0)]))}},OI=xm(NI,[["__scopeId","data-v-487ad7b0"]]),FI={class:"h-full overflow-y-auto scrollable-grid w-[90%] ml-[5%]"},BI={class:"grid grid-cols-2 sm:grid-cols-3 gap-1 mb-6 text-slate-800 text-sm font-handwriting"},jI={class:"text-xl sm:text-2xl text-slate-800"},VI={class:"text-base sm:text-lg"},UI={class:"grid grid-cols-2 sm:grid-cols-3 gap-3 text-xs font-handwriting"},GI={key:0,class:"text-start text-gray-500 italic"},qI={class:"font-bold text-center leading-tight"},$I={class:"text-[10px] text-gray-600 text-center"},ZI={__name:"NoteJournal",setup(c){_h();const y=Ju(),T=io(()=>Kv.filter(I=>y.unlockedAchievements.includes(I.id)));return(I,E)=>(mi(),Di("div",FI,[E[3]||(E[3]=vt("h2",{class:"text-red-800 text-center text-2xl mb-4 font-bold"},"Player Field Record",-1)),vt("div",BI,[vt("div",null,[E[0]||(E[0]=vt("h3",{class:"font-semibold"},"Hantu Caught",-1)),vt("p",jI,yn(xn(y).totalHantu),1)]),E[2]||(E[2]=vt("div",null,[vt("h3",{class:"font-semibold"},"Kawasan Angker Visited"),vt("p",{class:"text-base italic text-slate-800"},"Not tracked yet")],-1)),vt("div",null,[E[1]||(E[1]=vt("h3",{class:"font-semibold"},"Distance Walked",-1)),vt("p",VI,yn(xn(y).formattedDistance),1)])]),E[4]||(E[4]=vt("h3",{class:"text-slate-950 text-lg font-bold mb-3 font-handwriting"},"Achievements",-1)),vt("div",UI,[T.value.length===0?(mi(),Di("div",GI," No achievements unlocked yet. ")):jn("",!0),(mi(!0),Di(Wr,null,ph(T.value,(z,P)=>(mi(),Di("div",{key:P,class:"bg-yellow-100 text-gray-900 rounded-md p-2 shadow flex flex-col items-center"},[vt("div",qI,yn(z.title),1),vt("div",$I,yn(z.desc),1)]))),128))])]))}},HI={key:0,class:"fixed inset-0 z-[51] bg-black bg-opacity-80 flex items-center justify-center p-2"},XI={class:"bg-transparent font-horror rounded-xl p-6 max-w-5xl w-full h-[98vh] shadow-2xl relative overflow-hidden flex items-center justify-center"},WI={__name:"Journal",props:{visible:Boolean},emits:["close"],setup(c,{emit:y}){const T=y,I=["caught","notes"],E=vn("caught"),z=vn("right"),P=io(()=>I.indexOf(E.value)),o=io(()=>{switch(E.value){case"caught":return OI;case"notes":return ZI}}),J=io(()=>z.value==="right"?"slide-left":"slide-right"),re=vn(0),H=vn(0),ie=()=>T("close"),ce=()=>{z.value="right";const Qe=P.value;E.value=I[(Qe+1)%I.length]},Y=()=>{z.value="left";const Qe=P.value;E.value=I[(Qe-1+I.length)%I.length]},le=io(()=>({backgroundImage:`url(${gm})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})),Xe=Qe=>{re.value=Qe.changedTouches[0].clientX},ft=Qe=>{H.value=Qe.changedTouches[0].clientX,it()},it=()=>{const Qe=H.value-re.value,tt=50;Qe>tt?Y():Qe<-tt&&ce()};return(Qe,tt)=>c.visible?(mi(),Di("div",HI,[vt("div",XI,[vt("button",{onClick:Y,class:"absolute left-2 top-1/2 -translate-y-1/2 text-white text-4xl z-50 hover:text-yellow-300 transition"},"  "),vt("div",{class:"relative w-full h-full overflow-hidden rounded-xl",style:Wu(le.value),onTouchstart:Xe,onTouchend:ft},[tn(ww,{name:J.value,mode:"out-in"},{default:lv(()=>[(mi(),Aa(um(o.value),{key:E.value,class:"absolute inset-0 p-4 w-full h-full overflow-y-auto text-white"}))]),_:1},8,["name"])],36),vt("button",{onClick:ce,class:"absolute right-2 top-1/2 -translate-y-1/2 text-white text-4xl z-50 hover:text-yellow-300 transition"},"  "),vt("button",{onClick:ie,class:"absolute top-4 right-4 p-1 text-white hover:text-red-400 text-4xl z-50"},"  ")])])):jn("",!0)}},YI="./assets/journal-Bakbpv4i.png",KI="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAABLCAYAAAA4TnrqAAABcWlDQ1BEaXNwbGF5UDMuaWNjAAAokXWQsUvDQBjFX1NLxVZEdHTIoOJQodjBLoK2BUGK1Kpg1SW9Jq2Q1HBJkc76BwgurorgJjoWhzo4OAqCOojOgpOCi5Tzu6bQIuaOy/149+5xeYCSMZnl9M0DVtXl+cWUulHYVMPvCNMMIQlVY469kMtl4Tu+HxGQ+8O0zPL3/TsiJd1hQKCfOM5s7hInibN7ri35gHiUVbQS8TFxjNMDiW+lXvT4WXLZ4w/JfC2fBhSZr5Z7uNjDrMItYpV43DJrrPMe+SdRvbq+KnNojSGDHTiwYUJDHSpySPj4423/MnbJxehrk5/T7TIqcBEjtUZJOu0G6TpNE3XZ998eHSMx46VHU0DoVYivCSB8BLQOhfg5EaJ1CgRfgJtq9/7+GzDXFEJcd7Up6nI4Atw1utpSE7iaBQYatsa1thSkpRgG8HkODBaAkXs63/I66pzjgvpYoX7TT8DlGTBJ/qHtX/WVaHS0AdokAAAACXBIWXMAAC4jAAAuIwF4pT92AAAFX0lEQVR4Ae1cS8scRRQ9FU2MT2IgiBtBXQgu3In/QHARXboUBd34X1y58S+4dCn6HxRByEZcqSCSgA/QqDecSd+eO9VVXa/unp6ZLghVdes+zj11q6bnkQ/Y2sbAxsDGwMbAWTLgjp2ViDwB4EkATwN4FsAzAK4DeAoA1x4BcA3AFQCPAngMwFUA/wN4gbrOuQ+WyGMRskRERpL5rSOHRPBfCJPKrB+V0TXl3wL4HMCXAO445/4ciVm1ZANWOfCNRORxAH/58sRcSVA8OqcZZZzrWsLVcNk5V21rvU3ihA5FhFVx3zr3xv91R4fH5x8AvwK41/V3O9lNAC91dq969nbK6nnTChLjq865fxM6yeVJyBKRFwH84EX7u7tfvgfwFYAvAHzXEXTfOWerxzOtn8aO/FTVVY/sYUW9Q4Bee0tEbokIL+ejNA8Pp++3AmmqLBH5GMCnHogrrVUjuJFVdQ73RvGTIYONR/8N59w3RlY0HA2W8uSBQarUYyQw6dhaCkNsXYn0MP7hnOMjSlWbjCyfqFjymkQV2gwjP+5uI/YVJs45Pq9VtcnJUrBzk1KSrVddyRMQ813NsnXoV9WaiCJOH5/FXjKehCwbcG1EGWyfmHHVsJosv7Sroi9r9ArDtVRZNVktQZflqI/2MkdH22QGZlM4dqyyNfUP0Ur1i1p1Za2dmJFN4nvTqlZNVlW0dRh9tjiMrqR3nQZfe7V1mKs/fbjEyqp+c3+JZOlBKO43sgoou0iyau/WiySroJgOVC+WrJrqqiKrJtDBFq1k0j1KPC+S91RfTNY5EOW9r/2J3zqJyHOpPSwiyxLlBUzFWd16AP8vKZDZZJ0TUUoKCWPTuc1RZbbPIss6sc6to1Me25xsrn5OSbKssXXqOzr1uc2NObP5OY2SZQ2sM9+J1fPXTmk+liPziJJlCUg5UUKoZ+1Ufqq9nwt/zDFoVimXqIGTAoGNlzJbAk8Mw6CySoDHnJbIo/Ecf9c2f9PvOXMiHVRWDDgdzv4VV4gcXyb8ZdLxWl9ZMaKOB82LfI2/lDxu68k65l2QRcFH72Wp1SjlHsX+6ZVB/OpSAmPH0Or3unxXap6KU+B7H/6RCxnK3eIvSelf8Wgsne9y9q4Y1bHhVf/gzrIKpzAOJRbCnasXsrWyWcnKBplTVRZ1N+aOM4bufEClF2Vj6S2Gg/7OGi61S5hEqu2iNLzK0X8r0tw7a1ayspOorKxc/1NUFWM1HUPuqgLRnk45nmLHQ2TYOKH1OWVNZI0BO2ZSY7ha1tZxDFsyWNB2tspaMIfsUK1Xw1ZZ2VQ3XvCMo7s1+x3VPV7YFxWbp+KwsqnHkx3DWrA1JNfGaiVvHcew4aG0lQDa5378tA6ypsi4wcckT/A1R6Qa81h1ja1VB9wbTlZZuazvQxeP9tWdIOVYd5VmNNkFrw5Le/OOaWiaIG9oMK8kSRZLdO7qYsX0Rz5C0BxVVZrX/ghENqXUYcRNUpwg4/WkgwUUkpW1AAYb4jUAX3d/5+FnAD92f+fhXRH53Tl3p69Aa5UYj21E7uXOEAcfnAWB8LOmyNFIYIwuj4G3RiJyG8CHzrm3rZzjIFZfKTEP4Qj5Vb0kWVTkURzbgVCAEM6dr+4HFwogpJcr07glvmgT0ldfodiqf0AWFX0jVQw5OSeZn7fNTTlIXvA7AjP+N/xYMA2co6O6U/eMbZv6V5nO/V6JojxZWdaYhnRuZec+tmRlVZYScmlEad7aF5GlRpfS26pizoNjqERcehX5RI2SpaSxn4O4EBgbc65xTi4xbNHKmgNsDtA54oZ8xggJ6a5WRkK15YCkbo7eprMxsF4GHgB+H2R0KYF61wAAAA5lWElmTU0AKgAAAAgAAAAAAAAA0lOTAAAAAElFTkSuQmCC",JI={class:"absolute bg-none bottom-10 left-0 w-full z-50 p-3 flex justify-around items-end"},QI={class:"relative flex flex-col items-center"},e2=["src"],t2={class:"relative flex flex-col items-center"},i2=["src"],n2={__name:"FooterMenu",emits:["showInventory","showJournal"],setup(c,{emit:y}){const T=y;return(I,E)=>(mi(),Di("div",JI,[vt("div",QI,[vt("button",{onClick:E[0]||(E[0]=z=>T("showJournal")),class:"w-14 h-14 rounded-full bg-black/70 border border-red-600 hover:bg-red-900 hover:text-white transition-all duration-200 flex items-center justify-center shadow-md"},[vt("img",{src:xn(YI),alt:"btn.label",class:"w-8 h-8"},null,8,e2)]),E[2]||(E[2]=vt("span",{class:"absolute -bottom-4 bg-red-800 text-white text-[10px] font-horror px-2 py-0.5 rounded-full shadow-md"}," Journal ",-1))]),vt("div",t2,[vt("button",{onClick:E[1]||(E[1]=z=>T("showInventory")),class:"w-14 h-14 rounded-full bg-black/70 border border-red-600 hover:bg-red-900 hover:text-white transition-all duration-200 flex items-center justify-center shadow-md"},[vt("img",{src:xn(KI),alt:"btn.label",class:"w-8 h-8"},null,8,i2)]),E[3]||(E[3]=vt("span",{class:"absolute -bottom-4 bg-red-800 text-white text-[10px] font-horror px-2 py-0.5 rounded-full shadow-md"}," Inventory ",-1))])]))}},r2={__name:"PanningButton",setup(c){const y=jo("isPanningMode"),T=()=>{y.value=!y.value};return(I,E)=>(mi(),Di("button",{onClick:T,class:"absolute top-4 right-4 z-[50] bg-black/70 border border-red-600 shadow p-2 rounded-full text-sm font-semibold hover:border-2 transition"},[(mi(),Aa(um(xn(y)?xn(vh):xn(DS)),{class:"w-5 h-5 text-white"}))]))}},s2={__name:"IntroToggleButton",setup(c){const y=jo("showIntroModal"),T=()=>{y.value=!y.value};return(I,E)=>(mi(),Di("button",{onClick:T,class:"absolute top-16 right-4 z-[50] bg-black/70 border border-red-600 shadow p-2 rounded-full text-sm font-semibold hover:border-2 transition"},[(mi(),Aa(um(xn(y)?xn(vh):xn(RS)),{class:"w-5 h-5 text-white"}))]))}},a2={__name:"App",setup(c){const y=vn(!1),T=vn(!1),I=vn(null),E=vn(!1),z=gh(),P=_h(),o=Qf(),J=Ju(),re=Jf(),H=vn(!1);Np("isPanningMode",H),Np("showIntroModal",T),Ul(()=>J.latestUnlocked,ce=>{ce&&(I.value=ce)});const ie=()=>{o.consumeMaterials(z.selectedKawasan.properties.requirements)&&z.clearSelectedKawasan()};return dh(()=>{const ce=JSON.parse(localStorage.getItem("materials")||"{}"),Y=JSON.parse(localStorage.getItem("ghost")||"{}");((ce.collectedMaterials?.length??0)>0||(Y.caught?.length??0)>0)&&(confirm(`You have previous progress.

Press OK to continue, or Cancel to start a new game.`)||(localStorage.removeItem("materials"),localStorage.removeItem("ghost"),localStorage.removeItem("player"),localStorage.removeItem("layers"),P.$reset(),o.$reset(),J.$reset(),re.$reset(),z.$reset?.()))}),(ce,Y)=>{const le=I1("AchievementModal");return mi(),Di("div",null,[tn(r2),tn(s2),tn(HT,{visible:T.value,onStart:Y[0]||(Y[0]=Xe=>T.value=!1)},null,8,["visible"]),tn(iS),xn(z).selectedKawasan?(mi(),Aa(xI,{key:0,visible:!0,requirements:xn(z).selectedKawasan.properties.requirements,onClose:xn(z).clearSelectedKawasan,onConsume:ie},null,8,["requirements","onClose"])):jn("",!0),tn(CI,{visible:y.value,onClose:Y[1]||(Y[1]=Xe=>y.value=!1)},null,8,["visible"]),tn(WI,{visible:E.value,onClose:Y[2]||(Y[2]=Xe=>E.value=!1)},null,8,["visible"]),I.value?(mi(),Aa(le,{key:1,achievement:I.value,onClose:Y[3]||(Y[3]=Xe=>I.value=null)},null,8,["achievement"])):jn("",!0),tn(ES),tn(n2,{onShowInventory:Y[4]||(Y[4]=Xe=>y.value=!0),onShowJournal:Y[5]||(Y[5]=Xe=>E.value=!0)})])}}},A0=$w(a2),R0=Xw();R0.use(uT);A0.use(R0);A0.mount("#app");
